import{_ as i,c as u,e as o,b as p,d as t,a as n,r,o as k,f as s}from"./app-BIGZvh4f.js";const d={};function m(g,a){const c=r("Tabs");return k(),u("div",null,[a[26]||(a[26]=o(`<h1 id="alibabasentinel" tabindex="-1"><a class="header-anchor" href="#alibabasentinel"><span>AlibabaSentinel</span></a></h1><h2 id="微服务相关知识" tabindex="-1"><a class="header-anchor" href="#微服务相关知识"><span>微服务相关知识</span></a></h2><p><strong>限流</strong>：控制服务在单位时间内处理请求总数。</p><p><strong>熔断</strong>：当下游服务器突然不可用或不稳定时，服务可以自行切断和下游服务的交互，从而保证自身可用。</p><p><strong>流量效果控制</strong>：控制流量以达到某种效果，如控制每毫秒只放行一个请求以达到匀速处理的效果。常见的流量效果控制有匀速通过(排队)、冷启动。</p><p><strong>服务降级</strong>：临时暂停一些不是那么重要的服务，以释放更多的资源给其它服务使用。常见的服务降级实现有：限流降级、熔断降级、开关降级。</p><p><strong>限流降级</strong>：服务A需要依赖服务B完成一次请求。若为服务B配置限流阈值为200QPS，则当一秒内服务B接收请求数超过200个时，超出的请求就会被服务B拒绝。对于超出阈值的流量除直接拒绝外，还可以采取一些策略以处理更多的请求，及流量效果控制。如使用匀速通过方式处理间隔性的突发流量，避免只在第一秒拒绝多余的请求。</p><p><strong>熔断降级</strong>：服务A需要依赖服务B完成一次请求。如果服务A能感知到服务B的状态，在服务B不行的时候不请求服务B，就能避免服务A受到服务B的影响。以一个周期作为计算范围，如果处理请求的异常比达到一定程度，则不再向服务B发起请求。常见的熔断降级策略有：</p><ul><li>每秒请求异常超过多少触发熔断。</li><li>每秒请求异常错误率超过多少触发熔断。</li><li>每秒请求平均耗时超过多少触发熔断。</li></ul><p><strong>开关降级</strong>：服务A需要依赖服务B完成一次请求。服务B在接收到请求时，先看Redis中的开关，如果未开启，则直接拒绝请求。</p><h2 id="sentinel概念" tabindex="-1"><a class="header-anchor" href="#sentinel概念"><span>Sentinel概念</span></a></h2><p><strong>资源</strong>：在Sentinel中，资源是Java程序中的任何内容，只要通过Sentinel API定义的代码，就是资源。</p><p><strong>规则</strong>：围绕资源实时状态设定的规则，可以包括流量控制规则、熔断降级规则，以及系统保护规则。</p><p><strong>资源实时状态</strong>：Sentinel以资源为维度统计的数据，反映了资源的实时状态。这些指标有：每秒请求数、请求平均耗时、每秒异常总数等。</p><h3 id="熔断降级设计理念" tabindex="-1"><a class="header-anchor" href="#熔断降级设计理念"><span>熔断降级设计理念</span></a></h3><p>Hystrix通过线程池的方式实现熔断降级。使用不当，会导致程序创建过多线程资源。</p><p>Hystrix熔断实现介绍：https://github.com/Netflix/Hystrix/wiki/How-it-Works</p><p>Hystrix熔断使用介绍：https://github.com/Netflix/Hystrix/wiki/How-To-Use</p><p>Sentinel堆熔断降级采取了两种手段：</p><ul><li>通过并发线程数进行限制：Sentinel通过限制资源的并发线程数量，来减少不稳定资源对其它资源的影响。当响应时间变长，对资源直接的影响就是线程数量的逐步堆积。当在特定资源的线程数达到一定数量之后，对该资源的新请求就会被拒绝。堆积的线程处理完成后才开始继续接收请求。</li><li>通过响应时间对资源进行降级：当依赖的资源出现响应时间过长后，所有对该资源的访问都被拒绝，直到达到指定的时间窗口之后才重新恢复。</li></ul><h3 id="sentinel工作原理" tabindex="-1"><a class="header-anchor" href="#sentinel工作原理"><span>Sentinel工作原理</span></a></h3><p>Sentinel工作机制如下：</p><ul><li>对主流框架提供适配或者显示的 API，来定义需要保护的资源，并提供设施对资源进行<strong>实时统计和调用链路分析</strong>。</li><li>根据预设的规则，结合对资源的实时统计信息，对流量进行控制。同时，Sentinel 提供开放的接口，方便您定义及改变规则。</li><li>Sentinel提供实时的监控系统，方便快速了解目前系统的状态。</li></ul><p>在<code>Sentinel</code>里面，所有的资源都对应一个资源名称以及一个<code>Entry</code>。<code>Entry</code>可以通过对主流框架的适配自动创建，也可以通过注解的方式或调用API显式创建；每一个<code>Entry</code>创建的时候，同时也会创建一系列功能插槽<code>slot chain</code>。这些插槽有不同的职责，例如：</p><ul><li><code>NodeSelectorSlot</code>：负责收集资源的路径，并将这些资源的调用路径，以树状结构存储起来，用于根据调用路径来限流降级；</li><li><code>ClusterBuilderSlot</code>：负则用于存储资源的统计信息以及调用者信息，例如该资源的<code>RT</code>, <code>QPS</code>, <code>thread count</code>等等，这些信息将用作为多维度限流，降级的依据；</li><li><code>StatisticSlot</code>：则用于记录、统计不同纬度的<code>runtime</code>指标监控信息；</li><li><code>FlowSlot</code>：则用于根据预设的限流规则以及前面<code>slot</code>统计的状态，来进行流量控制；</li><li><code>AuthoritySlot</code>：则根据配置的黑白名单和调用来源信息，来做黑白名单控制；</li><li><code>DegradeSlot</code>：则通过统计信息以及预设的规则，来做熔断降级；</li><li><code>SystemSlot</code>：则通过系统的状态，例如<code>load1</code>等，来控制总的入口流量；</li></ul><figure><img src="http://47.101.155.205/image-20250607181010962.png" alt="image-20250607181010962" tabindex="0" loading="lazy"><figcaption>image-20250607181010962</figcaption></figure><h4 id="spi" tabindex="-1"><a class="header-anchor" href="#spi"><span>SPI</span></a></h4><p>SPI(Service Provider Interface服务提供者接口)是一种服务发现机制，是Java的一个内置标准，可以通过配置实现功能的切换。</p><p>SPI的本质是将接口实现类的全限定名称配置在文件中，由服务加载器读取配置文件，加载实现类并创建实例。使用SPI机制能实现运行时从配置文件中读取接口的实现类并创建实例。</p><figure><img src="http://47.101.155.205/image-20250608154124314.png" alt="SPI机制" tabindex="0" loading="lazy"><figcaption>SPI机制</figcaption></figure><figure><img src="http://47.101.155.205/image-20250608154507690.png" alt="SPI构建插槽链构建器" tabindex="0" loading="lazy"><figcaption>SPI构建插槽链构建器</figcaption></figure><p><strong>可以通过META-INF/services文件配置SlotChainBuilder，ProcessorSlots从而实现自定义控制插槽执行顺序。</strong></p><h3 id="服务治理" tabindex="-1"><a class="header-anchor" href="#服务治理"><span>服务治理</span></a></h3><p>微服务治理：https://opensergo.io/zh-cn/</p><p>流量防护与容错：https://github.com/opensergo/opensergo-specification/blob/main/specification/zh-Hans/fault-tolerance.md</p><h2 id="快速使用" tabindex="-1"><a class="header-anchor" href="#快速使用"><span>快速使用</span></a></h2><p>更多使用demo：https://github.com/alibaba/Sentinel/tree/master/sentinel-demo</p><p><strong>添加核心依赖：</strong></p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.8.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-transport-simple-http<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.8.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>启动应用添加JVM参数-Dcsp.sentinel.dashboard.server=ip:port</strong>，指定控制的ip+端口</p><p><strong>启动日志在\${user_home}/logs/csp/目录下，Windows通常是C:\\Users\\oycm\\用户</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SentinelMain</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 配置规则.</span></span>
<span class="line">        <span class="token function">initFlowRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span> entry <span class="token operator">=</span> <span class="token class-name">SphU</span><span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">&quot;HelloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 被保护的逻辑</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BlockException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 处理被流控的逻辑</span></span>
<span class="line">                <span class="token comment">//System.out.println(&quot;blocked!&quot;);</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initFlowRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FlowRule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">FlowRule</span> rule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlowRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        rule<span class="token punctuation">.</span><span class="token function">setResource</span><span class="token punctuation">(</span><span class="token string">&quot;HelloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        rule<span class="token punctuation">.</span><span class="token function">setGrade</span><span class="token punctuation">(</span><span class="token class-name">RuleConstant</span><span class="token punctuation">.</span><span class="token constant">FLOW_GRADE_QPS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 限制资源每秒执行20次</span></span>
<span class="line">        rule<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">FlowRuleManager</span><span class="token punctuation">.</span><span class="token function">loadRules</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sentinel控制台" tabindex="-1"><a class="header-anchor" href="#sentinel控制台"><span>Sentinel控制台</span></a></h2><p>下载控制台地址：https://github.com/alibaba/Sentinel/releases</p><figure><img src="http://47.101.155.205/image-20250607191655257.png" alt="image-20250607191655257" tabindex="0" loading="lazy"><figcaption>image-20250607191655257</figcaption></figure><h3 id="持久化指标" tabindex="-1"><a class="header-anchor" href="#持久化指标"><span>持久化指标</span></a></h3><p>实现<code>MetricsRepository</code>接口，将<code>Sentinel Dashboard</code>自动注册的<code>InMemoryMetricsRepository</code>改为自定义的资源指标存储器。</p><h2 id="使用文档" tabindex="-1"><a class="header-anchor" href="#使用文档"><span>使用文档</span></a></h2><p>Sentinel可以简单的分为<code>Sentinel 核心库</code>和<code>Dashboard</code>。核心库不依赖Dashboard，但是结合Dashboard可以取得最好的效果。</p><h3 id="基本使用" tabindex="-1"><a class="header-anchor" href="#基本使用"><span>基本使用</span></a></h3><p>使用Sentinel，需要先定义需要保护的资源，再定义配置规则。</p><h4 id="资源" tabindex="-1"><a class="header-anchor" href="#资源"><span>资源</span></a></h4><p>定义资源的方式：</p><ol><li>抛出异常的方式定义资源：</li><li>返回布尔值方式定义资源</li><li>注解方式定义资源：https://github.com/alibaba/Sentinel/tree/master/sentinel-demo/sentinel-demo-annotation-spring-aop</li><li>异步调用支持：https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/AsyncEntryDemo.java</li></ol>`,54)),p(c,{id:"248",data:[{id:"1.抛出异常的方式定义"},{id:"2.返回布尔值方式"},{id:"3.注解方式定义"},{id:"4.异步调用支持"}]},{title0:t(({value:e,isActive:l})=>a[0]||(a[0]=[s("1.抛出异常的方式定义")])),title1:t(({value:e,isActive:l})=>a[1]||(a[1]=[s("2.返回布尔值方式")])),title2:t(({value:e,isActive:l})=>a[2]||(a[2]=[s("3.注解方式定义")])),title3:t(({value:e,isActive:l})=>a[3]||(a[3]=[s("4.异步调用支持")])),tab0:t(({value:e,isActive:l})=>a[4]||(a[4]=[n("p",null,[n("strong",null,"注意1"),s("："),n("code",null,"SphU.entry(xxx)"),s("需要与"),n("code",null,"entry.exit()"),s("方法成对出现，匹配调用，否则会导致调用链记录异常，抛出 "),n("code",null,"ErrorEntryFreeException"),s("异常。")],-1),n("p",null,[n("strong",null,"注意2"),s("：由于"),n("code",null,"try-with-resources"),s("语法中"),n("code",null,"catch"),s("调用顺序的问题("),n("strong",null,"可能是资源关闭在catch之前"),s(")，会导致无法正确统计异常数，因此统计异常信息时也不能在"),n("code",null,"try-with-resources"),s("的"),n("code",null,"catch"),s("块中调用"),n("code",null,"Tracer.trace(ex)"),s("。")],-1),n("figure",null,[n("img",{src:"http://47.101.155.205/image-20250612211715983.png",alt:"image-20250612211715983",tabindex:"0",loading:"lazy"}),n("figcaption",null,"image-20250612211715983")],-1),n("div",{class:"language-java line-numbers-mode","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token comment"},"// try-with-resources 特性")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Entry"),s(" entry "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"SphU"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"entry"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"resourceName"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token comment"},"// 被保护的业务逻辑")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token comment"},"// do something here...")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"catch"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"BlockException"),s(" ex"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 限流之后会抛出 BlockException")]),s(`
`),n("span",{class:"line"},[s("  	"),n("span",{class:"token comment"},"// 资源访问阻止，被限流或被降级")]),s(`
`),n("span",{class:"line"},[s("  	"),n("span",{class:"token comment"},"// 在此处进行相应的处理操作")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,null,-1)])),tab1:t(({value:e,isActive:l})=>a[5]||(a[5]=[n("div",{class:"language-java line-numbers-mode","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"SphO"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"entry"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"自定义资源名"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 务必保证finally会被执行")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("      "),n("span",{class:"token doc-comment comment"},"/**"),s(`
`),n("span",{class:"line"},"      * 被保护的业务逻辑"),s(`
`),n("span",{class:"line"},"      */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"finally"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token class-name"},"SphO"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 资源访问阻止，被限流或被降级")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 进行相应的处理操作")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,null,-1)])),tab2:t(({value:e,isActive:l})=>a[6]||(a[6]=[n("p",null,"添加依赖：",-1),n("div",{class:"language-xml","data-highlighter":"prismjs","data-ext":"xml","data-title":"xml"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s("com.alibaba.csp"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("groupId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s("sentinel-annotation-aspectj"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("artifactId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("version")]),n("span",{class:"token punctuation"},">")]),s("version"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("version")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("div",{class:"language-java line-numbers-mode","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token comment"},"// blockHandler 和 fallback 配置限流后的处理")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token annotation punctuation"},"@SentinelResource"),n("span",{class:"token punctuation"},"("),s("blockHandler "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"blockHandlerForGetUser"'),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"User"),s(),n("span",{class:"token function"},"getUserById"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),s(" id"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"throw"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"RuntimeException"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"getUserById command failed"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// 原方法调用被 限流/降级/系统保护 的时候调用")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"User"),s(),n("span",{class:"token function"},"blockHandlerForGetUser"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),s(" id"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"BlockException"),s(" ex"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"User"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"admin"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,"@SentinelResource属性介绍：",-1),n("ul",null,[n("li",null,[n("code",null,"value"),s("：资源名称，必需项（不能为空）。")]),n("li",null,[n("code",null,"entryType"),s("：entry类型，可选项（默认为 "),n("code",null,"EntryType.OUT"),s("）。")]),n("li",null,[n("code",null,"blockHandler"),s(" / "),n("code",null,"blockHandlerClass"),s(": "),n("code",null,"blockHandler"),s("对应处理"),n("code",null,"BlockException"),s("的方法名称，可选项。"),n("code",null,"blockHandler"),s("方法访问范围需要是"),n("code",null,"public"),s("，返回类型需要与原方法相匹配，参数类型需要和原方法相匹配并且最后加一个额外的参数，类型为"),n("code",null,"BlockException"),s("。"),n("code",null,"blockHandler"),s("方法默认需要和原方法在同一个类中。若希望使用其他类的方法，则可以指定 "),n("code",null,"blockHandlerClass"),s(" 为对应的类的 "),n("code",null,"Class"),s(" 对象，注意对应的方法必需为"),n("code",null,"static"),s("方法，否则无法解析。")]),n("li",null,[n("code",null,"fallback"),s("：fallback方法名称，可选项，用于在抛出异常的时候提供"),n("code",null,"fallback"),s("处理逻辑。"),n("code",null,"fallback"),s("方法可以针对所有类型的异常（除了"),n("code",null,"exceptionsToIgnore"),s("里面排除掉的异常类型）进行处理。"),n("code",null,"fallback"),s("方法签名和位置要求： "),n("ul",null,[n("li",null,"返回值类型必须与原方法返回值类型一致；"),n("li",null,[s("方法参数列表需要和原方法一致，或者可以额外多一个 "),n("code",null,"Throwable"),s(" 类型的参数用于接收对应的异常。")]),n("li",null,[n("code",null,"fallback"),s("方法默认需要和原方法在同一个类中。若希望使用其他类的方法，则可以指定 "),n("code",null,"fallbackClass"),s("为对应的类的"),n("code",null,"Class"),s("对象，注意对应的方法必需为"),n("code",null,"static"),s("方法，否则无法解析。")])])]),n("li",null,[n("code",null,"defaultFallback"),s("(since 1.6.0)：默认的"),n("code",null,"fallback"),s("方法名称，可选项，通常用于通用的"),n("code",null,"fallback"),s("逻辑（即可以用于很多服务或方法）。若同时配置了"),n("code",null,"fallback"),s("和"),n("code",null,"defaultFallback"),s("，则只有"),n("code",null,"fallback"),s("会生效。`defaultFallback方法签名要求： "),n("ul",null,[n("li",null,"返回值类型必须与原方法返回值类型一致；"),n("li",null,[s("方法参数列表需要为空，或者可以额外多一个 "),n("code",null,"Throwable"),s(" 类型的参数用于接收对应的异常。")]),n("li",null,[n("code",null,"defaultFallback"),s("方法默认需要和原方法在同一个类中。若希望使用其他类的方法，则可以指定 "),n("code",null,"fallbackClass"),s("为对应的类的"),n("code",null,"Class"),s("对象，注意对应的方法必需为"),n("code",null,"static"),s("方法，否则无法解析。")])])]),n("li",null,[n("code",null,"exceptionsToIgnore"),s("(since 1.6.0)：用于指定哪些异常被排除掉，不会计入异常统计中，也不会进入 "),n("code",null,"fallback"),s("逻辑中，而是会原样抛出。")])],-1),n("p",null,[n("strong",null,"注意"),s("：若"),n("code",null,"blockHandler"),s("和"),n("code",null,"fallback"),s("都进行了配置，则被限流降级而抛出"),n("code",null,"BlockException"),s("时只会进入 "),n("code",null,"blockHandler"),s("处理逻辑。若未配置"),n("code",null,"blockHandler"),s("、"),n("code",null,"fallback"),s("和"),n("code",null,"defaultFallback"),s("，则被限流降级时会将 "),n("code",null,"BlockException"),n("strong",null,"直接抛出"),s("。")],-1),n("p",null,[n("strong",null,[s("AspectJ AOP代理使用方式：在 "),n("code",null,"aop.xml"),s(" 文件中引入对应的 Aspect")])],-1),n("div",{class:"language-xml","data-highlighter":"prismjs","data-ext":"xml","data-title":"xml"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("aspects")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("aspect")]),s(),n("span",{class:"token attr-name"},"name"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("com.alibaba.csp.sentinel.annotation.aspectj.SentinelResourceAspect"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},"/>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("aspects")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,[n("strong",null,"Spring AOP处理方式：注册SentinelResourceAspect Bean")],-1),n("div",{class:"language-java","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token annotation punctuation"},"@Configuration")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"SentinelAspectConfiguration"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token annotation punctuation"},"@Bean")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"SentinelResourceAspect"),s(),n("span",{class:"token function"},"sentinelResourceAspect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"SentinelResourceAspect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,null,-1)])),tab3:t(({value:e,isActive:l})=>a[7]||(a[7]=[n("div",{class:"language-java line-numbers-mode","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token class-name"},"AsyncEntry"),s(" entry "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"SphU"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"asyncEntry"),n("span",{class:"token punctuation"},"("),s("resourceName"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 异步调用.")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"doAsync"),n("span",{class:"token punctuation"},"("),s("userId"),n("span",{class:"token punctuation"},","),s(" result "),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token comment"},"// 在此处处理异步调用的结果")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"finally"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token comment"},"//异步的回调函数中调用 exit")]),s(`
`),n("span",{class:"line"},[s("            entry"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"catch"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"BlockException"),s(" ex"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// Request blocked.")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// Handle the exception (e.g. retry or fallback).")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,null,-1)])),_:1}),a[27]||(a[27]=o('<h4 id="规则" tabindex="-1"><a class="header-anchor" href="#规则"><span>规则</span></a></h4><p>规则的种类：</p><ol><li>流量控制规则(<code>FlowRule</code>)：</li><li>熔断降级规则<code>DegradeRule</code>：https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/degrade/SlowRatioCircuitBreakerDemo.java</li><li>系统保护规则(<code>SystemRule</code>)：https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/system/SystemGuardDemo.java</li><li>来源访问控制规则(<code>AuthorityRule</code>)：https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/authority/AuthorityDemo.java</li><li>热点参数规则(<code>ParamFlowRule</code>)：https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-parameter-flow-control/src/main/java/com/alibaba/csp/sentinel/demo/flow/param/ParamFlowQpsDemo.java</li></ol>',3)),p(c,{id:"400",data:[{id:"1.流量控制规则(<code v-pre>FlowRule</code>)"},{id:"2.熔断降级规则(<code v-pre>DegradeRule</code>)"},{id:"3.系统保护规则(<code v-pre>SystemRule</code>)"},{id:"4.访问控制规则"},{id:"5.热点规则"}]},{title0:t(({value:e,isActive:l})=>a[8]||(a[8]=[s("1.流量控制规则("),n("code",null,"FlowRule",-1),s(")")])),title1:t(({value:e,isActive:l})=>a[9]||(a[9]=[s("2.熔断降级规则("),n("code",null,"DegradeRule",-1),s(")")])),title2:t(({value:e,isActive:l})=>a[10]||(a[10]=[s("3.系统保护规则("),n("code",null,"SystemRule",-1),s(")")])),title3:t(({value:e,isActive:l})=>a[11]||(a[11]=[s("4.访问控制规则")])),title4:t(({value:e,isActive:l})=>a[12]||(a[12]=[s("5.热点规则")])),tab0:t(({value:e,isActive:l})=>a[13]||(a[13]=[n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"center"}},"Field"),n("th",{style:{"text-align":"left"}},"说明"),n("th",{style:{"text-align":"left"}},"默认值")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"center"}},"resource"),n("td",{style:{"text-align":"left"}},"资源名，资源名是限流规则的作用对象"),n("td",{style:{"text-align":"left"}})]),n("tr",null,[n("td",{style:{"text-align":"center"}},"count"),n("td",{style:{"text-align":"left"}},"限流阈值"),n("td",{style:{"text-align":"left"}})]),n("tr",null,[n("td",{style:{"text-align":"center"}},"grade"),n("td",{style:{"text-align":"left"}},"限流阈值类型，QPS或线程数模式"),n("td",{style:{"text-align":"left"}},"QPS模式")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"limitApp"),n("td",{style:{"text-align":"left"}},"流控针对的调用来源"),n("td",{style:{"text-align":"left"}},[n("code",null,"default"),s("，代表不区分调用来源")])]),n("tr",null,[n("td",{style:{"text-align":"center"}},"strategy"),n("td",{style:{"text-align":"left"}},"调用关系限流策略：直接、链路、关联"),n("td",{style:{"text-align":"left"}},"根据资源本身（直接）")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"controlBehavior"),n("td",{style:{"text-align":"left"}},"流控效果（直接拒绝 / 排队等待 / 慢启动模式），不支持按调用关系限流"),n("td",{style:{"text-align":"left"}},"直接拒绝")])])],-1),n("div",{class:"language-java line-numbers-mode","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initFlowQpsRule"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token class-name"},"List"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},">")]),s(" rules "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ArrayList"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token class-name"},"FlowRule"),s(" rule1 "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    rule1"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setResource"),n("span",{class:"token punctuation"},"("),s("resource"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    rule1"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setCount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"20"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    rule1"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setGrade"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"RuleConstant"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"FLOW_GRADE_QPS"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    rule1"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setLimitApp"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"default"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    rules"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),s("rule1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 配置规则生效")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token class-name"},"FlowRuleManager"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"loadRules"),n("span",{class:"token punctuation"},"("),s("rules"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,null,-1)])),tab1:t(({value:e,isActive:l})=>a[14]||(a[14]=[n("p",null,"同一个资源可以同时有多个降级规则。",-1),n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"center"}},"Field"),n("th",{style:{"text-align":"left"}},"说明"),n("th",{style:{"text-align":"left"}},"默认值")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"center"}},"resource"),n("td",{style:{"text-align":"left"}},"资源名，即规则的作用对象"),n("td",{style:{"text-align":"left"}})]),n("tr",null,[n("td",{style:{"text-align":"center"}},"grade"),n("td",{style:{"text-align":"left"}},"熔断策略，支持慢调用比例/异常比例/异常数策略"),n("td",{style:{"text-align":"left"}},"慢调用比例")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"count"),n("td",{style:{"text-align":"left"}},"慢调用比例模式下为慢调用临界 RT（超出该值计为慢调用）；异常比例/异常数模式下为对应的阈值"),n("td",{style:{"text-align":"left"}})]),n("tr",null,[n("td",{style:{"text-align":"center"}},"timeWindow"),n("td",{style:{"text-align":"left"}},"熔断时长，单位为 s"),n("td",{style:{"text-align":"left"}})]),n("tr",null,[n("td",{style:{"text-align":"center"}},"minRequestAmount"),n("td",{style:{"text-align":"left"}},"熔断触发的最小请求数，请求数小于该值时即使异常比率超出阈值也不会熔断（1.7.0引入）"),n("td",{style:{"text-align":"left"}},"5")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"statIntervalMs"),n("td",{style:{"text-align":"left"}},"统计时长（单位为 ms），如 60*1000 代表分钟级（1.8.0引入）"),n("td",{style:{"text-align":"left"}},"1000 ms")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"slowRatioThreshold"),n("td",{style:{"text-align":"left"}},"慢调用比例阈值，仅慢调用比例模式有效（1.8.0引入）"),n("td",{style:{"text-align":"left"}})])])],-1),n("div",{class:"language-java line-numbers-mode","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initDegradeRule"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token class-name"},"List"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"DegradeRule"),n("span",{class:"token punctuation"},">")]),s(" rules "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ArrayList"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token class-name"},"DegradeRule"),s(" rule "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"DegradeRule"),n("span",{class:"token punctuation"},"("),s("resource"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setGrade"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"CircuitBreakerStrategy"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"ERROR_RATIO"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getType"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setCount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0.7"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// Threshold is 70% error ratio")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setMinRequestAmount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"100"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setStatIntervalMs"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"30000"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 30s")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setTimeWindow"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    rules"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),s("rule"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token class-name"},"DegradeRuleManager"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"loadRules"),n("span",{class:"token punctuation"},"("),s("rules"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,null,-1)])),tab2:t(({value:e,isActive:l})=>a[15]||(a[15]=[n("p",null,"Sentinel系统自适应限流从整体维度对应用入口流量进行控制，结合应用的Load、CPU 使用率、总体平均RT、入口QPS和并发线程数等几个维度的监控指标，通过自适应的流控策略，让系统的入口流量和系统的负载达到一个平衡，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性。",-1),n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"center"}},"Field"),n("th",{style:{"text-align":"left"}},"说明"),n("th",{style:{"text-align":"left"}},"默认值")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"center"}},"highestSystemLoad"),n("td",{style:{"text-align":"left"}},[n("code",null,"load1"),s(" 触发值，用于触发自适应控制阶段")]),n("td",{style:{"text-align":"left"}},"-1 (不生效)")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"avgRt"),n("td",{style:{"text-align":"left"}},"所有入口流量的平均响应时间"),n("td",{style:{"text-align":"left"}},"-1 (不生效)")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"maxThread"),n("td",{style:{"text-align":"left"}},"入口流量的最大并发数"),n("td",{style:{"text-align":"left"}},"-1 (不生效)")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"qps"),n("td",{style:{"text-align":"left"}},"所有入口资源的 QPS"),n("td",{style:{"text-align":"left"}},"-1 (不生效)")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"highestCpuUsage"),n("td",{style:{"text-align":"left"}},"当前系统的 CPU 使用率（0.0-1.0）"),n("td",{style:{"text-align":"left"}},"-1 (不生效)")])])],-1),n("div",{class:"language-java","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initSystemProtectionRule"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token class-name"},"List"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"SystemRule"),n("span",{class:"token punctuation"},">")]),s(" rules "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ArrayList"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token class-name"},"SystemRule"),s(" rule "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"SystemRule"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  rule"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setHighestSystemLoad"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  rules"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),s("rule"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token class-name"},"SystemRuleManager"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"loadRules"),n("span",{class:"token punctuation"},"("),s("rules"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,null,-1)])),tab3:t(({value:e,isActive:l})=>a[16]||(a[16]=[n("p",null,[s("Sentinel的访问控制（黑白名单）的功能。黑白名单根据资源的请求来源()"),n("code",null,"origin"),s(")限制资源是否通过，若配置白名单则只有请求来源位于白名单内时才可通过；若配置黑名单则请求来源位于黑名单时不通过，其余的请求通过。")],-1),n("p",null,[n("strong",null,[s("调用方信息通过"),n("code",null,"ContextUtil.enter(resourceName, origin)"),s("方法中的origin参数传入。")])],-1),n("p",null,[n("code",null,"AuthorityRule"),s("配置项：")],-1),n("ul",null,[n("li",null,[n("code",null,"resource"),s("：资源名，即限流规则的作用对象；")]),n("li",null,[n("code",null,"limitApp"),s("：对应的黑名单/白名单来源 , 分隔，如 appA,appB")]),n("li",null,[n("code",null,"strategy"),s("：限制模式，"),n("code",null,"AUTHORITY_WHITE"),s("为白名单模式，"),n("code",null,"AUTHORITY_BLACK"),s("为黑名单模式，默认为白名单模式。")])],-1),n("div",{class:"language-java","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token class-name"},"AuthorityRule"),s(" rule "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"AuthorityRule"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("rule"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setResource"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"test"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("rule"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setStrategy"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"RuleConstant"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"AUTHORITY_WHITE"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// 来源为 appA 和 appB 的请求才能通过")]),s(`
`),n("span",{class:"line"},[s("rule"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setLimitApp"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"appA,appB"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"AuthorityRuleManager"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"loadRules"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Collections"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"singletonList"),n("span",{class:"token punctuation"},"("),s("rule"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,null,-1)])),tab4:t(({value:e,isActive:l})=>a[17]||(a[17]=[n("p",null,[n("strong",null,"热点参数限流"),s("：热点即经常访问的数据。很多时候我们希望统计某个热点数据中访问频次最高的"),n("code",null,"Top K"),s("数据，并对其访问进行限制。")],-1),n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"center"}},"Field"),n("th",{style:{"text-align":"left"}},"说明"),n("th",{style:{"text-align":"left"}},"默认值")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"center"}},"resource"),n("td",{style:{"text-align":"left"}},"资源名，必填"),n("td",{style:{"text-align":"left"}})]),n("tr",null,[n("td",{style:{"text-align":"center"}},"count"),n("td",{style:{"text-align":"left"}},"限流阈值，必填"),n("td",{style:{"text-align":"left"}})]),n("tr",null,[n("td",{style:{"text-align":"center"}},"grade"),n("td",{style:{"text-align":"left"}},"限流模式"),n("td",{style:{"text-align":"left"}},"QPS")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"durationInSec"),n("td",{style:{"text-align":"left"}},"统计窗口时间长度（单位为秒），1.6.0 版本开始支持"),n("td",{style:{"text-align":"left"}},"1s")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"controlBehavior"),n("td",{style:{"text-align":"left"}},"流控效果（支持快速失败和匀速排队模式），1.6.0 版本开始支持"),n("td",{style:{"text-align":"left"}},"快速失败")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"maxQueueingTimeMs"),n("td",{style:{"text-align":"left"}},"最大排队等待时长（仅在匀速排队模式生效），1.6.0 版本开始支持"),n("td",{style:{"text-align":"left"}},"0ms")]),n("tr",null,[n("td",{style:{"text-align":"center"}},"paramIdx"),n("td",{style:{"text-align":"left"}},[s("热点参数的索引，必填，对应 "),n("code",null,"SphU.entry(xxx, args)"),s(" 中的参数索引位置")]),n("td",{style:{"text-align":"left"}})]),n("tr",null,[n("td",{style:{"text-align":"center"}},"paramFlowItemList"),n("td",{style:{"text-align":"left"}},[s("参数例外项，可以针对指定的参数值单独设置限流阈值，不受前面 "),n("code",null,"count"),s(" 阈值的限制。"),n("strong",null,"仅支持基本类型和字符串类型")]),n("td",{style:{"text-align":"left"}})]),n("tr",null,[n("td",{style:{"text-align":"center"}},"clusterMode"),n("td",{style:{"text-align":"left"}},"是否是集群参数流控规则"),n("td",{style:{"text-align":"left"}},[n("code",null,"false")])]),n("tr",null,[n("td",{style:{"text-align":"center"}},"clusterConfig"),n("td",{style:{"text-align":"left"}},"集群流控相关配置"),n("td",{style:{"text-align":"left"}})])])],-1),n("p",null,[n("strong",null,"ParamFlowRuleManager配置热点参数规则：")],-1),n("div",{class:"language-java line-numbers-mode","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token class-name"},"ParamFlowRule"),s(" rule "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ParamFlowRule"),n("span",{class:"token punctuation"},"("),s("resourceName"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setParamIdx"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setCount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// 针对 int 类型的参数 PARAM_B，单独设置限流 QPS 阈值为 10，而不是全局的阈值 5.")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"ParamFlowItem"),s(" item "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ParamFlowItem"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setObject"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"valueOf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"PARAM_B"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setClassType"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"int"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getName"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setCount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("rule"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setParamFlowItemList"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Collections"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"singletonList"),n("span",{class:"token punctuation"},"("),s("item"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"ParamFlowRuleManager"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"loadRules"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Collections"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"singletonList"),n("span",{class:"token punctuation"},"("),s("rule"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,"需要添加依赖：",-1),n("div",{class:"language-xml","data-highlighter":"prismjs","data-ext":"xml","data-title":"xml"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s("com.alibaba.csp"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("groupId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s("sentinel-parameter-flow-control"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("artifactId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("version")]),n("span",{class:"token punctuation"},">")]),s("version"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("version")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,[n("strong",null,"通过entry重载方法传入热点参数：")],-1),n("div",{class:"language-java","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token class-name"},"Entry"),s(),n("span",{class:"token function"},"entry"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),s(" name"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"EntryType"),s(" type"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"int"),s(" count"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Object"),n("span",{class:"token punctuation"},"."),n("span",{class:"token punctuation"},"."),n("span",{class:"token punctuation"},"."),s(" args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"BlockException"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token class-name"},"Entry"),s(),n("span",{class:"token function"},"entry"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Method"),s(" method"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"EntryType"),s(" type"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"int"),s(" count"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Object"),n("span",{class:"token punctuation"},"."),n("span",{class:"token punctuation"},"."),n("span",{class:"token punctuation"},"."),s(" args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"BlockException"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"SphU"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"entry"),n("span",{class:"token punctuation"},"("),s("resourceName"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"EntryType"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"IN"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(" paramA"),n("span",{class:"token punctuation"},","),s(" paramB"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,[n("strong",null,[s("若"),n("code",null,"entry"),s("的时候传入了热点参数，那么"),n("code",null,"exit"),s("的时候也一定要带上对应的参数：")])],-1),n("div",{class:"language-java line-numbers-mode","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token class-name"},"Entry"),s(" entry "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    entry "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"SphU"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"entry"),n("span",{class:"token punctuation"},"("),s("resourceName"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"EntryType"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"IN"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(" paramA"),n("span",{class:"token punctuation"},","),s(" paramB"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// Your logic here.")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"catch"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"BlockException"),s(" ex"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// Handle request rejection.")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"finally"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("entry "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        entry"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(" paramA"),n("span",{class:"token punctuation"},","),s(" paramB"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,[n("strong",null,"注解使用：若注解作用的方法上有参数，则将方法作为参数传入entry")],-1),n("div",{class:"language-java","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token annotation punctuation"},"@SentinelResource"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"myMethod"'),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"Result"),s(),n("span",{class:"token function"},"doSomething"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),s(" uid"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"int"),s(" type"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token comment"},"// some logic here...")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,null,-1)])),_:1}),a[28]||(a[28]=o(`<h4 id="查看规则" tabindex="-1"><a class="header-anchor" href="#查看规则"><span>查看规则</span></a></h4><p>添加<code>transport</code>模块后，可以通过HTTP API获取已加载的规则：</p><div class="language-markdown" data-highlighter="prismjs" data-ext="md" data-title="md"><pre><code><span class="line">http://localhost:8719/getRules?type=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">type=flow 以JSON格式返回现有的限流规则</span>
<span class="line">degrade 返回现有生效的降级规则列表</span>
<span class="line">system 则返回系统保护规则</span>
<span class="line"></span>
<span class="line">获取所有热点规则，也可以添加type参数</span>
<span class="line">http://localhost:8719/getParamRules</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="集群限流配置" tabindex="-1"><a class="header-anchor" href="#集群限流配置"><span>集群限流配置</span></a></h3><h3 id="网关流量控制" tabindex="-1"><a class="header-anchor" href="#网关流量控制"><span>网关流量控制</span></a></h3><h2 id="开源框架适配" tabindex="-1"><a class="header-anchor" href="#开源框架适配"><span>开源框架适配</span></a></h2><p>https://sentinelguard.io/zh-cn/docs/open-source-framework-integrations.html</p><h2 id="动态配置规则" tabindex="-1"><a class="header-anchor" href="#动态配置规则"><span>动态配置规则</span></a></h2><p>Sentinel的理念是<strong>开发者只需要关注资源的定义</strong>，当资源定义成功后可以动态增加各种流控降级规则。</p><p>Sentinel 提供两种方式修改规则：</p><ul><li>通过 API 直接修改 loadRules；</li><li>通过 <code>DataSource</code> 适配不同数据源修改</li></ul><h3 id="datasource扩展" tabindex="-1"><a class="header-anchor" href="#datasource扩展"><span>DataSource扩展</span></a></h3><p>Sentinel推荐<strong>通过控制台设置规则后将规则推送到统一的规则中心，客户端实现</strong> <code>ReadableDataSource</code> <strong>接口端监听规则中心实时获取变更</strong>，流程如下：</p><figure><img src="http://47.101.155.205/image-20250608172737967.png" alt="image-20250608172737967" tabindex="0" loading="lazy"><figcaption>image-20250608172737967</figcaption></figure><p><code>DataSource</code>扩展常见的实现方式有:</p><ul><li><p><strong>拉模式</strong>：客户端主动向某个规则管理中心定期轮询拉取规则，这个规则中心可以是RDBMS、文件，甚至是 VCS等。这样做的方式是简单，缺点是无法及时获取变更。支持的数据源：动态文件数据源、Consul、 Eureka。</p></li><li><p><strong>推模式</strong>：规则中心统一推送，客户端通过注册监听器的方式时刻监听变化，比如使用<code>Nacos</code>、<code>Zookeeper</code>等配置中心。这种方式有更好的实时性和一致性保证。ZooKeeper, Redis, Nacos, Apollo, etcd</p></li><li><p><strong>拉模式扩展</strong>：继承<code>AutoRefreshDataSource</code>抽象类，然后实现<code>readSource()</code>方法，在该方法里从指定数据源读取字符串格式的配置数据。如<a href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-dynamic-file-rule/src/main/java/com/alibaba/csp/sentinel/demo/file/rule/FileDataSourceDemo.java" target="_blank" rel="noopener noreferrer">基于文件的数据源</a>。</p></li><li><p><strong>推模式扩展</strong>：继承<code>AbstractDataSource</code>抽象类，在其构造方法中添加监听器，并实现<code>readSource()</code>从指定数据源读取字符串格式的配置数据。如<a href="https://github.com/alibaba/Sentinel/blob/master/sentinel-extension/sentinel-datasource-nacos/src/main/java/com/alibaba/csp/sentinel/datasource/nacos/NacosDataSource.java" target="_blank" rel="noopener noreferrer">基于Nacos的数据源</a>。</p></li></ul><h4 id="拉模式" tabindex="-1"><a class="header-anchor" href="#拉模式"><span>拉模式</span></a></h4>`,17)),p(c,{id:"939",data:[{id:"文件模式"}]},{title0:t(({value:e,isActive:l})=>a[18]||(a[18]=[s("文件模式")])),tab0:t(({value:e,isActive:l})=>a[19]||(a[19]=[n("p",null,"添加依赖：",-1),n("div",{class:"language-xml","data-highlighter":"prismjs","data-ext":"xml","data-title":"xml"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s("com.alibaba.csp"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("groupId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s("sentinel-datasource-extension"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("artifactId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("version")]),n("span",{class:"token punctuation"},">")]),s("version"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("version")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,[n("code",null,"FileRefreshableDataSource"),s("会周期性的读取文件以获取规则，当文件有更新时会及时发现，并将规则更新到内存中。")],-1),n("p",null,[n("strong",null,"注意idea启动修改target目录下的文件。或者调整加载指定位置文件")],-1),n("div",{class:"language-java line-numbers-mode","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"FileDataSourceDemo"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),s(" args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"Exception"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token class-name"},"FileDataSourceDemo"),s(" demo "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"FileDataSourceDemo"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        demo"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"listenRules"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},"        "),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token class-name"},"FlowQpsRunner"),s(" runner "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"FlowQpsRunner"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        runner"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"simulateTraffic"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        runner"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"tick"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"listenRules"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"Exception"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token class-name"},"ClassLoader"),s(" classLoader "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"getClass"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getClassLoader"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 加载文件配置资源 注意idea启动修改target目录下的文件。或者调整加载指定位置文件")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token class-name"},"String"),s(" flowRulePath "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"URLDecoder"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"decode"),n("span",{class:"token punctuation"},"("),s("classLoader"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getResource"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"FlowRule.json"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getFile"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'"UTF-8"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token class-name"},"FileRefreshableDataSource"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"List"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),s(" flowRuleDataSource "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"FileRefreshableDataSource"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),s("flowRulePath"),n("span",{class:"token punctuation"},","),s(" flowRuleListParser"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token class-name"},"FlowRuleManager"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"register2Property"),n("span",{class:"token punctuation"},"("),s("flowRuleDataSource"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getProperty"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token class-name"},"Converter"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"List"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),s(" flowRuleListParser "),n("span",{class:"token operator"},"="),s(" source "),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token constant"},"JSON"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"parseObject"),n("span",{class:"token punctuation"},"("),s("source"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"TypeReference"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"List"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,[n("strong",null,"FlowRule.json文件内容：")],-1),n("div",{class:"language-json line-numbers-mode","data-highlighter":"prismjs","data-ext":"json","data-title":"json"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token punctuation"},"[")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"resource"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},'"abc"'),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"controlBehavior"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"count"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"10.0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"grade"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"limitApp"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},'"default"'),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"strategy"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"0")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"resource"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},'"abc1"'),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"controlBehavior"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"count"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"20.0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"grade"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"limitApp"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},'"default"'),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token property"},'"strategy"'),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"0")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"]")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),n("p",null,null,-1)])),_:1}),a[29]||(a[29]=n("h4",{id:"推模式",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#推模式"},[n("span",null,"推模式")])],-1)),p(c,{id:"964",data:[{id:"Nacos"},{id:"ZooKeeper"},{id:"Apollo"}]},{title0:t(({value:e,isActive:l})=>a[20]||(a[20]=[s("Nacos")])),title1:t(({value:e,isActive:l})=>a[21]||(a[21]=[s("ZooKeeper")])),title2:t(({value:e,isActive:l})=>a[22]||(a[22]=[s("Apollo")])),tab0:t(({value:e,isActive:l})=>a[23]||(a[23]=[n("p",null,"https://github.com/alibaba/Sentinel/tree/master/sentinel-demo/sentinel-demo-nacos-datasource",-1),n("div",{class:"language-xml","data-highlighter":"prismjs","data-ext":"xml","data-title":"xml"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s("com.alibaba.csp"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("groupId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s("sentinel-datasource-nacos"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("artifactId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("version")]),n("span",{class:"token punctuation"},">")]),s("version"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("version")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,[s("创建"),n("code",null,"NacosDataSource"),s("并将其注册至对应的"),n("code",null,"RuleManager"),s("。")],-1),n("div",{class:"language-java","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token comment"},"// remoteAddress 代表 Nacos 服务端的地址")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// groupId 和 dataId 对应 Nacos 中相应配置")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"ReadableDataSource"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"List"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),s(" flowRuleDataSource "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"NacosDataSource"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),s("remoteAddress"),n("span",{class:"token punctuation"},","),s(" groupId"),n("span",{class:"token punctuation"},","),s(" dataId"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    source "),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token constant"},"JSON"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"parseObject"),n("span",{class:"token punctuation"},"("),s("source"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"TypeReference"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"List"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"FlowRuleManager"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"register2Property"),n("span",{class:"token punctuation"},"("),s("flowRuleDataSource"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getProperty"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,null,-1)])),tab1:t(({value:e,isActive:l})=>a[24]||(a[24]=[n("p",null,"https://github.com/alibaba/Sentinel/tree/master/sentinel-demo/sentinel-demo-zookeeper-datasource",-1),n("div",{class:"language-xml","data-highlighter":"prismjs","data-ext":"xml","data-title":"xml"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s("com.alibaba.csp"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("groupId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s("sentinel-datasource-zookeeper"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("artifactId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("version")]),n("span",{class:"token punctuation"},">")]),s("version"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("version")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,[s("创建"),n("code",null,"ZookeeperDataSource"),s("并将其注册至对应的"),n("code",null,"RuleManager")],-1),n("div",{class:"language-java","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token comment"},"// remoteAddress 代表 ZooKeeper 服务端的地址")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// path 对应 ZK 中的数据路径")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"ReadableDataSource"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"List"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),s(" flowRuleDataSource "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ZookeeperDataSource"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),s("remoteAddress"),n("span",{class:"token punctuation"},","),s(" path"),n("span",{class:"token punctuation"},","),s(" source "),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token constant"},"JSON"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"parseObject"),n("span",{class:"token punctuation"},"("),s("source"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"TypeReference"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"List"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"FlowRuleManager"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"register2Property"),n("span",{class:"token punctuation"},"("),s("flowRuleDataSource"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getProperty"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,null,-1)])),tab2:t(({value:e,isActive:l})=>a[25]||(a[25]=[n("p",null,"https://github.com/alibaba/Sentinel/tree/master/sentinel-demo/sentinel-demo-apollo-datasource",-1),n("div",{class:"language-xml","data-highlighter":"prismjs","data-ext":"xml","data-title":"xml"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("groupId")]),n("span",{class:"token punctuation"},">")]),s("com.alibaba.csp"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("groupId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("artifactId")]),n("span",{class:"token punctuation"},">")]),s("sentinel-datasource-apollo"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("artifactId")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("version")]),n("span",{class:"token punctuation"},">")]),s("version"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("version")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("dependency")]),n("span",{class:"token punctuation"},">")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,[s("创建"),n("code",null,"ApolloDataSource"),s("并将其注册至对应的"),n("code",null,"RuleManager")],-1),n("div",{class:"language-java","data-highlighter":"prismjs","data-ext":"java","data-title":"java"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token comment"},"// namespaceName 对应 Apollo 的命名空间名称")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// ruleKey 对应规则存储的 key")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// defaultRules 对应连接不上 Apollo 时的默认规则")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"ReadableDataSource"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"List"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),s(" flowRuleDataSource "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ApolloDataSource"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),s("namespaceName"),n("span",{class:"token punctuation"},","),s(" ruleKey"),n("span",{class:"token punctuation"},","),s(" defaultRules"),n("span",{class:"token punctuation"},","),s(" source "),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token constant"},"JSON"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"parseObject"),n("span",{class:"token punctuation"},"("),s("source"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"TypeReference"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"List"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"FlowRule"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"FlowRuleManager"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"register2Property"),n("span",{class:"token punctuation"},"("),s("flowRuleDataSource"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getProperty"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"})])])],-1),n("p",null,null,-1)])),_:1}),a[30]||(a[30]=o('<h2 id="日志说明" tabindex="-1"><a class="header-anchor" href="#日志说明"><span>日志说明</span></a></h2><p><code>csp.sentinel.log.dir</code>配置日志目录。</p><h3 id="block日志" tabindex="-1"><a class="header-anchor" href="#block日志"><span>block日志</span></a></h3><p>无论触发了<strong>限流、熔断降级还是系统保护</strong>，它们的秒级拦截详情日志都在<code>${user_home}/logs/csp/sentinel-block.log</code>里。如果没有发生拦截，则该日志不会出现。日志格式如下:</p><div class="language-log" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token date number">2014-06-20</span> <span class="token time number">16:35:10</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span>sayHello<span class="token operator">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String<span class="token punctuation">,</span>long<span class="token operator">)</span><span class="token punctuation">,</span>FlowException<span class="token punctuation">,</span>default<span class="token punctuation">,</span>origin<span class="token operator">|</span><span class="token number">61</span><span class="token punctuation">,</span><span class="token number">0</span></span>\n<span class="line"><span class="token date number">2014-06-20</span> <span class="token time number">16:35:11</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span>sayHello<span class="token operator">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String<span class="token punctuation">,</span>long<span class="token operator">)</span><span class="token punctuation">,</span>FlowException<span class="token punctuation">,</span>default<span class="token punctuation">,</span>origin<span class="token operator">|</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span></span>\n<span class="line"></span>\n<span class="line"></span></code></pre></div><p>日志含义</p><table><thead><tr><th style="text-align:left;">index</th><th style="text-align:center;">例子</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">1</td><td style="text-align:center;"><code>2014-06-20 16:35:10</code></td><td style="text-align:left;">时间戳</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:center;"><code>1</code></td><td style="text-align:left;">该秒发生的第一个资源</td></tr><tr><td style="text-align:left;">3</td><td style="text-align:center;"><code>sayHello(java.lang.String,long)</code></td><td style="text-align:left;">资源名称</td></tr><tr><td style="text-align:left;">4</td><td style="text-align:center;"><code>FlowException</code></td><td style="text-align:left;">拦截的原因, <code>FlowException</code> 代表是被限流规则拦截，<code>DegradeException</code> 则表示被降级，<code>SystemBlockException</code> 则表示被系统保护拦截</td></tr><tr><td style="text-align:left;">5</td><td style="text-align:center;"><code>default</code></td><td style="text-align:left;">生效规则的调用来源（参数限流中代表生效的参数）</td></tr><tr><td style="text-align:left;">6</td><td style="text-align:center;"><code>origin</code></td><td style="text-align:left;">被拦截资源的调用者，可以为空</td></tr><tr><td style="text-align:left;">7</td><td style="text-align:center;"><code>61,0</code></td><td style="text-align:left;">61被拦截的数量，无意义可忽略</td></tr></tbody></table><h3 id="metrics日志" tabindex="-1"><a class="header-anchor" href="#metrics日志"><span>metrics日志</span></a></h3><p>所有的资源访问都会产生秒级监控日志，日志文件默认为<code>${user_home}/logs/csp/${app_name}-${pid}-metrics.log</code>（会随时间滚动）。格式如下：</p><div class="language-log" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token number">1532415661000</span><span class="token operator">|</span><span class="token date number">2018-07-24</span> <span class="token time number">15:01:01</span><span class="token operator">|</span>sayHello<span class="token operator">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String<span class="token operator">)</span><span class="token operator">|</span><span class="token number">12</span><span class="token operator">|</span><span class="token number">3</span><span class="token operator">|</span><span class="token number">4</span><span class="token operator">|</span><span class="token number">2</span><span class="token operator">|</span><span class="token number">295</span><span class="token operator">|</span><span class="token number">0</span><span class="token operator">|</span><span class="token number">0</span><span class="token operator">|</span><span class="token number">1</span></span>\n<span class="line"></span>\n<span class="line"></span></code></pre></div><ol><li><code>1532415661000</code>：时间戳</li><li><code>2018-07-24 15:01:01</code>：格式化之后的时间戳</li><li><code>sayHello(java.lang.String)</code>：资源名</li><li><code>12</code>：表示到来的数量，即此刻通过 Sentinel 规则 check 的数量（passed QPS）</li><li><code>3</code>：实际该资源被拦截的数量（blocked QPS）</li><li><code>4</code>：每秒结束的资源个数（完成调用），包括正常结束和异常结束的情况（exit QPS）</li><li><code>2</code>：异常的数量</li><li><code>295</code>：资源的平均响应时间（RT）</li><li><code>0</code>: 该秒占用未来请求的数目（since 1.5.0）</li><li><code>0</code>: 最大并发数（预留用）</li><li><code>1</code>: 资源分类（since 1.7.0）</li></ol><p>固定的线程池每秒输出日志。</p><figure><img src="http://47.101.155.205/image-20250608183809296.png" alt="image-20250608183809296" tabindex="0" loading="lazy"><figcaption>image-20250608183809296</figcaption></figure><h3 id="业务日志" tabindex="-1"><a class="header-anchor" href="#业务日志"><span>业务日志</span></a></h3><p>其它的日志在 <code>${user_home}/logs/csp/sentinel-record.log.xxx</code> 里。该日志包含规则的推送、接收、处理等记录，排查问题的时候会非常有帮助。</p><h3 id="集群限流日志" tabindex="-1"><a class="header-anchor" href="#集群限流日志"><span>集群限流日志</span></a></h3><p><code>${log_dir}/sentinel-cluster-client.log</code>：<code>Token Client</code>日志，会记录请求失败的信息。</p><h3 id="spi扩展机制" tabindex="-1"><a class="header-anchor" href="#spi扩展机制"><span>SPI扩展机制</span></a></h3><p>1.7.2 版本开始，Sentinel支持Logger扩展机制，可以实现自定义的<code>Logger SPI</code>来将<code>record log</code>等日志自行处理。<code>metric/block log</code>暂不支持定制。</p>',19))])}const v=i(d,[["render",m],["__file","AlibabaSentinel.html.vue"]]),y=JSON.parse('{"path":"/springcloud/AlibabaSentinel.html","title":"AlibabaSentinel","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"微服务相关知识","slug":"微服务相关知识","link":"#微服务相关知识","children":[]},{"level":2,"title":"Sentinel概念","slug":"sentinel概念","link":"#sentinel概念","children":[{"level":3,"title":"熔断降级设计理念","slug":"熔断降级设计理念","link":"#熔断降级设计理念","children":[]},{"level":3,"title":"Sentinel工作原理","slug":"sentinel工作原理","link":"#sentinel工作原理","children":[]},{"level":3,"title":"服务治理","slug":"服务治理","link":"#服务治理","children":[]}]},{"level":2,"title":"快速使用","slug":"快速使用","link":"#快速使用","children":[]},{"level":2,"title":"Sentinel控制台","slug":"sentinel控制台","link":"#sentinel控制台","children":[{"level":3,"title":"持久化指标","slug":"持久化指标","link":"#持久化指标","children":[]}]},{"level":2,"title":"使用文档","slug":"使用文档","link":"#使用文档","children":[{"level":3,"title":"基本使用","slug":"基本使用","link":"#基本使用","children":[]},{"level":3,"title":"集群限流配置","slug":"集群限流配置","link":"#集群限流配置","children":[]},{"level":3,"title":"网关流量控制","slug":"网关流量控制","link":"#网关流量控制","children":[]}]},{"level":2,"title":"开源框架适配","slug":"开源框架适配","link":"#开源框架适配","children":[]},{"level":2,"title":"动态配置规则","slug":"动态配置规则","link":"#动态配置规则","children":[{"level":3,"title":"DataSource扩展","slug":"datasource扩展","link":"#datasource扩展","children":[]}]},{"level":2,"title":"日志说明","slug":"日志说明","link":"#日志说明","children":[{"level":3,"title":"block日志","slug":"block日志","link":"#block日志","children":[]},{"level":3,"title":"metrics日志","slug":"metrics日志","link":"#metrics日志","children":[]},{"level":3,"title":"业务日志","slug":"业务日志","link":"#业务日志","children":[]},{"level":3,"title":"集群限流日志","slug":"集群限流日志","link":"#集群限流日志","children":[]},{"level":3,"title":"SPI扩展机制","slug":"spi扩展机制","link":"#spi扩展机制","children":[]}]}],"git":{"updatedTime":1749734369000,"contributors":[{"name":"oycm","username":"oycm","email":"1164864987@qq.com","commits":2,"url":"https://github.com/oycm"}]},"filePathRelative":"springcloud/AlibabaSentinel.md"}');export{v as comp,y as data};
