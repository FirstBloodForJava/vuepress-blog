import{_ as n,c as a,e as t,o as e}from"./app-BIGZvh4f.js";const o={};function p(l,s){return e(),a("div",null,s[0]||(s[0]=[t(`<h1 id="elk" tabindex="-1"><a class="header-anchor" href="#elk"><span>ELK</span></a></h1><p>https://www.elastic.co/elastic-stack/</p><p>技术栈：Elasticsearch、Logstash、Kibana。</p><h2 id="elasticsearch" tabindex="-1"><a class="header-anchor" href="#elasticsearch"><span>Elasticsearch</span></a></h2><p>https://www.elastic.co/downloads/elasticsearch</p><p>老版本地址：https://www.elastic.co/downloads/past-releases#elasticsearch</p><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> elasticsearch-8.15.0-linux-x86_64.tar.gz</span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">cd</span> elasticsearch-8.15.0/</span>
<span class="line"></span>
<span class="line">bin/elasticsearch</span>
<span class="line"></span>
<span class="line"><span class="token comment"># root用户需要新建用户启动</span></span>
<span class="line"><span class="token function">useradd</span> elasticsearch</span>
<span class="line"><span class="token function">passwd</span> oycm0610</span>
<span class="line"><span class="token comment"># 更改/usr/local/elasticsearch-8.15.0的所有者为elasticsearch</span></span>
<span class="line"><span class="token function">chown</span> elasticsearch /usr/local/elasticsearch-8.15.0</span>
<span class="line"><span class="token function">chmod</span> u+rwx /usr/local/elasticsearch-8.15.0</span>
<span class="line"><span class="token function">usermod</span> <span class="token parameter variable">-d</span> /usr/local/elasticsearch-8.15.0 elasticsearch</span>
<span class="line"><span class="token function">userdel</span> username</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 默认以https协议启动</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不调整配置直接启动，需要启动需要4g的内存。</p><figure><img src="http://47.101.155.205/image-20240829105906132.png" alt="image-20240829105906132" tabindex="0" loading="lazy"><figcaption>image-20240829105906132</figcaption></figure><figure><img src="http://47.101.155.205/image-20240829112121202.png" alt="image-20240829112121202" tabindex="0" loading="lazy"><figcaption>image-20240829112121202</figcaption></figure><figure><img src="http://47.101.155.205/image-20240830161741349.png" alt="image-20240830161741349" tabindex="0" loading="lazy"><figcaption>image-20240830161741349</figcaption></figure><figure><img src="http://47.101.155.205/image-20240830162103879.png" alt="image-20240830162103879" tabindex="0" loading="lazy"><figcaption>image-20240830162103879</figcaption></figure><h3 id="启动" tabindex="-1"><a class="header-anchor" href="#启动"><span>启动</span></a></h3><figure><img src="http://47.101.155.205/image-20240904104649232.png" alt="image-20240904104649232" tabindex="0" loading="lazy"><figcaption>image-20240904104649232</figcaption></figure><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># 禁用https协议</span></span>
<span class="line"><span class="token key atrule">xpack.security.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">xpack.security.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查找elasticsearch的进程pid</span></span>
<span class="line"><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> elasticsearch</span>
<span class="line"><span class="token comment"># 安全干掉进程</span></span>
<span class="line"><span class="token function">kill</span> <span class="token parameter variable">-SIGTERM</span> <span class="token operator">&lt;</span>PID<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 后台启动</span></span>
<span class="line"><span class="token function">nohup</span> ./bin/elasticsearch <span class="token operator">&gt;</span> ./logs/elasticsearch.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240905150548338.png" alt="image-20240905150548338" tabindex="0" loading="lazy"><figcaption>image-20240905150548338</figcaption></figure><h2 id="kibana" tabindex="-1"><a class="header-anchor" href="#kibana"><span>Kibana</span></a></h2><h3 id="安装启动" tabindex="-1"><a class="header-anchor" href="#安装启动"><span>安装启动</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">tar</span> <span class="token parameter variable">-zvxf</span> kibana-8.15.0-linux-x86_64.tar.gz</span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">cd</span> kibana-8.15.0/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动命令,启动之后，访问地址后面的6位验证码连接ES使用</span></span>
<span class="line">./bin/kibana</span>
<span class="line"></span>
<span class="line"><span class="token comment"># https启动的ES会打印密码及可供kibana连接的密钥</span></span>
<span class="line">elastic/_pwLsbtGW1aIsawB1IdV <span class="token comment"># 登录</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240830162446634.png" alt="image-20240830162446634" tabindex="0" loading="lazy"><figcaption>image-20240830162446634</figcaption></figure><figure><img src="http://47.101.155.205/image-20240830161823841.png" alt="image-20240830161823841" tabindex="0" loading="lazy"><figcaption>image-20240830161823841</figcaption></figure><figure><img src="http://47.101.155.205/image-20240830162254438.png" alt="image-20240830162254438" tabindex="0" loading="lazy"><figcaption>image-20240830162254438</figcaption></figure><figure><img src="http://47.101.155.205/image-20240904112326678.png" alt="image-20240904112326678" tabindex="0" loading="lazy"><figcaption>image-20240904112326678</figcaption></figure><h3 id="http协议连接es-中文" tabindex="-1"><a class="header-anchor" href="#http协议连接es-中文"><span>Http协议连接ES(中文)</span></a></h3><p>编辑kibana.yml文档。</p><div class="language-kibana.yml" data-highlighter="prismjs" data-ext="kibana.yml" data-title="kibana.yml"><pre><code><span class="line"># 中文</span>
<span class="line">i18n.locale: &quot;zh-CN&quot;</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 后台启动</span></span>
<span class="line"><span class="token function">nohup</span> ./bin/kibana <span class="token operator">&gt;</span> ./logs/kibana.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240904112641605.png" alt="image-20240904112641605" tabindex="0" loading="lazy"><figcaption>image-20240904112641605</figcaption></figure><figure><img src="http://47.101.155.205/image-20240904125421824.png" alt="image-20240904125421824" tabindex="0" loading="lazy"><figcaption>image-20240904125421824</figcaption></figure><h3 id="kibana使用文档" tabindex="-1"><a class="header-anchor" href="#kibana使用文档"><span>Kibana使用文档</span></a></h3><p>https://www.elastic.co/guide/en/kibana/current/introduction.html</p><p>需要选中一个索引才能渲染数据。</p><figure><img src="http://47.101.155.205/image-20240902142819308.png" alt="image-20240902142819308" tabindex="0" loading="lazy"><figcaption>image-20240902142819308</figcaption></figure><h2 id="kibana操作es指南" tabindex="-1"><a class="header-anchor" href="#kibana操作es指南"><span>Kibana操作ES指南</span></a></h2><p>Elasticsearch操作文档：https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</p><p>https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html</p><p>Kibana开发工具</p><figure><img src="http://47.101.155.205/image-20240830163743569.png" alt="image-20240830163743569" tabindex="0" loading="lazy"><figcaption>image-20240830163743569</figcaption></figure><p>执行调用Elasticsearch的接口。</p><figure><img src="http://47.101.155.205/image-20240830164008727.png" alt="image-20240830164008727" tabindex="0" loading="lazy"><figcaption>image-20240830164008727</figcaption></figure><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-u</span> elastic:_pwLsbtGW1aIsawB1IdV https://192.168.125.165:9200/</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240830164939589.png" alt="image-20240830164939589" tabindex="0" loading="lazy"><figcaption>image-20240830164939589</figcaption></figure><h3 id="往es索引中添加数据" tabindex="-1"><a class="header-anchor" href="#往es索引中添加数据"><span>往ES索引中添加数据</span></a></h3><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">POST books/_doc</span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;fine&quot;</span>, <span class="token string">&quot;author&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;oycm&quot;</span>, <span class="token string">&quot;release_date&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2024-08-30&quot;</span>, <span class="token string">&quot;page_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">360</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240830165211377.png" alt="image-20240830165211377" tabindex="0" loading="lazy"><figcaption>image-20240830165211377</figcaption></figure><h3 id="索引中添加多条数据" tabindex="-1"><a class="header-anchor" href="#索引中添加多条数据"><span>索引中添加多条数据</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">POST /_bulk</span>
<span class="line"><span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_index&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;books&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Revelation Space&quot;</span>, <span class="token string">&quot;author&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Alastair Reynolds&quot;</span>, <span class="token string">&quot;release_date&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2000-03-15&quot;</span>, <span class="token string">&quot;page_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">585</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_index&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;books&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1984&quot;</span>, <span class="token string">&quot;author&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;George Orwell&quot;</span>, <span class="token string">&quot;release_date&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1985-06-01&quot;</span>, <span class="token string">&quot;page_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">328</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_index&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;books&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Fahrenheit 451&quot;</span>, <span class="token string">&quot;author&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Ray Bradbury&quot;</span>, <span class="token string">&quot;release_date&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1953-10-15&quot;</span>, <span class="token string">&quot;page_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">227</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_index&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;books&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Brave New World&quot;</span>, <span class="token string">&quot;author&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Aldous Huxley&quot;</span>, <span class="token string">&quot;release_date&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1932-06-01&quot;</span>, <span class="token string">&quot;page_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">268</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_index&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;books&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;The Handmaids Tale&quot;</span>, <span class="token string">&quot;author&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Margaret Atwood&quot;</span>, <span class="token string">&quot;release_date&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1985-06-01&quot;</span>, <span class="token string">&quot;page_count&quot;</span><span class="token builtin class-name">:</span> <span class="token number">311</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240830170124073.png" alt="image-20240830170124073" tabindex="0" loading="lazy"><figcaption>image-20240830170124073</figcaption></figure><h3 id="搜索索引中的数据" tabindex="-1"><a class="header-anchor" href="#搜索索引中的数据"><span>搜索索引中的数据</span></a></h3><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">GET books/_search</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240830171009681.png" alt="image-20240830171009681" tabindex="0" loading="lazy"><figcaption>image-20240830171009681</figcaption></figure><h4 id="匹配搜索" tabindex="-1"><a class="header-anchor" href="#匹配搜索"><span>匹配搜索</span></a></h4><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">GET books/_search</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;brave&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240830171151084.png" alt="image-20240830171151084" tabindex="0" loading="lazy"><figcaption>image-20240830171151084</figcaption></figure><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">GET books/_search</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;The&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240830171340140.png" alt="image-20240830171340140" tabindex="0" loading="lazy"><figcaption>image-20240830171340140</figcaption></figure><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">GET books/_search</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;fi&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240830171410734.png" alt="image-20240830171410734" tabindex="0" loading="lazy"><figcaption>image-20240830171410734</figcaption></figure><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">GET books/_search</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;fine&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240830171433547.png" alt="image-20240830171433547" tabindex="0" loading="lazy"><figcaption>image-20240830171433547</figcaption></figure><h3 id="删除索引中匹配的数据" tabindex="-1"><a class="header-anchor" href="#删除索引中匹配的数据"><span>删除索引中匹配的数据</span></a></h3><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">POST /log-nginx-2024-09/_delete_by_query</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;current_date&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2024-09-10&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="搜索接口api" tabindex="-1"><a class="header-anchor" href="#搜索接口api"><span>搜索接口api</span></a></h3><p>https://www.elastic.co/guide/en/elasticsearch/reference/current/search-with-elasticsearch.html</p><p>https://www.elastic.co/guide/en/elasticsearch/reference/current/search-search.html</p><h3 id="添加数据进阶" tabindex="-1"><a class="header-anchor" href="#添加数据进阶"><span>添加数据进阶</span></a></h3><p>kibana插入数据：https://www.elastic.co/guide/en/kibana/8.15/sample-data.html</p><p>上传文件：https://www.elastic.co/guide/en/kibana/8.15/sample-data.html</p><p>使用bulk数据到es：https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html</p><h3 id="es客户端" tabindex="-1"><a class="header-anchor" href="#es客户端"><span>ES客户端</span></a></h3><p>官网文档：https://www.elastic.co/guide/en/elasticsearch/client/index.html</p><h2 id="logstash" tabindex="-1"><a class="header-anchor" href="#logstash"><span>Logstash</span></a></h2><p>官网地址：https://www.elastic.co/logstash</p><p>使用文档首页：https://www.elastic.co/guide/en/logstash/current/index.html</p><p>快速开始使用文档：https://www.elastic.co/guide/en/logstash/current/getting-started-with-logstash.html</p><h3 id="安装-1" tabindex="-1"><a class="header-anchor" href="#安装-1"><span>安装</span></a></h3><p>下载地址：https://www.elastic.co/downloads/logstash</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> logstash-8.15.0-linux-x86_64.tar.gz</span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">cd</span> logstash-8.15.0</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="启动-1" tabindex="-1"><a class="header-anchor" href="#启动-1"><span>启动</span></a></h3><p>Logstash启动需要两个必须元素input和output，还有一个可选元素filter。input指定数据的来源，filter指定怎么修改数据，output决定将结果输出到哪。</p><figure><img src="http://47.101.155.205/image-20240902145136949.png" alt="image-20240902145136949" tabindex="0" loading="lazy"><figcaption>image-20240902145136949</figcaption></figure><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 启动</span></span>
<span class="line"><span class="token comment"># -e 从命令行读取启动配置</span></span>
<span class="line"><span class="token comment"># input stdin表示是标准的input输入</span></span>
<span class="line"><span class="token comment"># output stdout表示是标准的output输出 意味着在控制台输入和输出</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-e</span> <span class="token string">&#39;input { stdin { } } output { stdout {} }&#39;</span></span>
<span class="line"><span class="token comment"># ctrl + d停止</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># --config.test_and_exit配置,解析配置文件并记录错误(并不启动)</span></span>
<span class="line"><span class="token comment"># --config.reload.automatic修改配置即生效启动</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.test_and_exit</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.reload.automatic</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240902145821304.png" alt="image-20240902145821304" tabindex="0" loading="lazy"><figcaption>image-20240902145821304</figcaption></figure><figure><img src="http://47.101.155.205/image-20240902150410418.png" alt="image-20240902150410418" tabindex="0" loading="lazy"><figcaption>image-20240902150410418</figcaption></figure><h3 id="结合filebeat解析日志" tabindex="-1"><a class="header-anchor" href="#结合filebeat解析日志"><span>结合Filebeat解析日志</span></a></h3><p>官网文档介绍：https://www.elastic.co/guide/en/logstash/current/advanced-pipeline.html</p><p>使用Filebeat解析的日志作为input，从日志中自定义修改，输出到Elasticsearch。</p><h4 id="配置filebeat发送日志到logstash" tabindex="-1"><a class="header-anchor" href="#配置filebeat发送日志到logstash"><span>配置Filebeat发送日志到Logstash</span></a></h4><p>git仓库地址：https://github.com/elastic/beats/tree/main/filebeat</p><p>Filebeat下载地址：https://www.elastic.co/downloads/beats/filebeat</p><p>Filebeat使用文档：https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html</p><p>正常情况，Filebeat不会和Logstash运行在同一台计算机。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># curl命令下载压缩包</span></span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">-O</span> https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.15.0-linux-x86_64.tar.gz</span>
<span class="line"><span class="token comment"># 解压缩</span></span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-zvxf</span> filebeat-8.15.0-linux-x86_64.tar.gz</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 解压缩.log.gz日志文件得到文件logstash-tutorial.log</span></span>
<span class="line"><span class="token function">gzip</span> <span class="token parameter variable">-d</span> logstash-tutorial.log.gz</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 新建一个filebeat_test.yml配置文件</span></span>
<span class="line"><span class="token function">touch</span> filebeat_test.yml</span>
<span class="line"><span class="token comment"># 启动报错提示执行,没有文件权限</span></span>
<span class="line"><span class="token function">chmod</span> go-w /u01/lgsa/local/filebeat-8.15.0-linux-x86_64/filebeat_test.yml</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动filebeat,启动之后会一直尝试连接</span></span>
<span class="line">./filebeat <span class="token parameter variable">-e</span> <span class="token parameter variable">-c</span> filebeat_test.yml <span class="token parameter variable">-d</span> <span class="token string">&quot;publish&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-filebeat.yml" data-highlighter="prismjs" data-ext="filebeat.yml" data-title="filebeat.yml"><pre><code><span class="line">filebeat.inputs:</span>
<span class="line">- type: log</span>
<span class="line">  paths:</span>
<span class="line">    - /u01/lgsa/local/logstash-tutorial.log</span>
<span class="line">output.logstash:</span>
<span class="line">  hosts: [&quot;localhost:5044&quot;]</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240902160825291.png" alt="image-20240902160825291" tabindex="0" loading="lazy"><figcaption>image-20240902160825291</figcaption></figure><h4 id="使用beats-input" tabindex="-1"><a class="header-anchor" href="#使用beats-input"><span>使用beats(input)</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">cp</span> logstash-sample.conf first-pipeline.conf</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 修改first-pipeline.conf文件内容</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># --config.test_and_exit配置,解析配置文件并记录错误(并不启动)</span></span>
<span class="line"><span class="token comment"># --config.reload.automatic修改配置即生效启动</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.test_and_exit</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.reload.automatic</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># message是filebeat解析日志的源数据</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">  beats {</span>
<span class="line">    port =&gt; 5044</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">output {</span>
<span class="line">  stdout {</span>
<span class="line">    codec =&gt; rubydebug # 日志数据会以键值对的方式展示</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240902163226343.png" alt="image-20240902163226343" tabindex="0" loading="lazy"><figcaption>image-20240902163226343</figcaption></figure><figure><img src="http://47.101.155.205/image-20240902163537624.png" alt="image-20240902163537624" tabindex="0" loading="lazy"><figcaption>image-20240902163537624</figcaption></figure><figure><img src="http://47.101.155.205/image-20240903133529458.png" alt="image-20240903133529458" tabindex="0" loading="lazy"><figcaption>image-20240903133529458</figcaption></figure><h3 id="使用grok过滤器" tabindex="-1"><a class="header-anchor" href="#使用grok过滤器"><span>使用grok过滤器</span></a></h3><p>待解析日志记录行。</p><div class="language-log" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token ip-address constant">83.149.9.216</span> <span class="token separator comment">- - </span><span class="token punctuation">[</span><span class="token date number">04/Jan/2015</span><span class="token operator">:</span><span class="token time number">05:13:42 +0000</span><span class="token punctuation">]</span> </span>
<span class="line"><span class="token string">&quot;GET /presentations/logstash-monitorama-2013/images/kibana-search.png HTTP/1.1&quot;</span> </span>
<span class="line"><span class="token number">200</span> <span class="token number">203023</span> </span>
<span class="line"><span class="token string">&quot;http://semicomplete.com/presentations/logstash-monitorama-2013/&quot;</span> </span>
<span class="line"><span class="token string">&quot;Mozilla/5.0 (Macintosh; IntelMac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>默认会将日志解析成key=value的json格式，json的key以最终结果为准。其中@version、@timestamp、tags(解析错误才有)是使用logstash后自动产生的字段。</p><table><thead><tr><th>字段名</th><th>内容</th><th>信息</th></tr></thead><tbody><tr><td>clientip</td><td>83.149.9.216</td><td>客户端ip</td></tr><tr><td>ident</td><td>-</td><td></td></tr><tr><td>auth</td><td>-</td><td></td></tr><tr><td>timestamp</td><td>04/Jan/2015:05:13:42 +0000</td><td>请求记录时间</td></tr><tr><td>verb</td><td>GET</td><td>请求方式</td></tr><tr><td>request</td><td>/presentations/logstash-monitorama-2013/images/kibana-search.png</td><td>uri</td></tr><tr><td>httpversion</td><td>1.1</td><td>请求版本</td></tr><tr><td>response</td><td>200</td><td>响应状态码</td></tr><tr><td>bytes</td><td>203023</td><td>响应体字节数</td></tr><tr><td>referrer</td><td>http://semicomplete.com/presentations/logstash-monitorama-2013/</td><td></td></tr><tr><td>agent</td><td>Mozilla/5.0 (Macintosh; IntelMac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36</td><td>客户端版本</td></tr></tbody></table><figure><img src="http://47.101.155.205/image-20240902164057049.png" alt="image-20240902164057049" tabindex="0" loading="lazy"><figcaption>image-20240902164057049</figcaption></figure><h4 id="结合标准input和output-json-使用" tabindex="-1"><a class="header-anchor" href="#结合标准input和output-json-使用"><span>结合标准input和output(json)使用</span></a></h4><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    stdin {}</span>
<span class="line">}</span>
<span class="line">filter {</span>
<span class="line">    grok {</span>
<span class="line">        match =&gt; { &quot;message&quot; =&gt; &quot;%{COMBINEDAPACHELOG}&quot;}</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    stdout { codec =&gt; json } # json_lines 每行输出json</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token ip-address constant">86.1.76.62</span> <span class="token separator comment">- - </span><span class="token punctuation">[</span><span class="token date number">04/Jan/2015</span><span class="token operator">:</span><span class="token time number">05:30:37 +0000</span><span class="token punctuation">]</span> <span class="token string">&quot;GET /style2.css HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">4877</span> <span class="token string">&quot;http://www.semicomplete.com/projects/xdotool/&quot;</span> <span class="token string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:24.0) Gecko/20140205 Firefox/24.0 Iceweasel/24.3.0&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240903143712930.png" alt="image-20240903143712930" tabindex="0" loading="lazy"><figcaption>image-20240903143712930</figcaption></figure><figure><img src="http://47.101.155.205/image-20240903143107146.png" alt="image-20240903143107146" tabindex="0" loading="lazy"><figcaption>image-20240903143107146</figcaption></figure><div class="language-log" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token ip-address constant">127.0.0.1</span> <span class="token operator">-</span> frank <span class="token punctuation">[</span><span class="token date number">10/Oct/2000</span><span class="token operator">:</span><span class="token time number">13:55:36 -0700</span><span class="token punctuation">]</span> <span class="token string">&quot;GET /apache_pb.gif HTTP/1.0&quot;</span> <span class="token number">200</span> <span class="token number">2326</span> <span class="token string">&quot;http://www.example.com/start.html&quot;</span> <span class="token string">&quot;Mozilla/4.08 [en] (Win98; I ;Nav)&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240903144247105.png" alt="image-20240903144247105" tabindex="0" loading="lazy"><figcaption>image-20240903144247105</figcaption></figure><h4 id="结合标准input和output-rubydebug-使用" tabindex="-1"><a class="header-anchor" href="#结合标准input和output-rubydebug-使用"><span>结合标准input和output(rubydebug)使用</span></a></h4><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    stdin {}</span>
<span class="line">}</span>
<span class="line">filter {</span>
<span class="line">    grok {</span>
<span class="line">        match =&gt; { &quot;message&quot; =&gt; &quot;%{COMBINEDAPACHELOG}&quot;}</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    stdout { codec =&gt; rubydebug }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token ip-address constant">86.1.76.62</span> <span class="token separator comment">- - </span><span class="token punctuation">[</span><span class="token date number">04/Jan/2015</span><span class="token operator">:</span><span class="token time number">05:30:37 +0000</span><span class="token punctuation">]</span> <span class="token string">&quot;GET /style2.css HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">4877</span> <span class="token string">&quot;http://www.semicomplete.com/projects/xdotool/&quot;</span> <span class="token string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:24.0) Gecko/20140205 Firefox/24.0 Iceweasel/24.3.0&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240903144701170.png" alt="image-20240903144701170" tabindex="0" loading="lazy"><figcaption>image-20240903144701170</figcaption></figure><div class="language-log" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token ip-address constant">127.0.0.1</span> <span class="token operator">-</span> frank <span class="token punctuation">[</span><span class="token date number">10/Oct/2000</span><span class="token operator">:</span><span class="token time number">13:55:36 -0700</span><span class="token punctuation">]</span> <span class="token string">&quot;GET /apache_pb.gif HTTP/1.0&quot;</span> <span class="token number">200</span> <span class="token number">2326</span> <span class="token string">&quot;http://www.example.com/start.html&quot;</span> <span class="token string">&quot;Mozilla/4.08 [en] (Win98; I ;Nav)&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240903144811485.png" alt="image-20240903144811485" tabindex="0" loading="lazy"><figcaption>image-20240903144811485</figcaption></figure><h4 id="结合input-filebeat-和output-rubudub-使用" tabindex="-1"><a class="header-anchor" href="#结合input-filebeat-和output-rubudub-使用"><span>结合input(filebeat)和output(rubudub)使用</span></a></h4><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    beats {</span>
<span class="line">        port =&gt; &quot;5044&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">filter {</span>
<span class="line">    grok {</span>
<span class="line">        match =&gt; { &quot;message&quot; =&gt; &quot;%{COMBINEDAPACHELOG}&quot;}</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    stdout { codec =&gt; rubydebug }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-filebeat_test.yml" data-highlighter="prismjs" data-ext="filebeat_test.yml" data-title="filebeat_test.yml"><pre><code><span class="line"># filebeat启动配置文件</span>
<span class="line">filebeat.inputs:</span>
<span class="line">- type: log</span>
<span class="line">  paths:</span>
<span class="line">    - /u01/lgsa/local/logstash-tutorial.log</span>
<span class="line">output.logstash:</span>
<span class="line">  hosts: [&quot;localhost:5044&quot;]</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># filebeat已经读取了文件,停止filebeat(ctrl + c),然后再删除读取记录</span></span>
<span class="line"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> data/registry</span>
<span class="line"></span>
<span class="line">./filebeat <span class="token parameter variable">-e</span> <span class="token parameter variable">-c</span> filebeat_test.yml <span class="token parameter variable">-d</span> <span class="token string">&quot;publish&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240902165555287.png" alt="image-20240902165555287" tabindex="0" loading="lazy"><figcaption>image-20240902165555287</figcaption></figure><figure><img src="http://47.101.155.205/image-20240902170810021.png" alt="image-20240902170810021" tabindex="0" loading="lazy"><figcaption>image-20240902170810021</figcaption></figure><figure><img src="http://47.101.155.205/image-20240903133815542.png" alt="image-20240903133815542" tabindex="0" loading="lazy"><figcaption>image-20240903133815542</figcaption></figure><h4 id="结合input-filebeat-和output-json-使用" tabindex="-1"><a class="header-anchor" href="#结合input-filebeat-和output-json-使用"><span>结合input(filebeat)和output(json)使用</span></a></h4><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    beats {</span>
<span class="line">        port =&gt; &quot;5044&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">filter {</span>
<span class="line">    grok {</span>
<span class="line">        match =&gt; { &quot;message&quot; =&gt; &quot;%{COMBINEDAPACHELOG}&quot;}</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    file { </span>
<span class="line">        codec =&gt; json</span>
<span class="line">        path =&gt; &quot;/u01/lgsa/local/logstash-8.15.0/logs/custom-json.log&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>filebeat配置文件不变</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 让filebeat重新推送日志</span></span>
<span class="line"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> data/registry/</span>
<span class="line"></span>
<span class="line">./filebeat <span class="token parameter variable">-e</span> <span class="token parameter variable">-c</span> filebeat_test.yml <span class="token parameter variable">-d</span> <span class="token string">&quot;publish&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>打印的json数据</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;@version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;83.149.9.216 - - [04/Jan/2015:05:13:42 +0000] \\&quot;GET /presentations/logstash-monitorama-2013/images/kibana-search.png HTTP/1.1\\&quot; 200 203023 \\&quot;http://semicomplete.com/presentations/logstash-monitorama-2013/\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\&quot;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;input&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;log&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;http&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;response&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;status_code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;bytes&quot;</span><span class="token operator">:</span> <span class="token number">203023</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;referrer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://semicomplete.com/presentations/logstash-monitorama-2013/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;04/Jan/2015:05:13:42 +0000&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;83.149.9.216 - - [04/Jan/2015:05:13:42 +0000] \\&quot;GET /presentations/logstash-monitorama-2013/images/kibana-search.png HTTP/1.1\\&quot; 200 203023 \\&quot;http://semicomplete.com/presentations/logstash-monitorama-2013/\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\&quot;&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;offset&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/u01/lgsa/local/logstash-tutorial.log&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;agent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;V-YF116-D0099-HGJF001&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.15.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;ephemeral_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6fec3991-12dc-4902-8c09-dcdcd75c7e41&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filebeat&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;07170b2c-6b9b-4c8d-a4ef-46f79737b213&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;@timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-09-03T07:30:05.754Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;user_agent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;ecs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.0.0&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">&quot;beats_input_codec_plain_applied&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;83.149.9.216&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;V-YF116-D0099-HGJF001&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/presentations/logstash-monitorama-2013/images/kibana-search.png&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240903153519318.png" alt="image-20240903153519318" tabindex="0" loading="lazy"><figcaption>image-20240903153519318</figcaption></figure><h3 id="使用geoip过滤器" tabindex="-1"><a class="header-anchor" href="#使用geoip过滤器"><span>使用geoip过滤器</span></a></h3><p>解析ip地址</p><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    beats {</span>
<span class="line">        port =&gt; &quot;5044&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"> filter {</span>
<span class="line">    grok {</span>
<span class="line">        match =&gt; { &quot;message&quot; =&gt; &quot;%{COMBINEDAPACHELOG}&quot;}</span>
<span class="line">    }</span>
<span class="line">    geoip {</span>
<span class="line">        source =&gt; &quot;clientip&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    stdout { codec =&gt; rubydebug }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>插件修改后，启动不支持(现在应该是没有自带geoip所需要的数据源)。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查询geoip插件是否存在</span></span>
<span class="line">bin/logstash-plugin list <span class="token parameter variable">--verbose</span> <span class="token operator">|</span> <span class="token function">grep</span> logstash-filter-geoip</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 不存在,安装geoip插件命令</span></span>
<span class="line">bin/logstash-plugin <span class="token function">install</span> logstash-filter-geoip</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>没有解析数据</p><figure><img src="http://47.101.155.205/image-20240902172451119.png" alt="image-20240902172451119" tabindex="0" loading="lazy"><figcaption>image-20240902172451119</figcaption></figure><h4 id="下载geoip数据源并使用" tabindex="-1"><a class="header-anchor" href="#下载geoip数据源并使用"><span>下载geoip数据源并使用</span></a></h4><p>https://dev.maxmind.com/geoip/geolite2-free-geolocation-data</p><p>地址注册登录之后下载</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> GeoLite2-City_20240830.tar.gz</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动filebeat</span></span>
<span class="line">./filebeat <span class="token parameter variable">-e</span> <span class="token parameter variable">-c</span> filebeat_test.yml <span class="token parameter variable">-d</span> <span class="token string">&quot;publish&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动logstash</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.test_and_exit</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.reload.automatic</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># source,target,database配置都需要才能解析</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-first-pipeline.conf" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">geoip {</span>
<span class="line">    source =&gt; &quot;client_ip&quot;   # 指定包含IP地址的字段,josn多级配置格式[k1][k11]</span>
<span class="line">    target =&gt; &quot;geoip&quot;       # 输出的目标字段</span>
<span class="line">    database =&gt; &quot;/u01/lgsa/local/GeoLite2-City_20240830/GeoLite2-City.mmdb&quot;  # 指定数据库路径</span>
<span class="line">    # optional：指定需要的字段</span>
<span class="line">    fields =&gt; [&quot;city_name&quot;, &quot;country_name&quot;, &quot;latitude&quot;, &quot;longitude&quot;]</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>启动配置文件</p><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    beats {</span>
<span class="line">        port =&gt; &quot;5044&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"> filter {</span>
<span class="line">    grok {</span>
<span class="line">        match =&gt; { &quot;message&quot; =&gt; &quot;%{COMBINEDAPACHELOG}&quot;}</span>
<span class="line">    }</span>
<span class="line">    geoip {</span>
<span class="line">        source =&gt; &quot;[source][address]&quot; # 前面解析的ip地址格式为&quot;source&quot;: {&quot;address&quot;: &quot;83.149.9.216&quot;}</span>
<span class="line">        target =&gt; &quot;geoip&quot;</span>
<span class="line">        database =&gt; &quot;/u01/lgsa/local/GeoLite2-City_20240830/GeoLite2-City.mmdb&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    file { </span>
<span class="line">    	codec =&gt; json_lines # json输出后换行</span>
<span class="line">    	path =&gt; &quot;/u01/lgsa/local/logstash-8.15.0/logs/custom-geoip-json.log&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解析后效果</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;@version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;83.149.9.216 - - [04/Jan/2015:05:13:45 +0000] \\&quot;GET /presentations/logstash-monitorama-2013/css/fonts/Roboto-Bold.ttf HTTP/1.1\\&quot; 200 38720 \\&quot;http://semicomplete.com/presentations/logstash-monitorama-2013/\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\&quot;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;input&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;log&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;http&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;response&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;status_code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;bytes&quot;</span><span class="token operator">:</span> <span class="token number">38720</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;referrer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://semicomplete.com/presentations/logstash-monitorama-2013/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;04/Jan/2015:05:13:45 +0000&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;83.149.9.216 - - [04/Jan/2015:05:13:45 +0000] \\&quot;GET /presentations/logstash-monitorama-2013/css/fonts/Roboto-Bold.ttf HTTP/1.1\\&quot; 200 38720 \\&quot;http://semicomplete.com/presentations/logstash-monitorama-2013/\\&quot; \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\&quot;&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;offset&quot;</span><span class="token operator">:</span> <span class="token number">1945</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/u01/lgsa/local/logstash-tutorial.log&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;agent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.15.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;ephemeral_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e9d3554d-b5b9-4809-bac7-2a841947723e&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;V-YF116-D0099-HGJF001&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filebeat&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;07170b2c-6b9b-4c8d-a4ef-46f79737b213&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;@timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-09-03T07:54:25.356Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;user_agent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;ecs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.0.0&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;geoip&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;83.149.9.216&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;geo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;location&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;lat&quot;</span><span class="token operator">:</span> <span class="token number">55.7483</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;lon&quot;</span><span class="token operator">:</span> <span class="token number">37.6171</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;country_iso_code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;RU&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;city_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Moscow&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;postal_code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;102210&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;country_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Russia&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;region_iso_code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;RU-MOW&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;continent_code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;EU&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;region_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Moscow&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;timezone&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Europe/Moscow&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">&quot;beats_input_codec_plain_applied&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;83.149.9.216&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;V-YF116-D0099-HGJF001&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/presentations/logstash-monitorama-2013/css/fonts/Roboto-Bold.ttf&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240903160128888.png" alt="image-20240903160128888" tabindex="0" loading="lazy"><figcaption>image-20240903160128888</figcaption></figure><h4 id="nginx日志grok和geoip过滤器解析效果" tabindex="-1"><a class="header-anchor" href="#nginx日志grok和geoip过滤器解析效果"><span>nginx日志grok和geoip过滤器解析效果</span></a></h4><div class="language-conf" data-highlighter="prismjs" data-ext="conf" data-title="conf"><pre><code><span class="line"># nginx记录访问日志格式</span>
<span class="line">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
<span class="line">&#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
<span class="line">&#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-log" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token ip-address constant">180.166.146.226</span> <span class="token separator comment">- - </span><span class="token punctuation">[</span><span class="token date number">03/Sep/2024</span><span class="token operator">:</span><span class="token time number">16:05:47 +0800</span><span class="token punctuation">]</span> <span class="token string">&quot;GET /image-20240830162103879.png HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">21052</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Typora/0.9.86 Chrome/76.0.3809.146 Electron/6.1.4 Safari/537.36&quot;</span> <span class="token string">&quot;-&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;@version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;180.166.146.226 - - [03/Sep/2024:16:05:47 +0800] \\&quot;GET /image-20240830162103879.png HTTP/1.1\\&quot; 200 21052 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Typora/0.9.86 Chrome/76.0.3809.146 Electron/6.1.4 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;input&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;log&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;http&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;response&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;status_code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;bytes&quot;</span><span class="token operator">:</span> <span class="token number">21052</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;03/Sep/2024:16:05:47 +0800&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;180.166.146.226 - - [03/Sep/2024:16:05:47 +0800] \\&quot;GET /image-20240830162103879.png HTTP/1.1\\&quot; 200 21052 \\&quot;-\\&quot; \\&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Typora/0.9.86 Chrome/76.0.3809.146 Electron/6.1.4 Safari/537.36\\&quot; \\&quot;-\\&quot;&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;offset&quot;</span><span class="token operator">:</span> <span class="token number">1039</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/u01/lgsa/local/filebeat-8.15.0-linux-x86_64/nginx.log&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;agent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;V-YF116-D0099-HGJF001&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.15.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;ephemeral_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;9c4c75e9-744a-4371-9f68-983d882210b3&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filebeat&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;07170b2c-6b9b-4c8d-a4ef-46f79737b213&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;@timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-09-03T08:27:53.743Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;user_agent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Typora/0.9.86 Chrome/76.0.3809.146 Electron/6.1.4 Safari/537.36&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;ecs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.0.0&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;geoip&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;180.166.146.226&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;geo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;location&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;lat&quot;</span><span class="token operator">:</span> <span class="token number">31.2222</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;lon&quot;</span><span class="token operator">:</span> <span class="token number">121.4581</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;country_iso_code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;city_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Shanghai&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;region_iso_code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CN-SH&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;country_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;China&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;timezone&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Asia/Shanghai&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;continent_code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AS&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;region_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Shanghai&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">&quot;beats_input_codec_plain_applied&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;180.166.146.226&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;V-YF116-D0099-HGJF001&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/image-20240830162103879.png&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240903163353524.png" alt="image-20240903163353524" tabindex="0" loading="lazy"><figcaption>image-20240903163353524</figcaption></figure><h3 id="output-to-elasticsearch" tabindex="-1"><a class="header-anchor" href="#output-to-elasticsearch"><span>output to ELasticsearch</span></a></h3><p>output格式</p><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line"># output</span>
<span class="line">output {</span>
<span class="line">	elasticsearch {</span>
<span class="line">		hosts =&gt; [&quot;请求协议Elasticsearch ServerIp + port&quot;]</span>
<span class="line">		index =&gt; &quot;Elasticsearch索引名称&quot;</span>
<span class="line">		#user =&gt; &quot;elastic&quot;</span>
<span class="line">    	#password =&gt; &quot;changeme&quot;</span>
<span class="line">	}</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>没有配置到es的索引名称，默认的索引是数据流，索引名称不是官网文档的logstash-YYYY.MM.DD格式，而是生成了一个名为logs-generic-default的数据流。</p><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    beats {</span>
<span class="line">        port =&gt; &quot;5044&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"> filter {</span>
<span class="line">    grok {</span>
<span class="line">        match =&gt; { &quot;message&quot; =&gt; &quot;%{COMBINEDAPACHELOG}&quot;}</span>
<span class="line">    }</span>
<span class="line">    geoip {</span>
<span class="line">        source =&gt; &quot;[source][address]&quot;</span>
<span class="line">        target =&gt; &quot;geoip&quot;</span>
<span class="line">        database =&gt; &quot;/u01/lgsa/local/GeoLite2-City_20240830/GeoLite2-City.mmdb&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    elasticsearch {</span>
<span class="line">		hosts =&gt; [&quot;http://192.168.125.165:9200&quot;]</span>
<span class="line">	}</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 启动filebeat</span></span>
<span class="line">./filebeat <span class="token parameter variable">-e</span> <span class="token parameter variable">-c</span> filebeat_test.yml <span class="token parameter variable">-d</span> <span class="token string">&quot;publish&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动logstash</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.test_and_exit</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.reload.automatic</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># $DATE格式为当前时间格式YYYY.MM.DD</span></span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-XGET</span> <span class="token string">&#39;http://192.168.125.165:9200/logstash-2024.09.04/_search?pretty&amp;q=response=200&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 最终日志的索引是logs-generic-default且是数据流类型</span></span>
<span class="line"><span class="token comment"># 日志中有37行数据，最终写入到ES的只有36，是因为最后一行日志没有换行，所以没有解析这一行日志。</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240904131936628.png" alt="image-20240904131936628" tabindex="0" loading="lazy"><figcaption>image-20240904131936628</figcaption></figure><figure><img src="http://47.101.155.205/image-20240904133056364.png" alt="image-20240904133056364" tabindex="0" loading="lazy"><figcaption>image-20240904133056364</figcaption></figure><figure><img src="http://47.101.155.205/image-20240904143710490.png" alt="image-20240904143710490" tabindex="0" loading="lazy"><figcaption>image-20240904143710490</figcaption></figure><h4 id="配置es的index名称" tabindex="-1"><a class="header-anchor" href="#配置es的index名称"><span>配置ES的index名称</span></a></h4><div class="language-first.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first.conf" data-title="first.conf"><pre><code><span class="line">input {</span>
<span class="line">    beats {</span>
<span class="line">        port =&gt; &quot;5044&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"> filter {</span>
<span class="line">    grok {</span>
<span class="line">        match =&gt; { &quot;message&quot; =&gt; &quot;%{COMBINEDAPACHELOG}&quot;}</span>
<span class="line">    }</span>
<span class="line">    geoip {</span>
<span class="line">        source =&gt; &quot;[source][address]&quot;</span>
<span class="line">        target =&gt; &quot;geoip&quot;</span>
<span class="line">        database =&gt; &quot;/u01/lgsa/local/GeoLite2-City_20240830/GeoLite2-City.mmdb&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    elasticsearch {</span>
<span class="line">		hosts =&gt; [&quot;http://192.168.125.165:9200&quot;]</span>
<span class="line">		index =&gt; &quot;log-nginx-%{+YYYY-MM-DD}&quot; # 到日格式会有问题,%{+YYYY-MM}不会有问题</span>
<span class="line">	}</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成的索引名称不对。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">./filebeat <span class="token parameter variable">-e</span> <span class="token parameter variable">-c</span> filebeat_test.yml <span class="token parameter variable">-d</span> <span class="token string">&quot;publish&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240904153337923.png" alt="image-20240904153337923" tabindex="0" loading="lazy"><figcaption>image-20240904153337923</figcaption></figure><h4 id="json-input-toes" tabindex="-1"><a class="header-anchor" href="#json-input-toes"><span>json(input)toEs</span></a></h4><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    stdin {}</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">output {</span>
<span class="line">    elasticsearch {</span>
<span class="line">        hosts =&gt; [&quot;http://192.168.125.165:9200&quot;]</span>
<span class="line">        index =&gt; &quot;log-nginx-%{+YYYY-MM}&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>字段太长，不是符合规范的json，调整成读取文件(读取文件之后会有记录，更改文件名)，最终的字段结构和错误json一致。解析失败，显示表中会有字段tags=_jsonparsefailure。</p><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    file {</span>
<span class="line">    	path =&gt; &quot;/u01/lgsa/local/logstash-8.15.0/json/gateway1.json&quot;</span>
<span class="line">    	start_position =&gt; &quot;beginning&quot;</span>
<span class="line">  	}</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    elasticsearch {</span>
<span class="line">        hosts =&gt; [&quot;http://192.168.125.165:9200&quot;]</span>
<span class="line">        index =&gt; &quot;log-nginx-%{+YYYY-MM}&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bsah" data-highlighter="prismjs" data-ext="bsah" data-title="bsah"><pre><code><span class="line">bin/logstash -f config/first-pipeline.conf --config.test_and_exit</span>
<span class="line">bin/logstash -f config/first-pipeline.conf --config.reload.automatic</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-json" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span><span class="token property">&quot;afterReturningResult&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\\&quot;status\\&quot;:\\&quot;1\\&quot;,\\&quot;note\\&quot;:null,\\&quot;description\\&quot;:null,\\&quot;map\\&quot;:{\\&quot;data\\&quot;:{\\&quot;content\\&quot;:[{\\&quot;id\\&quot;:867331,\\&quot;orgId\\&quot;:104370,\\&quot;whRecPreentNo\\&quot;:\\&quot;104370WH240826017119\\&quot;,\\&quot;inExpWhNo\\&quot;:\\&quot;PRE20230719E00201\\&quot;,\\&quot;inExpType\\&quot;:\\&quot;7\\&quot;,\\&quot;bizopEtpsno\\&quot;:\\&quot;3122S66009\\&quot;,\\&quot;bizopEtpsNm\\&quot;:\\&quot;上海语霆国际贸易股份有限公司\\&quot;,\\&quot;bizopEtpsSccd\\&quot;:\\&quot;91310115MA1K47Y39X\\&quot;,\\&quot;businessTypecd\\&quot;:\\&quot;25\\&quot;,\\&quot;inExpTime\\&quot;:null,\\&quot;mtpckEndprdTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;supvModecd\\&quot;:\\&quot;0110\\&quot;,\\&quot;trspModecd\\&quot;:\\&quot;0\\&quot;,\\&quot;impexpPortcd\\&quot;:\\&quot;2249\\&quot;,\\&quot;masterCuscd\\&quot;:\\&quot;2249\\&quot;,\\&quot;rltEntryNo\\&quot;:null,\\&quot;rltWhRecNo\\&quot;:null,\\&quot;whRecNo\\&quot;:null,\\&quot;dclTime\\&quot;:null,\\&quot;dclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;dclcusTypecd\\&quot;:\\&quot;2\\&quot;,\\&quot;preRecAccountTime\\&quot;:null,\\&quot;recAccountTime\\&quot;:null,\\&quot;invtIochkptStucd\\&quot;:\\&quot;1\\&quot;,\\&quot;vrfdedMarkcd\\&quot;:\\&quot;0\\&quot;,\\&quot;rmk\\&quot;:\\&quot;/工单/11\\&quot;,\\&quot;entryStucd\\&quot;:null,\\&quot;optStatus\\&quot;:\\&quot;1\\&quot;,\\&quot;destinationNatcd\\&quot;:\\&quot;142\\&quot;,\\&quot;tradeCountry\\&quot;:\\&quot;142\\&quot;,\\&quot;tradingRegion\\&quot;:\\&quot;142\\&quot;,\\&quot;districtCode\\&quot;:\\&quot;31166\\&quot;,\\&quot;grossWt\\&quot;:\\&quot;1000\\&quot;,\\&quot;transMode\\&quot;:\\&quot;1\\&quot;,\\&quot;ieTypecd\\&quot;:\\&quot;E\\&quot;,\\&quot;passportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;relDclcusFlag\\&quot;:\\&quot;1\\&quot;,\\&quot;inexpRltType\\&quot;:null,\\&quot;grtNo\\&quot;:\\&quot;2\\&quot;,\\&quot;isDrag\\&quot;:\\&quot;1\\&quot;,\\&quot;dclTypecd\\&quot;:\\&quot;2\\&quot;,\\&quot;chgTmsCnt\\&quot;:\\&quot;0\\&quot;,\\&quot;specialBusiness\\&quot;:null,\\&quot;allocationMode\\&quot;:null,\\&quot;enterNumber\\&quot;:\\&quot;1\\&quot;,\\&quot;releasePassDate\\&quot;:null,\\&quot;whpassportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;entryRealeaseDate\\&quot;:null,\\&quot;checkBondInvtNo\\&quot;:null,\\&quot;area\\&quot;:\\&quot;L\\&quot;,\\&quot;declareCustomeName\\&quot;:null,\\&quot;declareTradeCode\\&quot;:null,\\&quot;declareNumber\\&quot;:null,\\&quot;declareStatus\\&quot;:null,\\&quot;declareFlag\\&quot;:null,\\&quot;declareEdiNo\\&quot;:null,\\&quot;endStatus\\&quot;:null,\\&quot;endResult\\&quot;:null,\\&quot;changeType\\&quot;:\\&quot;1\\&quot;,\\&quot;productCharCode\\&quot;:\\&quot;0\\&quot;,\\&quot;passTime\\&quot;:null,\\&quot;receiveGoodsTime\\&quot;:null,\\&quot;whSeqNo\\&quot;:\\&quot;49E240800004879606\\&quot;},{\\&quot;id\\&quot;:867257,\\&quot;orgId\\&quot;:104370,\\&quot;whRecPreentNo\\&quot;:\\&quot;104370WH230628015583\\&quot;,\\&quot;inExpWhNo\\&quot;:\\&quot;PRE20230506I0003\\&quot;,\\&quot;inExpType\\&quot;:\\&quot;1\\&quot;,\\&quot;bizopEtpsno\\&quot;:\\&quot;3122S66009\\&quot;,\\&quot;bizopEtpsNm\\&quot;:\\&quot;上海语霆国际贸易有限公司\\&quot;,\\&quot;bizopEtpsSccd\\&quot;:\\&quot;91310115MA1K47Y39X\\&quot;,\\&quot;businessTypecd\\&quot;:\\&quot;4\\&quot;,\\&quot;inExpTime\\&quot;:null,\\&quot;mtpckEndprdTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;supvModecd\\&quot;:\\&quot;0110\\&quot;,\\&quot;trspModecd\\&quot;:\\&quot;1\\&quot;,\\&quot;impexpPortcd\\&quot;:\\&quot;2249\\&quot;,\\&quot;masterCuscd\\&quot;:\\&quot;2249\\&quot;,\\&quot;rltEntryNo\\&quot;:null,\\&quot;rltWhRecNo\\&quot;:null,\\&quot;whRecNo\\&quot;:null,\\&quot;dclTime\\&quot;:\\&quot;2023-06-28 15:48:58\\&quot;,\\&quot;dclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;dclcusTypecd\\&quot;:\\&quot;2\\&quot;,\\&quot;preRecAccountTime\\&quot;:null,\\&quot;recAccountTime\\&quot;:null,\\&quot;invtIochkptStucd\\&quot;:\\&quot;1\\&quot;,\\&quot;vrfdedMarkcd\\&quot;:\\&quot;0\\&quot;,\\&quot;rmk\\&quot;:\\&quot;备注字段-添加备注\\&quot;,\\&quot;entryStucd\\&quot;:null,\\&quot;optStatus\\&quot;:\\&quot;17\\&quot;,\\&quot;destinationNatcd\\&quot;:\\&quot;142\\&quot;,\\&quot;tradeCountry\\&quot;:\\&quot;142\\&quot;,\\&quot;tradingRegion\\&quot;:\\&quot;142\\&quot;,\\&quot;districtCode\\&quot;:\\&quot;31166\\&quot;,\\&quot;grossWt\\&quot;:\\&quot;1000\\&quot;,\\&quot;transMode\\&quot;:\\&quot;1\\&quot;,\\&quot;ieTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;passportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;relDclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;inexpRltType\\&quot;:null,\\&quot;grtNo\\&quot;:\\&quot;0\\&quot;,\\&quot;isDrag\\&quot;:\\&quot;0\\&quot;,\\&quot;dclTypecd\\&quot;:\\&quot;3\\&quot;,\\&quot;chgTmsCnt\\&quot;:\\&quot;0\\&quot;,\\&quot;specialBusiness\\&quot;:null,\\&quot;allocationMode\\&quot;:null,\\&quot;enterNumber\\&quot;:null,\\&quot;releasePassDate\\&quot;:null,\\&quot;whpassportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;entryRealeaseDate\\&quot;:\\&quot;2023-06-28 15:54:17\\&quot;,\\&quot;checkBondInvtNo\\&quot;:null,\\&quot;area\\&quot;:\\&quot;L\\&quot;,\\&quot;declareCustomeName\\&quot;:null,\\&quot;declareTradeCode\\&quot;:null,\\&quot;declareNumber\\&quot;:null,\\&quot;declareStatus\\&quot;:null,\\&quot;declareFlag\\&quot;:null,\\&quot;declareEdiNo\\&quot;:null,\\&quot;endStatus\\&quot;:null,\\&quot;endResult\\&quot;:null,\\&quot;changeType\\&quot;:null,\\&quot;productCharCode\\&quot;:\\&quot;0\\&quot;,\\&quot;passTime\\&quot;:null,\\&quot;receiveGoodsTime\\&quot;:null,\\&quot;whSeqNo\\&quot;:null},{\\&quot;id\\&quot;:867247,\\&quot;orgId\\&quot;:104370,\\&quot;whRecPreentNo\\&quot;:\\&quot;\\&quot;,\\&quot;inExpWhNo\\&quot;:\\&quot;PRE20230719E00204\\&quot;,\\&quot;inExpType\\&quot;:\\&quot;1\\&quot;,\\&quot;bizopEtpsno\\&quot;:\\&quot;3122S66009\\&quot;,\\&quot;bizopEtpsNm\\&quot;:\\&quot;上海语霆国际贸易股份有限公司\\&quot;,\\&quot;bizopEtpsSccd\\&quot;:\\&quot;91310115MA1K47Y39X\\&quot;,\\&quot;businessTypecd\\&quot;:\\&quot;4\\&quot;,\\&quot;inExpTime\\&quot;:null,\\&quot;mtpckEndprdTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;supvModecd\\&quot;:\\&quot;0110\\&quot;,\\&quot;trspModecd\\&quot;:\\&quot;1\\&quot;,\\&quot;impexpPortcd\\&quot;:\\&quot;2249\\&quot;,\\&quot;masterCuscd\\&quot;:\\&quot;2249\\&quot;,\\&quot;rltEntryNo\\&quot;:null,\\&quot;rltWhRecNo\\&quot;:null,\\&quot;whRecNo\\&quot;:null,\\&quot;dclTime\\&quot;:null,\\&quot;dclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;dclcusTypecd\\&quot;:\\&quot;2\\&quot;,\\&quot;preRecAccountTime\\&quot;:null,\\&quot;recAccountTime\\&quot;:null,\\&quot;invtIochkptStucd\\&quot;:\\&quot;1\\&quot;,\\&quot;vrfdedMarkcd\\&quot;:\\&quot;0\\&quot;,\\&quot;rmk\\&quot;:\\&quot;备注字段-添加备注\\&quot;,\\&quot;entryStucd\\&quot;:null,\\&quot;optStatus\\&quot;:\\&quot;99\\&quot;,\\&quot;destinationNatcd\\&quot;:\\&quot;142\\&quot;,\\&quot;tradeCountry\\&quot;:\\&quot;142\\&quot;,\\&quot;tradingRegion\\&quot;:\\&quot;142\\&quot;,\\&quot;districtCode\\&quot;:\\&quot;31166\\&quot;,\\&quot;grossWt\\&quot;:\\&quot;1000\\&quot;,\\&quot;transMode\\&quot;:\\&quot;1\\&quot;,\\&quot;ieTypecd\\&quot;:\\&quot;E\\&quot;,\\&quot;passportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;relDclcusFlag\\&quot;:\\&quot;1\\&quot;,\\&quot;inexpRltType\\&quot;:null,\\&quot;grtNo\\&quot;:\\&quot;1\\&quot;,\\&quot;isDrag\\&quot;:\\&quot;1\\&quot;,\\&quot;dclTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;chgTmsCnt\\&quot;:\\&quot;0\\&quot;,\\&quot;specialBusiness\\&quot;:null,\\&quot;allocationMode\\&quot;:null,\\&quot;enterNumber\\&quot;:null,\\&quot;releasePassDate\\&quot;:null,\\&quot;whpassportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;entryRealeaseDate\\&quot;:null,\\&quot;checkBondInvtNo\\&quot;:null,\\&quot;area\\&quot;:\\&quot;L\\&quot;,\\&quot;declareCustomeName\\&quot;:null,\\&quot;declareTradeCode\\&quot;:null,\\&quot;declareNumber\\&quot;:null,\\&quot;declareStatus\\&quot;:null,\\&quot;declareFlag\\&quot;:null,\\&quot;declareEdiNo\\&quot;:null,\\&quot;endStatus\\&quot;:null,\\&quot;endResult\\&quot;:null,\\&quot;changeType\\&quot;:null,\\&quot;productCharCode\\&quot;:null,\\&quot;passTime\\&quot;:null,\\&quot;receiveGoodsTime\\&quot;:null,\\&quot;whSeqNo\\&quot;:\\&quot;49E240800004879699\\&quot;},{\\&quot;id\\&quot;:867121,\\&quot;orgId\\&quot;:104370,\\&quot;whRecPreentNo\\&quot;:\\&quot;\\&quot;,\\&quot;inExpWhNo\\&quot;:\\&quot;PRE20230719E00203\\&quot;,\\&quot;inExpType\\&quot;:\\&quot;2\\&quot;,\\&quot;bizopEtpsno\\&quot;:\\&quot;3122S66009\\&quot;,\\&quot;bizopEtpsNm\\&quot;:\\&quot;上海语霆国际贸易股份有限公司\\&quot;,\\&quot;bizopEtpsSccd\\&quot;:\\&quot;91310115MA1K47Y39X\\&quot;,\\&quot;businessTypecd\\&quot;:\\&quot;4\\&quot;,\\&quot;inExpTime\\&quot;:null,\\&quot;mtpckEndprdTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;supvModecd\\&quot;:\\&quot;0110\\&quot;,\\&quot;trspModecd\\&quot;:\\&quot;0\\&quot;,\\&quot;impexpPortcd\\&quot;:\\&quot;2249\\&quot;,\\&quot;masterCuscd\\&quot;:\\&quot;2249\\&quot;,\\&quot;rltEntryNo\\&quot;:null,\\&quot;rltWhRecNo\\&quot;:null,\\&quot;whRecNo\\&quot;:null,\\&quot;dclTime\\&quot;:null,\\&quot;dclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;dclcusTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;preRecAccountTime\\&quot;:null,\\&quot;recAccountTime\\&quot;:null,\\&quot;invtIochkptStucd\\&quot;:\\&quot;1\\&quot;,\\&quot;vrfdedMarkcd\\&quot;:\\&quot;0\\&quot;,\\&quot;rmk\\&quot;:\\&quot;/1/\\&quot;,\\&quot;entryStucd\\&quot;:null,\\&quot;optStatus\\&quot;:\\&quot;99\\&quot;,\\&quot;destinationNatcd\\&quot;:\\&quot;142\\&quot;,\\&quot;tradeCountry\\&quot;:\\&quot;142\\&quot;,\\&quot;tradingRegion\\&quot;:\\&quot;142\\&quot;,\\&quot;districtCode\\&quot;:\\&quot;31166\\&quot;,\\&quot;grossWt\\&quot;:\\&quot;1000\\&quot;,\\&quot;transMode\\&quot;:\\&quot;1\\&quot;,\\&quot;ieTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;passportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;relDclcusFlag\\&quot;:\\&quot;1\\&quot;,\\&quot;inexpRltType\\&quot;:null,\\&quot;grtNo\\&quot;:\\&quot;1\\&quot;,\\&quot;isDrag\\&quot;:\\&quot;1\\&quot;,\\&quot;dclTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;chgTmsCnt\\&quot;:\\&quot;0\\&quot;,\\&quot;specialBusiness\\&quot;:null,\\&quot;allocationMode\\&quot;:null,\\&quot;enterNumber\\&quot;:null,\\&quot;releasePassDate\\&quot;:null,\\&quot;whpassportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;entryRealeaseDate\\&quot;:null,\\&quot;checkBondInvtNo\\&quot;:null,\\&quot;area\\&quot;:\\&quot;L\\&quot;,\\&quot;declareCustomeName\\&quot;:null,\\&quot;declareTradeCode\\&quot;:null,\\&quot;declareNumber\\&quot;:null,\\&quot;declareStatus\\&quot;:null,\\&quot;declareFlag\\&quot;:null,\\&quot;declareEdiNo\\&quot;:null,\\&quot;endStatus\\&quot;:null,\\&quot;endResult\\&quot;:null,\\&quot;changeType\\&quot;:null,\\&quot;productCharCode\\&quot;:null,\\&quot;passTime\\&quot;:null,\\&quot;receiveGoodsTime\\&quot;:null,\\&quot;whSeqNo\\&quot;:\\&quot;49I240800004879608\\&quot;},{\\&quot;id\\&quot;:867119,\\&quot;orgId\\&quot;:104370,\\&quot;whRecPreentNo\\&quot;:\\&quot;104370WH240826017119\\&quot;,\\&quot;inExpWhNo\\&quot;:\\&quot;PRE20230719E00201\\&quot;,\\&quot;inExpType\\&quot;:\\&quot;7\\&quot;,\\&quot;bizopEtpsno\\&quot;:\\&quot;3122S66009\\&quot;,\\&quot;bizopEtpsNm\\&quot;:\\&quot;上海语霆国际贸易股份有限公司\\&quot;,\\&quot;bizopEtpsSccd\\&quot;:\\&quot;91310115MA1K47Y39X\\&quot;,\\&quot;businessTypecd\\&quot;:\\&quot;25\\&quot;,\\&quot;inExpTime\\&quot;:null,\\&quot;mtpckEndprdTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;supvModecd\\&quot;:\\&quot;0110\\&quot;,\\&quot;trspModecd\\&quot;:\\&quot;0\\&quot;,\\&quot;impexpPortcd\\&quot;:\\&quot;2249\\&quot;,\\&quot;masterCuscd\\&quot;:\\&quot;2249\\&quot;,\\&quot;rltEntryNo\\&quot;:null,\\&quot;rltWhRecNo\\&quot;:null,\\&quot;whRecNo\\&quot;:null,\\&quot;dclTime\\&quot;:null,\\&quot;dclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;dclcusTypecd\\&quot;:\\&quot;2\\&quot;,\\&quot;preRecAccountTime\\&quot;:null,\\&quot;recAccountTime\\&quot;:null,\\&quot;invtIochkptStucd\\&quot;:\\&quot;1\\&quot;,\\&quot;vrfdedMarkcd\\&quot;:\\&quot;0\\&quot;,\\&quot;rmk\\&quot;:\\&quot;/工单/11\\&quot;,\\&quot;entryStucd\\&quot;:null,\\&quot;optStatus\\&quot;:\\&quot;8\\&quot;,\\&quot;destinationNatcd\\&quot;:\\&quot;142\\&quot;,\\&quot;tradeCountry\\&quot;:\\&quot;142\\&quot;,\\&quot;tradingRegion\\&quot;:\\&quot;142\\&quot;,\\&quot;districtCode\\&quot;:\\&quot;31166\\&quot;,\\&quot;grossWt\\&quot;:\\&quot;1000\\&quot;,\\&quot;transMode\\&quot;:\\&quot;1\\&quot;,\\&quot;ieTypecd\\&quot;:\\&quot;E\\&quot;,\\&quot;passportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;relDclcusFlag\\&quot;:\\&quot;1\\&quot;,\\&quot;inexpRltType\\&quot;:null,\\&quot;grtNo\\&quot;:\\&quot;2\\&quot;,\\&quot;isDrag\\&quot;:\\&quot;1\\&quot;,\\&quot;dclTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;chgTmsCnt\\&quot;:\\&quot;0\\&quot;,\\&quot;specialBusiness\\&quot;:null,\\&quot;allocationMode\\&quot;:null,\\&quot;enterNumber\\&quot;:\\&quot;1\\&quot;,\\&quot;releasePassDate\\&quot;:null,\\&quot;whpassportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;entryRealeaseDate\\&quot;:null,\\&quot;checkBondInvtNo\\&quot;:null,\\&quot;area\\&quot;:\\&quot;L\\&quot;,\\&quot;declareCustomeName\\&quot;:null,\\&quot;declareTradeCode\\&quot;:null,\\&quot;declareNumber\\&quot;:null,\\&quot;declareStatus\\&quot;:null,\\&quot;declareFlag\\&quot;:null,\\&quot;declareEdiNo\\&quot;:null,\\&quot;endStatus\\&quot;:null,\\&quot;endResult\\&quot;:null,\\&quot;changeType\\&quot;:null,\\&quot;productCharCode\\&quot;:\\&quot;0\\&quot;,\\&quot;passTime\\&quot;:null,\\&quot;receiveGoodsTime\\&quot;:null,\\&quot;whSeqNo\\&quot;:\\&quot;49E240800004879606\\&quot;},{\\&quot;id\\&quot;:867074,\\&quot;orgId\\&quot;:104370,\\&quot;whRecPreentNo\\&quot;:\\&quot;\\&quot;,\\&quot;inExpWhNo\\&quot;:\\&quot;PRE20230720E00404\\&quot;,\\&quot;inExpType\\&quot;:\\&quot;4\\&quot;,\\&quot;bizopEtpsno\\&quot;:\\&quot;3122S66009\\&quot;,\\&quot;bizopEtpsNm\\&quot;:\\&quot;上海语霆国际贸易股份有限公司\\&quot;,\\&quot;bizopEtpsSccd\\&quot;:\\&quot;91310115MA1K47Y39X\\&quot;,\\&quot;businessTypecd\\&quot;:\\&quot;26\\&quot;,\\&quot;inExpTime\\&quot;:null,\\&quot;mtpckEndprdTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;supvModecd\\&quot;:\\&quot;0110\\&quot;,\\&quot;trspModecd\\&quot;:\\&quot;0\\&quot;,\\&quot;impexpPortcd\\&quot;:\\&quot;2249\\&quot;,\\&quot;masterCuscd\\&quot;:\\&quot;2249\\&quot;,\\&quot;rltEntryNo\\&quot;:null,\\&quot;rltWhRecNo\\&quot;:\\&quot;1\\&quot;,\\&quot;whRecNo\\&quot;:null,\\&quot;dclTime\\&quot;:null,\\&quot;dclcusFlag\\&quot;:\\&quot;1\\&quot;,\\&quot;dclcusTypecd\\&quot;:null,\\&quot;preRecAccountTime\\&quot;:null,\\&quot;recAccountTime\\&quot;:null,\\&quot;invtIochkptStucd\\&quot;:\\&quot;1\\&quot;,\\&quot;vrfdedMarkcd\\&quot;:\\&quot;0\\&quot;,\\&quot;rmk\\&quot;:\\&quot;备注字段-添加备注\\&quot;,\\&quot;entryStucd\\&quot;:null,\\&quot;optStatus\\&quot;:\\&quot;1\\&quot;,\\&quot;destinationNatcd\\&quot;:\\&quot;142\\&quot;,\\&quot;tradeCountry\\&quot;:\\&quot;142\\&quot;,\\&quot;tradingRegion\\&quot;:\\&quot;142\\&quot;,\\&quot;districtCode\\&quot;:\\&quot;31166\\&quot;,\\&quot;grossWt\\&quot;:\\&quot;1000\\&quot;,\\&quot;transMode\\&quot;:\\&quot;1\\&quot;,\\&quot;ieTypecd\\&quot;:\\&quot;E\\&quot;,\\&quot;passportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;relDclcusFlag\\&quot;:\\&quot;1\\&quot;,\\&quot;inexpRltType\\&quot;:null,\\&quot;grtNo\\&quot;:\\&quot;1\\&quot;,\\&quot;isDrag\\&quot;:\\&quot;1\\&quot;,\\&quot;dclTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;chgTmsCnt\\&quot;:\\&quot;0\\&quot;,\\&quot;specialBusiness\\&quot;:null,\\&quot;allocationMode\\&quot;:\\&quot;1\\&quot;,\\&quot;enterNumber\\&quot;:null,\\&quot;releasePassDate\\&quot;:null,\\&quot;whpassportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;entryRealeaseDate\\&quot;:null,\\&quot;checkBondInvtNo\\&quot;:null,\\&quot;area\\&quot;:\\&quot;L\\&quot;,\\&quot;declareCustomeName\\&quot;:null,\\&quot;declareTradeCode\\&quot;:null,\\&quot;declareNumber\\&quot;:null,\\&quot;declareStatus\\&quot;:null,\\&quot;declareFlag\\&quot;:null,\\&quot;declareEdiNo\\&quot;:null,\\&quot;endStatus\\&quot;:null,\\&quot;endResult\\&quot;:null,\\&quot;changeType\\&quot;:null,\\&quot;productCharCode\\&quot;:null,\\&quot;passTime\\&quot;:null,\\&quot;receiveGoodsTime\\&quot;:null,\\&quot;whSeqNo\\&quot;:\\&quot;49E240800004879569\\&quot;},{\\&quot;id\\&quot;:867067,\\&quot;orgId\\&quot;:104370,\\&quot;whRecPreentNo\\&quot;:\\&quot;104370WH240821017067\\&quot;,\\&quot;inExpWhNo\\&quot;:\\&quot;PRE20230720E00402\\&quot;,\\&quot;inExpType\\&quot;:\\&quot;7\\&quot;,\\&quot;bizopEtpsno\\&quot;:\\&quot;3122S66009\\&quot;,\\&quot;bizopEtpsNm\\&quot;:\\&quot;上海语霆国际贸易股份有限公司\\&quot;,\\&quot;bizopEtpsSccd\\&quot;:\\&quot;91310115MA1K47Y39X\\&quot;,\\&quot;businessTypecd\\&quot;:\\&quot;25\\&quot;,\\&quot;inExpTime\\&quot;:null,\\&quot;mtpckEndprdTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;supvModecd\\&quot;:\\&quot;0110\\&quot;,\\&quot;trspModecd\\&quot;:\\&quot;0\\&quot;,\\&quot;impexpPortcd\\&quot;:\\&quot;2249\\&quot;,\\&quot;masterCuscd\\&quot;:\\&quot;2249\\&quot;,\\&quot;rltEntryNo\\&quot;:null,\\&quot;rltWhRecNo\\&quot;:null,\\&quot;whRecNo\\&quot;:null,\\&quot;dclTime\\&quot;:\\&quot;2024-08-21 10:54:12\\&quot;,\\&quot;dclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;dclcusTypecd\\&quot;:\\&quot;2\\&quot;,\\&quot;preRecAccountTime\\&quot;:null,\\&quot;recAccountTime\\&quot;:null,\\&quot;invtIochkptStucd\\&quot;:\\&quot;1\\&quot;,\\&quot;vrfdedMarkcd\\&quot;:\\&quot;0\\&quot;,\\&quot;rmk\\&quot;:\\&quot;备注字段-添加备注\\&quot;,\\&quot;entryStucd\\&quot;:null,\\&quot;optStatus\\&quot;:\\&quot;17\\&quot;,\\&quot;destinationNatcd\\&quot;:\\&quot;142\\&quot;,\\&quot;tradeCountry\\&quot;:\\&quot;142\\&quot;,\\&quot;tradingRegion\\&quot;:\\&quot;142\\&quot;,\\&quot;districtCode\\&quot;:\\&quot;31166\\&quot;,\\&quot;grossWt\\&quot;:\\&quot;1000\\&quot;,\\&quot;transMode\\&quot;:\\&quot;1\\&quot;,\\&quot;ieTypecd\\&quot;:\\&quot;E\\&quot;,\\&quot;passportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;relDclcusFlag\\&quot;:\\&quot;1\\&quot;,\\&quot;inexpRltType\\&quot;:null,\\&quot;grtNo\\&quot;:\\&quot;1\\&quot;,\\&quot;isDrag\\&quot;:\\&quot;1\\&quot;,\\&quot;dclTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;chgTmsCnt\\&quot;:\\&quot;0\\&quot;,\\&quot;specialBusiness\\&quot;:null,\\&quot;allocationMode\\&quot;:null,\\&quot;enterNumber\\&quot;:null,\\&quot;releasePassDate\\&quot;:null,\\&quot;whpassportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;entryRealeaseDate\\&quot;:null,\\&quot;checkBondInvtNo\\&quot;:null,\\&quot;area\\&quot;:\\&quot;L\\&quot;,\\&quot;declareCustomeName\\&quot;:null,\\&quot;declareTradeCode\\&quot;:null,\\&quot;declareNumber\\&quot;:null,\\&quot;declareStatus\\&quot;:null,\\&quot;declareFlag\\&quot;:null,\\&quot;declareEdiNo\\&quot;:null,\\&quot;endStatus\\&quot;:null,\\&quot;endResult\\&quot;:null,\\&quot;changeType\\&quot;:null,\\&quot;productCharCode\\&quot;:\\&quot;0\\&quot;,\\&quot;passTime\\&quot;:null,\\&quot;receiveGoodsTime\\&quot;:null,\\&quot;whSeqNo\\&quot;:\\&quot;49E240800004879562\\&quot;},{\\&quot;id\\&quot;:867045,\\&quot;orgId\\&quot;:104370,\\&quot;whRecPreentNo\\&quot;:\\&quot;104370WH240820017045\\&quot;,\\&quot;inExpWhNo\\&quot;:\\&quot;PRE20230720E00401\\&quot;,\\&quot;inExpType\\&quot;:\\&quot;5\\&quot;,\\&quot;bizopEtpsno\\&quot;:\\&quot;3122S66009\\&quot;,\\&quot;bizopEtpsNm\\&quot;:\\&quot;上海语霆国际贸易股份有限公司\\&quot;,\\&quot;bizopEtpsSccd\\&quot;:\\&quot;91310115MA1K47Y39X\\&quot;,\\&quot;businessTypecd\\&quot;:\\&quot;27\\&quot;,\\&quot;inExpTime\\&quot;:null,\\&quot;mtpckEndprdTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;supvModecd\\&quot;:\\&quot;0615\\&quot;,\\&quot;trspModecd\\&quot;:\\&quot;0\\&quot;,\\&quot;impexpPortcd\\&quot;:\\&quot;2249\\&quot;,\\&quot;masterCuscd\\&quot;:\\&quot;2249\\&quot;,\\&quot;rltEntryNo\\&quot;:null,\\&quot;rltWhRecNo\\&quot;:null,\\&quot;whRecNo\\&quot;:null,\\&quot;dclTime\\&quot;:\\&quot;2024-08-20 16:40:35\\&quot;,\\&quot;dclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;dclcusTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;preRecAccountTime\\&quot;:null,\\&quot;recAccountTime\\&quot;:null,\\&quot;invtIochkptStucd\\&quot;:\\&quot;1\\&quot;,\\&quot;vrfdedMarkcd\\&quot;:\\&quot;1\\&quot;,\\&quot;rmk\\&quot;:\\&quot;备注字段-添加备注\\&quot;,\\&quot;entryStucd\\&quot;:null,\\&quot;optStatus\\&quot;:\\&quot;5\\&quot;,\\&quot;destinationNatcd\\&quot;:\\&quot;142\\&quot;,\\&quot;tradeCountry\\&quot;:\\&quot;142\\&quot;,\\&quot;tradingRegion\\&quot;:\\&quot;142\\&quot;,\\&quot;districtCode\\&quot;:\\&quot;31166\\&quot;,\\&quot;grossWt\\&quot;:\\&quot;1000\\&quot;,\\&quot;transMode\\&quot;:\\&quot;1\\&quot;,\\&quot;ieTypecd\\&quot;:\\&quot;E\\&quot;,\\&quot;passportUsedTypecd\\&quot;:\\&quot;3\\&quot;,\\&quot;relDclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;inexpRltType\\&quot;:null,\\&quot;grtNo\\&quot;:\\&quot;1\\&quot;,\\&quot;isDrag\\&quot;:\\&quot;1\\&quot;,\\&quot;dclTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;chgTmsCnt\\&quot;:\\&quot;0\\&quot;,\\&quot;specialBusiness\\&quot;:null,\\&quot;allocationMode\\&quot;:null,\\&quot;enterNumber\\&quot;:null,\\&quot;releasePassDate\\&quot;:null,\\&quot;whpassportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;entryRealeaseDate\\&quot;:\\&quot;2024-08-20 16:41:24\\&quot;,\\&quot;checkBondInvtNo\\&quot;:null,\\&quot;area\\&quot;:\\&quot;L\\&quot;,\\&quot;declareCustomeName\\&quot;:null,\\&quot;declareTradeCode\\&quot;:null,\\&quot;declareNumber\\&quot;:null,\\&quot;declareStatus\\&quot;:null,\\&quot;declareFlag\\&quot;:null,\\&quot;declareEdiNo\\&quot;:null,\\&quot;endStatus\\&quot;:null,\\&quot;endResult\\&quot;:null,\\&quot;changeType\\&quot;:null,\\&quot;productCharCode\\&quot;:\\&quot;0\\&quot;,\\&quot;passTime\\&quot;:null,\\&quot;receiveGoodsTime\\&quot;:null,\\&quot;whSeqNo\\&quot;:\\&quot;49E240800004879559\\&quot;},{\\&quot;id\\&quot;:867044,\\&quot;orgId\\&quot;:104370,\\&quot;whRecPreentNo\\&quot;:\\&quot;104370WH240820017044\\&quot;,\\&quot;inExpWhNo\\&quot;:\\&quot;PRE20230720E00401\\&quot;,\\&quot;inExpType\\&quot;:\\&quot;7\\&quot;,\\&quot;bizopEtpsno\\&quot;:\\&quot;3122S66009\\&quot;,\\&quot;bizopEtpsNm\\&quot;:\\&quot;上海语霆国际贸易股份有限公司\\&quot;,\\&quot;bizopEtpsSccd\\&quot;:\\&quot;91310115MA1K47Y39X\\&quot;,\\&quot;businessTypecd\\&quot;:\\&quot;25\\&quot;,\\&quot;inExpTime\\&quot;:null,\\&quot;mtpckEndprdTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;supvModecd\\&quot;:\\&quot;0110\\&quot;,\\&quot;trspModecd\\&quot;:\\&quot;0\\&quot;,\\&quot;impexpPortcd\\&quot;:\\&quot;2249\\&quot;,\\&quot;masterCuscd\\&quot;:\\&quot;2249\\&quot;,\\&quot;rltEntryNo\\&quot;:null,\\&quot;rltWhRecNo\\&quot;:null,\\&quot;whRecNo\\&quot;:null,\\&quot;dclTime\\&quot;:\\&quot;2024-08-20 16:40:35\\&quot;,\\&quot;dclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;dclcusTypecd\\&quot;:\\&quot;2\\&quot;,\\&quot;preRecAccountTime\\&quot;:null,\\&quot;recAccountTime\\&quot;:null,\\&quot;invtIochkptStucd\\&quot;:\\&quot;1\\&quot;,\\&quot;vrfdedMarkcd\\&quot;:\\&quot;1\\&quot;,\\&quot;rmk\\&quot;:\\&quot;备注字段-添加备注\\&quot;,\\&quot;entryStucd\\&quot;:null,\\&quot;optStatus\\&quot;:\\&quot;5\\&quot;,\\&quot;destinationNatcd\\&quot;:\\&quot;142\\&quot;,\\&quot;tradeCountry\\&quot;:\\&quot;142\\&quot;,\\&quot;tradingRegion\\&quot;:\\&quot;142\\&quot;,\\&quot;districtCode\\&quot;:\\&quot;31166\\&quot;,\\&quot;grossWt\\&quot;:\\&quot;1000\\&quot;,\\&quot;transMode\\&quot;:\\&quot;1\\&quot;,\\&quot;ieTypecd\\&quot;:\\&quot;E\\&quot;,\\&quot;passportUsedTypecd\\&quot;:\\&quot;3\\&quot;,\\&quot;relDclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;inexpRltType\\&quot;:null,\\&quot;grtNo\\&quot;:\\&quot;1\\&quot;,\\&quot;isDrag\\&quot;:\\&quot;1\\&quot;,\\&quot;dclTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;chgTmsCnt\\&quot;:\\&quot;0\\&quot;,\\&quot;specialBusiness\\&quot;:null,\\&quot;allocationMode\\&quot;:null,\\&quot;enterNumber\\&quot;:null,\\&quot;releasePassDate\\&quot;:null,\\&quot;whpassportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;entryRealeaseDate\\&quot;:\\&quot;2024-08-20 16:41:18\\&quot;,\\&quot;checkBondInvtNo\\&quot;:null,\\&quot;area\\&quot;:\\&quot;L\\&quot;,\\&quot;declareCustomeName\\&quot;:null,\\&quot;declareTradeCode\\&quot;:null,\\&quot;declareNumber\\&quot;:null,\\&quot;declareStatus\\&quot;:null,\\&quot;declareFlag\\&quot;:null,\\&quot;declareEdiNo\\&quot;:null,\\&quot;endStatus\\&quot;:null,\\&quot;endResult\\&quot;:null,\\&quot;changeType\\&quot;:null,\\&quot;productCharCode\\&quot;:\\&quot;0\\&quot;,\\&quot;passTime\\&quot;:null,\\&quot;receiveGoodsTime\\&quot;:null,\\&quot;whSeqNo\\&quot;:\\&quot;49E240800004879558\\&quot;},{\\&quot;id\\&quot;:867043,\\&quot;orgId\\&quot;:104370,\\&quot;whRecPreentNo\\&quot;:\\&quot;104370WH240820017043\\&quot;,\\&quot;inExpWhNo\\&quot;:\\&quot;PRE20230720E00401\\&quot;,\\&quot;inExpType\\&quot;:\\&quot;1\\&quot;,\\&quot;bizopEtpsno\\&quot;:\\&quot;3122S66009\\&quot;,\\&quot;bizopEtpsNm\\&quot;:\\&quot;上海语霆国际贸易股份有限公司\\&quot;,\\&quot;bizopEtpsSccd\\&quot;:\\&quot;91310115MA1K47Y39X\\&quot;,\\&quot;businessTypecd\\&quot;:\\&quot;28\\&quot;,\\&quot;inExpTime\\&quot;:null,\\&quot;mtpckEndprdTypecd\\&quot;:\\&quot;I\\&quot;,\\&quot;supvModecd\\&quot;:\\&quot;0110\\&quot;,\\&quot;trspModecd\\&quot;:\\&quot;1\\&quot;,\\&quot;impexpPortcd\\&quot;:\\&quot;2249\\&quot;,\\&quot;masterCuscd\\&quot;:\\&quot;2249\\&quot;,\\&quot;rltEntryNo\\&quot;:null,\\&quot;rltWhRecNo\\&quot;:null,\\&quot;whRecNo\\&quot;:null,\\&quot;dclTime\\&quot;:\\&quot;2024-08-20 16:40:35\\&quot;,\\&quot;dclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;dclcusTypecd\\&quot;:\\&quot;2\\&quot;,\\&quot;preRecAccountTime\\&quot;:null,\\&quot;recAccountTime\\&quot;:null,\\&quot;invtIochkptStucd\\&quot;:\\&quot;1\\&quot;,\\&quot;vrfdedMarkcd\\&quot;:\\&quot;1\\&quot;,\\&quot;rmk\\&quot;:\\&quot;一纳成品出境\\&quot;,\\&quot;entryStucd\\&quot;:null,\\&quot;optStatus\\&quot;:\\&quot;5\\&quot;,\\&quot;destinationNatcd\\&quot;:\\&quot;142\\&quot;,\\&quot;tradeCountry\\&quot;:\\&quot;142\\&quot;,\\&quot;tradingRegion\\&quot;:\\&quot;142\\&quot;,\\&quot;districtCode\\&quot;:\\&quot;31166\\&quot;,\\&quot;grossWt\\&quot;:\\&quot;1000\\&quot;,\\&quot;transMode\\&quot;:\\&quot;1\\&quot;,\\&quot;ieTypecd\\&quot;:\\&quot;E\\&quot;,\\&quot;passportUsedTypecd\\&quot;:\\&quot;3\\&quot;,\\&quot;relDclcusFlag\\&quot;:\\&quot;2\\&quot;,\\&quot;inexpRltType\\&quot;:null,\\&quot;grtNo\\&quot;:\\&quot;1\\&quot;,\\&quot;isDrag\\&quot;:\\&quot;1\\&quot;,\\&quot;dclTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;chgTmsCnt\\&quot;:\\&quot;0\\&quot;,\\&quot;specialBusiness\\&quot;:null,\\&quot;allocationMode\\&quot;:null,\\&quot;enterNumber\\&quot;:null,\\&quot;releasePassDate\\&quot;:null,\\&quot;whpassportUsedTypecd\\&quot;:\\&quot;1\\&quot;,\\&quot;entryRealeaseDate\\&quot;:\\&quot;2024-08-20 16:41:03\\&quot;,\\&quot;checkBondInvtNo\\&quot;:null,\\&quot;area\\&quot;:\\&quot;L\\&quot;,\\&quot;declareCustomeName\\&quot;:null,\\&quot;declareTradeCode\\&quot;:null,\\&quot;declareNumber\\&quot;:null,\\&quot;declareStatus\\&quot;:null,\\&quot;declareFlag\\&quot;:null,\\&quot;declareEdiNo\\&quot;:null,\\&quot;endStatus\\&quot;:null,\\&quot;endResult\\&quot;:null,\\&quot;changeType\\&quot;:null,\\&quot;productCharCode\\&quot;:\\&quot;0\\&quot;,\\&quot;passTime\\&quot;:null,\\&quot;receiveGoodsTime\\&quot;:null,\\&quot;whSeqNo\\&quot;:\\&quot;49E240800004879557\\&quot;}],\\&quot;pageable\\&quot;:{\\&quot;sort\\&quot;:{\\&quot;sorted\\&quot;:false,\\&quot;unsorted\\&quot;:true,\\&quot;empty\\&quot;:true},\\&quot;pageSize\\&quot;:10,\\&quot;pageNumber\\&quot;:0,\\&quot;offset\\&quot;:0,\\&quot;unpaged\\&quot;:false,\\&quot;paged\\&quot;:true},\\&quot;totalElements\\&quot;:20,\\&quot;last\\&quot;:false,\\&quot;totalPages\\&quot;:2,\\&quot;first\\&quot;:true,\\&quot;sort\\&quot;:{\\&quot;sorted\\&quot;:false,\\&quot;unsorted\\&quot;:true,\\&quot;empty\\&quot;:true},\\&quot;numberOfElements\\&quot;:10,\\&quot;size\\&quot;:10,\\&quot;number\\&quot;:0,\\&quot;empty\\&quot;:false}}}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;businessFlag&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;contentType&quot;</span><span class="token operator">:</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;contextPath&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;cookies&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\\&quot;BDSVRTM\\&quot;:[{\\&quot;name\\&quot;:\\&quot;BDSVRTM\\&quot;,\\&quot;value\\&quot;:\\&quot;3\\&quot;}],\\&quot;BD_HOME\\&quot;:[{\\&quot;name\\&quot;:\\&quot;BD_HOME\\&quot;,\\&quot;value\\&quot;:\\&quot;1\\&quot;}]}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;exceptionMsg&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;fullUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://192.168.8.8:9002/wareHouse/getList&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metadata&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;afterReturningResultLength&quot;</span><span class="token operator">:</span><span class="token number">13508</span><span class="token punctuation">,</span><span class="token property">&quot;appCode&quot;</span><span class="token operator">:</span><span class="token string">&quot;lgsa-wareHouse-mgr&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;cmProjectCode&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gatewayClusterName&quot;</span><span class="token operator">:</span><span class="token string">&quot;cluster-api-gateway-lgsa-test-gcc&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gatewayLocalIpAddress&quot;</span><span class="token operator">:</span><span class="token string">&quot;[\\&quot;192.168.8.8\\&quot;]&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gatewayRequestHost&quot;</span><span class="token operator">:</span><span class="token string">&quot;192.168.116.12&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gatewayRequestUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://192.168.116.12:9101/wareHouse/getList&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gatewaySendTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2024-09-04T07:49:26.545Z&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;host&quot;</span><span class="token operator">:</span><span class="token string">&quot;192.168.8.8&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;responseContentType&quot;</span><span class="token operator">:</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;responseHttpStatusCode&quot;</span><span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token string">&quot;CompositeDiscoveryClient_wareHouse-mgr&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;routeToString&quot;</span><span class="token operator">:</span><span class="token string">&quot;Route{id=&#39;CompositeDiscoveryClient_wareHouse-mgr&#39;, uri=lb://lgsa-wareHouse-mgr, order=0, predicate=Paths: [/wareHouse/**], match trailing slash: true, gatewayFilters=[[[EpOauthAuthority clientId = &#39;XPQ_XTJG&#39;, customClientIdSwitch = &#39;false&#39;, customClientIdHeader = &#39;Custom-Ep-Oauth-Client-Id&#39;, whiteList = &#39;&#39;, validateList = &#39;&#39;, permitSwitch = &#39;false&#39;, permitWhiteList = [null], userAuthCodeKey = &#39;userAuthCode,appId,auth_code,Gw-App-Id,Gw-Authorization-Ac,Fip-Authorization-Ac&#39;, refreshTokenKey = &#39;refresh_token,epToken,Gw-Authorization-Rt&#39;, accessTokenKey = &#39;access_token,Gw-Authorization-At&#39;, userInfoInjectSwitch = &#39;true&#39;, whiteListInject = &#39;/v*/outside/ep-oauth/**,/v*/captcha/**&#39;, permitWhiteListInject = &#39;/v*/inside/ep-oauth/**&#39;, diyErrorInfoTD = [null], diyErrorInfoTE = [null], diyErrorInfoPNM = [null], orgExtApplyKey = [null], orgExtJsonKeyGray = &#39;gray&#39;, userExtApplyKey = [null], userExtJsonKeyGray = &#39;gray&#39;, graySwitch = &#39;false&#39;, userInfoType = &#39;EpOauthUserInfo&#39;], order = 1], [com.easipass.gateway.plugin.filter.LgsaAuthGatewayFilterFactory$1@4f13d2fd, order = 2]], metadata={response-timeout=100000, appCode=lgsa-wareHouse-mgr, multipart-form-data-white-list=, cm-project-code=}}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uummLoginId&quot;</span><span class="token operator">:</span><span class="token string">&quot;Ad_001&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uummOrgCode&quot;</span><span class="token operator">:</span><span class="token string">&quot;MA1K47Y39&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uummOrgName&quot;</span><span class="token operator">:</span><span class="token string">&quot;上海语霆国际贸易有限公司&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;proceedMills&quot;</span><span class="token operator">:</span><span class="token number">3053</span><span class="token punctuation">,</span><span class="token property">&quot;queryString&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;requestBody&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\\r\\n  \\&quot;size\\&quot;: 10,\\r\\n  \\&quot;page\\&quot;: 1\\r\\n}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;requestHeaders&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\\&quot;Accept\\&quot;:[\\&quot;*/*\\&quot;],\\&quot;Accept-Encoding\\&quot;:[\\&quot;gzip, deflate, br\\&quot;],\\&quot;Content-Length\\&quot;:[\\&quot;32\\&quot;],\\&quot;Content-Type\\&quot;:[\\&quot;application/json\\&quot;],\\&quot;Cookie\\&quot;:[\\&quot;BDSVRTM=3; BD_HOME=1\\&quot;],\\&quot;Eptoken\\&quot;:[\\&quot;75b166bf-70d2-42ee-9cf4-fdf0698c6227\\&quot;],\\&quot;Host\\&quot;:[\\&quot;192.168.8.8:9002\\&quot;],\\&quot;Postman-Token\\&quot;:[\\&quot;df3b92f2-7600-4190-beb8-9e614fadf5ac\\&quot;],\\&quot;User-Agent\\&quot;:[\\&quot;PostmanRuntime/7.41.1\\&quot;],\\&quot;X-B3-SpanId\\&quot;:[\\&quot;0\\&quot;],\\&quot;X-B3-TraceId\\&quot;:[\\&quot;c0a808081725436163546100132484\\&quot;]}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;requestMethod&quot;</span><span class="token operator">:</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;requestParames&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;requestUri&quot;</span><span class="token operator">:</span><span class="token string">&quot;/wareHouse/getList&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;requestUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://192.168.8.8:9002/wareHouse/getList&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;responseHeaders&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\\&quot;Content-Type\\&quot;:[\\&quot;application/json;charset=UTF-8\\&quot;],\\&quot;Date\\&quot;:[\\&quot;Wed, 04 Sep 2024 07:48:11 GMT\\&quot;],\\&quot;X-B3-TraceId\\&quot;:[\\&quot;c0a808081725436163546100132484\\&quot;],\\&quot;transfer-encoding\\&quot;:[\\&quot;chunked\\&quot;]}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;restBizResultCode&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;restResultCode&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;serverIp&quot;</span><span class="token operator">:</span><span class="token string">&quot;192.168.8.8&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;servletPath&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;sessionId&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;stackTraceMsg&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;topicProject&quot;</span><span class="token operator">:</span><span class="token string">&quot;ep-api-gateway&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;traceId&quot;</span><span class="token operator">:</span><span class="token string">&quot;c0a808081725436163546100132484&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;userAgent&quot;</span><span class="token operator">:</span><span class="token string">&quot;PostmanRuntime/7.41.1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;userIp&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240904160246632.png" alt="image-20240904160246632" tabindex="0" loading="lazy"><figcaption>image-20240904160246632</figcaption></figure><figure><img src="http://47.101.155.205/image-20240904163855127.png" alt="image-20240904163855127" tabindex="0" loading="lazy"><figcaption>image-20240904163855127</figcaption></figure><h4 id="添加json过滤器" tabindex="-1"><a class="header-anchor" href="#添加json过滤器"><span>添加json过滤器</span></a></h4><div class="language-conf" data-highlighter="prismjs" data-ext="conf" data-title="conf"><pre><code><span class="line">json {</span>
<span class="line">	source =&gt; &quot;message&quot; # 要解析的字段,应该是json字符串,通常是message</span>
<span class="line">	target =&gt; &quot;msg&quot; # 可选,指定解析后的json数据存储在哪个字段下,没指定直接作为根字段</span>
<span class="line">	remove_field =&gt; [&quot;msginfo&quot;] # 可选,移除指定字段,通常是原始的json字符串字段</span>
<span class="line">	add_field =&gt; # 可选,解析完成后,添加额外的字段</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>使用stdin，json的长度超过4096会无法全部输入，切换成file文件输入。</p><p><strong>/logstash-8.15.0/data/plugins/inputs/file目录下隐藏文件删除，logstash会重头开始读取文件。</strong></p><p>解析message的json字段后再移除，json中的key作为json的根，message字段也删除了。</p><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    file {</span>
<span class="line">    	path =&gt; &quot;/u01/lgsa/local/logstash-8.15.0/json/gateway.json&quot;</span>
<span class="line">    	start_position =&gt; &quot;beginning&quot;</span>
<span class="line">  	}</span>
<span class="line">}</span>
<span class="line">filter {</span>
<span class="line">	json {</span>
<span class="line">		source =&gt; &quot;message&quot;</span>
<span class="line">		remove_field =&gt; [&quot;message&quot;]</span>
<span class="line">	}</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    elasticsearch {</span>
<span class="line">        hosts =&gt; [&quot;http://192.168.125.165:9200&quot;]</span>
<span class="line">        index =&gt; &quot;log-nginx-%{+YYYY-MM}&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.test_and_exit</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.reload.automatic</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240904162555758.png" alt="image-20240904162555758" tabindex="0" loading="lazy"><figcaption>image-20240904162555758</figcaption></figure><figure><img src="http://47.101.155.205/image-20240904162603107.png" alt="image-20240904162603107" tabindex="0" loading="lazy"><figcaption>image-20240904162603107</figcaption></figure><figure><img src="http://47.101.155.205/image-20240904162658884.png" alt="image-20240904162658884" tabindex="0" loading="lazy"><figcaption>image-20240904162658884</figcaption></figure><h4 id="json添加target效果" tabindex="-1"><a class="header-anchor" href="#json添加target效果"><span>json添加target效果</span></a></h4><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    file {</span>
<span class="line">    	path =&gt; &quot;/u01/lgsa/local/logstash-8.15.0/json/gateway2.json&quot;</span>
<span class="line">    	start_position =&gt; &quot;beginning&quot;</span>
<span class="line">  	}</span>
<span class="line">}</span>
<span class="line">filter {</span>
<span class="line">	json {</span>
<span class="line">		source =&gt; &quot;message&quot;</span>
<span class="line">		remove_field =&gt; [&quot;message&quot;]</span>
<span class="line">		target =&gt; &quot;kakfa&quot;</span>
<span class="line">	}</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    elasticsearch {</span>
<span class="line">        hosts =&gt; [&quot;http://192.168.125.165:9200&quot;]</span>
<span class="line">        index =&gt; &quot;log-nginx-%{+YYYY-MM}&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>json对象有一个key为target的值。</p><figure><img src="http://47.101.155.205/image-20240904164419543.png" alt="image-20240904164419543" tabindex="0" loading="lazy"><figcaption>image-20240904164419543</figcaption></figure><figure><img src="http://47.101.155.205/image-20240904164508813.png" alt="image-20240904164508813" tabindex="0" loading="lazy"><figcaption>image-20240904164508813</figcaption></figure><h4 id="grok搭配json使用" tabindex="-1"><a class="header-anchor" href="#grok搭配json使用"><span>grok搭配json使用</span></a></h4><p>kibana有grok的表达式调试器</p><figure><img src="http://47.101.155.205/image-20240905090837128.png" alt="image-20240905090837128" tabindex="0" loading="lazy"><figcaption>image-20240905090837128</figcaption></figure><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    file {</span>
<span class="line">    	path =&gt; &quot;/u01/lgsa/local/logstash-8.15.0/json/gateway6.json&quot;</span>
<span class="line">    	start_position =&gt; &quot;beginning&quot;</span>
<span class="line">  	}</span>
<span class="line">}</span>
<span class="line">filter {</span>
<span class="line">	grok {</span>
<span class="line">	match =&gt; [&quot;message&quot;, &quot;(?&lt;time&gt;%{YEAR}[-]%{MONTHNUM}[-]%{MONTHDAY} %{TIME}) %{NOTSPACE:level} \\[%{NOTSPACE:threadId}\\] \\[%{NOTSPACE:threadName}\\] \\[%{NOTSPACE:class}\\]\\s+\\-+\\s+%{GREEDYDATA:msginfo}&quot;]</span>
<span class="line">}</span>
<span class="line">json {	</span>
<span class="line">	source =&gt; &quot;msginfo&quot;</span>
<span class="line">	remove_field=&gt;[&quot;msginfo&quot;]</span>
<span class="line">}</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    elasticsearch {</span>
<span class="line">        hosts =&gt; [&quot;http://192.168.125.165:9200&quot;]</span>
<span class="line">        index =&gt; &quot;log-nginx-%{+YYYY-MM}&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token date number">2024-09-04</span> <span class="token time number">12:34:56</span> <span class="token level info keyword">INFO</span> <span class="token punctuation">[</span><span class="token number">12345</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>MyClass<span class="token punctuation">]</span> <span class="token operator">-</span> json字符串</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.test_and_exit</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.reload.automatic</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240904172442698.png" alt="image-20240904172442698" tabindex="0" loading="lazy"><figcaption>image-20240904172442698</figcaption></figure><h3 id="解析特定格式log日志" tabindex="-1"><a class="header-anchor" href="#解析特定格式log日志"><span>解析特定格式log日志</span></a></h3><p>日志格式，[%-5level]会在INOF后面补空格，导致[INFO ]的日志解析失败。</p><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{HH:mm:ss.SSS}[%X{traceId},%X{spanId}] [%-5level] [%thread] %logger{36} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>grok表达式，\\[%{LOGLEVEL:level}\\]需要对空格再处理</p><div class="language-conf" data-highlighter="prismjs" data-ext="conf" data-title="conf"><pre><code><span class="line">%{TIME:time}\\[%{DATA:traceId},%{DATA:spanId}\\] \\[%{LOGLEVEL:level}\\s*\\] \\[%{DATA:threadName}\\] %{JAVACLASS:class} - %{GREEDYDATA:msg}</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-first-pipeline.conf line-numbers-mode" data-highlighter="prismjs" data-ext="first-pipeline.conf" data-title="first-pipeline.conf"><pre><code><span class="line">input {</span>
<span class="line">    file {</span>
<span class="line">    	path =&gt; &quot;/u01/lgsa/local/logstash-8.15.0/logFile.2024-09-05.log&quot;</span>
<span class="line">    	start_position =&gt; &quot;beginning&quot;</span>
<span class="line">  	}</span>
<span class="line">}</span>
<span class="line">filter {</span>
<span class="line">	grok {</span>
<span class="line">	match =&gt; { &quot;message&quot; =&gt; &quot;%{TIME:time}\\[%{DATA:traceId},%{DATA:spanId}\\] \\[%{LOGLEVEL:level}\\s*\\] \\[%{DATA:threadName}\\] %{JAVACLASS:class} - %{GREEDYDATA:msg}&quot; }</span>
<span class="line">	}</span>
<span class="line">	mutate  {</span>
<span class="line">		# 添加属性</span>
<span class="line">		add_field =&gt; { &quot;current_date&quot; =&gt; &quot;%{+YYYY-MM-dd}&quot; }</span>
<span class="line">		# 删除属性</span>
<span class="line">		remove_field =&gt; [ &quot;message&quot; ]</span>
<span class="line">	}</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    elasticsearch {</span>
<span class="line">        hosts =&gt; [&quot;http://192.168.125.165:9200&quot;]</span>
<span class="line">        index =&gt; &quot;log-nginx-%{+YYYY-MM}&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240905161235538.png" alt="image-20240905161235538" tabindex="0" loading="lazy"><figcaption>image-20240905161235538</figcaption></figure><figure><img src="http://47.101.155.205/image-20240905163420840.png" alt="image-20240905163420840" tabindex="0" loading="lazy"><figcaption>image-20240905163420840</figcaption></figure><p>解析效果</p><figure><img src="http://47.101.155.205/image-20240905165333482.png" alt="image-20240905165333482" tabindex="0" loading="lazy"><figcaption>image-20240905165333482</figcaption></figure><p>logstash.yml中编辑配置，强制保持事件(message消息)的顺序性质</p><figure><img src="http://47.101.155.205/image-20240905165825560.png" alt="image-20240905165825560" tabindex="0" loading="lazy"><figcaption>image-20240905165825560</figcaption></figure><p><strong>pipeline.ordered: auto修改为true</strong></p><figure><img src="http://47.101.155.205/image-20240905170326388.png" alt="image-20240905170326388" tabindex="0" loading="lazy"><figcaption>image-20240905170326388</figcaption></figure><h4 id="日志格式" tabindex="-1"><a class="header-anchor" href="#日志格式"><span>日志格式</span></a></h4><div class="language-conf line-numbers-mode" data-highlighter="prismjs" data-ext="conf" data-title="conf"><pre><code><span class="line">input {</span>
<span class="line">    file {</span>
<span class="line">    	path =&gt; &quot;/u01/lgsa/local/logstash-8.15.0/eg-info.2024-09-09.log&quot;</span>
<span class="line">    	start_position =&gt; &quot;beginning&quot;</span>
<span class="line">  	}</span>
<span class="line">}</span>
<span class="line">filter {</span>
<span class="line">	grok {</span>
<span class="line">		match =&gt; { &quot;message&quot; =&gt; &quot;%{TIME:time} \\[%{LOGLEVEL:level}\\s*\\] \\[%{DATA:threadName}\\] %{JAVACLASS:class} - %{GREEDYDATA:msg}&quot; }</span>
<span class="line">	}</span>
<span class="line">	</span>
<span class="line">	if &quot;_grokparsefailure&quot; in [tags] {</span>
<span class="line">    	drop { }</span>
<span class="line">  	}</span>
<span class="line">	mutate  {</span>
<span class="line">		# 添加属性</span>
<span class="line">		add_field =&gt; { &quot;current_date&quot; =&gt; &quot;%{+YYYY-MM-dd}&quot; }</span>
<span class="line">		# 删除属性</span>
<span class="line">		remove_field =&gt; [ &quot;message&quot;, &quot;hostName&quot;, &quot;appType&quot;, &quot;logid&quot;]</span>
<span class="line">	}</span>
<span class="line">	json {	</span>
<span class="line">		source =&gt; &quot;msg&quot;</span>
<span class="line">		remove_field=&gt;[&quot;msg&quot;]</span>
<span class="line">	}</span>
<span class="line">}</span>
<span class="line">output {</span>
<span class="line">    elasticsearch {</span>
<span class="line">        hosts =&gt; [&quot;http://192.168.125.165:9200&quot;]</span>
<span class="line">        index =&gt; &quot;log-nginx-%{+YYYY-MM}&quot;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.test_and_exit</span></span>
<span class="line">bin/logstash <span class="token parameter variable">-f</span> config/first-pipeline.conf <span class="token parameter variable">--config.reload.automatic</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240911103957579.png" alt="image-20240911103957579" tabindex="0" loading="lazy"><figcaption>image-20240911103957579</figcaption></figure><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># 这里设置前置顺序执行，需要pipeline.workers改为1，默认应该是2启动的，有冲突</span></span>
<span class="line"><span class="token key atrule">pipeline.ordered</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"><span class="token key atrule">pipeline.workers</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240911110322473.png" alt="image-20240911110322473" tabindex="0" loading="lazy"><figcaption>image-20240911110322473</figcaption></figure>`,223)]))}const u=n(o,[["render",p],["__file","ELK.html.vue"]]),c=JSON.parse('{"path":"/monitoring/ELK.html","title":"ELK","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"Elasticsearch","slug":"elasticsearch","link":"#elasticsearch","children":[{"level":3,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":3,"title":"启动","slug":"启动","link":"#启动","children":[]}]},{"level":2,"title":"Kibana","slug":"kibana","link":"#kibana","children":[{"level":3,"title":"安装启动","slug":"安装启动","link":"#安装启动","children":[]},{"level":3,"title":"Http协议连接ES(中文)","slug":"http协议连接es-中文","link":"#http协议连接es-中文","children":[]},{"level":3,"title":"Kibana使用文档","slug":"kibana使用文档","link":"#kibana使用文档","children":[]}]},{"level":2,"title":"Kibana操作ES指南","slug":"kibana操作es指南","link":"#kibana操作es指南","children":[{"level":3,"title":"往ES索引中添加数据","slug":"往es索引中添加数据","link":"#往es索引中添加数据","children":[]},{"level":3,"title":"索引中添加多条数据","slug":"索引中添加多条数据","link":"#索引中添加多条数据","children":[]},{"level":3,"title":"搜索索引中的数据","slug":"搜索索引中的数据","link":"#搜索索引中的数据","children":[]},{"level":3,"title":"删除索引中匹配的数据","slug":"删除索引中匹配的数据","link":"#删除索引中匹配的数据","children":[]},{"level":3,"title":"搜索接口api","slug":"搜索接口api","link":"#搜索接口api","children":[]},{"level":3,"title":"添加数据进阶","slug":"添加数据进阶","link":"#添加数据进阶","children":[]},{"level":3,"title":"ES客户端","slug":"es客户端","link":"#es客户端","children":[]}]},{"level":2,"title":"Logstash","slug":"logstash","link":"#logstash","children":[{"level":3,"title":"安装","slug":"安装-1","link":"#安装-1","children":[]},{"level":3,"title":"启动","slug":"启动-1","link":"#启动-1","children":[]},{"level":3,"title":"结合Filebeat解析日志","slug":"结合filebeat解析日志","link":"#结合filebeat解析日志","children":[]},{"level":3,"title":"使用grok过滤器","slug":"使用grok过滤器","link":"#使用grok过滤器","children":[]},{"level":3,"title":"使用geoip过滤器","slug":"使用geoip过滤器","link":"#使用geoip过滤器","children":[]},{"level":3,"title":"output to ELasticsearch","slug":"output-to-elasticsearch","link":"#output-to-elasticsearch","children":[]},{"level":3,"title":"解析特定格式log日志","slug":"解析特定格式log日志","link":"#解析特定格式log日志","children":[]}]}],"git":{"updatedTime":1737272098000,"contributors":[{"name":"oycm","username":"oycm","email":"1164864987@qq.com","commits":2,"url":"https://github.com/oycm"}]},"filePathRelative":"monitoring/ELK.md"}');export{u as comp,c as data};
