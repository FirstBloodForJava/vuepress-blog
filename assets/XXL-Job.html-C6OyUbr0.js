import{_ as n,c as s,e,o as t}from"./app-BIGZvh4f.js";const l={};function p(i,a){return t(),s("div",null,a[0]||(a[0]=[e(`<h1 id="xxl-job" tabindex="-1"><a class="header-anchor" href="#xxl-job"><span>xxl-job</span></a></h1><p>GitHub官网地址：https://github.com/xuxueli/xxl-job/</p><p>XXL-JOB官网文档地址：https://www.xuxueli.com/xxl-job/</p><h2 id="调度中心" tabindex="-1"><a class="header-anchor" href="#调度中心"><span>调度中心</span></a></h2><p><code>xxl-job-admin</code>模块是调度中心。</p><h3 id="配置文件" tabindex="-1"><a class="header-anchor" href="#配置文件"><span>配置文件</span></a></h3><p>调度中心配置文件说明：</p><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token comment"># web 端口+servlet上下文配置</span></span>
<span class="line"><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">8080</span></span>
<span class="line"><span class="token key attr-name">server.servlet.context-path</span><span class="token punctuation">=</span><span class="token value attr-value">/xxl-job-admin</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># actuator 监控相关配置</span></span>
<span class="line"><span class="token key attr-name">management.server.base-path</span><span class="token punctuation">=</span><span class="token value attr-value">/actuator</span></span>
<span class="line"><span class="token key attr-name">management.health.mail.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># web 静态资源</span></span>
<span class="line"><span class="token key attr-name">spring.mvc.servlet.load-on-startup</span><span class="token punctuation">=</span><span class="token value attr-value">0</span></span>
<span class="line"><span class="token key attr-name">spring.mvc.static-path-pattern</span><span class="token punctuation">=</span><span class="token value attr-value">/static/**</span></span>
<span class="line"><span class="token key attr-name">spring.web.resources.static-locations</span><span class="token punctuation">=</span><span class="token value attr-value">classpath:/static/</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># freemarker 模板引擎配置</span></span>
<span class="line"><span class="token key attr-name">spring.freemarker.templateLoaderPath</span><span class="token punctuation">=</span><span class="token value attr-value">classpath:/templates/</span></span>
<span class="line"><span class="token key attr-name">spring.freemarker.suffix</span><span class="token punctuation">=</span><span class="token value attr-value">.ftl</span></span>
<span class="line"><span class="token key attr-name">spring.freemarker.charset</span><span class="token punctuation">=</span><span class="token value attr-value">UTF-8</span></span>
<span class="line"><span class="token key attr-name">spring.freemarker.request-context-attribute</span><span class="token punctuation">=</span><span class="token value attr-value">request</span></span>
<span class="line"><span class="token key attr-name">spring.freemarker.settings.number_format</span><span class="token punctuation">=</span><span class="token value attr-value">0.##########</span></span>
<span class="line"><span class="token key attr-name">spring.freemarker.settings.new_builtin_class_resolver</span><span class="token punctuation">=</span><span class="token value attr-value">safer</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># mybatis xml映射地址</span></span>
<span class="line"><span class="token key attr-name">mybatis.mapper-locations</span><span class="token punctuation">=</span><span class="token value attr-value">classpath:/mybatis-mapper/*Mapper.xml</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># datasource-pool 连接池配置</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.type</span><span class="token punctuation">=</span><span class="token value attr-value">com.zaxxer.hikari.HikariDataSource</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.hikari.minimum-idle</span><span class="token punctuation">=</span><span class="token value attr-value">10</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.hikari.maximum-pool-size</span><span class="token punctuation">=</span><span class="token value attr-value">30</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.hikari.auto-commit</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.hikari.idle-timeout</span><span class="token punctuation">=</span><span class="token value attr-value">30000</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.hikari.pool-name</span><span class="token punctuation">=</span><span class="token value attr-value">HikariCP</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.hikari.max-lifetime</span><span class="token punctuation">=</span><span class="token value attr-value">900000</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.hikari.connection-timeout</span><span class="token punctuation">=</span><span class="token value attr-value">10000</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.hikari.connection-test-query</span><span class="token punctuation">=</span><span class="token value attr-value">SELECT 1</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.hikari.validation-timeout</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># xxl-job, datasource 数据库配置</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://127.0.0.1:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">root_pwd</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># xxl-job, spring email 邮件配置</span></span>
<span class="line"><span class="token key attr-name">spring.mail.host</span><span class="token punctuation">=</span><span class="token value attr-value">smtp.qq.com</span></span>
<span class="line"><span class="token key attr-name">spring.mail.port</span><span class="token punctuation">=</span><span class="token value attr-value">25</span></span>
<span class="line"><span class="token key attr-name">spring.mail.username</span><span class="token punctuation">=</span><span class="token value attr-value">xxx@qq.com</span></span>
<span class="line"><span class="token key attr-name">spring.mail.from</span><span class="token punctuation">=</span><span class="token value attr-value">1164864987@qq.com</span></span>
<span class="line"><span class="token key attr-name">spring.mail.password</span><span class="token punctuation">=</span><span class="token value attr-value">xxx</span></span>
<span class="line"><span class="token key attr-name">spring.mail.properties.mail.smtp.auth</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"><span class="token key attr-name">spring.mail.properties.mail.smtp.starttls.enable</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"><span class="token key attr-name">spring.mail.properties.mail.smtp.starttls.required</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"><span class="token key attr-name">spring.mail.properties.mail.smtp.socketFactory.class</span><span class="token punctuation">=</span><span class="token value attr-value">javax.net.ssl.SSLSocketFactory</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">### xxl-job, access token</span></span>
<span class="line"><span class="token key attr-name">xxl.job.accessToken</span><span class="token punctuation">=</span><span class="token value attr-value">default_token</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># xxl-job, 调度中心触发任务的超时时间</span></span>
<span class="line"><span class="token key attr-name">xxl.job.timeout</span><span class="token punctuation">=</span><span class="token value attr-value">3</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># xxl-job, i18n (default is zh_CN, and you can choose &quot;zh_CN&quot;, &quot;zh_TC&quot; and &quot;en&quot;) i18n国际化配置</span></span>
<span class="line"><span class="token key attr-name">xxl.job.i18n</span><span class="token punctuation">=</span><span class="token value attr-value">zh_CN</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># xxl-job, 调度线程池最大数量 max size</span></span>
<span class="line"><span class="token key attr-name">xxl.job.triggerpool.fast.max</span><span class="token punctuation">=</span><span class="token value attr-value">200</span></span>
<span class="line"><span class="token key attr-name">xxl.job.triggerpool.slow.max</span><span class="token punctuation">=</span><span class="token value attr-value">100</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># xxl-job, log retention days 日志保留天数 小于7不生效</span></span>
<span class="line"><span class="token key attr-name">xxl.job.logretentiondays</span><span class="token punctuation">=</span><span class="token value attr-value">30</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="docker镜像构建" tabindex="-1"><a class="header-anchor" href="#docker镜像构建"><span>Docker镜像构建</span></a></h3><p>Dockerfile构建Docker镜像命令</p><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker" data-title="docker"><pre><code><span class="line"><span class="token comment"># jre运行环境</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> openjdk:8-jre-slim</span></span>
<span class="line"><span class="token comment"># 镜像创建者</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">MAINTAINER</span> ouyangcm</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">ENV</span> PARAMS=<span class="token string">&quot;&quot;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">ENV</span> TZ=PRC</span></span>
<span class="line"><span class="token comment"># 设置系统时区为中国标准时间</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> ln -snf /usr/share/zoneinfo/<span class="token variable">$TZ</span> /etc/localtime &amp;&amp; echo <span class="token variable">$TZ</span> &gt; /etc/timezone</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 添加jar文件到镜像</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">ADD</span> target/xxl-job-admin-*.jar /app.jar</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动镜像命令</span></span>
<span class="line"><span class="token comment"># PARAMS 通过环境变量替换jar包的配置文件配置</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;sh&quot;</span>,<span class="token string">&quot;-c&quot;</span>,<span class="token string">&quot;java -jar $JAVA_OPTS /app.jar $PARAMS&quot;</span>]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 使用Dockerfile 构建镜像</span></span>
<span class="line"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> xxl-job-admin:1.0 <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动镜像</span></span>
<span class="line"><span class="token comment"># -v /tmp:/data/applogs 主机目录和容器目录挂载</span></span>
<span class="line"><span class="token comment"># --name 容器名称</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-e</span> <span class="token assign-left variable">PARAMS</span><span class="token operator">=</span><span class="token string">&quot;--spring.datasource.url=jdbc:mysql://127.0.0.1:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai&quot;</span> <span class="token parameter variable">-p</span> <span class="token number">8080</span>:8080 <span class="token parameter variable">-v</span> /tmp:/data/applogs <span class="token parameter variable">--name</span> xxl-job-admin  <span class="token parameter variable">-d</span> xxl-job-admin:1.0</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="logback" tabindex="-1"><a class="header-anchor" href="#logback"><span>logback</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span> <span class="token attr-name">debug</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scanPeriod</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1 seconds<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contextName</span><span class="token punctuation">&gt;</span></span>logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contextName</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log.path<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/data/applogs/xxl-job/xxl-job-admin.log<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>console<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>\${log.path}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>\${log.path}.%d{yyyy-MM-dd}.zip<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%date %level [%thread] %logger{36} [%file : %line] %msg%n</span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>console<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="触发一次任务" tabindex="-1"><a class="header-anchor" href="#触发一次任务"><span>触发一次任务</span></a></h3><p>uri：<code>/xxl-job-admin/jobinfo/trigger</code></p><p>请求方式：<code>POST</code></p><p>请求参数格式：<code>application/x-www-form-urlencoded; charset=UTF-8</code></p><div class="language-markdown" data-highlighter="prismjs" data-ext="md" data-title="md"><pre><code><span class="line"><span class="token title important"><span class="token punctuation">#</span> 任务 id</span></span>
<span class="line">id=4&amp;</span>
<span class="line">executorParam=ping+192.168.8.8&amp;</span>
<span class="line">addressList=</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="停止执行器" tabindex="-1"><a class="header-anchor" href="#停止执行器"><span>停止执行器</span></a></h3><p>uri：<code>/xxl-job-admin/jobinfo/stop</code></p><p>请求方式：<code>POST</code></p><p>请求参数格式：<code>application/x-www-form-urlencoded; charset=UTF-8</code></p><div class="language-markdown" data-highlighter="prismjs" data-ext="md" data-title="md"><pre><code><span class="line"><span class="token title important"><span class="token punctuation">#</span> 任务 id</span></span>
<span class="line">id=4</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="停止调度中任务" tabindex="-1"><a class="header-anchor" href="#停止调度中任务"><span>停止调度中任务</span></a></h3><p>uri：<code>/xxl-job-admin/jobinfo/logKill</code></p><p>请求方式：<code>POST</code></p><p>请求参数格式：<code>application/x-www-form-urlencoded; charset=UTF-8</code></p><div class="language-markdown" data-highlighter="prismjs" data-ext="md" data-title="md"><pre><code><span class="line"><span class="token title important"><span class="token punctuation">#</span> 调度记录 id</span></span>
<span class="line">id=4</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>停止任务逻辑如下：</p><ol><li>根据 id 查询调度记录，获取执行器信息，<code>ip:port</code>；</li><li>调用执行器的 <code>kill</code>接口；等待接口返回；</li><li>执行器 <code>kill</code> 逻辑： <ol><li>根据调度记录id，获取任务线程对象 <code>JobThread</code>，不存在则直接返回成功；</li><li>将任务线程对象从缓存中移除，标记任务停止；</li><li>调用线程的实例方法 <code>interrupt()</code> 标记线程中断，结束。</li><li><strong>如果需要停止任务，还需要任务执行器线程自己获取线程中断状态，会根据线程对象的属性来停止任务。</strong></li></ol></li><li>执行器返回成功，则根据调度记录的任务状态和日志。</li></ol><h2 id="执行器" tabindex="-1"><a class="header-anchor" href="#执行器"><span>执行器</span></a></h2><p><code>xxl-job-executor-sample-springboot</code>基于SpringBoot开发的执行器例子。</p><figure><img src="http://47.101.155.205/image-20250604165149209.png" alt="image-20250604165149209" tabindex="0" loading="lazy"><figcaption>image-20250604165149209</figcaption></figure><p>执行器启动，会开启一个线程先 xxl-job-admin 注册自己。xxl_job_registry 表中存储注册的应用名和地址信息。xxl-job-admin 会定时去检测这个表中的执行器是否可用，如果不可用则删除该配置。如果可用，则会将相同 <code>appname</code> 的地址设置到自动注册的执行器地址。</p><h3 id="运行模式" tabindex="-1"><a class="header-anchor" href="#运行模式"><span>运行模式</span></a></h3><p>支持的运行模式有：</p><ul><li>BEAN：结合<code>JobHandler</code>属性使用，<code>JobHandler</code>设置</li><li>GLUE(Java)：</li><li>GLUE(Shell)：</li><li>GLUE(Python)：</li><li>GLUE(PHP)：</li><li>GLUE(NodeJS)：</li><li>GLUE(PowerShell)：</li></ul><h4 id="运行本质" tabindex="-1"><a class="header-anchor" href="#运行本质"><span>运行本质</span></a></h4><p>执行器作为一个Netty Web容器，在启动时将JobHandler注册在其中。当调度中心配置的任务被触发时，将触发参数调用在执行器的<code>run</code>接口上，执行器在根据参数做对应的任务调度。容器的核心类：<code>EmbedServer</code>。</p><p>无框架的执行还是SpringBoot的执行器，调度逻辑都是如此。</p><figure><img src="http://47.101.155.205/image-20250610214852614.png" alt="image-20250610214852614" tabindex="0" loading="lazy"><figcaption>image-20250610214852614</figcaption></figure><p>任务的调用逻辑：</p><ol><li>处理请求的线程上，在启动了一个任务线程来处理真正的任务。</li><li>任务可中断功能仅支持阻塞状态的线程，例如：<code>sleep</code>、<code>wait</code>、<code>join</code>等。如果线程是在运行状态，则是伪中断。</li><li>任务启动后，在调度中心的有两个线程池，一个线程池负责查询出执行时间在当前时间+5s前的； <ol><li>如果任务下次执行时间早于当前时间-5s，根据过期策略是否触发任务，并设置下次任务执行时间；</li><li>如果任务下次执行时间在当前时间前5s内，触发调度，并设置下次调用时间，如果下次调用时间少于5s，则将任务放入map中交给另外一个ring线程处理并设只下次调用时间；</li><li>如果任务还未到触发事件，5s内调用，则将任务放入map交给另外线程处理，并设置下次调用时间。</li></ol></li></ol><h4 id="_1-bean" tabindex="-1"><a class="header-anchor" href="#_1-bean"><span>1.BEAN</span></a></h4><p>实现自定义执行器的方式：</p><ol><li>注册类模式：继承<code>com.xxl.job.core.handler.IJobHandler</code>抽象类，手动注册到执行器容器。</li><li>注解方法模式：<code>@XxlJob</code>，注解定义<code>JobHandler</code>名称</li></ol><h5 id="_1-类模式" tabindex="-1"><a class="header-anchor" href="#_1-类模式"><span>1.类模式</span></a></h5><p>每个任务对应一个Java类。步骤如下：</p><ol><li>开发一个继承<code>com.xxl.job.core.handler.IJobHandler</code>的类；</li><li>手动注册到执行器容器：<code>XxlJobExecutor.registJobHandler(&quot;demoJobHandler&quot;, new DemoJobHandler())</code>。</li></ol><h5 id="_2-注解方法" tabindex="-1"><a class="header-anchor" href="#_2-注解方法"><span>2.注解方法</span></a></h5><p>xxl-job提个了几个默认的Bean执行器：</p><ul><li>demoJobHandler：简单的任务；</li><li>shardingJobHandler：分片广播任务；</li><li>commandJobHandler：命令行任务；</li><li>httpJobHandler：根据参数发起简单http请求；</li></ul><figure><img src="http://47.101.155.205/image-20250605162700204.png" alt="image-20250605162700204" tabindex="0" loading="lazy"><figcaption>image-20250605162700204</figcaption></figure>`,54)]))}const o=n(l,[["render",p],["__file","XXL-Job.html.vue"]]),r=JSON.parse('{"path":"/tools/XXL-Job.html","title":"xxl-job","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"调度中心","slug":"调度中心","link":"#调度中心","children":[{"level":3,"title":"配置文件","slug":"配置文件","link":"#配置文件","children":[]},{"level":3,"title":"Docker镜像构建","slug":"docker镜像构建","link":"#docker镜像构建","children":[]},{"level":3,"title":"logback","slug":"logback","link":"#logback","children":[]},{"level":3,"title":"触发一次任务","slug":"触发一次任务","link":"#触发一次任务","children":[]},{"level":3,"title":"停止执行器","slug":"停止执行器","link":"#停止执行器","children":[]},{"level":3,"title":"停止调度中任务","slug":"停止调度中任务","link":"#停止调度中任务","children":[]}]},{"level":2,"title":"执行器","slug":"执行器","link":"#执行器","children":[{"level":3,"title":"运行模式","slug":"运行模式","link":"#运行模式","children":[]}]}],"git":{"updatedTime":1763544673000,"contributors":[{"name":"ouyangcm","username":"ouyangcm","email":"mingorg@163.com","commits":6,"url":"https://github.com/ouyangcm"},{"name":"oycm","username":"oycm","email":"1164864987@qq.com","commits":4,"url":"https://github.com/oycm"}]},"filePathRelative":"tools/XXL-Job.md"}');export{o as comp,r as data};
