<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><title>SpringBoot | VuePress</title><meta name="description" content="基于MarkDown文档使用VuePress搭建的博客">
    <link rel="preload" href="/vuepress-blog/assets/style-CpYaHraZ.css" as="style"><link rel="stylesheet" href="/vuepress-blog/assets/style-CpYaHraZ.css">
    <link rel="modulepreload" href="/vuepress-blog/assets/app-BIGZvh4f.js"><link rel="modulepreload" href="/vuepress-blog/assets/SpringBoot-2.2.7.RELEASE.html-DfLyzdvT.js">
    <link rel="prefetch" href="/vuepress-blog/assets/index.html-D4m84eZG.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ErrorFile文件分析.html-DtPPg4f6.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JVM.html-xpwRrYJm.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JVM调优理论.html-R6Icu2Yo.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Java多线程理论.html-CNmm_RCh.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/垃圾收集器和内存分配策略.html-DG0aoQGg.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/虚拟机性能监控工具.html-Ba51msip.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/EnumSet集合.html-C-Yo6vLG.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/IO.html-TnA5q-2z.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JUC.html-BvvhxQR2.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JavaSE.html-C_SrYoyO.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JavaWeb.html-CorQ_hvS.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Java多线程使用.html-Bgkcs6bJ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Java注解.html-wS4heilI.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Java进阶.html-ZoewIylX.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Netty.html-CW6gvJi3.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Reactor.html-CzjEUGzk.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/javaUtil.html-CHKNgTCz.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/networkModel.html-DG2c09pe.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/recursion.html-BsfK7KJ3.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/divideAndConquer.html-LViisBnw.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/dp.html-BXF8a3Dm.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/algorithm.html-Cw5QfyqL.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/data-structure.html-C80WvTja.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/math.html-LxL70pyz.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Docker.html-BpvEbC-T.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/gradle.html-CAQ9x-vL.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/gradle管理Java项目.html-DamWgccU.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/maven.html-CfyKtPDZ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/maven项目切换gradle步骤.html-DsIQ6hFI.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/DruidPoolProblem.html-4Tsk67Uo.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/InfluxDB.html-CXrGIjVY.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/MongoDB.html-BqFartrm.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Mysql.html-CRgerypE.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Oracle-SQLErr.html-CeAOmq0Z.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Oracle.html-lF4hP9Kk.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ShardingSphere.html-CMTWpPjQ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Transactional.html-COVODrDC.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/seata.html-Du3LTjzb.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JavaScript.html-OKNHcyn1.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/VSCode.html-NUrKwCwt.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/css.html-qCw17Qu5.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/html.html-C9FL80cP.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/nodejs.html-DHyyn_N9.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/vue.html-CETM6P0K.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Linux.html-BgTuIrT4.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Linux进阶.html-B0I1PaiA.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Redis.html-BZrpHpct.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/TCP.html-Bcouziou.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/problem.html-B9b4elh1.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/shell语法.html-BPxht2Gk.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ELK.html-DY_R7M5-.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Elasticsearch.html-CtVAIgLc.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Logstash-8.15.html-BjD0FxU4.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/prometheus.html-CWR35qc3.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ActiveMQ.html-I8YPBsWv.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/RabbitMQ.html-DR8ipnun.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/kafka.html-Bs8iR7F1.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/nginx.html-DecO0DaM.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/nginx配置代理400.html-ByZTU-yx.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/nginx配置代理https请求步骤.html-DKHRZWN8.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Hadoop.html-MhzteBWs.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Scala-Collection.html-B1UsYe_4.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Scala.html-BKdyopUj.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spark.html-CqsO7U6T.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/DesignMode.html-D-e8Jtzy.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpecialInterfaceFunction.html-DEhsvwwZ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Spring注解介绍.html-DmDUYONL.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/logFramework.html-DfdLcpzi.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/util.html-kJA-6haH.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Micrometer.html-DTi65kOP.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-kafka.html-DYQgaOUn.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/starter-actuator.html-BWA9VZ8G.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/starter-embedded.html-DtfhWCI8.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/starter-web.html-CezIzjMG.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/AlibabaSentinel.html-a449dTg0.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Dubbo.html-d2PzlPLQ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpringCloud.html-BLWGlK1E.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ZooKeeper.html-Bwt2jSpZ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/nacos.html-BUwS5yPv.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-sleuth.html-Cg_1ye9r.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/DDD.html-f9waKzIw.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JMeter.html-R36TbFWS.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/WebService.html-CdQ9yQrX.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/XXL-Job.html-C6OyUbr0.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/cron.html-8S7XAjoD.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/git.html-Iz4ma8iD.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/gitlab.html-D3DU-VnA.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/interview.html-qWyhQrrh.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/uml.html-DzMTw3Ck.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/yaml.html-DPcoPFxY.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/vuepress使用介绍.html-D1-15YXV.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/DateBufferAndCodecs.html-WHhR5FWB.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-core-AOP.html-DEVJbTyV.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-core-SpEL.html-CZQS5Qas.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-core-ioc.html-7HP3lKuU.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Dao.html-Uvr19uw0.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpringDataJPA.html-DsIbMVqT.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/transactionManagement.html-BhrMq0mO.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpringWebFlux.html-1SspC1kl.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/WebClient.html-Bd6TdmCi.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpringMVC.html-Bk3GxmgZ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/WebSocket.html-Cc9tNp1U.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-cloud-gateway-core.html-Csxz-fNz.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-cloud-gateway.html-BkQWF5pW.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-cloud-starter-netflix-zuul.html-r6EEs-d-.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/404.html-BeuyeZRv.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index-DuqNHZ2Z.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/setupDevtools-7MC2TMWH-BEauj7aL.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/vuepress-blog/"><!----><span class="vp-site-name" aria-hidden="true">VuePress</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法策略"><span class="title">算法策略</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法策略"><span class="title">算法策略</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/recursion.html" aria-label="递归"><!---->递归<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/divideAndConquer.html" aria-label="分治"><!---->分治<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/dp.html" aria-label="动态规划"><!---->动态规划<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/data-structure.html" aria-label="数据结构"><!---->数据结构<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/algorithm.html" aria-label="算法"><!---->算法<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/math.html" aria-label="数学"><!---->数学<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="vue"><span class="title">vue</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="vue"><span class="title">vue</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>vuepress</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/vuepress/vuepress%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D.html" aria-label="vuepress使用介绍"><!---->vuepress使用介绍<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/html.html" aria-label="html"><!---->html<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/css.html" aria-label="css"><!---->css<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/JavaScript.html" aria-label="JavaScript"><!---->JavaScript<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/VSCode.html" aria-label="VSCode"><!---->VSCode<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/vue.html" aria-label="vue"><!---->vue<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="nginx"><span class="title">nginx</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="nginx"><span class="title">nginx</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx.html" aria-label="nginx"><!---->nginx<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86https%E8%AF%B7%E6%B1%82%E6%AD%A5%E9%AA%A4.html" aria-label="nginx配置代理https请求步骤"><!---->nginx配置代理https请求步骤<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86400.html" aria-label="nginx配置代理400"><!---->nginx配置代理400<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="监控"><span class="title">监控</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="监控"><span class="title">监控</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/Elasticsearch.html" aria-label="Elasticsearch"><!---->Elasticsearch<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/ELK.html" aria-label="ELK"><!---->ELK<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/Logstash-8.15.html" aria-label="Logstash"><!---->Logstash<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/prometheus.html" aria-label="prometheus"><!---->prometheus<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JavaEE"><span class="title">JavaEE</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JavaEE"><span class="title">JavaEE</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JavaSE.html" aria-label="JavaSE"><!---->JavaSE<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E8%BF%9B%E9%98%B6.html" aria-label="进阶"><!---->进阶<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JavaWeb.html" aria-label="JavaWeb"><!---->JavaWeb<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BD%BF%E7%94%A8.html" aria-label="Java多线程使用"><!---->Java多线程使用<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JUC.html" aria-label="JUC"><!---->JUC<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/EnumSet%E9%9B%86%E5%90%88.html" aria-label="EnumSet集合"><!---->EnumSet集合<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E6%B3%A8%E8%A7%A3.html" aria-label="Java注解"><!---->Java注解<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/javaUtil.html" aria-label="javaUtil"><!---->javaUtil<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/networkModel.html" aria-label="网络模型"><!---->网络模型<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/IO.html" aria-label="JavaIO"><!---->JavaIO<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Netty.html" aria-label="Netty"><!---->Netty<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Reactor.html" aria-label="Reactor"><!---->Reactor<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="构建工具"><span class="title">构建工具</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="构建工具"><span class="title">构建工具</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/maven.html" aria-label="maven"><!---->maven<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/Docker.html" aria-label="Docker"><!---->Docker<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/gradle.html" aria-label="gradle"><!---->gradle<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/gradle%E7%AE%A1%E7%90%86Java%E9%A1%B9%E7%9B%AE.html" aria-label="gradle管理Java项目"><!---->gradle管理Java项目<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/maven%E9%A1%B9%E7%9B%AE%E5%88%87%E6%8D%A2gradle%E6%AD%A5%E9%AA%A4.html" aria-label="maven项目切换gradle步骤"><!---->maven项目切换gradle步骤<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JVM"><span class="title">JVM</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JVM"><span class="title">JVM</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/JVM.html" aria-label="JVM"><!---->JVM<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%92%8C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5.html" aria-label="垃圾收集器和内存分配策略"><!---->垃圾收集器和内存分配策略<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html" aria-label="虚拟机性能监控工具"><!---->虚拟机性能监控工具<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/JVM%E8%B0%83%E4%BC%98%E7%90%86%E8%AE%BA.html" aria-label="JVM调优理论"><!---->JVM调优理论<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%90%86%E8%AE%BA.html" aria-label="Java多线程理论"><!---->Java多线程理论<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/ErrorFile%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90.html" aria-label="ErrorFile文件分析"><!---->ErrorFile文件分析<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="linux"><span class="title">linux</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="linux"><span class="title">linux</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Linux.html" aria-label="Linux"><!---->Linux<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/shell%E8%AF%AD%E6%B3%95.html" aria-label="shell语法"><!---->shell语法<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/TCP.html" aria-label="tcp"><!---->tcp<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Redis.html" aria-label="Redis"><!---->Redis<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Linux%E8%BF%9B%E9%98%B6.html" aria-label="Linux进阶"><!---->Linux进阶<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/problem.html" aria-label="问题收集"><!---->问题收集<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/RabbitMQ.html" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/ActiveMQ.html" aria-label="ActiveMQ"><!---->ActiveMQ<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/kafka.html" aria-label="Kafka"><!---->Kafka<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="spring"><span class="title">spring</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="spring"><span class="title">spring</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/Spring%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D.html" aria-label="Spring注解介绍"><!---->Spring注解介绍<!----></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>spring核心-5.2.6.RELEASE</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-ioc.html" aria-label="IOC容器相关"><!---->IOC容器相关<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-SpEL.html" aria-label="SpEL表达式"><!---->SpEL表达式<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-AOP.html" aria-label="Spring AOP代理"><!---->Spring AOP代理<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/DateBufferAndCodecs.html" aria-label="数据缓冲区和编解码器"><!---->数据缓冲区和编解码器<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>数据访问</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/transactionManagement.html" aria-label="事物管理"><!---->事物管理<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/Dao.html" aria-label="数据访问对象"><!---->数据访问对象<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/SpringDataJPA.html" aria-label="SpringDataJPA"><!---->SpringDataJPA<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Servlet请求</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webServlet/SpringMVC.html" aria-label="SpringMVC"><!---->SpringMVC<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webServlet/WebSocket.html" aria-label="WebSocket"><!---->WebSocket<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>响应式处理</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webReactive/SpringWebFlux.html" aria-label="SpringWebFlux"><!---->SpringWebFlux<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webReactive/WebClient.html" aria-label="响应式客户端"><!---->响应式客户端<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/Spring%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D.html" aria-label="Spring注解介绍"><!---->Spring注解介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/logFramework.html" aria-label="日志框架"><!---->日志框架<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/SpecialInterfaceFunction.html" aria-label="Spring特殊接口"><!---->Spring特殊接口<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/DesignMode.html" aria-label="设计模式"><!---->设计模式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/util.html" aria-label="工具类"><!---->工具类<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="springboot"><span class="title">springboot</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="springboot"><span class="title">springboot</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-blog/springboot/SpringBoot-2.2.7.RELEASE.html" aria-label="SpringBoot-2.2.7.RELEASE介绍"><!---->SpringBoot-2.2.7.RELEASE介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-embedded.html" aria-label="嵌入式容器starter"><!---->嵌入式容器starter<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-web.html" aria-label="starter-web"><!---->starter-web<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/spring-kafka.html" aria-label="springboot使用Kafka"><!---->springboot使用Kafka<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/Micrometer.html" aria-label="Micrometer"><!---->Micrometer<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-actuator.html" aria-label="starter-actuator"><!---->starter-actuator<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/SpringCloud.html" aria-label="SpringCloud"><!---->SpringCloud<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/spring-sleuth.html" aria-label="spring-sleuth"><!---->spring-sleuth<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/AlibabaSentinel.html" aria-label="Sentinel"><!---->Sentinel<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/nacos.html" aria-label="Nacos"><!---->Nacos<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/ZooKeeper.html" aria-label="ZooKeeper"><!---->ZooKeeper<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/Dubbo.html" aria-label="Dubbo"><!---->Dubbo<!----></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>网关</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-gateway.html" aria-label="spring-cloud-gateway使用介绍"><!---->spring-cloud-gateway使用介绍<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-gateway-core.html" aria-label="gateway核心"><!---->gateway核心<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-starter-netflix-zuul.html" aria-label="zuul-1.x"><!---->zuul-1.x<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="database"><span class="title">database</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="database"><span class="title">database</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Mysql.html" aria-label="MySQL"><!---->MySQL<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Oracle.html" aria-label="Oracle"><!---->Oracle<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/MongoDB.html" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/InfluxDB.html" aria-label="InfluxDB"><!---->InfluxDB<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Oracle-SQLErr.html" aria-label="Oracle执行错误代码"><!---->Oracle执行错误代码<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/ShardingSphere.html" aria-label="ShardingSphere"><!---->ShardingSphere<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Transactional.html" aria-label="Spring事物控制"><!---->Spring事物控制<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/DruidPoolProblem.html" aria-label="DruidPoolProblem"><!---->DruidPoolProblem<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/seata.html" aria-label="seata"><!---->seata<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/cron.html" aria-label="cron表达式"><!---->cron表达式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/uml.html" aria-label="UML介绍"><!---->UML介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/JMeter.html" aria-label="JMeter"><!---->JMeter<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/XXL-Job.html" aria-label="XXL-Job"><!---->XXL-Job<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/DDD.html" aria-label="领域驱动设计"><!---->领域驱动设计<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/git.html" aria-label="git"><!---->git<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/WebService.html" aria-label="WebService"><!---->WebService<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/interview.html" aria-label="interview"><!---->interview<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="spark"><span class="title">spark</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="spark"><span class="title">spark</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/spark.html" aria-label="spark"><!---->spark<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/Scala.html" aria-label="Scala2/3"><!---->Scala2/3<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/Scala-Collection.html" aria-label="Scala-集合"><!---->Scala-集合<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法策略"><span class="title">算法策略</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法策略"><span class="title">算法策略</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/recursion.html" aria-label="递归"><!---->递归<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/divideAndConquer.html" aria-label="分治"><!---->分治<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/dp.html" aria-label="动态规划"><!---->动态规划<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/data-structure.html" aria-label="数据结构"><!---->数据结构<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/algorithm.html" aria-label="算法"><!---->算法<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/math.html" aria-label="数学"><!---->数学<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="vue"><span class="title">vue</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="vue"><span class="title">vue</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>vuepress</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/vuepress/vuepress%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D.html" aria-label="vuepress使用介绍"><!---->vuepress使用介绍<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/html.html" aria-label="html"><!---->html<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/css.html" aria-label="css"><!---->css<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/JavaScript.html" aria-label="JavaScript"><!---->JavaScript<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/VSCode.html" aria-label="VSCode"><!---->VSCode<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/vue.html" aria-label="vue"><!---->vue<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="nginx"><span class="title">nginx</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="nginx"><span class="title">nginx</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx.html" aria-label="nginx"><!---->nginx<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86https%E8%AF%B7%E6%B1%82%E6%AD%A5%E9%AA%A4.html" aria-label="nginx配置代理https请求步骤"><!---->nginx配置代理https请求步骤<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86400.html" aria-label="nginx配置代理400"><!---->nginx配置代理400<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="监控"><span class="title">监控</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="监控"><span class="title">监控</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/Elasticsearch.html" aria-label="Elasticsearch"><!---->Elasticsearch<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/ELK.html" aria-label="ELK"><!---->ELK<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/Logstash-8.15.html" aria-label="Logstash"><!---->Logstash<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/prometheus.html" aria-label="prometheus"><!---->prometheus<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JavaEE"><span class="title">JavaEE</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JavaEE"><span class="title">JavaEE</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JavaSE.html" aria-label="JavaSE"><!---->JavaSE<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E8%BF%9B%E9%98%B6.html" aria-label="进阶"><!---->进阶<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JavaWeb.html" aria-label="JavaWeb"><!---->JavaWeb<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BD%BF%E7%94%A8.html" aria-label="Java多线程使用"><!---->Java多线程使用<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JUC.html" aria-label="JUC"><!---->JUC<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/EnumSet%E9%9B%86%E5%90%88.html" aria-label="EnumSet集合"><!---->EnumSet集合<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E6%B3%A8%E8%A7%A3.html" aria-label="Java注解"><!---->Java注解<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/javaUtil.html" aria-label="javaUtil"><!---->javaUtil<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/networkModel.html" aria-label="网络模型"><!---->网络模型<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/IO.html" aria-label="JavaIO"><!---->JavaIO<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Netty.html" aria-label="Netty"><!---->Netty<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Reactor.html" aria-label="Reactor"><!---->Reactor<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="构建工具"><span class="title">构建工具</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="构建工具"><span class="title">构建工具</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/maven.html" aria-label="maven"><!---->maven<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/Docker.html" aria-label="Docker"><!---->Docker<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/gradle.html" aria-label="gradle"><!---->gradle<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/gradle%E7%AE%A1%E7%90%86Java%E9%A1%B9%E7%9B%AE.html" aria-label="gradle管理Java项目"><!---->gradle管理Java项目<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/maven%E9%A1%B9%E7%9B%AE%E5%88%87%E6%8D%A2gradle%E6%AD%A5%E9%AA%A4.html" aria-label="maven项目切换gradle步骤"><!---->maven项目切换gradle步骤<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JVM"><span class="title">JVM</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JVM"><span class="title">JVM</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/JVM.html" aria-label="JVM"><!---->JVM<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%92%8C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5.html" aria-label="垃圾收集器和内存分配策略"><!---->垃圾收集器和内存分配策略<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html" aria-label="虚拟机性能监控工具"><!---->虚拟机性能监控工具<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/JVM%E8%B0%83%E4%BC%98%E7%90%86%E8%AE%BA.html" aria-label="JVM调优理论"><!---->JVM调优理论<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%90%86%E8%AE%BA.html" aria-label="Java多线程理论"><!---->Java多线程理论<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/ErrorFile%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90.html" aria-label="ErrorFile文件分析"><!---->ErrorFile文件分析<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="linux"><span class="title">linux</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="linux"><span class="title">linux</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Linux.html" aria-label="Linux"><!---->Linux<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/shell%E8%AF%AD%E6%B3%95.html" aria-label="shell语法"><!---->shell语法<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/TCP.html" aria-label="tcp"><!---->tcp<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Redis.html" aria-label="Redis"><!---->Redis<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Linux%E8%BF%9B%E9%98%B6.html" aria-label="Linux进阶"><!---->Linux进阶<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/problem.html" aria-label="问题收集"><!---->问题收集<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/RabbitMQ.html" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/ActiveMQ.html" aria-label="ActiveMQ"><!---->ActiveMQ<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/kafka.html" aria-label="Kafka"><!---->Kafka<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="spring"><span class="title">spring</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="spring"><span class="title">spring</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/Spring%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D.html" aria-label="Spring注解介绍"><!---->Spring注解介绍<!----></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>spring核心-5.2.6.RELEASE</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-ioc.html" aria-label="IOC容器相关"><!---->IOC容器相关<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-SpEL.html" aria-label="SpEL表达式"><!---->SpEL表达式<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-AOP.html" aria-label="Spring AOP代理"><!---->Spring AOP代理<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/DateBufferAndCodecs.html" aria-label="数据缓冲区和编解码器"><!---->数据缓冲区和编解码器<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>数据访问</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/transactionManagement.html" aria-label="事物管理"><!---->事物管理<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/Dao.html" aria-label="数据访问对象"><!---->数据访问对象<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/SpringDataJPA.html" aria-label="SpringDataJPA"><!---->SpringDataJPA<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Servlet请求</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webServlet/SpringMVC.html" aria-label="SpringMVC"><!---->SpringMVC<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webServlet/WebSocket.html" aria-label="WebSocket"><!---->WebSocket<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>响应式处理</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webReactive/SpringWebFlux.html" aria-label="SpringWebFlux"><!---->SpringWebFlux<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webReactive/WebClient.html" aria-label="响应式客户端"><!---->响应式客户端<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/Spring%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D.html" aria-label="Spring注解介绍"><!---->Spring注解介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/logFramework.html" aria-label="日志框架"><!---->日志框架<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/SpecialInterfaceFunction.html" aria-label="Spring特殊接口"><!---->Spring特殊接口<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/DesignMode.html" aria-label="设计模式"><!---->设计模式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/util.html" aria-label="工具类"><!---->工具类<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="springboot"><span class="title">springboot</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="springboot"><span class="title">springboot</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-blog/springboot/SpringBoot-2.2.7.RELEASE.html" aria-label="SpringBoot-2.2.7.RELEASE介绍"><!---->SpringBoot-2.2.7.RELEASE介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-embedded.html" aria-label="嵌入式容器starter"><!---->嵌入式容器starter<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-web.html" aria-label="starter-web"><!---->starter-web<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/spring-kafka.html" aria-label="springboot使用Kafka"><!---->springboot使用Kafka<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/Micrometer.html" aria-label="Micrometer"><!---->Micrometer<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-actuator.html" aria-label="starter-actuator"><!---->starter-actuator<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/SpringCloud.html" aria-label="SpringCloud"><!---->SpringCloud<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/spring-sleuth.html" aria-label="spring-sleuth"><!---->spring-sleuth<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/AlibabaSentinel.html" aria-label="Sentinel"><!---->Sentinel<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/nacos.html" aria-label="Nacos"><!---->Nacos<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/ZooKeeper.html" aria-label="ZooKeeper"><!---->ZooKeeper<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/Dubbo.html" aria-label="Dubbo"><!---->Dubbo<!----></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>网关</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-gateway.html" aria-label="spring-cloud-gateway使用介绍"><!---->spring-cloud-gateway使用介绍<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-gateway-core.html" aria-label="gateway核心"><!---->gateway核心<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-starter-netflix-zuul.html" aria-label="zuul-1.x"><!---->zuul-1.x<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="database"><span class="title">database</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="database"><span class="title">database</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Mysql.html" aria-label="MySQL"><!---->MySQL<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Oracle.html" aria-label="Oracle"><!---->Oracle<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/MongoDB.html" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/InfluxDB.html" aria-label="InfluxDB"><!---->InfluxDB<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Oracle-SQLErr.html" aria-label="Oracle执行错误代码"><!---->Oracle执行错误代码<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/ShardingSphere.html" aria-label="ShardingSphere"><!---->ShardingSphere<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Transactional.html" aria-label="Spring事物控制"><!---->Spring事物控制<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/DruidPoolProblem.html" aria-label="DruidPoolProblem"><!---->DruidPoolProblem<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/seata.html" aria-label="seata"><!---->seata<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/cron.html" aria-label="cron表达式"><!---->cron表达式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/uml.html" aria-label="UML介绍"><!---->UML介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/JMeter.html" aria-label="JMeter"><!---->JMeter<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/XXL-Job.html" aria-label="XXL-Job"><!---->XXL-Job<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/DDD.html" aria-label="领域驱动设计"><!---->领域驱动设计<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/git.html" aria-label="git"><!---->git<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/WebService.html" aria-label="WebService"><!---->WebService<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/interview.html" aria-label="interview"><!---->interview<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="spark"><span class="title">spark</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="spark"><span class="title">spark</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/spark.html" aria-label="spark"><!---->spark<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/Scala.html" aria-label="Scala2/3"><!---->Scala2/3<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/Scala-Collection.html" aria-label="Scala-集合"><!---->Scala-集合<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">SpringBoot <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="springboot" tabindex="-1"><a class="header-anchor" href="#springboot"><span>SpringBoot</span></a></h1><h2 id="_1-介绍" tabindex="-1"><a class="header-anchor" href="#_1-介绍"><span>1.介绍</span></a></h2><p>官网文档(单页)：https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/reference/htmlsingle/</p><p>最新文档：https://docs.spring.io/spring-boot/</p><p>常见问题的解决方案：https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/reference/htmlsingle/#howto</p><p>springboot相关项目入门介绍(太简单+jdk版本高)：https://spring.io/guides</p><p>官网介绍的学习步骤：</p><ol><li>入门</li><li>使用SpringBoot</li><li>了解SpringBoot的属性</li><li>生产使用SpringBoot的技巧</li><li>进阶</li></ol><h2 id="_2-入门" tabindex="-1"><a class="header-anchor" href="#_2-入门"><span>2.入门</span></a></h2><p>what？</p><p>how？</p><p>why？</p><p>SpringBoot的介绍：可以快速简单的快发一个基于Spring的应用。以自己独特的方式整合了第三方依赖。可以通过java -jar或war包或Spring CLI来启动SpringBoot应用。</p><p>SpringBoot的目标：</p><ol><li>为Spring的开发人员提供快速开始的使用体验。</li><li>开箱即用：依赖管理、自动配置。</li><li>继承了非功能性的特性：嵌入式容器、security、metrics、health check、外部化配置。</li><li>没有xml配置。</li><li>构建(部署)的简化。java不支持嵌套jar文件(jar文件中嵌套jar)。SpringBoot提供了uber-jar(fat-jar可执行的jar)，该项目所有依赖的jar文件都在这个jar中。在这个jar中BOOT-INFO目录下，classes是开发者的代码，lib是maven依赖的jar文件。META-INF目录中maven构建的信息。org.springframework.boot.loader目录下一些class文件，Main-Class: org.springframework.boot.loader.JarLauncher是启动的主类，在这里面定义了加载jar的class的过程。</li></ol><p>2.2.7版本支持的Java版本是8-14。支持Spring Framework版本是5.2.6或跟高。</p><p>maven构建版本支持3.3+。</p><p>gradle支持版本5.x或6.x。</p><figure><img src="http://47.101.155.205/image-20241201160746731.png" alt="image-20241201160746731" tabindex="0" loading="lazy"><figcaption>image-20241201160746731</figcaption></figure><p>Springboot初始化模板地址：https://start.spring.io/</p><p>替换pom.xml文件内容。</p><p>maven项目的pom文件。</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.oycm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-example-maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!-- 继承的SpringBoot版本 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!-- 引用spring-boot-starter-web依赖 web应用依赖 --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!-- 引入插件 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 将项目构建成一个可执行的jar包 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动类</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>oycm</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">EnableAutoConfiguration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@EnableAutoConfiguration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBootExample</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token class-name">String</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringBootExample</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>EnableAutoConfiguration作用：通知SpringBoot基于加载的jar依赖自动配置。</p><p>starters和自动配置的关系：自动配置的设计是为了更好的和starters协作，这两者之间没有捆绑的关系。starter提供了一个功能相关的依赖集合，里面有核心依赖实现了自动配置的功能。</p><h3 id="spring-boot-jar" tabindex="-1"><a class="header-anchor" href="#spring-boot-jar"><span>spring-boot-jar</span></a></h3><p>官网文档：https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/maven-plugin/usage.html</p><p>需要引入插件：</p><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20241201202548724.png" alt="image-20241201202548724" tabindex="0" loading="lazy"><figcaption>image-20241201202548724</figcaption></figure><figure><img src="http://47.101.155.205/image-20241201201302236.png" alt="image-20241201201302236" tabindex="0" loading="lazy"><figcaption>image-20241201201302236</figcaption></figure><figure><img src="http://47.101.155.205/image-20241201201521439.png" alt="image-20241201201521439" tabindex="0" loading="lazy"><figcaption>image-20241201201521439</figcaption></figure><h3 id="original-jar" tabindex="-1"><a class="header-anchor" href="#original-jar"><span>original-jar</span></a></h3><p>使用maven的package打包后，在target目录下有两个jar包，其中original结尾的文件是在使用SpringBoot在打包之前maven构建的jar包。</p><figure><img src="http://47.101.155.205/image-20241201202141733.png" alt="image-20241201202141733" tabindex="0" loading="lazy"><figcaption>image-20241201202141733</figcaption></figure><h2 id="_3-使用" tabindex="-1"><a class="header-anchor" href="#_3-使用"><span>3.使用</span></a></h2><p>SpringBoot的每个版本都提供了一些列它支持的第三方依赖，在使用一个具体的SpringBoot版本时，可以不用指定它支持的依赖的版本(版本升级也只需要更换SpringBoot的版本)。</p><h3 id="maven" tabindex="-1"><a class="header-anchor" href="#maven"><span>Maven</span></a></h3><p>使用spring-boot-starter-parent做为maven项目的父模块，可以继承parent的一些属性。</p><ol><li>编译时java的版本。</li><li>spring-boot-starter-parent继承spring-boot-dependencies，继承了父模块的依赖管理，所有在自己模块中定义被管理的依赖时，可以不用指定依赖的版本。</li><li>提供了spring-boot-maven-plugin插件，将项目打包成可指向的jar包。</li><li>parent配置了对resources目录下application.yml、application.yaml、application.properties名称开始的文件，将里面的@name@进行占位替换。</li><li>可以通过覆盖spring-boot-dependencies中定义的属性值，来替换成你想要的版本。</li></ol><p>spring-boot-dependencies依赖源码：https://github.com/spring-projects/spring-boot/blob/v2.2.7.RELEASE/spring-boot-project/spring-boot-dependencies/pom.xml</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token comment">&lt;!-- 继承spring boot的默认maven配置 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token comment">&lt;!-- 替换spring boot 管理的依赖版本 --&gt;</span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-data-releasetrain.version</span><span class="token punctuation">&gt;</span></span>Fowler-SR2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-data-releasetrain.version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    </span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="不指定parent" tabindex="-1"><a class="header-anchor" href="#不指定parent"><span>不指定parent</span></a></h4><p>maven的parent可以不用指向spring-boot-starter-parent，但是你有需要parent的依赖管理功能，则可以这样做(但是构建的插件不能少)。</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 从Spring Boot导入依赖管理 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!-- 构建可执行文件的插件 --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span>MainClass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是这种方式不能通过修改属性值的方式实现依赖版本的升级，而是将依赖定义在dependencies之前的方式。</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!-- 替换Spring Boot指定的依赖版本 --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-data-releasetrain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>Fowler-SR2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gradle" tabindex="-1"><a class="header-anchor" href="#gradle"><span>gradle</span></a></h3><p>官网介绍使用文档：https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/gradle-plugin/reference/html/</p><h4 id="springboot官网初始化" tabindex="-1"><a class="header-anchor" href="#springboot官网初始化"><span>SpringBoot官网初始化</span></a></h4><p>build.gradle</p><div class="language-gradle line-numbers-mode" data-highlighter="prismjs" data-ext="gradle" data-title="gradle"><pre><code><span class="line"><span class="token keyword">plugins</span> <span class="token punctuation">{</span></span>
<span class="line">    id <span class="token string">&#39;java&#39;</span></span>
<span class="line">    id <span class="token string">&#39;org.springframework.boot&#39;</span> version <span class="token string">&#39;2.2.7.RELEASE&#39;</span></span>
<span class="line">    id <span class="token string">&#39;io.spring.dependency-management&#39;</span> version <span class="token string">&#39;1.0.9.RELEASE&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 项目信息</span></span>
<span class="line">group <span class="token operator">=</span> <span class="token string">&#39;com.example&#39;</span></span>
<span class="line">version <span class="token operator">=</span> <span class="token string">&#39;0.0.1-SNAPSHOT&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 导入依赖</span></span>
<span class="line"><span class="token keyword">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">implementation</span> <span class="token string">&#39;org.springframework.boot:spring-boot-starter&#39;</span></span>
<span class="line">    <span class="token keyword">implementation</span> <span class="token string">&#39;org.springframework.boot:spring-boot-starter-web&#39;</span></span>
<span class="line">    testImplementation <span class="token string">&#39;org.springframework.boot:spring-boot-starter-test&#39;</span></span>
<span class="line">    testRuntimeOnly <span class="token string">&#39;org.junit.platform:junit-platform-launcher&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20241206091649090.png" alt="image-20241206091649090" tabindex="0" loading="lazy"><figcaption>image-20241206091649090</figcaption></figure><figure><img src="http://47.101.155.205/image-20241206091722557.png" alt="image-20241206091722557" tabindex="0" loading="lazy"><figcaption>image-20241206091722557</figcaption></figure><h4 id="依赖管理" tabindex="-1"><a class="header-anchor" href="#依赖管理"><span>依赖管理</span></a></h4><p>build.gradle</p><div class="language-gradle line-numbers-mode" data-highlighter="prismjs" data-ext="gradle" data-title="gradle"><pre><code><span class="line"><span class="token keyword">plugins</span> <span class="token punctuation">{</span></span>
<span class="line">	java</span>
<span class="line">	<span class="token comment">// 引入插件不使用,该模块不会被打包成可执行的jar</span></span>
<span class="line">	<span class="token function">id</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;org.springframework.boot&quot;</span></span><span class="token punctuation">)</span> version <span class="token interpolation-string"><span class="token string">&quot;2.2.7.RELEASE&quot;</span></span> <span class="token keyword">apply</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token function">id</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;io.spring.dependency-management&quot;</span></span><span class="token punctuation">)</span> version <span class="token interpolation-string"><span class="token string">&quot;1.0.9.RELEASE&quot;</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">dependencyManagement <span class="token punctuation">{</span></span>
<span class="line">    imports <span class="token punctuation">{</span></span>
<span class="line">    	<span class="token comment">// 引入spring cloud的相关依赖管理</span></span>
<span class="line">        mavenBom <span class="token string">&#39;org.springframework.cloud:spring-cloud-dependencies:Brixton.RELEASE&#39;</span></span>
<span class="line">        <span class="token comment">// 引入spring boot的相关依赖管理</span></span>
<span class="line">        mavenBom <span class="token string">&#39;org.springframework.boot:spring-boot-dependencies:2.2.7.RELEASE&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="其它配置" tabindex="-1"><a class="header-anchor" href="#其它配置"><span>其它配置</span></a></h4><p>build.gradle</p><div class="language-gradle line-numbers-mode" data-highlighter="prismjs" data-ext="gradle" data-title="gradle"><pre><code><span class="line"><span class="token comment">// 里面的配置应用至所有项目，包括root</span></span>
<span class="line">allprojects <span class="token punctuation">{</span></span>
<span class="line">	</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">// 里面的配置应用至所有项目，不包括root</span></span>
<span class="line">subprojects <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 是否打成jar包</span></span>
<span class="line">jar <span class="token punctuation">{</span></span>
<span class="line">    enabled <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 构建成可执行jar包，添加的后缀boot(org.springframework.boot插件启动才可配置)</span></span>
<span class="line">bootJar <span class="token punctuation">{</span></span>
<span class="line">    classifier <span class="token operator">=</span> <span class="token string">&#39;boot&#39;</span></span>
<span class="line">    <span class="token comment">// 可执行main的类全路径名称</span></span>
<span class="line">    mainClassName <span class="token operator">=</span> <span class="token string">&#39;com.oycm.SpringBootExample&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>setting.gradle</p><div class="language-gradle" data-highlighter="prismjs" data-ext="gradle" data-title="gradle"><pre><code><span class="line"><span class="token comment">// 配置远程仓库</span></span>
<span class="line">pluginManagement <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">repositories</span> <span class="token punctuation">{</span></span>
<span class="line">        maven <span class="token punctuation">{</span> url <span class="token string">&#39;https://maven.aliyun.com/repository/public&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h4 id="命令" tabindex="-1"><a class="header-anchor" href="#命令"><span>命令</span></a></h4><p>task</p><p>列出可执行的命令</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gradle task</span>
<span class="line"></span>
<span class="line"><span class="token comment"># gradle wrapper</span></span>
<span class="line">./gradlew task</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20241206111556605.png" alt="image-20241206111556605" tabindex="0" loading="lazy"><figcaption>image-20241206111556605</figcaption></figure><p>build</p><p>构建成jar或war包。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gradle build</span>
<span class="line"></span>
<span class="line"><span class="token comment"># gradle wrapper</span></span>
<span class="line">./gradlew build</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h4 id="自定义task" tabindex="-1"><a class="header-anchor" href="#自定义task"><span>自定义task</span></a></h4><p>build.gradle</p><div class="language-gradle line-numbers-mode" data-highlighter="prismjs" data-ext="gradle" data-title="gradle"><pre><code><span class="line"><span class="token comment">// 定义build命令在 clean之后运行</span></span>
<span class="line">build<span class="token punctuation">.</span>mustRunAfter clean</span>
<span class="line"></span>
<span class="line"><span class="token comment">// 自定义这个task,名称buildJar，依赖build,和clean之后执行。前面定义了build在clean之后执行</span></span>
<span class="line"><span class="token keyword">tasks</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&#39;buildJar&#39;</span><span class="token punctuation">,</span> GradleBuild<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    dependsOn build<span class="token punctuation">,</span> clean</span>
<span class="line"></span>
<span class="line">    doLast <span class="token punctuation">{</span></span>
<span class="line">        String jarName <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">rootProject</span></span><span class="token string">.name&quot;</span></span></span>
<span class="line">        <span class="token function">delete</span><span class="token punctuation">(</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;jar&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;jar&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        String jarPath <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">&quot;build/libs&quot;</span></span></span>
<span class="line">        <span class="token comment">// 复制到一个目录下,并重命名</span></span>
<span class="line">        copy <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">from</span><span class="token punctuation">(</span>jarPath<span class="token punctuation">)</span></span>
<span class="line">            into  <span class="token interpolation-string"><span class="token string">&quot;jar&quot;</span></span></span>
<span class="line">            rename <span class="token punctuation">{</span></span>
<span class="line">                String fileName <span class="token operator">-&gt;</span> jarName <span class="token operator">+</span> <span class="token string">&#39;.jar&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">// 删除build及里面的所有东西</span></span>
<span class="line">        <span class="token function">file</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;build&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deleteDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">task buildJar1 <span class="token punctuation">(</span>type<span class="token punctuation">:</span> GradleBuild<span class="token punctuation">,</span> dependsOn<span class="token punctuation">:</span> <span class="token punctuation">[</span>build<span class="token punctuation">,</span> clean<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="starter" tabindex="-1"><a class="header-anchor" href="#starter"><span>starter</span></a></h3><p>https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/reference/htmlsingle/#using-boot-starter</p><p>spring官方提供的starter遵循命名规则<code>spring-boot-starter-[name]</code>，name都具有一定的含义。</p><p>也可以自定义starter，第三方的starter一般遵循<code>[name]-spring-boot-starter</code>命名规则。</p><p>自定义starter文档：https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/reference/htmlsingle/#boot-features-custom-starter</p><p>starter分为三类：</p><ol><li>应用类型starter：如spring-boot-starter-web。</li><li>功能(监控)类型starter：<code>spring-boot-starter-actuator</code>。</li><li>技术型starter：<code>spring-boot-starter-jetty</code>、<code>spring-boot-starter-undertow</code>；<code>spring-boot-starter-log4j2</code>、<code>spring-boot-starter-logging</code>；<code>spring-boot-starter-reactor-netty</code>。</li></ol><h3 id="编写代码建议" tabindex="-1"><a class="header-anchor" href="#编写代码建议"><span>编写代码建议</span></a></h3><p>每个类都定义包名，缺省的包名，会让<code>@ComponentScan</code>, <code>@ConfigurationPropertiesScan</code>,<code> @EntityScan</code>, <code>@SpringBootApplication</code>扫描所有的类。</p><p><code>@SpringBootApplication</code>注解通过被使用在启动类上，他会自动扫描当前包下的所路径。</p><p>不使用<code>@SpringBootApplication</code>注解，可以使用<code>@EnableAutoConfiguration</code>和<code>@ComponentScan</code>注解进行替换。</p><h3 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h3><p>配置类：配置类可以使用@Configuration修饰，通过@Import(该类)或@ComponentScan扫描的方式将配置类交友Spring容器管理。</p><p>自动配置功能：SpringBoot会自动根据加载的jar，是否启动某个功能。启动这种功能的方式在一个@Configuration上使用一个@SpringBootApplication或@EnableAutoConfiguration注解。通常情况下是在main方法上使用这个注解。</p><p>通过通过添加启动参数--debug查看启动加载了哪些类。</p><p>禁用一些自动配置方式：</p><ol><li>@SpringBootApplication(exclude={DataSourceAutoConfiguration.class})，exclude指向class，excludeName指向类的全路径名称。</li><li>@EnableAutoConfiguration方式同样使用方式，exclude指向class，excludeName指向类的全路径名称。</li></ol><h3 id="bean和依赖注入" tabindex="-1"><a class="header-anchor" href="#bean和依赖注入"><span>Bean和依赖注入</span></a></h3><p>使用@ComponentScan注解扫描被定义的Bean，使用@Autowired构造方法注入。@Component, @Service, @Repository, @Controller注解的类在根路径的包下，则可以不用配置扫描的包路径。</p><figure><img src="http://47.101.155.205/image-20241206151407094.png" alt="image-20241206151407094" tabindex="0" loading="lazy"><figcaption>image-20241206151407094</figcaption></figure><h3 id="热拔插开发工具" tabindex="-1"><a class="header-anchor" href="#热拔插开发工具"><span>热拔插开发工具</span></a></h3><p>代码修改，编译后生效。</p><p>spring.devtools.restart.enabled=false配置禁用重新加载。</p><p>System.setProperty(&quot;spring.devtools.restart.enabled&quot;, &quot;false&quot;);代码方式(main方法中)</p><p>maven导入，pom.xml</p><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>gradle导入，build.gradle</p><div class="language-gradle line-numbers-mode" data-highlighter="prismjs" data-ext="gradle" data-title="gradle"><pre><code><span class="line">configurations <span class="token punctuation">{</span></span>
<span class="line">    developmentOnly</span>
<span class="line">    runtimeClasspath <span class="token punctuation">{</span></span>
<span class="line">        extendsFrom developmentOnly</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">developmentOnly</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;org.springframework.boot:spring-boot-devtools&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以在$HOME/.config/spring-boot目录下添加以下配置文件实现devtools的全局配置：</p><ol><li>spring-boot-devtools.properties</li><li>spring-boot-devtools.yaml</li><li>spring-boot-devtools.yml</li></ol><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token comment"># 禁用重启</span></span>
<span class="line"><span class="token key attr-name">spring.devtools.restart.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></span>
<span class="line"><span class="token comment"># 程序在.reloadtrigger文件被修改时触发重启(编译后)</span></span>
<span class="line"><span class="token key attr-name">spring.devtools.restart.trigger-file</span><span class="token punctuation">=</span><span class="token value attr-value">.reloadtrigger</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="_4-功能" tabindex="-1"><a class="header-anchor" href="#_4-功能"><span>4.功能</span></a></h2><h3 id="springapplication" tabindex="-1"><a class="header-anchor" href="#springapplication"><span>SpringApplication</span></a></h3><p><strong>启动失败</strong></p><p>失败原因分析处理：</p><p>spring-boot模块中的<code>META-INF/spring.factories</code>文件中定义了<code>org.springframework.boot.diagnostics.FailureAnalyzer=class</code>名称，实现对SpringBoot启动失败分析。</p><p>启动日志记录</p><p>org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener注册监听时间，根据日志级别打印自动配置的情况。</p><p>实现了ApplicationContextInitializer接口，通过spring-boot-autoconfigure模块META-INF/spring.factories自动注入，<code>org.springframework.context.ApplicationContextInitializer=class</code>。</p><p>main方法启动参数--debug将日期级别设置为debug。</p><p><strong>延迟初始化</strong></p><p>延迟初始化可以支持Bean不在应用启动的时候创建，而是在被使用的时候创建。如web应用，controller相关的bean知道接收http请求才创建。</p><p>延迟加载虽然能减少启动应用的时间，也会带来许多问题。延迟发现程序的问题、程序需要有足够的内存去加载哪些为创建的bean。</p><p>可以同@Lazy(false)将已经延迟初始化的设置为立即初始化。</p><p><strong>自定义应用的特点</strong></p><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">SpringApplication</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span><span class="token class-name">MySpringConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 不打印banner</span></span>
<span class="line">    app<span class="token punctuation">.</span><span class="token function">setBannerMode</span><span class="token punctuation">(</span><span class="token class-name">Banner<span class="token punctuation">.</span>Mode</span><span class="token punctuation">.</span><span class="token constant">OFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>api文档：https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/api//org/springframework/boot/SpringApplication.html</p><p><strong>流式构建启动</strong></p><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">new</span> <span class="token class-name">SpringApplicationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">sources</span><span class="token punctuation">(</span><span class="token class-name">Parent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">bannerMode</span><span class="token punctuation">(</span><span class="token class-name">Banner<span class="token punctuation">.</span>Mode</span><span class="token punctuation">.</span><span class="token constant">OFF</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>构建的ApplicationContext上下文有层级关系，可以采用这种方式启动。</p><p>创建了层级的ApplicationContext，要求Web组件必须在child上下文，parent和child使用相同的Enviroment。</p><p><strong>ApplicationEvent和ApplicationListener</strong></p><p>除了Spring Framework常见的事件，例如ContextRefreshedEvent，SpringApplication提供了其它的事件。</p><p>有些监听事件是在ApplicationContext创建之前触发的，因此不能将其注册为Bean。可以使用SpringApplication.addListeners(...)或SpringApplicationBuilder.listeners(…)方法注册。</p><p>通过META-INF/spring.factories中添加key=org.springframework.context.ApplicationListener，value指向监听器的全路径名称，可以实现自动注册监听器。</p><p>应用程序运行时，遵循以下顺序发送事件：</p><ol><li>ApplicationStartingEvent在运行时发送，在任何程序执行之前，除了注册监听器和初始化程序之外。</li><li>ApplicationEnvironmentPreparedEvent在已知context使用Environment来创建context之前发送。</li><li>ApplicationContextInitializedEvent在ApplicationContext已创建好和已调用ApplicationContextInitializers，bean未被加载之前发送。</li><li>ApplicationPreparedEvent在bean定义加载之后，在refresh之前发送。</li><li>ApplicationStartedEvent在context被刷新之后，在应用程序和command-line runners运行之前发送。</li><li>ApplicationReadyEvent在应用程序和command-line runners运行后，表明应用程序已准备做好服务请求。</li><li>ApplicationFailedEvent在启动出现异常发送。</li></ol><p>上面的事件是SpringApplication启动的SpringApplicationEvent事件。除了这些，在ApplicationPreparedEvent之后和ApplicationStartedEvent之前还会发送以下事件：</p><ol><li>ContextRefreshedEvent在ApplicationContext被刷新时发送。</li><li>WebServerInitializedEvent在WebServer准备就绪时发送。ServletWebServerInitializedEvent和ReactiveWebServerInitializedEvent分别是servlet和reactive实现。</li></ol><p>应用程序事件使用了Spring Framework的事件发布机制。</p><p>可以通过实现ApplicationContextAware接口注入bean的方式来管理上下文。</p><p><strong>Web环境</strong></p><p>SpringApplication在启动时，需要确定创建哪种类型的ApplicationContext。用于确认WebApplicationType的算法如下：</p><ol><li>如果Spring MVC存在，则使用AnnotationConfigServletWebServerApplicationContext。</li><li>如果Spring MVC不存在且Spring WebFlux存在，则使用AnnotationConfigReactiveWebServerApplicationContext。</li><li>否则使用AnnotationConfigApplicationContext。</li></ol><p>Spring MVC的优先级高于SpringWebFlux，可以通过SpringApplication.setWebApplicationType(WebApplicationType)的方式修改启动的类型或setApplicationContextClass(Class)。</p><p><strong>命令行参数访问</strong></p><p>注入org.springframework.boot.ApplicationArguments可以实现对命令行参数的访问。</p><p>提供了两种方式方式访问：</p><ol><li>getSourceArgs()访问原始的参数。</li><li>访问解析后的参数：getOptionValues、getNonOptionArgs</li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">boolean</span> debug <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">containsOption</span><span class="token punctuation">(</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> files <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">getNonOptionArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// if run with &quot;--debug logfile.txt&quot; debug=true, files=[&quot;logfile.txt&quot;]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SpringBoot使用Spring的Environment注册了CommandLinePropertySource。可以通过@Value注入单个的应用参数。</p><p><strong>使用ApplicationRunner或CommandLineRunner</strong></p><p>可以通过实现ApplicationRunner或CommandLineRunner接口，达到在SpringApplication启动后执行某些代码。两个接口的工作方式相同，都提供了一个run方法，该方法在SpringApplication.run(...)完成之前调用。</p><p>如果定义了多个ApplicationRunner或CommandLineRunner，可以通过实现org.springframework.core.Ordered接口或使用注解org.springframework.core.annotation.Order的方式来指定执行顺序(值越大优先级越低)。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Do something...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Application退出</strong></p><p>SpringApplication向JVM注册了一个关闭狗子，确保ApplicationContext在退出时正常关闭。例如：</p><ol><li>实现DisposableBean接口。</li><li>Bean中被@PreDestroy注解的方法。</li></ol><p>注入一个ExitCodeGenerator对象的作用？</p><p><strong>Admin属性</strong></p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token comment"># 通过VisualVM可以查看注入的MBean。</span></span>
<span class="line"><span class="token key attr-name">spring.application.admin.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>注入了SpringApplicationAdminMXBean对象，可以调用方法getProperty(&quot;local.server.port&quot;)获取http端口。</p><p>shutdown停止程序。</p><figure><img src="http://47.101.155.205/image-20241207171952985.png" alt="image-20241207171952985" tabindex="0" loading="lazy"><figcaption>image-20241207171952985</figcaption></figure><h3 id="外部化配置" tabindex="-1"><a class="header-anchor" href="#外部化配置"><span>外部化配置</span></a></h3><p>SpringBoot支持外部化配置，可以让一份代码以不同的环境启动。可以使用properties文件、yaml(yml)文件、环境变量、命令行参数来外部化配置。属性能通过@Value注入Bean中，@ConfigurationProperties注解可以将配置结构化。</p><p>SpringBoot通过PropertySource来实现合理的配置覆盖值。配置遵循以下规则：</p><ol><li>当devtools 插件生效时，其全局配置优先级最高。</li><li>测试中的注解@TestPropertySource。</li><li>测试中的属性。@SpringBootTest。</li><li>命令行参数(系统属性或args)。</li><li>来自SPRING_APPLICATION_JSON(嵌入在环境变量或系统属性的json)的属性。</li><li>ServletConfig初始化参数。</li><li>ServletConfig初始化参数。</li><li>来自java:comp/env的JNDI属性。</li><li>Java系统属性(System.getProperties())。</li><li>操作系统变量。</li><li>random.*的属性(RandomValuePropertySource)。</li><li>在jar包外的application-{profile}.properties(yaml|yml)。</li><li>在jar包内的application-{profile}.properties(yaml|yml)。</li><li>在jar包外的application.properties(yaml|yml)。</li><li>在jar包内的application.properties(yaml|yml)。</li><li>@Configuration和@PropertySource一起注解的类。这个自会在ApplicationContext被刷新后才生效，对于一些在刷新之前就读取的配置就太迟了，如：logging.、spring.main.。</li><li>默认属性，通过SpringApplication.setDefaultProperties设置。</li></ol><p>application.properties配置文件打包jar中和jar包外，生效的是@name@。</p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">name</span><span class="token punctuation">=</span><span class="token value attr-value">@name@</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p><strong>配置随机值</strong></p><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token comment"># 随机字符串</span></span>
<span class="line"><span class="token key attr-name">my.secret</span><span class="token punctuation">=</span><span class="token value attr-value">${random.value}</span></span>
<span class="line"><span class="token comment"># 随机int</span></span>
<span class="line"><span class="token key attr-name">my.number</span><span class="token punctuation">=</span><span class="token value attr-value">${random.int}</span></span>
<span class="line"><span class="token key attr-name">my.bignumber</span><span class="token punctuation">=</span><span class="token value attr-value">${random.long}</span></span>
<span class="line"><span class="token comment"># uuid</span></span>
<span class="line"><span class="token key attr-name">my.uuid</span><span class="token punctuation">=</span><span class="token value attr-value">${random.uuid}</span></span>
<span class="line"><span class="token comment"># 范围内随机数</span></span>
<span class="line"><span class="token key attr-name">my.number.less.than.ten</span><span class="token punctuation">=</span><span class="token value attr-value">${random.int(10)}</span></span>
<span class="line"><span class="token comment"># 区间内随机数</span></span>
<span class="line"><span class="token key attr-name">my.number.in.range</span><span class="token punctuation">=</span><span class="token value attr-value">${random.int[1024,65536]}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>命令行参数</strong></p><p>命令参数的优先级高于其它配置属性来源。SpringApplication会将--server.port=9000配置添加到Spring的Enviroment中。</p><p>通过SpringApplication.setAddCommandLineProperties(false)禁用命令行配置。</p><p><strong>配置属性文件</strong></p><p>SpringApplication加载application.properties(yaml|yml)文件进入Enviroment。优先级如下：</p><ol><li>当前目录的config子目录。</li><li>当前目录。</li><li>包中的config目录下的。</li><li>classpath根目录下的。</li></ol><p>优先级高的配置值覆盖优先级低的。</p><p>可以通过命令行参数指定修改配置文件的名称，不使用application。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">java</span> <span class="token parameter variable">-jar</span> my.jar <span class="token parameter variable">--spring.config.name</span><span class="token operator">=</span>myproject</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>可以修改配置的文件的路径：</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">java</span> <span class="token parameter variable">-jar</span> myproject.jar <span class="token parameter variable">--spring.config.location</span><span class="token operator">=</span>classpath:/default.properties,classpath:/override.properties</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>spring.config.name和spring.config.location被决定哪个文件被加载。这个变量的配置就需要提前配置，通常在系统环境变量，系统属性或命令行参数使用。</p><p>spring.config.location的配置指向目录时，需要/结尾。</p><p>spring.config.location的配置按相反顺序搜索，例如：配置为classpath:/,classpath:/config/,file:./,file:./config/(这个也是默认加载配置文件的路径配置)，则按以下顺序搜索：</p><ol><li>file:./config。</li><li>file:./。</li><li>classpath:/config。</li><li>classpath:/</li></ol><p>spring.config.additional-location可以添加更多的配置文件路径，加载顺序相反，优先级比默认扫码路径高。</p><p><strong>特定profile配置</strong></p><p>遵循application-{profile}.properties(yaml|yml)命名规则的配置文件，通过指定一系列的profiles，默认是default(application-default.properties)。加载位置的默认规则和application.properties一致。特定配置文件的优先级高于非特定配置文件(无论是jar中的或jar包外的)。</p><p>如果spring.config.location指定了具体的文件，则特定配置文件失效。需要生效则只能指向目录。</p><p>spring.profiles.active表示指定的{profile}的值。</p><p><strong>配置文件占位符</strong></p><p>value值使用前面定义的变量值。</p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">name</span><span class="token punctuation">=</span><span class="token value attr-value">MyApp</span></span>
<span class="line"><span class="token key attr-name">app.description</span><span class="token punctuation">=</span><span class="token value attr-value">${name} is a Spring Boot application</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p><strong>加密配置</strong></p><p>SpringBoot没有提供对配置值加密的功能，但是提供了修改Enviroment中属性值的构造。EnvironmentPostProcessor接口运行你在应用启动前修改Enviroment。</p><p><strong>yaml使用</strong></p><p>https://yaml.org/</p><p>yaml可以是JSON数据的表达。</p><p>SpringFramework提供了两个类去加载YAML文档。YamlPropertiesFactoryBean将YAML加载成Properties，YamlMapFactoryBean将YAML加载成Map。</p><p>list</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">my</span><span class="token punctuation">:</span></span>
<span class="line">   <span class="token key atrule">servers</span><span class="token punctuation">:</span></span>
<span class="line">       <span class="token punctuation">-</span> dev.example.com</span>
<span class="line">       <span class="token punctuation">-</span> another.example.com</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">my.servers[0]</span><span class="token punctuation">=</span><span class="token value attr-value">dev.example.com</span></span>
<span class="line"><span class="token key attr-name">my.servers[1]</span><span class="token punctuation">=</span><span class="token value attr-value">another.example.com</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>使用Java代码绑定配置。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;my&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> servers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>servers<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>多profile YAML文档，下面表示激活development部分的配置。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">address</span><span class="token punctuation">:</span> 192.168.1.100</span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  	<span class="token key atrule">profiles</span><span class="token punctuation">:</span></span>
<span class="line">    	<span class="token key atrule">active</span><span class="token punctuation">:</span> dev</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">profiles</span><span class="token punctuation">:</span> development</span>
<span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.1</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">profiles</span><span class="token punctuation">:</span> production &amp; eu<span class="token punctuation">-</span>central</span>
<span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">address</span><span class="token punctuation">:</span> 192.168.1.120</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果spring.profiles.active指定了值，存在application-{profiles}.yaml的文件，则profile的配置将失效，将以指定文件的配置为准。</p><h4 id="configurationproperties" tabindex="-1"><a class="header-anchor" href="#configurationproperties"><span>ConfigurationProperties</span></a></h4><p><strong>安全配置属性</strong></p><p>@Value和@ConfigurationProperties</p><p>将配置绑定到JavaBean属性(默认是没有被容器管理的)。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetAddress</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">boolean</span> enabled<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Security</span> security <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>enabled<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> enabled<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">InetAddress</span> <span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>remoteAddress<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRemoteAddress</span><span class="token punctuation">(</span><span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>remoteAddress <span class="token operator">=</span> remoteAddress<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Security</span> <span class="token function">getSecurity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>security<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token string">&quot;USER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>roles<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRoles</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>roles <span class="token operator">=</span> roles<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的类定义了以下属性：</p><ol><li>acme.enable：默认值false。</li><li>acme.remoteAddress(remote-address)：结果可以从String类型转换而来。</li><li>acme.security.username：带有嵌套的属性名称由属性名和类中属性名共同决定。</li><li>acme.security.password。</li><li>acme.security.roles：默认是有USER的List集合。</li></ol><p>JavaBean绑定私有属性的情况，setter方法可以省略的情况：</p><ol><li>Map属性，只要被初始化了，就只需要getter而不需要setter方法。</li><li>集合或数组，通过yaml的来配置或使用&#39;,&#39;分割的配置。确定这个类型是可变的，则推荐添加setter。</li><li>如果是被final修饰属性的可以不添加setter。</li></ol><p>构造方法绑定：</p><p>@ConstructorBinding和@ConfigurationProperties。</p><p>使用构造方法绑定的类必须使用@EnableConfigurationProperties或配置扫码的方式注入。不能使用@Bean注入或@Import的方式。如果有多个构造函数ConstructorBinding使用在对应的构造方法上。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetAddress</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConstructorBinding</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">DefaultValue</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@ConstructorBinding</span></span>
<span class="line"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> enabled<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Security</span> security<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 如果没有Security的相关配置，则security为null，可以使用DefaultValue注解让对象不为null</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">AcmeProperties</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> enabled<span class="token punctuation">,</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">,</span> <span class="token class-name">Security</span> security<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> enabled<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>remoteAddress <span class="token operator">=</span> remoteAddress<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>security <span class="token operator">=</span> security<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">InetAddress</span> <span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Security</span> <span class="token function">getSecurity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// DefaultValue指定默认值</span></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">Security</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span></span>
<span class="line">                <span class="token annotation punctuation">@DefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;USER&quot;</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>roles <span class="token operator">=</span> roles<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>激活(启用)ConfigurationProperties注解</strong></p><p>三种方式激活@ConfigurationProperties配置类。</p><ol><li>再@ConfigurationProperties上添加@Configuration(被扫描到)。</li><li>@EnableConfigurationProperties中配置这个class。</li><li>@ConfigurationPropertiesScan中配置扫码的路径(通常在main方法上使用，也可以在@Configuraion注解上使用)。</li></ol><p>ConfigurationProperties注入的Bean命名规则pre-fqn。pre表示配置的前缀；fqn表示类的全路径名称。</p><p>激活之后就可以像一个普通Bean一样使用。</p><p><strong>第三方配置</strong></p><p>AnotherComponent对象的属性会在返回自动设置属性。</p><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;another&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">AnotherComponent</span> <span class="token function">anotherComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p><strong>宽松的绑定方式</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;acme.my-project.person&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OwnerProperties</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> firstName<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFirstName</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>prefix指定的值，单词分割必须使用&#39;-&#39;。</p><table><thead><tr><th>key</th><th>使用说名</th></tr></thead><tbody><tr><td>acme.my-project.person.first-name</td><td>properties和yml中使用</td></tr><tr><td>acme.myProject.person.firstName</td><td>标准驼峰分割</td></tr><tr><td>acme.my_project.person.first_name</td><td>下划线分割，properties和yml中使用</td></tr><tr><td>ACME_MYPROJECT_PERSON_FIRSTNAME</td><td>大写格式，使用系统变量使用</td></tr></tbody></table><p><strong>绑定至Map</strong></p><p>如果Map的key中有非字母数字或&#39;-&#39;，则需要使用&quot;[]&quot;包裹，否则非字母数字或&#39;-&#39;的字符都会被删除。例如：</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">acme</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">map</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">&quot;[/key1]&quot;</span><span class="token punctuation">:</span> value1</span>
<span class="line">    <span class="token key atrule">&quot;[/key2]&quot;</span><span class="token punctuation">:</span> value2</span>
<span class="line">    <span class="token key atrule">/key3</span><span class="token punctuation">:</span> value3</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>map的key是：/key1、/key2、key3。</p><p><strong>绑定环境变量</strong></p><p>Linux系统的环境变量名仅包含字母(a-z|A-Z)、数字、下划线(_)，Unix变量名还会全部大写。</p><p>将配置文件的key转换成环境变量遵循以下规则：</p><ol><li>&#39;.&#39;转换成&#39;_&#39;。</li><li>去掉所有的&#39;-&#39;。</li><li>全部转大写。</li></ol><p>spring.main.log-startup-info对应环境变量名：SPRING_MAIN_LOGSTARTUPINFO。</p><p>如果绑定的环境变量值是List，则：my.acme[0].other变为MY_ACME_0_OTHER。</p><p><strong>配置合并规则</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">acme</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">list</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my name</span>
<span class="line">      <span class="token key atrule">description</span><span class="token punctuation">:</span> my description</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> dev</span>
<span class="line"><span class="token key atrule">acme</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">list</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my another name</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果dev不激活，则list中只会有一个对象，name的值是my name。</p><p>如果dev激活，则list也只会有一个对象，name的值是my another name。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">acme</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">list</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my name</span>
<span class="line">      <span class="token key atrule">description</span><span class="token punctuation">:</span> my description</span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> another name</span>
<span class="line">      <span class="token key atrule">description</span><span class="token punctuation">:</span> another description</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> dev</span>
<span class="line"><span class="token key atrule">acme</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">list</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my another name</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>多个配置指向一个列表，只会保留优先级高的配置。</p><p>如果dev不激活，则list中有2个对象。</p><p>如果dev激活，则list中只有1个对象。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">acme</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">map</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">key1</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> my name 1</span>
<span class="line">      <span class="token key atrule">description</span><span class="token punctuation">:</span> my description 1</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> dev</span>
<span class="line"><span class="token key atrule">acme</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">map</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">key1</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> dev name 1</span>
<span class="line">    <span class="token key atrule">key2</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> dev name 2</span>
<span class="line">      <span class="token key atrule">description</span><span class="token punctuation">:</span> dev description 2</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>激活情况同上。</p><p><strong>属性转换</strong></p><p>SpringBoot在绑定属性时，会自动尝试将外部属性进行转换。自己也可以自定义转换方式。</p><p>ConversionService</p><p>CustomEditorConfigurer</p><p><strong>Duration转换</strong></p><p>持续事件的设置，定义值的规则：</p><ol><li>long值表达式，默认的单位时ms(毫秒)，除非通过@DurationUnit指定单位。</li><li>ISO-8601格式(Duration)。</li><li>可读的格式，例如10s意味着10秒。</li></ol><p>可读单位表示：</p><ol><li>ns：纳秒</li><li>us：微秒</li><li>ms：毫秒</li><li>s：秒</li><li>m：分钟</li><li>h：小时</li><li>d：天</li></ol><p>500、 PT0.5S、500ms表示500毫秒。</p><p>单位指定后可以被覆盖？</p><p><strong>DataSize转换</strong></p><p>DataSize能识别以下的格式：</p><ol><li>long值，byte作为默认单位，除非@DataSizeUni指定单位。</li><li>可读的值和单位，例如：1MB。</li></ol><p>可读单位：</p><ol><li>B：</li><li>KB：</li><li>MB：</li><li>GB：</li><li>TB：</li></ol><p><strong>ConfigurationProperties校验</strong></p><p>添加@Validated可以使用</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@Validated</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@NotNull</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Valid</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Security</span> security <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ... getters and setters</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token annotation punctuation">@NotEmpty</span></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// ... getters and setters</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>@ConfigurationProperties和@Value</strong></p><table><thead><tr><th>特点</th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>宽松的绑定</td><td>支持</td><td>有限</td></tr><tr><td>元数据支持</td><td>支持</td><td>不支持</td></tr><tr><td>SPEL表达式</td><td>不支持</td><td>支持</td></tr></tbody></table><p>@Value(&quot;{demo.item-price}&quot;)支持配置值和@Configuration一致。但是@Value(&quot;{demo.itemPrice}&quot;)就支持配置文件中key为demo.itemPrice的。</p><h3 id="profiles" tabindex="-1"><a class="header-anchor" href="#profiles"><span>Profiles</span></a></h3><p>Spring提供了在代码中使用不同环境的配置文件方式，如在@Component、@Configuration、@ConfigurationProperties上使用@Profile注解来限制配置的加载。</p><p>如果@ConfigurationProperties通过@EnableConfigurationProperties的方式加载，则@Profile注解需要在注解@EnableConfigurationProperties上才会生效；如果是扫描加载，则不用。</p><p><strong>添加激活Profiles</strong></p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">my.property</span><span class="token punctuation">:</span> fromyamlfile</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">spring.profiles</span><span class="token punctuation">:</span> prod</span>
<span class="line"><span class="token key atrule">spring.profiles.include</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> proddb</span>
<span class="line">  <span class="token punctuation">-</span> prodmq</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>如果启动时添加了--spring.profiles.active=prod的配置，不存在application-prod.yml(yaml|properties)的配置文件，则proddb、prodmq将被激活。</p><p><strong>程序添加激活Profiles</strong></p><p>在SpringApplication调用run方法之前，SpringApplication.setAdditionalProfiles(…)添加激活Profiles。</p><p>这个添加的Profiles也遵循特定文件的规则。</p><h3 id="logging" tabindex="-1"><a class="header-anchor" href="#logging"><span>Logging</span></a></h3><p>SpringBoot使用Apache Logging作为底层，也保证了日志的对外的扩展。</p><p><strong>默认日志格式</strong></p><ol><li>带毫秒的日期：2024-12-07 17:19:39.073。</li><li>LEVEL：日志的级别，ERROR、WARN、INFO、DEBUG、TRACE。</li><li>分割符：---</li><li>threadName：线程名</li><li>LoggerName：记录日志的log设置的类名。</li><li>msg：日志消息。</li></ol><p><strong>控制台输出</strong></p><p>控制日志的级别：</p><ol><li>启动参数：--debug、--trace。</li><li>配置文件：debug=true、trace=true。</li></ol><p><strong>控制台颜色输出</strong></p><p>%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){yellow}表示日期打印的颜色是黄色。</p><p>支持的颜色有：</p><ol><li>blue</li><li>cyan</li><li>faint</li><li>green</li><li>megenta</li><li>red</li><li>yellow</li></ol><p><strong>日志输出到文件</strong></p><p>可以通过logging.file.name或logging.file.path配置日志输出到文件。</p><table><thead><tr><th>logging.file.name</th><th>logging.file.path</th><th>example</th><th>description</th></tr></thead><tbody><tr><td>none</td><td>none</td><td></td><td>输出到控制台</td></tr><tr><td>特定文件</td><td>none</td><td>application.log</td><td>写入指定文件，文件中也能指定路径</td></tr><tr><td>none</td><td>特定的目录</td><td>log</td><td>写入特定目录的spring.log文件中</td></tr></tbody></table><p>其它配置：</p><ol><li>logging.file.max-size：指定日志文件文件最大的大小，超过则被压缩成[logName].yyyy-MM-dd.n.gz文件。</li><li>logging.file.max-history：默认保留7天的轮换日志。</li><li>logging.file.total-size-cap：设置日志档案的大小，超过阈值则备份被删除(启动时压缩超过阈值会删除备份文档)。</li><li>logging.file.clean-history-on-start：启动强制清理存档。</li></ol><p><strong>日志级别设置</strong></p><p>logging.level.[logger-name]=[level]方式设置日志的隔离级别</p><p>logger-name可以指定路径下类的日志级别(也可以到类)，也可以指定根级别root。</p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">logging.level.root</span><span class="token punctuation">=</span><span class="token value attr-value">warn</span></span>
<span class="line"><span class="token key attr-name">logging.level.org.springframework.web</span><span class="token punctuation">=</span><span class="token value attr-value">debug</span></span>
<span class="line"><span class="token key attr-name">logging.level.org.hibernate</span><span class="token punctuation">=</span><span class="token value attr-value">error</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p><strong>日志组配置</strong></p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token comment"># 定义一个组</span></span>
<span class="line"><span class="token key attr-name">logging.group.tomcat</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.catalina, org.apache.coyote, org.apache.tomcat</span></span>
<span class="line"><span class="token comment"># 指定组的日志级别</span></span>
<span class="line"><span class="token key attr-name">logging.level.tomcat</span><span class="token punctuation">=</span><span class="token value attr-value">TRACE</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>SpringBoot提供的两个预定组：</p><ol><li>web：org.springframework.core.codec, org.springframework.http, org.springframework.web, org.springframework.boot.actuate.endpoint.web, org.springframework.boot.web.servlet.ServletContextInitializerBeans。</li><li>sql：org.springframework.jdbc.core, org.hibernate.SQL, org.jooq.tools.LoggerListener。</li></ol><p><strong>自定义日志配置</strong></p><p>SpringBoot使用哪套日志系统，由org.springframework.boot.logging.LoggingSystem类的get(ClassLoader classLoader)方法决定。</p><figure><img src="http://47.101.155.205/image-20241209131218562.png" alt="image-20241209131218562" tabindex="0" loading="lazy"><figcaption>image-20241209131218562</figcaption></figure><p>可以通过系统变量org.springframework.boot.logging.LoggingSystem的值来替换SpringBoot的日志系统，也可以通过none禁用SpringBoot的日志配置。</p><p><strong>日志系统是在ApplicationContext初始化之前确定的，所以改变日志系统或禁用日志配置的方式只能通过系统属性。</strong></p><p>默认日志系统自动加载的配置文件。可以通过logging.config指定加载的文件。</p><p>ResourceUtils.<em>getURL</em>(logging.config).openStream().close()方法校验文件是否存在。</p><table><thead><tr><th>日志系统</th><th>默认加载文件(位置classpath:)</th></tr></thead><tbody><tr><td>logback</td><td>logback-test[-spring].groovy、logback-test[-spring].xml、logback[-spring].groovy、logback[-spring].xml</td></tr><tr><td>Log4j2</td><td>log4j2-test[-spring].properties、log4j2-test[-spring].xml、log4j2[-spring].properties、log4j2[-spring].xml</td></tr><tr><td>JDK</td><td>logging[-spring].properties</td></tr></tbody></table><p>SpringBoot会将配置值转移到Java的系统变量中(变量不存在)。SpringBoot配置和系统变量key关系：</p><table><thead><tr><th>SpringBoot配置</th><th>系统变量</th><th>作用</th></tr></thead><tbody><tr><td>logging.exception-conversion-word</td><td>LOG_EXCEPTION_CONVERSION_WORD</td><td>记录异常转换的关键字</td></tr><tr><td>logging.pattern.console</td><td>CONSOLE_LOG_PATTERN</td><td>控制台输出的日志格式(仅logback)</td></tr><tr><td>logging.pattern.file</td><td>FILE_LOG_PATTERN</td><td>输出到文件日志格式(文件记录开启)(仅logback)</td></tr><tr><td>logging.file.clean-history-on-start</td><td>LOG_FILE_CLEAN_HISTORY_ON_START</td><td>是否启用清理归档日志(文件记录开启)(仅logback)</td></tr><tr><td>logging.file.max-history</td><td>LOG_FILE_MAX_HISTORY</td><td>日志保留的天数(文件记录开启)(仅logback)</td></tr><tr><td>logging.file.max-size</td><td>LOG_FILE_MAX_SIZE</td><td>最大日志文件大小(文件记录开启)(仅logback)</td></tr><tr><td>logging.file.total-size-cap</td><td>LOG_FILE_TOTAL_SIZE_CAP</td><td>保留压缩日志的总大小(文件记录开启)(仅logback)</td></tr><tr><td>logging.pattern.level</td><td>LOG_LEVEL_PATTERN</td><td>日志级别打印的格式(默认%5p)(仅logback)</td></tr><tr><td>logging.pattern.dateformat</td><td>LOG_DATEFORMAT_PATTERN</td><td>日志日期打印格式(仅logback)</td></tr><tr><td>logging.pattern.rolling-file-name</td><td>ROLLING_FILE_NAME_PATTERN</td><td>滚动日志的日志名(默认${LOG_FILE}.%d{yyyy-MM-dd}.%i.gz))(仅logback)</td></tr><tr><td></td><td>PID</td><td>当前Java进程的pid</td></tr></tbody></table><figure><img src="http://47.101.155.205/image-20241209140201531.png" alt="image-20241209140201531" tabindex="0" loading="lazy"><figcaption>image-20241209140201531</figcaption></figure><p>%clr在logback.xml配置文件中启动报错。</p><p>logback.xml(logback-spring.xml)控制日志行为</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token comment">&lt;!-- 定义全局属性 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOG_PATH<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./log<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>APP_NAME<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>springboot-example<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!-- 控制台输出 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CONSOLE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 日志格式不支持%clr --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                %d{yyyy-MM-dd HH:mm:ss.SSS} %highlight(%-5level) ${PID} --- [%thread]  %logger{36} - %msg%n</span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!-- 滚动文件输出 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FILE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${LOG_PATH}/${APP_NAME}.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 每天滚动 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${LOG_PATH}/${APP_NAME}-%d{yyyy-MM-dd}.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 保留最近 30 天的日志 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level ${PID} --- [%thread]  %logger{36} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!-- 定义日志级别 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CONSOLE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FILE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="国际化" tabindex="-1"><a class="header-anchor" href="#国际化"><span>国际化</span></a></h3><p>国际化配置默认情况下在classpath下有messages.properties文件时自动激活。</p><p>自动配置类：MessageSourceAutoConfiguration。</p><figure><img src="http://47.101.155.205/image-20241209171213730.png" alt="image-20241209171213730" tabindex="0" loading="lazy"><figcaption>image-20241209171213730</figcaption></figure><h3 id="json" tabindex="-1"><a class="header-anchor" href="#json"><span>JSON</span></a></h3><p>SpringBoot提供了三个JSON映射库：</p><ol><li>Gson</li><li>Jackson(默认的)</li><li>JSON-B</li></ol><p><strong>Jackson</strong></p><p>spring-boot-starter-json作为自动配置Jackson的一部分。</p><p>Jackson自动配置类org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration。</p><p>对ObjectMapper的配置https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/reference/htmlsingle/#howto-customize-the-jackson-objectmapper</p><p><strong>Gson</strong></p><p>Gson相关依赖存在时会自动配置Gson，提供了sprin.gson.*(org.springframework.boot.autoconfigure.gson.GsonProperties)来自定义Gson的行为。</p><p>自动配置类org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration。</p><p>怎么定义多个GsonBuilderCustomizer？</p><p><strong>JSON-B</strong></p><p>支持自动配置JSON-B。在JSON-B的依赖被加载时自动配置。</p><h3 id="web开发" tabindex="-1"><a class="header-anchor" href="#web开发"><span>Web开发</span></a></h3><p>SpringBoot非常适合做web开发，能够通过嵌入容器Tomcat, Jetty, Undertow或Netty快速开发独立的http服务器。有两种方式：</p><p>spring-boot-starter-web</p><p>spring-boot-starter-webflux</p><h4 id="springmvc" tabindex="-1"><a class="header-anchor" href="#springmvc"><span>SpringMVC</span></a></h4><p><strong>自动配置</strong></p><p>SpringMVC自动配置功能。</p><p>实现WebMvcConfigurer接口，添加注解@Configuration，来自定义拦截器、json解析、视图控制等功能。</p><p>想替换RequestMappingHandlerMapping、RequestMappingHandlerAdapter、ExceptionHandlerExceptionResolver，但是不修改SpringMVC的机制，声明一个WebMvcRegistrations Bean并提供这些对象。</p><p>想要完全控制控制SpringMVC的行为，可以通过继承抽象类WebMvcConfigurationSupport，并将其交由Spring管理。</p><p><strong>HttpMessageConverters</strong></p><p>SpringMVC使用HttpMessageConverter来转换http请求和响应。默认时开箱即用的。Json转换默认使用Jackson，xml使用Jackson XML或JAXB。字符串默认使用UTF-8编码.</p><p>也可以自定义HttpMessageConverters</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpMessageConverters</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>converter<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">HttpMessageConverters</span> <span class="token function">customConverters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> additional <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> another <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HttpMessageConverters</span><span class="token punctuation">(</span>additional<span class="token punctuation">,</span> another<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>自定义Json序列化和反序列化</strong></p><p>快速支持类的序列化和反序列化</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@JsonComponent</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Serializer</span> <span class="token keyword">extends</span> <span class="token class-name">JsonSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SomeObject</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Deserializer</span> <span class="token keyword">extends</span> <span class="token class-name">JsonDeserializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SomeObject</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>MessageCodesResolver</strong></p><p>定义解析出现错误时的提示格式。</p><p>spring.mvc.message-codes-resolver-format=prefix_error_code，格式为errorCode + . + objectName + . + field。</p><p>spring.mvc.message-codes-resolver-format=postfix_error_code，格式为objectName + . +field + . + errorCode。</p><p><strong>静态资源</strong></p><p>静态资源默认从classpath下的<code>/META-INF/resources/</code>、<code>/resources/</code>、<code>/static/</code>、<code>/public/</code>下加载，可以通过注入WebMvcConfigurer Bean重写addResourceHandlers调整资源目录，也可以通过<code>spring.resources.static-locations</code>配置修改目录，默认会在后面补<code>&#39;/&#39;</code>。</p><p>访问静态资源的默认路径是/**，spring.mvc.static-path-pattern配置修改访问静态资源的路径。</p><p><code>spring.mvc.static-path-pattern=/resources/**</code>，表示resources/开头的路径才会去访问静态资源。</p><p><strong>配置WebBindingInitializer</strong></p><p>SpringMVC使用WebBindingInitializer为特定的请求绑定WebDataBinder。</p><p>注入ConfigurableWebBindingInitializer Bean有什么作用？</p><p><strong>模板引擎</strong></p><p>FreeMarker：https://freemarker.apache.org/docs/</p><p>Groovy：http://docs.groovy-lang.org/docs/next/html/documentation/template-engines.html#_the_markuptemplateengine</p><p>Thymeleaf：https://www.thymeleaf.org/</p><p>Mustache：https://mustache.github.io/</p><p><strong>错误处理</strong></p><p>SpringBoot默认提供一个/error来处理所有的错误。SpringBoot会根据请求头Accept的值来决定返回返回视图还是文本。</p><p>BasicErrorController根据配置的路径处理错误。通过@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)，Accept=text/html，将会返回一个错误视图。</p><p>如果是其它类型的Accept，例如为PostMan默认的，则会返回json文本。</p><p>还可以通过@ControllerAdvice注解，来自定义哪些Controller的异常处理需要处理，例如：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 可以配置某个具体的类，也可以是包的路径</span></span>
<span class="line"><span class="token annotation punctuation">@ControllerAdvice</span><span class="token punctuation">(</span>basePackageClasses <span class="token operator">=</span> <span class="token class-name">AcmeController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeControllerAdvice</span> <span class="token keyword">extends</span> <span class="token class-name">ResponseEntityExceptionHandler</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 定义异常处理的类型</span></span>
<span class="line">    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">YourException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// 重写返回的状态码(不是ResponseEntity返回则可以通过这个指定状态码)</span></span>
<span class="line">    <span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token annotation punctuation">@ResponseBody</span></span>
<span class="line">    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleControllerException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> <span class="token function">getStatus</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomErrorType</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">HttpStatus</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Integer</span> statusCode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javax.servlet.error.status_code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>自定义错误页面</strong></p><p>resources/public/error目录下新建404.html的静态资源文件。也可以是模板文件。</p><p>添加一个重写ErrorViewResolver接口的Bean，定义规则。</p><p><strong>HATEOA</strong></p><p>功能支持，没有具体介绍，和@EnableHypermediaSupport注解有关。</p><p><strong>跨域支持</strong></p><p>SpringMVC自4.2版本开始，支持跨域请求。</p><p>SpringBoot支持使用注解@CrossOrigin开启跨域功能(局部配置)。</p><p>全局配置跨域方式如下：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">corsConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token annotation punctuation">@Override</span></span>
<span class="line">            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCorsMappings</span><span class="token punctuation">(</span><span class="token class-name">CorsRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                registry<span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="webflux" tabindex="-1"><a class="header-anchor" href="#webflux"><span>WebFlux</span></a></h4><p>Spring Framework 5.0开始提供的响应式Web，不像SpringMVC，不需要Servlet API，是完全异步和非阻塞的。</p><p>两者定义WebFlux处理接口的方式</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRestController</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}/customers&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Customer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoutingConfiguration</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">monoRouterFunction</span><span class="token punctuation">(</span><span class="token class-name">UserHandler</span> userHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">getUser</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}/customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">getUserCustomers</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span><span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">deleteUser</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserHandler</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>配置</strong></p><p>可以注入WebFluxConfigurer Bean自定义配置，不适应@EnableWebFlux注解。</p><p>添加额外的配置，注入WebFluxConfigurer Bean，不添加注解@EnableWebFlux。</p><p>安全控制，注入WebFluxConfigurer Bean，添加注解@EnableWebFlux。</p><p><strong>HttpMessageReaders和HttpMessageWriters</strong></p><p>使用HttpMessageReader和HttpMessageWriter来转换请求和响应。</p><p>spring.codec.*配置作用？</p><p>CodecCustomizer 来定义什么？</p><p>spring.jackson.*来配置Jackson的行为。</p><p><strong>静态资源访问</strong></p><p>配置方式略同SpringMVC Web。</p><p>没有Servlet，不支持war包部署。</p><p><strong>模板引擎</strong></p><p>FreeMarker：https://freemarker.apache.org/docs/</p><p>Thymeleaf：https://www.thymeleaf.org/</p><p>Mustache：https://mustache.github.io/</p><p><strong>错误处理</strong></p><p>默认的错误处理方式和SpringMVC web相同。</p><p>通过WebExceptionHandler去处理错误。</p><p>通常注入ErrorWebExceptionHandler Bean来自定义处理错误的方式。因为WebExceptionHandler优先级比较低，也可以通过注入AbstractErrorWebExceptionHandler Bean处理错误。</p><p>默认是DefaultErrorWebExceptionHandler。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomErrorWebExceptionHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractErrorWebExceptionHandler</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Define constructor here</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoutingFunction</span><span class="token punctuation">(</span><span class="token class-name">ErrorAttributes</span> errorAttributes<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">RouterFunctions</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>aPredicate<span class="token punctuation">,</span> aHandler<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span>anotherPredicate<span class="token punctuation">,</span> anotherHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>自定义错误页面</strong></p><p>配置同SpringMVC Web。</p><p><strong>Web过滤器</strong></p><p>Spring WebFlux提供了WebFilter接口实现过滤器的效果。</p><p>可以通过Ordered接口或注解@Order注解来指定过滤器的指向顺序。</p><table><thead><tr><th style="text-align:left;">Web Filter</th><th style="text-align:left;">Order</th></tr></thead><tbody><tr><td style="text-align:left;">MetricsWebFilter(Spring Actuator)</td><td style="text-align:left;">Ordered.HIGHEST_PRECEDENCE + 1</td></tr><tr><td style="text-align:left;">WebFilterChainProxy (Spring Security)</td><td style="text-align:left;">-100</td></tr><tr><td style="text-align:left;">HttpTraceWebFilter(Spring Actuator)</td><td style="text-align:left;">Ordered.LOWEST_PRECEDENCE - 10</td></tr></tbody></table><h4 id="jax-rs和jersey" tabindex="-1"><a class="header-anchor" href="#jax-rs和jersey"><span>JAX-RS和Jersey</span></a></h4><p>作用是什么？</p><p>应该是另外一直Web接口写法。</p><h4 id="嵌入式容器" tabindex="-1"><a class="header-anchor" href="#嵌入式容器"><span>嵌入式容器</span></a></h4><p>servlet容器可以定义过滤器监听器，并作为Bean注册在Spring中。</p><p>过滤器可以通过注解<code>@Order</code>或实现接口<code>Ordered</code>来控制指向的顺序，注解通过@Bean注入不能设置。</p><p>通过<code>FilterRegistrationBean</code>注入Bean是另外的方式控制顺序。</p><p>顺序的值要小于等于<code>OrderedFilter.REQUEST_WRAPPER_FILTER_MAX_ORDER</code>。</p><p>@ServletComponentScan注解可以扫描@WebServlet, @WebFilter, @WebListener注解的类。</p><p>可以自定义Servlet的行为：</p><ol><li>端口(server.port)，绑定的地址(server.address)。</li><li>Session设置：持久(server.servlet.session.persistent)，过期时间(server.servlet.session.timeout)，session存储位置(server.servlet.session.store-dir)，session-cookie配置(server.servlet.session.cookie.*)。</li><li>错误地址配置server.error.path。</li><li>SSL。</li><li>Http压缩</li></ol><p>ServerProperties：server.*配置。</p><p><strong>程序配置</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">WebServerFactoryCustomizer</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ConfigurableServletWebServerFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomizationBean</span> <span class="token keyword">implements</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableServletWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableServletWebServerFactory</span> server<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        server<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TomcatServletWebServerFactory, JettyServletWebServerFactory, UndertowServletWebServerFactory</p><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">ConfigurableServletWebServerFactory</span> <span class="token function">webServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">TomcatServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    factory<span class="token punctuation">.</span><span class="token function">setSessionTimeout</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MINUTES</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    factory<span class="token punctuation">.</span><span class="token function">addErrorPages</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ErrorPage</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">NOT_FOUND</span><span class="token punctuation">,</span> <span class="token string">&quot;/notfound.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> factory<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="rsocket" tabindex="-1"><a class="header-anchor" href="#rsocket"><span>RSocket</span></a></h3><h3 id="security" tabindex="-1"><a class="header-anchor" href="#security"><span>Security</span></a></h3><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="sql-database" tabindex="-1"><a class="header-anchor" href="#sql-database"><span>SQL Database</span></a></h3><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h4 id="内存数据库" tabindex="-1"><a class="header-anchor" href="#内存数据库"><span>内存数据库</span></a></h4><p>SpringBoot支持自动配置的内存数据库有H2、HSQL、Derby。</p><p>spring-data-jpa内置了测试hsql。</p><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.hsqldb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hsqldb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>内存数据库的绑定方式：</p><ol><li>引入spring-boot-starter-data-jpa依赖，其引入了spring-boot-starter-jdbc，jdbc提供了HikariCP依赖。</li><li>DataSourceConfiguration：SpringBoot根据加载的HikariCP依赖，创建了HikariDataSource(spring.datasource.hikari)。其中DataSourceProperties配置类(DataSourceAutoConfiguration)被其它类激活，该类实现了InitializingBean接口，在属性设置完成只会，调用afterPropertiesSet()，按H2、Debry、Hsql的顺序在看是否有内存数据库相关的驱动类，如果存在则设置这个内存数据库的驱动相关信息。</li><li>然后DataSourceBuilder构造器构造HikariDataSource(bind DataSourceProperties)数据源信息，spring.datasource.hikari再设置相关的数据源配置。</li><li>DataSourcePoolMetadataProvidersConfiguration：创建DataSourcePoolMetadataProvider对象。</li><li>创建DataSourcePoolMetadata对象，后面连接池就构建完成了。</li></ol><figure><img src="http://47.101.155.205/image-20241210204255423.png" alt="image-20241210204255423" tabindex="0" loading="lazy"><figcaption>image-20241210204255423</figcaption></figure><p>内存数据库会根据扫描到的Entity创建表。例如：https://spring.io/guides/gs/accessing-data-jpa</p><h4 id="jndi-数据源" tabindex="-1"><a class="header-anchor" href="#jndi-数据源"><span>JNDI 数据源</span></a></h4><p>JNDI(Java Naming and Directory Interface)Java提供的API，用于命名和目录服务。</p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">spring.datasource.jndi-name</span><span class="token punctuation">=</span><span class="token value attr-value">java:jboss/datasources/customers</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>context.xml文件。SpringBoot嵌入式容器不支持此方式启动。</p><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Context</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Resource</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java:jboss/datasources/customers<span class="token punctuation">&quot;</span></span></span>
<span class="line">              <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:oracle:thin:@//ip:port/database<span class="token punctuation">&quot;</span></span></span>
<span class="line">              <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.zaxxer.hikari.HikariDataSource<span class="token punctuation">&quot;</span></span></span>
<span class="line">              <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span></span>
<span class="line">              <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span></span>
<span class="line">    <span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Context</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h4 id="普通数据库" tabindex="-1"><a class="header-anchor" href="#普通数据库"><span>普通数据库</span></a></h4><p>SpringBoot支持自动配置的连接池有：HikariCP、tomcat DataSource、DBCP DataSource。</p><p>自动配置JdbcTemplate和NamedParameterJdbcTemplate，spring.jdbc.template.*配置JdbcTemplate功能。</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token comment">&lt;!-- tomcat 连接池依赖 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tomcat-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token comment">&lt;!-- dbcp2连接池依赖 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-dbcp2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">&lt;!-- Oracle驱动 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.oracle.ojdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ojdbc8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>19.3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 自动</span></span>
<span class="line"><span class="token keyword">create</span> <span class="token keyword">table</span> customer <span class="token punctuation">(</span>id number<span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> first_name varchar2<span class="token punctuation">(</span><span class="token number">255</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> last_name varchar2<span class="token punctuation">(</span><span class="token number">255</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">create</span> sequence seq_customer <span class="token keyword">start</span> <span class="token keyword">with</span> <span class="token number">1</span> increment <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">drop</span> <span class="token keyword">table</span> customer <span class="token keyword">cascade</span> constraints<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">drop</span> sequence seq_customer<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token comment"># 默认nono,内存数据库则为create-drop(根据Entity先删除后创建停止再删除表,强制停止不会指向删除)</span></span>
<span class="line"><span class="token comment"># DataSourceSchemaCreatedEvent时间</span></span>
<span class="line"><span class="token key attr-name">spring.jpa.hibernate.ddl-auto</span><span class="token punctuation">=</span><span class="token value attr-value">create-drop</span></span>
<span class="line"><span class="token comment"># 配置和上面的作用一致，优先级更高</span></span>
<span class="line"><span class="token key attr-name">spring.jpa.properties.hibernate.hbm2ddl.auto</span><span class="token punctuation">=</span><span class="token value attr-value">create-drop</span></span>
<span class="line"><span class="token comment"># true/false EntityManager 行为</span></span>
<span class="line"><span class="token key attr-name">spring.jpa.open-in-view</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 数据库连接配置</span></span>
<span class="line"><span class="token comment"># url指定后可以不指定驱动类名称，如果驱动为空，后续会推导。指定驱动的类必须要能被ClassLoader加载，否则启动不了。</span></span>
<span class="line"><span class="token comment"># oracle</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:oracle:thin:@//ip:port/database</span></span>
<span class="line"><span class="token comment"># mysql</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://ip:port/test</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">{username}</span></span>
<span class="line"><span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">{password}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SpringBoot官网说加载连接池的优先级：</p><ol><li>HikariCP可用则选它。</li><li>否则，Tomcat DataSource可用则选它。</li><li>否则，Dbcp2可用则选它。</li><li>spring.datasource.type指定忽略这个配置规则，因为注解@ConditionalOnProperty。</li></ol><p>这里的优先级应该由@Import({ DataSourceConfiguration.Tomcat.class, DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class })决定加载顺序。</p><p>可以Debug测试。</p><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// SpringBootCondition matches</span></span>
<span class="line">classOrMethodName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;$Hikari&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> classOrMethodName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;$Tomcat&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> classOrMethodName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;$Dbcp2&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// OnBeanCondition getMatchOutcome 方法</span></span>
<span class="line"><span class="token punctuation">(</span>metadata <span class="token keyword">instanceof</span> <span class="token class-name">SimpleAnnotationMetadata</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SimpleAnnotationMetadata</span><span class="token punctuation">)</span> metadata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;$Hikari&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SimpleAnnotationMetadata</span><span class="token punctuation">)</span> metadata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;$Tomcat&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span>  <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SimpleAnnotationMetadata</span><span class="token punctuation">)</span> metadata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;$Dbcp2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20241211112902475.png" alt="image-20241211112902475" tabindex="0" loading="lazy"><figcaption>image-20241211112902475</figcaption></figure><figure><img src="http://47.101.155.205/image-20241211123546596.png" alt="image-20241211123546596" tabindex="0" loading="lazy"><figcaption>image-20241211123546596</figcaption></figure><h4 id="jpa和spring-data-jpa" tabindex="-1"><a class="header-anchor" href="#jpa和spring-data-jpa"><span>JPA和Spring Data JPA</span></a></h4><p>JPA和Spring Data JPA</p><p>JPA(Java Persistence API)是将&quot;Map&quot;对象映射到关系型数据库的技术。</p><p>spring-boot-starter-data-jpa包含了spring-boot-starter-jdbc。</p><p>spring-boot-starter-jdbc提供了HikariCP依赖。</p><p>Spring Data JPA提供了基于JPA技术的实现，在SpringBoot项目可以快速应用。提供了以下依赖：</p><ol><li>Hibernate：JPA的一种实现。</li><li>Spring Data JPA：简化的JPA的操作。</li><li>Spring ORMs：Spring提供ORM(映射)。</li></ol><p>使用@Entity注解定义数据库的表，属性相当于数据库表的列。</p><p>数据库操作通过实现CityRepository 接口。可以通过方法名来生成sql查询数据。</p><p>复杂SQL可以使用@Query注解。</p><p>Spring Data JPA Repository提供了三种模式加载，defalut、defferred、lazy。通过spring.data.jpa.repositories.bootstrap-mode设置模式。</p><p>@EnableJdbcRepositories指定dao的包路径</p><h4 id="jooq" tabindex="-1"><a class="header-anchor" href="#jooq"><span>jooq</span></a></h4><p>快速构建查询和生成代码。</p><p>官网生成代码介绍：https://www.jooq.org/doc/3.12.4/manual-single-page/#jooq-in-7-steps-step3</p><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jooq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>插件根据数据库表生成类代码：部分数据库类型开源不支持，如Oracle。</p><p>引入插件配置</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.jooq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jooq-codegen-maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!-- 项目中有定义即可 --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.oracle.ojdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ojdbc8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>19.3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">&lt;!-- jdbc配置 --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbc</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driver</span><span class="token punctuation">&gt;</span></span>oracle.jdbc.OracleDriver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>driver</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>jdbc:oracle:thin:@//ip:port/database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">&gt;</span></span>user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>password<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbc</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generator</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generate</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pojos</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pojos</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generate</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">&lt;!-- 代码生成器,默认值 --&gt;</span></span>
<span class="line">            <span class="token comment">&lt;!--&lt;name&gt;org.jooq.codegen.JavaGenerator&lt;/name&gt;--&gt;</span></span>
<span class="line">            <span class="token comment">&lt;!-- 支持替换，当前项目打成jar包才能使用 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>com.oycm.codegen.CustomJavaGenerator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>database</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token comment">&lt;!-- 配置sql方言，SQLDialect有支持的类型，默认DEFALUT --&gt;</span></span>
<span class="line">                <span class="token comment">&lt;!--&lt;name&gt;org.jooq.meta.mysql.MySQLDatabase&lt;/name&gt;--&gt;</span></span>
<span class="line">                <span class="token comment">&lt;!-- 包含哪些表，支持正则匹配 --&gt;</span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>.*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                </span>
<span class="line">                <span class="token comment">&lt;!-- 排除哪些表(优先级更高)，支持正则匹配 --&gt;</span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                </span>
<span class="line">                <span class="token comment">&lt;!-- 哪个库(schema) --&gt;</span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>inputSchema</span><span class="token punctuation">&gt;</span></span>{database/schema}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>inputSchema</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>database</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token comment">&lt;!-- 生产的包前置 --&gt;</span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packageName</span><span class="token punctuation">&gt;</span></span>com.oycm.generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packageName</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token comment">&lt;!-- 生成代码目标路径 --&gt;</span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generator</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Oracle的方言不支持，可以通过自定义的方式来操作DefaultDataType的属性TYPES_BY_NAME的值。</p><p>能通过这种方式实现对表到类的转换。会有一点问题.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomJavaGenerator</span> <span class="token keyword">extends</span> <span class="token class-name">JavaGenerator</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">DataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Date</span><span class="token punctuation">&gt;</span></span> <span class="token constant">ORIGIN_DATE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultDataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 新增不支持，替换修改的实现自定义功能</span></span>
<span class="line">            <span class="token class-name">Field</span> typesByName <span class="token operator">=</span> <span class="token class-name">DefaultDataType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;TYPES_BY_NAME&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Field</span> typesByType <span class="token operator">=</span> <span class="token class-name">DefaultDataType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;TYPES_BY_TYPE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Field</span> typesBySqlDatatype <span class="token operator">=</span> <span class="token class-name">DefaultDataType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;TYPES_BY_SQL_DATATYPE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            typesByName<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            typesByType<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            typesBySqlDatatype<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataType</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> nameMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataType</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> typesByName<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">DefaultDataType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">DataType</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> typeMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">DataType</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> typesByType<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">DefaultDataType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DataType</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">DataType</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">DataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sqlDataMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DataType</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">DataType</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">DataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> typesBySqlDatatype<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">DefaultDataType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>nameMap <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> nameMap<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">// 替换date中的类型，生成的代码有问题</span></span>
<span class="line">                    <span class="token comment">/*DataType&lt;?&gt; date = nameMap[1].get(&quot;DATE&quot;);</span>
<span class="line">                    Field uType = DefaultDataType.class.getDeclaredField(&quot;uType&quot;);</span>
<span class="line">                    uType.setAccessible(true);</span>
<span class="line">                    uType.set(date, Date.class);*/</span></span>
<span class="line">                    nameMap<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;DATE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    </span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>typeMap <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> typeMap<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//typeMap[1].remove(&quot;DATE&quot;);</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlDataMap <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> sqlDataMap<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//sqlDataMap[1].remove(&quot;DATE&quot;);</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchFieldException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 使用这个类型，自动生成代码无法识别</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">DataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Date</span><span class="token punctuation">&gt;</span></span> <span class="token constant">SYD_DATE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultDataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SQLDialect</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> <span class="token constant">ORIGIN_DATE</span><span class="token punctuation">,</span> <span class="token string">&quot;sysdate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// java.sql.Date 换成了java.util.Date 但是生成代码过程的类有问题，不能扁你</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">DataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Date</span><span class="token punctuation">&gt;</span></span> <span class="token constant">DATE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultDataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SQLDialect</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> <span class="token constant">ORIGIN_DATE</span><span class="token punctuation">,</span> <span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">DataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token constant">NVARCHAR2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultDataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SQLDialect</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> <span class="token class-name">SQLDataType</span><span class="token punctuation">.</span><span class="token constant">NVARCHAR</span><span class="token punctuation">,</span> <span class="token string">&quot;nvarchar2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">DataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token constant">VARCHAR2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultDataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SQLDialect</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> <span class="token class-name">SQLDataType</span><span class="token punctuation">.</span><span class="token constant">NVARCHAR</span><span class="token punctuation">,</span> <span class="token string">&quot;varchar2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">DataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token constant">NUMBER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultDataType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SQLDialect</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nosql-database" tabindex="-1"><a class="header-anchor" href="#nosql-database"><span>NoSQL Database</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis-reactive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SpringBoot为Lettuce和Jedis 客户端提供了自动配置，spring-boot-starter-data-redis默认提供的客户端是Lettuce。</p><figure><img src="http://47.101.155.205/image-20241211212654269.png" alt="image-20241211212654269" tabindex="0" loading="lazy"><figcaption>image-20241211212654269</figcaption></figure><p>注入LettuceClientConfigurationBuilderCustomizer对象可以自定义一些功能。</p><figure><img src="http://47.101.155.205/image-20241211214831563.png" alt="image-20241211214831563" tabindex="0" loading="lazy"><figcaption>image-20241211214831563</figcaption></figure><h3 id="caching-缓存" tabindex="-1"><a class="header-anchor" href="#caching-缓存"><span>Caching(缓存)</span></a></h3><h3 id="message" tabindex="-1"><a class="header-anchor" href="#message"><span>message</span></a></h3><h4 id="jms-activemq" tabindex="-1"><a class="header-anchor" href="#jms-activemq"><span>JMS-activemq</span></a></h4><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-activemq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>配置项：spring.activemq.*</p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">spring.activemq.broker-url</span><span class="token punctuation">=</span><span class="token value attr-value">tcp://192.168.1.210:9876</span></span>
<span class="line"><span class="token key attr-name">spring.activemq.user</span><span class="token punctuation">=</span><span class="token value attr-value">admin</span></span>
<span class="line"><span class="token key attr-name">spring.activemq.password</span><span class="token punctuation">=</span><span class="token value attr-value">secret</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>默认使用CachingConnectionFactory连接工厂ConnectionFactory。</p><p>添加依赖org.messaginghub:pooled-jms，并添加以下配置，使用JmsPoolConnectionFactory</p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">spring.activemq.pool.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"><span class="token key attr-name">spring.activemq.pool.max-connections</span><span class="token punctuation">=</span><span class="token value attr-value">50</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>自动注入JmsTemplate，可以发送消息。</p><p>使用注解@JmsListener接收消息。</p><p>可以通过@EnableJms自定义一些配置类。</p><h4 id="amqp-rabbitmq" tabindex="-1"><a class="header-anchor" href="#amqp-rabbitmq"><span>AMQP-RabbitMQ</span></a></h4><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">spring.rabbitmq.host</span><span class="token punctuation">=</span><span class="token value attr-value">localhost</span></span>
<span class="line"><span class="token key attr-name">spring.rabbitmq.port</span><span class="token punctuation">=</span><span class="token value attr-value">5672</span></span>
<span class="line"><span class="token key attr-name">spring.rabbitmq.username</span><span class="token punctuation">=</span><span class="token value attr-value">admin</span></span>
<span class="line"><span class="token key attr-name">spring.rabbitmq.password</span><span class="token punctuation">=</span><span class="token value attr-value">secret</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>配置项：spring.rabbitmq.*</p><p>自动配置AmqpTemplate、AmqpAdmin，可以用来发送消息。</p><p>接收消息使用注解@RabbitListener。</p><p>注解@EnableRabbit。</p><h4 id="kafka" tabindex="-1"><a class="header-anchor" href="#kafka"><span>kafka</span></a></h4><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>项目中存在spring-kafka项目，会自动配置。</p><p>spring.kafka.*</p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">spring.kafka.bootstrap-servers</span><span class="token punctuation">=</span><span class="token value attr-value">localhost:9092</span></span>
<span class="line"><span class="token key attr-name">spring.kafka.consumer.group-id</span><span class="token punctuation">=</span><span class="token value attr-value">myGroup</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>在Spring中注入NewTopic Bean，会创建不存在的topic。</p><p>自动注入KafkaTemplate，可以用来发送消息。</p><p>存在spring.kafka.producer.transaction-id-prefix配置，自动创建KafkaTransactionManager。</p><p>存在RecordMessageConverter 唯一Bean，自动应用至KafkaTemplate。</p><figure><img src="http://47.101.155.205/image-20241212145407546.png" alt="image-20241212145407546" tabindex="0" loading="lazy"><figcaption>image-20241212145407546</figcaption></figure><p>如果没有定义KafkaListenerContainerFactory Bean，则通过spring.kafka.listener.*配置自动创建。</p><p>@KafkaListener注解接收kafka消息。</p><p>KafkaTransactionManager Bean会自动和容器工厂关联，相似的，ErrorHandler, AfterRollbackProcessor, ConsumerAwareRebalanceListener Bean也会自动关联默认的工厂。</p><figure><img src="http://47.101.155.205/image-20241212150522109.png" alt="image-20241212150522109" tabindex="0" loading="lazy"><figcaption>image-20241212150522109</figcaption></figure><h3 id="resttemplate" tabindex="-1"><a class="header-anchor" href="#resttemplate"><span>RestTemplate</span></a></h3><p>REST服务(Representational State Transfer Service)：基于REST架构风格的Web服务。</p><p>REST架构风格：是一种分布式系统的架构设计原则。核心思想是通过资源(Resource)来表示系统中的实体，客户端与服务器通过操作这些资源进行通信。资源的状态通过一种表述(Representation)传递给客户端，并且操作资源时会发生状态转移(State Transfer)。</p><p>REST不是一个标准，而是一种架构风格，有几个关键约束：</p><ol><li>客户端-服务端：解耦，客户端只关心何时使用资源，服务端只负责存储和管理资源。</li><li>无状态：每个客户端请求需要包含必要的信息，服务端不会存储客户端上下文信息。</li><li>统一接口：通过URL确定一个地址，资源操作(请求方式)、资源表述：JSON等格式。</li><li>系统分层。</li></ol><p>Spring提供了RestTemplate类来调用REST服务。SpringBoot不会自动创建任何RestTemplate Bean，RestTemplate需要在使用之前就被自定义好。然而SrpingBoot自动配置了RestTemplateBuilder(org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration)，可以用来创建RestTemplate。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Service</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token class-name">RestTemplateBuilder</span> restTemplateBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>restTemplate <span class="token operator">=</span> restTemplateBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Details</span> <span class="token function">someRestCall</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;/{name}/details&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Details</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>自定义RestTemplate的方式：</p><ol><li>使用自动注入RestTemplateBuilder，在build之前调用其它方法，如basicAuthentication(String username, String password, Charset charset)会返回一个新的RestTemplateBuilder。</li><li>注入RestTemplateCustomizer Bean，这个会作用至RestTemplateBuilder，最终作用于RestTemplate。</li><li>自定义RestTemplateBuilder。</li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 第二种方式例子</span></span>
<span class="line"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ProxyCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">RestTemplateCustomizer</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">HttpHost</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;proxy.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">HttpClient</span> httpClient <span class="token operator">=</span> <span class="token class-name">HttpClientBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRoutePlanner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultProxyRoutePlanner</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">            <span class="token annotation punctuation">@Override</span></span>
<span class="line">            <span class="token keyword">public</span> <span class="token class-name">HttpHost</span> <span class="token function">determineProxy</span><span class="token punctuation">(</span><span class="token class-name">HttpHost</span> target<span class="token punctuation">,</span> <span class="token class-name">HttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpContext</span> context<span class="token punctuation">)</span></span>
<span class="line">                    <span class="token keyword">throws</span> <span class="token class-name">HttpException</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.0.5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">determineProxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> request<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        restTemplate<span class="token punctuation">.</span><span class="token function">setRequestFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpComponentsClientHttpRequestFactory</span><span class="token punctuation">(</span>httpClient<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jmx" tabindex="-1"><a class="header-anchor" href="#jmx"><span>JMX</span></a></h3><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token comment"># 才会激活JMX功能，idea启动有参数-Dspring.jmx.enabled=true</span></span>
<span class="line"><span class="token key attr-name">spring.jmx.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>JmxAutoConfiguration配置类。</p><h3 id="测试" tabindex="-1"><a class="header-anchor" href="#测试"><span>测试</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token comment">&lt;!-- test starter为了兼容Junit4和Junit5引入的junit-vintage-engine,完全切换之后使用以下配置--&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>test starter提供的依赖库：</p><ol><li>JUnit5：https://junit.org/junit5/</li><li>Spring Test和SpringBoot Test</li><li>AssertJ：https://assertj.github.io/doc/</li><li>Hamcrest：https://github.com/hamcrest/JavaHamcrest</li><li>Mockito：https://site.mockito.org/</li><li>JSONassert：https://github.com/skyscreamer/JSONassert</li><li>JsonPath：https://github.com/jayway/JsonPath</li></ol><p>Spring Test文件：https://docs.spring.io/spring-framework/docs/5.2.6.RELEASE/spring-framework-reference/testing.html</p><h3 id="自动配置及自定义starter" tabindex="-1"><a class="header-anchor" href="#自动配置及自定义starter"><span>自动配置及自定义starter</span></a></h3><p><strong>@ConditionalOnClass注解不要直接作用于方法，方法上不是使用元数据的方式解析注解，会使用反射，如果注解的值是class，则会出现错误。使用ConditionalOnClass作为元注解时，其注解的数据也不会被添加到元数据，建议使用name属性，即类的名称。</strong></p><p><strong>自动配置类上使用@ConditionalOnBean或@ConditionalOnMissingBean注解的Bean，会在自定义的Bean之后加载。这个注解作用于配置上时，不匹配，则配置类不会被创建(测试发现，类加载也不会触发)，配置了中的Bean方法也失效。</strong></p><p><strong>自定义starter依赖</strong></p><p>starter依赖包中应该存在以下内容：</p><ol><li>存在自动配置的模块。</li><li>继承了这个模块功能的所有依赖，开箱即用。</li></ol><p><code>META-INF/spring.factories</code>文件，可以定义自动扫描的类。</p><ul><li><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=</code>指定自动配置类。</li><li><code>org.springframework.context.ApplicationListener=</code>应用事件监听器，监听Spring事件。</li><li><code>org.springframework.context.ApplicationContextInitializer=</code>应用上下文初始化器，用于在上下文准备阶段进行自定义。</li><li><code>org.springframework.boot.actuate.autoconfigure.web.ManagementContextConfiguration=</code>为管理上下文定义特定的配置。</li><li><code>**org.springframework.boot.env.EnvironmentPostProcessor**=</code>环境后处理器，用于在环境准备阶段修改配置。</li><li><code>org.springframework.boot.diagnostics.FailureAnalyzer=</code>启动失败分析器，打印启动失败的信息。</li></ul><p>inject.properties</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token comment">&lt;!-- 构建META-INF/spring-configuration-metadata.json 元数据 --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- 依据注解的@ConfigurationProperties类--&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">&lt;!-- 构建META-INF/spring-autoconfigure-metadata.properties 元数据 --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- 依据META-INF/spring.factories中自动配置类的信息生成 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-autoconfigure-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-gradle line-numbers-mode" data-highlighter="prismjs" data-ext="gradle" data-title="gradle"><pre><code><span class="line"><span class="token comment">// gradle &lt;= 4.5</span></span>
<span class="line"><span class="token keyword">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">    compileOnly <span class="token interpolation-string"><span class="token string">&quot;org.springframework.boot:spring-boot-configuration-processor&quot;</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">    compileOnly <span class="token interpolation-string"><span class="token string">&quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// gradle &gt;= 4.6</span></span>
<span class="line"><span class="token keyword">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">    annotationProcessor <span class="token interpolation-string"><span class="token string">&quot;org.springframework.boot:spring-boot-configuration-processor&quot;</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">    annotationProcessor <span class="token interpolation-string"><span class="token string">&quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-actuator" tabindex="-1"><a class="header-anchor" href="#_5-actuator"><span>5.actuator</span></a></h2><p>端点介绍详细文档：https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/actuator-api//html/</p><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>非技术型端点：</p><table><thead><tr><th style="text-align:left;">ID</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;">auditevents</td><td style="text-align:left;">暴露当前应用的审计事件信息，要求AuditEventRepository Bean</td></tr><tr><td style="text-align:left;">beans</td><td style="text-align:left;">展示应用程序中所有的Spring Beans</td></tr><tr><td style="text-align:left;">caches</td><td style="text-align:left;">暴露应用中的缓存</td></tr><tr><td style="text-align:left;">conditions</td><td style="text-align:left;">展示自动配置类的匹配详细信息</td></tr><tr><td style="text-align:left;">configprops</td><td style="text-align:left;">自动配置文件类@ConfigurationProperties的信息</td></tr><tr><td style="text-align:left;">env</td><td style="text-align:left;">激活配置的信息，spring.profiles.active</td></tr><tr><td style="text-align:left;">flyway</td><td style="text-align:left;">依赖Flyway数据库迁移依赖</td></tr><tr><td style="text-align:left;">health</td><td style="text-align:left;">应用的运行情况信息，许多技术层面的集成了这个信息</td></tr><tr><td style="text-align:left;">httptrace</td><td style="text-align:left;">展示Http信息跟踪信息，要求HttpTraceRepository bean，</td></tr><tr><td style="text-align:left;">info</td><td style="text-align:left;">展示应用的信息</td></tr><tr><td style="text-align:left;">integrationgraph</td><td style="text-align:left;">要求依赖spring-integration-core，展示Spring Integration graph</td></tr><tr><td style="text-align:left;">loggers</td><td style="text-align:left;">显示并修改应用的日志记录器配置</td></tr><tr><td style="text-align:left;">liquibase</td><td style="text-align:left;">显示应用的Liquibase迁移信息，要求Liquibase Bean</td></tr><tr><td style="text-align:left;">metrics</td><td style="text-align:left;">显示应用程序的metrics信息</td></tr><tr><td style="text-align:left;">mappings</td><td style="text-align:left;">显示@RequestMapping的路径</td></tr><tr><td style="text-align:left;">scheduledtasks</td><td style="text-align:left;">显示应用程序的定时任务</td></tr><tr><td style="text-align:left;">sessions</td><td style="text-align:left;">要求spring session，支持查询、操作 session</td></tr><tr><td style="text-align:left;">shutdown</td><td style="text-align:left;">关闭应用程序</td></tr><tr><td style="text-align:left;">threaddump</td><td style="text-align:left;">Performs a thread dump.</td></tr></tbody></table><p>web应用支持的额外端点：</p><table><thead><tr><th style="text-align:left;">ID</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;">heapdump</td><td style="text-align:left;">返回堆快照hprof文件</td></tr><tr><td style="text-align:left;">jolokia</td><td style="text-align:left;">需要jolokia-core依赖，通过Http来暴露JMX</td></tr><tr><td style="text-align:left;">logfile</td><td style="text-align:left;">logging.file.name或logging.file.path配置存在，能获取日志文件资源</td></tr><tr><td style="text-align:left;">prometheus</td><td style="text-align:left;">需要micrometer-registry-prometheus依赖，暴露的metrics能被prometheus抓取</td></tr></tbody></table><p>默认的web应用只开启2个Http端点：info、health；JMX的端点全部不开启。</p><p>spring.jmx.enabled=true，默认JMX的大部分端点开启。</p><figure><img src="http://47.101.155.205/image-20241214135538447.png" alt="image-20241214135538447" tabindex="0" loading="lazy"><figcaption>image-20241214135538447</figcaption></figure><p>当通过management.endpoints.web.exposure.include指定时，则不会走到上图的代码。</p><h3 id="暴露端点情况" tabindex="-1"><a class="header-anchor" href="#暴露端点情况"><span>暴露端点情况</span></a></h3><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token comment"># 是否将所有端点启用默认值设为true/false(false)</span></span>
<span class="line"><span class="token key attr-name">management.endpoints.enabled-by-default</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 禁用http的端点</span></span>
<span class="line"><span class="token key attr-name">management.server.port</span><span class="token punctuation">=</span><span class="token value attr-value">-1</span></span>
<span class="line"><span class="token key attr-name">management.endpoints.web.exposure.exclude</span><span class="token punctuation">=</span><span class="token value attr-value">*</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 绑定的ip地址</span></span>
<span class="line"><span class="token key attr-name">management.server.address</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 修改端点端口</span></span>
<span class="line"><span class="token key attr-name">management.server.port</span><span class="token punctuation">=</span><span class="token value attr-value">9090</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 修改端点health映射路径</span></span>
<span class="line"><span class="token key attr-name">management.endpoints.web.path-mapping.health</span><span class="token punctuation">=</span><span class="token value attr-value">healthcheck</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 配置端点的根路径，默认/actuator，访问该路径可以查询哪些能访问的接口</span></span>
<span class="line"><span class="token key attr-name">management.endpoints.web.basePath</span><span class="token punctuation">=</span><span class="token value attr-value">/management</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 端点自动缓存没有携带参数的查询请求,可以给这个端点(beans)配置缓存事件</span></span>
<span class="line"><span class="token key attr-name">management.endpoint.beans.cache.time-to-live</span><span class="token punctuation">=</span><span class="token value attr-value">10s</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 跨域配置</span></span>
<span class="line"><span class="token key attr-name">management.endpoints.web.cors.allowed-origins</span><span class="token punctuation">=</span><span class="token value attr-value">https://example.com</span></span>
<span class="line"><span class="token key attr-name">management.endpoints.web.cors.allowed-methods</span><span class="token punctuation">=</span><span class="token value attr-value">GET,POST</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>内置端点在默认配置下的暴露情况：</p><table><thead><tr><th style="text-align:left;">ID</th><th style="text-align:left;">JMX</th><th style="text-align:left;">Web</th></tr></thead><tbody><tr><td style="text-align:left;"><code>auditevents</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>beans</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>caches</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>conditions</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>configprops</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>env</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>flyway</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>health</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">Yes</td></tr><tr><td style="text-align:left;"><code>heapdump</code></td><td style="text-align:left;">N/A</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>httptrace</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>info</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">Yes</td></tr><tr><td style="text-align:left;"><code>integrationgraph</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>jolokia</code></td><td style="text-align:left;">N/A</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>logfile</code></td><td style="text-align:left;">N/A</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>loggers</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>liquibase</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>metrics</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>mappings</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>prometheus</code></td><td style="text-align:left;">N/A</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>scheduledtasks</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>sessions</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>shutdown</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr><tr><td style="text-align:left;"><code>threaddump</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;">No</td></tr></tbody></table><p>配置决定暴露哪些端点：</p><table><thead><tr><th style="text-align:left;">配置</th><th style="text-align:left;">默认值</th><th>作用</th></tr></thead><tbody><tr><td style="text-align:left;"><code>management.endpoints.jmx.exposure.exclude</code></td><td style="text-align:left;"></td><td>开启</td></tr><tr><td style="text-align:left;"><code>management.endpoints.jmx.exposure.include</code></td><td style="text-align:left;"><code>*</code></td><td>关闭(优先级更高)</td></tr><tr><td style="text-align:left;"><code>management.endpoints.web.exposure.exclude</code></td><td style="text-align:left;"></td><td>开启</td></tr><tr><td style="text-align:left;"><code>management.endpoints.web.exposure.include</code></td><td style="text-align:left;"><code>info, health</code></td><td>关闭(优先级更高)</td></tr></tbody></table><p>通过注入EndpointFilter Bean的方式实现端点暴露的自定义策略。</p><h3 id="安全访问" tabindex="-1"><a class="header-anchor" href="#安全访问"><span>安全访问</span></a></h3><p>端点默认集成spring security的功能。</p><p>http和https转换</p><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">8443</span></span>
<span class="line"><span class="token key attr-name">server.ssl.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"><span class="token key attr-name">server.ssl.key-store</span><span class="token punctuation">=</span><span class="token value attr-value">classpath:main.jks</span></span>
<span class="line"><span class="token key attr-name">server.ssl.key-password</span><span class="token punctuation">=</span><span class="token value attr-value">secret</span></span>
<span class="line"></span>
<span class="line"><span class="token key attr-name">management.server.port</span><span class="token punctuation">=</span><span class="token value attr-value">8080</span></span>
<span class="line"><span class="token key attr-name">management.server.ssl.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"><span class="token key attr-name">management.server.ssl.key-store</span><span class="token punctuation">=</span><span class="token value attr-value">classpath:management.jks</span></span>
<span class="line"><span class="token key attr-name">management.server.ssl.key-password</span><span class="token punctuation">=</span><span class="token value attr-value">secret</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">8443</span></span>
<span class="line"><span class="token key attr-name">server.ssl.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"><span class="token key attr-name">server.ssl.key-store</span><span class="token punctuation">=</span><span class="token value attr-value">classpath:store.jks</span></span>
<span class="line"><span class="token key attr-name">server.ssl.key-password</span><span class="token punctuation">=</span><span class="token value attr-value">secret</span></span>
<span class="line"></span>
<span class="line"><span class="token key attr-name">management.server.port</span><span class="token punctuation">=</span><span class="token value attr-value">8080</span></span>
<span class="line"><span class="token key attr-name">management.server.ssl.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>需要某个角色才能访问：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActuatorSecurity</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        http<span class="token punctuation">.</span><span class="token function">requestMatcher</span><span class="token punctuation">(</span><span class="token class-name">EndpointRequest</span><span class="token punctuation">.</span><span class="token function">toAnyEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">(</span>requests<span class="token punctuation">)</span> <span class="token operator">-&gt;</span></span>
<span class="line">                requests<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;ENDPOINT_ADMIN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        http<span class="token punctuation">.</span><span class="token function">httpBasic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不需要权限就能访问：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActuatorSecurity</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        http<span class="token punctuation">.</span><span class="token function">requestMatcher</span><span class="token punctuation">(</span><span class="token class-name">EndpointRequest</span><span class="token punctuation">.</span><span class="token function">toAnyEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">(</span>requests<span class="token punctuation">)</span> <span class="token operator">-&gt;</span></span>
<span class="line">            requests<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自定义端点" tabindex="-1"><a class="header-anchor" href="#自定义端点"><span>自定义端点</span></a></h3><p>定义的Bean 有@Endpoint注解，这个类里面的@ReadOperation(HTTP GET)、@WriteOperation(HTTP POST)、@DeleteOperation(HTTP DELETE)注解的方法就能被JMX或Http操作。</p><p>@JmxEndpoint、@WebEndpoint表示只针对特定方式开放的端点。</p><figure><img src="http://47.101.155.205/image-20241214153735581.png" alt="image-20241214153735581" tabindex="0" loading="lazy"><figcaption>image-20241214153735581</figcaption></figure><p>@EndpointWebExtension、@EndpointJmxExtension扩展注解。</p><h3 id="health" tabindex="-1"><a class="header-anchor" href="#health"><span>health</span></a></h3><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token comment"># 默认never,不返回健康信息详情;when-authorized=特定角色才返回</span></span>
<span class="line"><span class="token key attr-name">management.endpoint.health.show-details</span><span class="token punctuation">=</span><span class="token value attr-value">always</span></span>
<span class="line"><span class="token key attr-name">management.endpoint.health.roles</span><span class="token punctuation">=</span><span class="token value attr-value">ADMIN</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>自动配置了许多<code>HealthIndicator</code>，health(<code>HealthEndpointWebExtension</code>)接口详情会显示内容。注入抽象类<code>AbstractHealthIndicator</code>的实现Bean，在调用health接口触发<code>doHealthCheck()</code>方法。</p><figure><img src="http://47.101.155.205/image-20241214162602858.png" alt="image-20241214162602858" tabindex="0" loading="lazy"><figcaption>image-20241214162602858</figcaption></figure><p>自定义HealthIndicator</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHealthIndicator</span> <span class="token keyword">implements</span> <span class="token class-name">HealthIndicator</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Health</span> <span class="token function">health</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">int</span> errorCode <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// perform some specific health check</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>errorCode <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token class-name">Health</span><span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">&quot;Error Code&quot;</span><span class="token punctuation">,</span> errorCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Health</span><span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>自定义ReactiveHealthContributor，响应式非阻塞的。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyReactiveHealthIndicator</span> <span class="token keyword">implements</span> <span class="token class-name">ReactiveHealthIndicator</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Health</span><span class="token punctuation">&gt;</span></span> <span class="token function">health</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">doHealthCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//perform some specific health check that returns a Mono&lt;Health&gt;</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">onErrorResume</span><span class="token punctuation">(</span>ex <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Health<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="metrics" tabindex="-1"><a class="header-anchor" href="#metrics"><span>Metrics</span></a></h3><p>metrics官网：https://micrometer.io/docs</p><p>SpringBoot根据classpath加载的MeterRegistry实现自动注册，项目名通常是micrometer-registry-{system}依赖。</p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token comment"># 禁用prometheus注册功能</span></span>
<span class="line"><span class="token key attr-name">management.metrics.export.prometheus.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token class-name">MeterRegistryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MeterRegistry</span><span class="token punctuation">&gt;</span></span> <span class="token function">metricsCommonTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> registry <span class="token operator">-&gt;</span> registry<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commonTags</span><span class="token punctuation">(</span><span class="token string">&quot;region&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;us-east-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token class-name">MeterRegistryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GraphiteMeterRegistry</span><span class="token punctuation">&gt;</span></span> <span class="token function">graphiteMetricsNamingConvention</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> registry <span class="token operator">-&gt;</span> registry<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">namingConvention</span><span class="token punctuation">(</span><span class="token constant">MY_CUSTOM_CONVENTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleBean</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Counter</span> counter<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">SampleBean</span><span class="token punctuation">(</span><span class="token class-name">MeterRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>counter <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token string">&quot;received.messages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>counter<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// handle message implementation</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="监听器" tabindex="-1"><a class="header-anchor" href="#监听器"><span>监听器</span></a></h3><p>ApplicationPidFileWriter ：记录应用程序的pid，默认名application.pid。</p><p>WebServerPortFileWriter：web程序的端口，默认名为application.port。</p><p>默认是不启动的，配置启动方式，META-INF/spring.factories</p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">org.springframework.context.ApplicationListener</span><span class="token punctuation">=</span><span class="token value attr-value">\</span>
<span class="line">org.springframework.boot.context.ApplicationPidFileWriter,\</span>
<span class="line">org.springframework.boot.web.context.WebServerPortFileWriter</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>程序方式：SpringApplication.addListeners(…)。</p><h3 id="info" tabindex="-1"><a class="header-anchor" href="#info"><span>info</span></a></h3><p>通过注入<code>org.springframework.boot.actuate.info.InfoContributor</code>实例Bean，通过/actuator/info暴露应用信息。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InfoEndpointConfig</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">InfoEndpointConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 可去掉</span></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token annotation punctuation">@ConditionalOnMissingBean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">InfoEndpoint</span> <span class="token function">infoEndpoint</span><span class="token punctuation">(</span><span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InfoContributor</span><span class="token punctuation">&gt;</span></span> infoContributors<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InfoEndpoint</span><span class="token punctuation">(</span>infoContributors<span class="token punctuation">.</span><span class="token function">orderedStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">CustomInfoContributor</span> <span class="token function">customInfoContributor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;new CustomInfoContributor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomInfoContributor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 自定义的 InfoContributor 实现</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CustomInfoContributor</span> <span class="token keyword">implements</span> <span class="token class-name">InfoContributor</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token annotation punctuation">@Override</span></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token class-name">Info<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 获取该 class 的版本</span></span>
<span class="line">            properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;version&quot;</span><span class="token punctuation">,</span> <span class="token class-name">InfoContributor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getPackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getImplementationVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;componentsName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;custom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20250514165102697.png" alt="actuator/info" tabindex="0" loading="lazy"><figcaption>actuator/info</figcaption></figure><h2 id="补充" tabindex="-1"><a class="header-anchor" href="#补充"><span>补充</span></a></h2><h3 id="操作context或environment" tabindex="-1"><a class="header-anchor" href="#操作context或environment"><span>操作context或Environment</span></a></h3><p>通过ApplicationListener和ApplicationContextInitializer来自定义上下文和环境。额外自定义注册这些的方式：</p><ol><li>创建SpringApplication对象后，未调用run方法之前，通过addListeners、addInitializers方法。</li><li>通过context.initializer.classes、context.listener.classes。</li><li>通过添加META-INF/spring.factories文件。</li></ol><p>在刷新应用程序上下文之前，通过EnvironmentPostProcessor自定义Environment。META-INF/spring.factories，接口指向自定义的类。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 自定义操作Environment</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EnvironmentPostProcessorExample</span> <span class="token keyword">implements</span> <span class="token class-name">EnvironmentPostProcessor</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">YamlPropertySourceLoader</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YamlPropertySourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postProcessEnvironment</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">,</span> <span class="token class-name">SpringApplication</span> application<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Resource</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;com/example/myapp/config.yml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">PropertySource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> propertySource <span class="token operator">=</span> <span class="token function">loadYaml</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        environment<span class="token punctuation">.</span><span class="token function">getPropertySources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>propertySource<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">PropertySource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadYaml</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Resource &quot;</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">&quot; does not exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;custom-resource&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to load yaml configuration from &quot;</span> <span class="token operator">+</span> path<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="http://github.com/FirstBloodForJava/vuepress-blog/edit/main/docs/springboot/SpringBoot-2.2.7.RELEASE.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1164864987@qq.com">oycm</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: mingorg@163.com">ouyangcm</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/vuepress-blog/assets/app-BIGZvh4f.js" defer></script>
  </body>
</html>
