<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><title>spring-cloud-gateway | VuePress</title><meta name="description" content="基于MarkDown文档使用VuePress搭建的博客">
    <link rel="preload" href="/vuepress-blog/assets/style-CpYaHraZ.css" as="style"><link rel="stylesheet" href="/vuepress-blog/assets/style-CpYaHraZ.css">
    <link rel="modulepreload" href="/vuepress-blog/assets/app-BIGZvh4f.js"><link rel="modulepreload" href="/vuepress-blog/assets/spring-cloud-gateway.html-BkQWF5pW.js">
    <link rel="prefetch" href="/vuepress-blog/assets/index.html-D4m84eZG.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ErrorFile文件分析.html-DtPPg4f6.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JVM.html-xpwRrYJm.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JVM调优理论.html-R6Icu2Yo.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Java多线程理论.html-CNmm_RCh.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/垃圾收集器和内存分配策略.html-DG0aoQGg.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/虚拟机性能监控工具.html-Ba51msip.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/EnumSet集合.html-C-Yo6vLG.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/IO.html-TnA5q-2z.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JUC.html-BvvhxQR2.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JavaSE.html-C_SrYoyO.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JavaWeb.html-CorQ_hvS.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Java多线程使用.html-Bgkcs6bJ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Java注解.html-wS4heilI.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Java进阶.html-ZoewIylX.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Netty.html-CW6gvJi3.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Reactor.html-CzjEUGzk.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/javaUtil.html-CHKNgTCz.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/networkModel.html-DG2c09pe.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/recursion.html-BsfK7KJ3.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/divideAndConquer.html-LViisBnw.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/dp.html-BXF8a3Dm.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/algorithm.html-Cw5QfyqL.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/data-structure.html-C80WvTja.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/math.html-LxL70pyz.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Docker.html-BpvEbC-T.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/gradle.html-CAQ9x-vL.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/gradle管理Java项目.html-DamWgccU.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/maven.html-CfyKtPDZ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/maven项目切换gradle步骤.html-DsIQ6hFI.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/DruidPoolProblem.html-4Tsk67Uo.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/InfluxDB.html-CXrGIjVY.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/MongoDB.html-BqFartrm.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Mysql.html-CRgerypE.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Oracle-SQLErr.html-CeAOmq0Z.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Oracle.html-lF4hP9Kk.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ShardingSphere.html-CMTWpPjQ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Transactional.html-COVODrDC.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/seata.html-Du3LTjzb.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JavaScript.html-OKNHcyn1.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/VSCode.html-NUrKwCwt.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/css.html-qCw17Qu5.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/html.html-C9FL80cP.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/nodejs.html-DHyyn_N9.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/vue.html-CETM6P0K.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Linux.html-BgTuIrT4.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Linux进阶.html-B0I1PaiA.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Redis.html-BZrpHpct.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/TCP.html-Bcouziou.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/problem.html-B9b4elh1.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/shell语法.html-BPxht2Gk.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ELK.html-DY_R7M5-.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Elasticsearch.html-CtVAIgLc.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Logstash-8.15.html-BjD0FxU4.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/prometheus.html-CWR35qc3.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ActiveMQ.html-I8YPBsWv.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/RabbitMQ.html-DR8ipnun.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/kafka.html-Bs8iR7F1.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/nginx.html-DecO0DaM.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/nginx配置代理400.html-ByZTU-yx.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/nginx配置代理https请求步骤.html-DKHRZWN8.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Hadoop.html-MhzteBWs.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Scala-Collection.html-B1UsYe_4.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Scala.html-BKdyopUj.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spark.html-CqsO7U6T.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/DesignMode.html-D-e8Jtzy.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpecialInterfaceFunction.html-DEhsvwwZ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Spring注解介绍.html-DmDUYONL.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/logFramework.html-DfdLcpzi.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/util.html-kJA-6haH.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Micrometer.html-DTi65kOP.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpringBoot-2.2.7.RELEASE.html-DfLyzdvT.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-kafka.html-DYQgaOUn.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/starter-actuator.html-BWA9VZ8G.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/starter-embedded.html-DtfhWCI8.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/starter-web.html-CezIzjMG.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/AlibabaSentinel.html-a449dTg0.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Dubbo.html-d2PzlPLQ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpringCloud.html-BLWGlK1E.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ZooKeeper.html-Bwt2jSpZ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/nacos.html-BUwS5yPv.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-sleuth.html-Cg_1ye9r.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/DDD.html-f9waKzIw.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/JMeter.html-R36TbFWS.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/WebService.html-CdQ9yQrX.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/XXL-Job.html-C6OyUbr0.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/cron.html-8S7XAjoD.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/git.html-Iz4ma8iD.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/gitlab.html-D3DU-VnA.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/interview.html-qWyhQrrh.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/uml.html-DzMTw3Ck.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/yaml.html-DPcoPFxY.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/vuepress使用介绍.html-D1-15YXV.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/DateBufferAndCodecs.html-WHhR5FWB.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-core-AOP.html-DEVJbTyV.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-core-SpEL.html-CZQS5Qas.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-core-ioc.html-7HP3lKuU.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/Dao.html-Uvr19uw0.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpringDataJPA.html-DsIbMVqT.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/transactionManagement.html-BhrMq0mO.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpringWebFlux.html-1SspC1kl.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/WebClient.html-Bd6TdmCi.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/SpringMVC.html-Bk3GxmgZ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/WebSocket.html-Cc9tNp1U.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-cloud-gateway-core.html-Csxz-fNz.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/spring-cloud-starter-netflix-zuul.html-r6EEs-d-.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/404.html-BeuyeZRv.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index-DuqNHZ2Z.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/setupDevtools-7MC2TMWH-BEauj7aL.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/vuepress-blog/"><!----><span class="vp-site-name" aria-hidden="true">VuePress</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法策略"><span class="title">算法策略</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法策略"><span class="title">算法策略</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/recursion.html" aria-label="递归"><!---->递归<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/divideAndConquer.html" aria-label="分治"><!---->分治<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/dp.html" aria-label="动态规划"><!---->动态规划<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/data-structure.html" aria-label="数据结构"><!---->数据结构<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/algorithm.html" aria-label="算法"><!---->算法<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/math.html" aria-label="数学"><!---->数学<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="vue"><span class="title">vue</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="vue"><span class="title">vue</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>vuepress</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/vuepress/vuepress%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D.html" aria-label="vuepress使用介绍"><!---->vuepress使用介绍<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/html.html" aria-label="html"><!---->html<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/css.html" aria-label="css"><!---->css<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/JavaScript.html" aria-label="JavaScript"><!---->JavaScript<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/VSCode.html" aria-label="VSCode"><!---->VSCode<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/vue.html" aria-label="vue"><!---->vue<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="nginx"><span class="title">nginx</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="nginx"><span class="title">nginx</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx.html" aria-label="nginx"><!---->nginx<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86https%E8%AF%B7%E6%B1%82%E6%AD%A5%E9%AA%A4.html" aria-label="nginx配置代理https请求步骤"><!---->nginx配置代理https请求步骤<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86400.html" aria-label="nginx配置代理400"><!---->nginx配置代理400<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="监控"><span class="title">监控</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="监控"><span class="title">监控</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/Elasticsearch.html" aria-label="Elasticsearch"><!---->Elasticsearch<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/ELK.html" aria-label="ELK"><!---->ELK<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/Logstash-8.15.html" aria-label="Logstash"><!---->Logstash<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/prometheus.html" aria-label="prometheus"><!---->prometheus<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JavaEE"><span class="title">JavaEE</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JavaEE"><span class="title">JavaEE</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JavaSE.html" aria-label="JavaSE"><!---->JavaSE<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E8%BF%9B%E9%98%B6.html" aria-label="进阶"><!---->进阶<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JavaWeb.html" aria-label="JavaWeb"><!---->JavaWeb<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BD%BF%E7%94%A8.html" aria-label="Java多线程使用"><!---->Java多线程使用<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JUC.html" aria-label="JUC"><!---->JUC<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/EnumSet%E9%9B%86%E5%90%88.html" aria-label="EnumSet集合"><!---->EnumSet集合<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E6%B3%A8%E8%A7%A3.html" aria-label="Java注解"><!---->Java注解<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/javaUtil.html" aria-label="javaUtil"><!---->javaUtil<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/networkModel.html" aria-label="网络模型"><!---->网络模型<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/IO.html" aria-label="JavaIO"><!---->JavaIO<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Netty.html" aria-label="Netty"><!---->Netty<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Reactor.html" aria-label="Reactor"><!---->Reactor<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="构建工具"><span class="title">构建工具</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="构建工具"><span class="title">构建工具</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/maven.html" aria-label="maven"><!---->maven<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/Docker.html" aria-label="Docker"><!---->Docker<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/gradle.html" aria-label="gradle"><!---->gradle<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/gradle%E7%AE%A1%E7%90%86Java%E9%A1%B9%E7%9B%AE.html" aria-label="gradle管理Java项目"><!---->gradle管理Java项目<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/maven%E9%A1%B9%E7%9B%AE%E5%88%87%E6%8D%A2gradle%E6%AD%A5%E9%AA%A4.html" aria-label="maven项目切换gradle步骤"><!---->maven项目切换gradle步骤<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JVM"><span class="title">JVM</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JVM"><span class="title">JVM</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/JVM.html" aria-label="JVM"><!---->JVM<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%92%8C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5.html" aria-label="垃圾收集器和内存分配策略"><!---->垃圾收集器和内存分配策略<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html" aria-label="虚拟机性能监控工具"><!---->虚拟机性能监控工具<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/JVM%E8%B0%83%E4%BC%98%E7%90%86%E8%AE%BA.html" aria-label="JVM调优理论"><!---->JVM调优理论<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%90%86%E8%AE%BA.html" aria-label="Java多线程理论"><!---->Java多线程理论<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/ErrorFile%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90.html" aria-label="ErrorFile文件分析"><!---->ErrorFile文件分析<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="linux"><span class="title">linux</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="linux"><span class="title">linux</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Linux.html" aria-label="Linux"><!---->Linux<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/shell%E8%AF%AD%E6%B3%95.html" aria-label="shell语法"><!---->shell语法<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/TCP.html" aria-label="tcp"><!---->tcp<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Redis.html" aria-label="Redis"><!---->Redis<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Linux%E8%BF%9B%E9%98%B6.html" aria-label="Linux进阶"><!---->Linux进阶<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/problem.html" aria-label="问题收集"><!---->问题收集<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/RabbitMQ.html" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/ActiveMQ.html" aria-label="ActiveMQ"><!---->ActiveMQ<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/kafka.html" aria-label="Kafka"><!---->Kafka<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="spring"><span class="title">spring</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="spring"><span class="title">spring</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/Spring%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D.html" aria-label="Spring注解介绍"><!---->Spring注解介绍<!----></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>spring核心-5.2.6.RELEASE</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-ioc.html" aria-label="IOC容器相关"><!---->IOC容器相关<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-SpEL.html" aria-label="SpEL表达式"><!---->SpEL表达式<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-AOP.html" aria-label="Spring AOP代理"><!---->Spring AOP代理<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/DateBufferAndCodecs.html" aria-label="数据缓冲区和编解码器"><!---->数据缓冲区和编解码器<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>数据访问</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/transactionManagement.html" aria-label="事物管理"><!---->事物管理<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/Dao.html" aria-label="数据访问对象"><!---->数据访问对象<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/SpringDataJPA.html" aria-label="SpringDataJPA"><!---->SpringDataJPA<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Servlet请求</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webServlet/SpringMVC.html" aria-label="SpringMVC"><!---->SpringMVC<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webServlet/WebSocket.html" aria-label="WebSocket"><!---->WebSocket<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>响应式处理</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webReactive/SpringWebFlux.html" aria-label="SpringWebFlux"><!---->SpringWebFlux<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webReactive/WebClient.html" aria-label="响应式客户端"><!---->响应式客户端<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/Spring%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D.html" aria-label="Spring注解介绍"><!---->Spring注解介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/logFramework.html" aria-label="日志框架"><!---->日志框架<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/SpecialInterfaceFunction.html" aria-label="Spring特殊接口"><!---->Spring特殊接口<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/DesignMode.html" aria-label="设计模式"><!---->设计模式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/util.html" aria-label="工具类"><!---->工具类<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="springboot"><span class="title">springboot</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="springboot"><span class="title">springboot</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/SpringBoot-2.2.7.RELEASE.html" aria-label="SpringBoot-2.2.7.RELEASE介绍"><!---->SpringBoot-2.2.7.RELEASE介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-embedded.html" aria-label="嵌入式容器starter"><!---->嵌入式容器starter<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-web.html" aria-label="starter-web"><!---->starter-web<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/spring-kafka.html" aria-label="springboot使用Kafka"><!---->springboot使用Kafka<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/Micrometer.html" aria-label="Micrometer"><!---->Micrometer<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-actuator.html" aria-label="starter-actuator"><!---->starter-actuator<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/SpringCloud.html" aria-label="SpringCloud"><!---->SpringCloud<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/spring-sleuth.html" aria-label="spring-sleuth"><!---->spring-sleuth<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/AlibabaSentinel.html" aria-label="Sentinel"><!---->Sentinel<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/nacos.html" aria-label="Nacos"><!---->Nacos<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/ZooKeeper.html" aria-label="ZooKeeper"><!---->ZooKeeper<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/Dubbo.html" aria-label="Dubbo"><!---->Dubbo<!----></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>网关</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-gateway.html" aria-label="spring-cloud-gateway使用介绍"><!---->spring-cloud-gateway使用介绍<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-gateway-core.html" aria-label="gateway核心"><!---->gateway核心<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-starter-netflix-zuul.html" aria-label="zuul-1.x"><!---->zuul-1.x<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="database"><span class="title">database</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="database"><span class="title">database</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Mysql.html" aria-label="MySQL"><!---->MySQL<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Oracle.html" aria-label="Oracle"><!---->Oracle<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/MongoDB.html" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/InfluxDB.html" aria-label="InfluxDB"><!---->InfluxDB<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Oracle-SQLErr.html" aria-label="Oracle执行错误代码"><!---->Oracle执行错误代码<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/ShardingSphere.html" aria-label="ShardingSphere"><!---->ShardingSphere<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Transactional.html" aria-label="Spring事物控制"><!---->Spring事物控制<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/DruidPoolProblem.html" aria-label="DruidPoolProblem"><!---->DruidPoolProblem<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/seata.html" aria-label="seata"><!---->seata<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/cron.html" aria-label="cron表达式"><!---->cron表达式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/uml.html" aria-label="UML介绍"><!---->UML介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/JMeter.html" aria-label="JMeter"><!---->JMeter<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/XXL-Job.html" aria-label="XXL-Job"><!---->XXL-Job<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/DDD.html" aria-label="领域驱动设计"><!---->领域驱动设计<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/git.html" aria-label="git"><!---->git<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/WebService.html" aria-label="WebService"><!---->WebService<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/interview.html" aria-label="interview"><!---->interview<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="spark"><span class="title">spark</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="spark"><span class="title">spark</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/spark.html" aria-label="spark"><!---->spark<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/Scala.html" aria-label="Scala2/3"><!---->Scala2/3<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/Scala-Collection.html" aria-label="Scala-集合"><!---->Scala-集合<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法策略"><span class="title">算法策略</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法策略"><span class="title">算法策略</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/recursion.html" aria-label="递归"><!---->递归<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/divideAndConquer.html" aria-label="分治"><!---->分治<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/dp.html" aria-label="动态规划"><!---->动态规划<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/data-structure.html" aria-label="数据结构"><!---->数据结构<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/algorithm.html" aria-label="算法"><!---->算法<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/algorithmStrategy/math.html" aria-label="数学"><!---->数学<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="vue"><span class="title">vue</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="vue"><span class="title">vue</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>vuepress</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/vuepress/vuepress%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D.html" aria-label="vuepress使用介绍"><!---->vuepress使用介绍<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/html.html" aria-label="html"><!---->html<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/css.html" aria-label="css"><!---->css<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/JavaScript.html" aria-label="JavaScript"><!---->JavaScript<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/VSCode.html" aria-label="VSCode"><!---->VSCode<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/frontEnd/vue.html" aria-label="vue"><!---->vue<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="nginx"><span class="title">nginx</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="nginx"><span class="title">nginx</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx.html" aria-label="nginx"><!---->nginx<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86https%E8%AF%B7%E6%B1%82%E6%AD%A5%E9%AA%A4.html" aria-label="nginx配置代理https请求步骤"><!---->nginx配置代理https请求步骤<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/nginx/nginx%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86400.html" aria-label="nginx配置代理400"><!---->nginx配置代理400<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="监控"><span class="title">监控</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="监控"><span class="title">监控</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/Elasticsearch.html" aria-label="Elasticsearch"><!---->Elasticsearch<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/ELK.html" aria-label="ELK"><!---->ELK<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/Logstash-8.15.html" aria-label="Logstash"><!---->Logstash<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/monitoring/prometheus.html" aria-label="prometheus"><!---->prometheus<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JavaEE"><span class="title">JavaEE</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JavaEE"><span class="title">JavaEE</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JavaSE.html" aria-label="JavaSE"><!---->JavaSE<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E8%BF%9B%E9%98%B6.html" aria-label="进阶"><!---->进阶<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JavaWeb.html" aria-label="JavaWeb"><!---->JavaWeb<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BD%BF%E7%94%A8.html" aria-label="Java多线程使用"><!---->Java多线程使用<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/JUC.html" aria-label="JUC"><!---->JUC<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/EnumSet%E9%9B%86%E5%90%88.html" aria-label="EnumSet集合"><!---->EnumSet集合<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Java%E6%B3%A8%E8%A7%A3.html" aria-label="Java注解"><!---->Java注解<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/javaUtil.html" aria-label="javaUtil"><!---->javaUtil<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/networkModel.html" aria-label="网络模型"><!---->网络模型<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/IO.html" aria-label="JavaIO"><!---->JavaIO<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Netty.html" aria-label="Netty"><!---->Netty<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JavaEE/Reactor.html" aria-label="Reactor"><!---->Reactor<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="构建工具"><span class="title">构建工具</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="构建工具"><span class="title">构建工具</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/maven.html" aria-label="maven"><!---->maven<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/Docker.html" aria-label="Docker"><!---->Docker<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/gradle.html" aria-label="gradle"><!---->gradle<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/gradle%E7%AE%A1%E7%90%86Java%E9%A1%B9%E7%9B%AE.html" aria-label="gradle管理Java项目"><!---->gradle管理Java项目<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/build/maven%E9%A1%B9%E7%9B%AE%E5%88%87%E6%8D%A2gradle%E6%AD%A5%E9%AA%A4.html" aria-label="maven项目切换gradle步骤"><!---->maven项目切换gradle步骤<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JVM"><span class="title">JVM</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JVM"><span class="title">JVM</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/JVM.html" aria-label="JVM"><!---->JVM<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%92%8C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5.html" aria-label="垃圾收集器和内存分配策略"><!---->垃圾收集器和内存分配策略<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html" aria-label="虚拟机性能监控工具"><!---->虚拟机性能监控工具<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/JVM%E8%B0%83%E4%BC%98%E7%90%86%E8%AE%BA.html" aria-label="JVM调优理论"><!---->JVM调优理论<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%90%86%E8%AE%BA.html" aria-label="Java多线程理论"><!---->Java多线程理论<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/JVM/ErrorFile%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90.html" aria-label="ErrorFile文件分析"><!---->ErrorFile文件分析<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="linux"><span class="title">linux</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="linux"><span class="title">linux</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Linux.html" aria-label="Linux"><!---->Linux<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/shell%E8%AF%AD%E6%B3%95.html" aria-label="shell语法"><!---->shell语法<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/TCP.html" aria-label="tcp"><!---->tcp<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Redis.html" aria-label="Redis"><!---->Redis<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/Linux%E8%BF%9B%E9%98%B6.html" aria-label="Linux进阶"><!---->Linux进阶<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/linux/problem.html" aria-label="问题收集"><!---->问题收集<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/RabbitMQ.html" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/ActiveMQ.html" aria-label="ActiveMQ"><!---->ActiveMQ<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/mq/kafka.html" aria-label="Kafka"><!---->Kafka<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="spring"><span class="title">spring</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="spring"><span class="title">spring</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/Spring%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D.html" aria-label="Spring注解介绍"><!---->Spring注解介绍<!----></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>spring核心-5.2.6.RELEASE</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-ioc.html" aria-label="IOC容器相关"><!---->IOC容器相关<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-SpEL.html" aria-label="SpEL表达式"><!---->SpEL表达式<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/spring-core-AOP.html" aria-label="Spring AOP代理"><!---->Spring AOP代理<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/core/DateBufferAndCodecs.html" aria-label="数据缓冲区和编解码器"><!---->数据缓冲区和编解码器<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>数据访问</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/transactionManagement.html" aria-label="事物管理"><!---->事物管理<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/Dao.html" aria-label="数据访问对象"><!---->数据访问对象<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/dataAccess/SpringDataJPA.html" aria-label="SpringDataJPA"><!---->SpringDataJPA<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Servlet请求</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webServlet/SpringMVC.html" aria-label="SpringMVC"><!---->SpringMVC<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webServlet/WebSocket.html" aria-label="WebSocket"><!---->WebSocket<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>响应式处理</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webReactive/SpringWebFlux.html" aria-label="SpringWebFlux"><!---->SpringWebFlux<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/spring/webReactive/WebClient.html" aria-label="响应式客户端"><!---->响应式客户端<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/Spring%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D.html" aria-label="Spring注解介绍"><!---->Spring注解介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/logFramework.html" aria-label="日志框架"><!---->日志框架<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/SpecialInterfaceFunction.html" aria-label="Spring特殊接口"><!---->Spring特殊接口<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/DesignMode.html" aria-label="设计模式"><!---->设计模式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spring/util.html" aria-label="工具类"><!---->工具类<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="springboot"><span class="title">springboot</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="springboot"><span class="title">springboot</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/SpringBoot-2.2.7.RELEASE.html" aria-label="SpringBoot-2.2.7.RELEASE介绍"><!---->SpringBoot-2.2.7.RELEASE介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-embedded.html" aria-label="嵌入式容器starter"><!---->嵌入式容器starter<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-web.html" aria-label="starter-web"><!---->starter-web<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/spring-kafka.html" aria-label="springboot使用Kafka"><!---->springboot使用Kafka<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/Micrometer.html" aria-label="Micrometer"><!---->Micrometer<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springboot/starter-actuator.html" aria-label="starter-actuator"><!---->starter-actuator<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="springcloud"><span class="title">springcloud</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/SpringCloud.html" aria-label="SpringCloud"><!---->SpringCloud<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/spring-sleuth.html" aria-label="spring-sleuth"><!---->spring-sleuth<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/AlibabaSentinel.html" aria-label="Sentinel"><!---->Sentinel<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/nacos.html" aria-label="Nacos"><!---->Nacos<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/ZooKeeper.html" aria-label="ZooKeeper"><!---->ZooKeeper<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/springcloud/Dubbo.html" aria-label="Dubbo"><!---->Dubbo<!----></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>网关</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-gateway.html" aria-label="spring-cloud-gateway使用介绍"><!---->spring-cloud-gateway使用介绍<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-gateway-core.html" aria-label="gateway核心"><!---->gateway核心<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-blog/springcloud/gateway/spring-cloud-starter-netflix-zuul.html" aria-label="zuul-1.x"><!---->zuul-1.x<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="database"><span class="title">database</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="database"><span class="title">database</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Mysql.html" aria-label="MySQL"><!---->MySQL<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Oracle.html" aria-label="Oracle"><!---->Oracle<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/MongoDB.html" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/InfluxDB.html" aria-label="InfluxDB"><!---->InfluxDB<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Oracle-SQLErr.html" aria-label="Oracle执行错误代码"><!---->Oracle执行错误代码<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/ShardingSphere.html" aria-label="ShardingSphere"><!---->ShardingSphere<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/Transactional.html" aria-label="Spring事物控制"><!---->Spring事物控制<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/DruidPoolProblem.html" aria-label="DruidPoolProblem"><!---->DruidPoolProblem<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/database/seata.html" aria-label="seata"><!---->seata<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/cron.html" aria-label="cron表达式"><!---->cron表达式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/uml.html" aria-label="UML介绍"><!---->UML介绍<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/JMeter.html" aria-label="JMeter"><!---->JMeter<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/XXL-Job.html" aria-label="XXL-Job"><!---->XXL-Job<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/DDD.html" aria-label="领域驱动设计"><!---->领域驱动设计<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/git.html" aria-label="git"><!---->git<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/WebService.html" aria-label="WebService"><!---->WebService<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/tools/interview.html" aria-label="interview"><!---->interview<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="spark"><span class="title">spark</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="spark"><span class="title">spark</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/spark.html" aria-label="spark"><!---->spark<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/Scala.html" aria-label="Scala2/3"><!---->Scala2/3<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/spark/Scala-Collection.html" aria-label="Scala-集合"><!---->Scala-集合<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">spring-cloud-gateway <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="spring-cloud-gateway" tabindex="-1"><a class="header-anchor" href="#spring-cloud-gateway"><span>spring-cloud-gateway</span></a></h1><p>不同版本文档：https://docs.spring.io/spring-cloud-gateway/docs/</p><p>当前文档版本：https://docs.spring.io/spring-cloud-gateway/docs/3.1.0/reference/html/</p><p>GitHub地址：https://github.com/FirstBloodForJava/spring-cloud-gateway-simple</p><div class="language-pom" data-highlighter="prismjs" data-ext="pom" data-title="pom"><pre><code><span class="line">&lt;dependency&gt;</span>
<span class="line">	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span>
<span class="line">	&lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;</span>
<span class="line">&lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>gateway的特性：</p><ol><li>基于Spring框架和SpringBoot构建；</li><li>能够匹配任何请求属性上的路由；</li><li>Predicates和filters可以基于路由定制；</li><li>集成断路器；</li><li>集成SpringCloud发现客户端；</li><li>简单编写Predicates和filters；</li><li>请求速率限制；</li><li>路径重写。</li></ol><figure><img src="http://47.101.155.205/image-20240812101839801.png" alt="image-20240812101839801" tabindex="0" loading="lazy"><figcaption>image-20240812101839801</figcaption></figure><h2 id="_1-构建一个spring-cloud-gateway项目" tabindex="-1"><a class="header-anchor" href="#_1-构建一个spring-cloud-gateway项目"><span>1.构建一个spring-cloud-gateway项目</span></a></h2><p>https://start.spring.io/</p><p>根据所需选择依赖</p><figure><img src="http://47.101.155.205/image-20240812103904652.png" alt="image-20240812103904652" tabindex="0" loading="lazy"><figcaption>image-20240812103904652</figcaption></figure><p>可能有一些同步库的依赖不能使用(例如redis)，因为这个是基于SpringBoot2.x版本、SpringWebFlux、Project Reactor构建的。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 下载依赖的源码</span></span>
<span class="line">mvn dependency:resolve <span class="token parameter variable">-Dclassifier</span><span class="token operator">=</span>sources</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p><strong>包含spring-cloud-starter-gateway启动器，但是不想启用网关，添加配置spring.cloud.gateway.enabled=false。</strong></p><h2 id="_2-名词解释" tabindex="-1"><a class="header-anchor" href="#_2-名词解释"><span>2.名词解释</span></a></h2><ol><li>Route：网关的基本构建块。由id(String)、目的uri(URI)、集合predicate(PredicateDefinition)、集合filters(FilterDefinition)，predicate执行结果为true则route匹配。</li><li>Predicate：java.util.function.Predicate&lt;T&gt;函数式接口。泛型为ServerWebExchange。这可以匹配http请求中的任何东西，例如请求头或参数。</li><li>Filter：特定工厂建造的GatewayFilter的实现Bean。你可以在这里修改request和response在发送请求之后或之后。</li></ol><h2 id="_3-工作原理" tabindex="-1"><a class="header-anchor" href="#_3-工作原理"><span>3.工作原理</span></a></h2><figure><img src="http://47.101.155.205/image-20240812111953557.png" alt="image-20240812111953557" tabindex="0" loading="lazy"><figcaption>image-20240812111953557</figcaption></figure><p>http请求到gateway，Gateway Handlr Mapping确定请求和route匹配，则会把请求交给Gateway Web Handler处理。这个处理器按特定的filter链处理请求。过滤器可以在发送代理请求之前(pre)和之后(port)处理。所有的pre Filter被执行完成，发出代理请求，在代理请求被处理之后，post Filter被执行。</p><h2 id="_4-配置route-predicate-factories和gateway-filter-factories" tabindex="-1"><a class="header-anchor" href="#_4-配置route-predicate-factories和gateway-filter-factories"><span>4.配置Route Predicate Factories和Gateway Filter Factories</span></a></h2><h3 id="_4-1-shortcut-configuration" tabindex="-1"><a class="header-anchor" href="#_4-1-shortcut-configuration"><span>4.1.Shortcut Configuration</span></a></h3><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org<span class="token punctuation">:</span><span class="token number">80</span></span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Cookie=mycookie<span class="token punctuation">,</span>mycookievalue</span>
<span class="line">            </span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240812133032549.png" alt="image-20240812133032549" tabindex="0" loading="lazy"><figcaption>image-20240812133032549</figcaption></figure><h3 id="_4-2-fully-expanded-arguments" tabindex="-1"><a class="header-anchor" href="#_4-2-fully-expanded-arguments"><span>4.2.Fully Expanded Arguments</span></a></h3><p>与快捷配置不同的地方在于predicate的配置</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cookie</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> mycookie</span>
<span class="line">                <span class="token key atrule">regexp</span><span class="token punctuation">:</span> mycookievalue</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-route-predicate工厂" tabindex="-1"><a class="header-anchor" href="#_5-route-predicate工厂"><span>5.Route Predicate工厂</span></a></h2><p>有许多内置的Predicate工厂。这些工厂是为了匹配Http请求的不同属性。可以将多个Predicate工厂与and组合在一起。</p><h3 id="_5-1-after" tabindex="-1"><a class="header-anchor" href="#_5-1-after"><span>5.1.After</span></a></h3><p>代理2024-08-12T13:42:13.485+08:00[Asia/Shanghai]之后的所有请求。时间式ZonedDateTime类型的格式。</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> After=2024<span class="token punctuation">-</span>08<span class="token punctuation">-</span>12T13<span class="token punctuation">:</span>42<span class="token punctuation">:</span>13.485+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> After</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">datetime</span><span class="token punctuation">:</span> 2024<span class="token punctuation">-</span>08<span class="token punctuation">-</span>12T13<span class="token punctuation">:</span>42<span class="token punctuation">:</span>13.485+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-before" tabindex="-1"><a class="header-anchor" href="#_5-2-before"><span>5.2.Before</span></a></h3><p>匹配时间之前的。</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> before_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Before=2024<span class="token punctuation">-</span>08<span class="token punctuation">-</span>12T13<span class="token punctuation">:</span>42<span class="token punctuation">:</span>13.485+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> before_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Before</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">datetime</span><span class="token punctuation">:</span> 2024<span class="token punctuation">-</span>08<span class="token punctuation">-</span>12T13<span class="token punctuation">:</span>42<span class="token punctuation">:</span>13.485+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-between" tabindex="-1"><a class="header-anchor" href="#_5-3-between"><span>5.3.Between</span></a></h3><p>时间段</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> between_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Between=2024<span class="token punctuation">-</span>08<span class="token punctuation">-</span>12T14<span class="token punctuation">:</span>11<span class="token punctuation">:</span>33.959+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span><span class="token punctuation">,</span> 2024<span class="token punctuation">-</span>08<span class="token punctuation">-</span>13T14<span class="token punctuation">:</span>11<span class="token punctuation">:</span>33.959+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> between_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Between</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">datetime1</span><span class="token punctuation">:</span> 2024<span class="token punctuation">-</span>08<span class="token punctuation">-</span>12T14<span class="token punctuation">:</span>11<span class="token punctuation">:</span>33.959+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span></span>
<span class="line">                <span class="token key atrule">datetime2</span><span class="token punctuation">:</span> 2024<span class="token punctuation">-</span>08<span class="token punctuation">-</span>13T14<span class="token punctuation">:</span>11<span class="token punctuation">:</span>33.959+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-cookie" tabindex="-1"><a class="header-anchor" href="#_5-4-cookie"><span>5.4.Cookie</span></a></h3><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cookie_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Cookie=chocolate<span class="token punctuation">,</span> ch.p</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cookie_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cookie</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> chocolate</span>
<span class="line">                <span class="token key atrule">regexp</span> <span class="token punctuation">:</span> ch.p</span>
<span class="line">                </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-header" tabindex="-1"><a class="header-anchor" href="#_5-5-header"><span>5.5.Header</span></a></h3><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> header_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span> \d+</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> header_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Header</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">header</span><span class="token punctuation">:</span> X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id</span>
<span class="line">                <span class="token key atrule">regexp</span><span class="token punctuation">:</span> \d+</span>
<span class="line">                </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-6-host" tabindex="-1"><a class="header-anchor" href="#_5-6-host"><span>5.6.Host</span></a></h3><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> host_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Host=<span class="token important">**.somehost.org</span><span class="token punctuation">,</span><span class="token important">**.anotherhost.org</span><span class="token punctuation">,</span><span class="token important">**.localhost.**</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> host_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Host</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns1</span><span class="token punctuation">:</span> localhost.<span class="token important">**</span></span>
<span class="line">                <span class="token key atrule">patterns2</span><span class="token punctuation">:</span> <span class="token string">&quot;**.anotherhost.org&quot;</span></span>
<span class="line">                <span class="token key atrule">patterns3</span><span class="token punctuation">:</span> <span class="token string">&quot;**.somehost.org&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-7-method" tabindex="-1"><a class="header-anchor" href="#_5-7-method"><span>5.7.Method</span></a></h3><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> method_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Method=GET<span class="token punctuation">,</span>POST</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> method_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Method</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">methods</span><span class="token punctuation">:</span> GET</span>
<span class="line">                <span class="token key atrule">methods1</span><span class="token punctuation">:</span> POST</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-8-path" tabindex="-1"><a class="header-anchor" href="#_5-8-path"><span>5.8.Path</span></a></h3><p>//delay/**和/delay/**</p><p>//delya/**不会匹配到gateway的/delay/4请求，会匹配//delay/4请求。</p><p>/delay/1的匹配规则，如果为true，则/delay/1/会被匹配，false则不会</p><figure><img src="http://47.101.155.205/image-20240826153418417.png" alt="image-20240826153418417" tabindex="0" loading="lazy"><figcaption>image-20240826153418417</figcaption></figure><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> path_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/delay/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> path_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /delay/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line">                <span class="token key atrule">matchTrailingSlash</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240812145229828.png" alt="image-20240812145229828" tabindex="0" loading="lazy"><figcaption>image-20240812145229828</figcaption></figure><h3 id="_5-9-query" tabindex="-1"><a class="header-anchor" href="#_5-9-query"><span>5.9.Query</span></a></h3><p>参数param，regexp，其中regexp可以没有，表示什么都可以</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> query_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Query=green<span class="token punctuation">,</span> gree.</span>
<span class="line">            </span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> query_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Query</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">param</span><span class="token punctuation">:</span> green</span>
<span class="line">                <span class="token key atrule">regexp</span><span class="token punctuation">:</span> gree.</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-10-remoteaddr" tabindex="-1"><a class="header-anchor" href="#_5-10-remoteaddr"><span>5.10.RemoteAddr</span></a></h3><p>localhost地址获取的RemoteAddr为0:0:0:0:0:0:0:1。</p><p>获取的为发起请求的客户端的ip地址，如果存在代理，则这里获取的地址可能不准确。</p><figure><img src="http://47.101.155.205/image-20240812151214211.png" alt="image-20240812151214211" tabindex="0" loading="lazy"><figcaption>image-20240812151214211</figcaption></figure><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> remoteaddr_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> RemoteAddr=127.0.0.1</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> remoteaddr_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RemoteAddr</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">sources</span><span class="token punctuation">:</span> 127.0.0.1</span>
<span class="line">                <span class="token key atrule">sources1</span><span class="token punctuation">:</span> 192.168.8.8</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-10-1修改获取remoteaddr方式" tabindex="-1"><a class="header-anchor" href="#_5-10-1修改获取remoteaddr方式"><span>5.10.1修改获取RemoteAddr方式</span></a></h4><p>XForwardedRemoteAddressResolver提供了两个方法</p><ol><li>trustAll：总是获取请求头中X-Forwarded-For的第一个值，会存在风险，客户端可以修改X-Forwarded-For的初始值，该值也会被解析器接收。</li><li>maxTrustedIndex(数字)：在到达gateway之前经历可信代理的次数。</li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">RemoteAddressResolver</span> resolver <span class="token operator">=</span> <span class="token class-name">XForwardedRemoteAddressResolver</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">maxTrustedIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">myRoutes</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;direct-route&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                        r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">remoteAddr</span><span class="token punctuation">(</span><span class="token string">&quot;10.1.1.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10.10.1.1/24&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://downstream1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;proxied-route&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                        r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">remoteAddr</span><span class="token punctuation">(</span>resolver<span class="token punctuation">,</span> <span class="token string">&quot;10.10.1.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10.10.1.1/24&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://downstream2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-11-weight" tabindex="-1"><a class="header-anchor" href="#_5-11-weight"><span>5.11.Weight</span></a></h3><p>组group1，20%的代理到https://weightlow.org，80%代理到http://httpbin.org</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> weight_high</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org/get</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Weight=group1<span class="token punctuation">,</span> <span class="token number">8</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> weight_low</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//weightlow.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Weight=group1<span class="token punctuation">,</span> <span class="token number">2</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> weight_high</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Weight</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">group</span><span class="token punctuation">:</span> group1</span>
<span class="line">                <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">8</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> weight_low</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//weightlow.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Weight</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">group</span><span class="token punctuation">:</span> group1</span>
<span class="line">                <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">2</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-gatewayfilter-工厂" tabindex="-1"><a class="header-anchor" href="#_6-gatewayfilter-工厂"><span>6.GatewayFilter 工厂</span></a></h2><p>Route过滤器能修改进来的Http请求和响应。</p><h3 id="_6-1-addrequestheader" tabindex="-1"><a class="header-anchor" href="#_6-1-addrequestheader"><span>6.1.AddRequestHeader</span></a></h3><p>给匹配的request的请求头添加对应的key=value。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_header_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>red<span class="token punctuation">,</span> blue</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /delay/<span class="token punctuation">{</span>int<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_header_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> AddRequestHeader</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>red</span>
<span class="line">                <span class="token key atrule">value</span><span class="token punctuation">:</span> blue<span class="token punctuation">-</span><span class="token punctuation">{</span>int<span class="token punctuation">}</span></span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /delay/<span class="token punctuation">{</span>int<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-addrequestparameter" tabindex="-1"><a class="header-anchor" href="#_6-2-addrequestparameter"><span>6.2.AddRequestParameter</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_parameter_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Host=<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>.myhost.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> AddRequestParameter=foo<span class="token punctuation">,</span> bar<span class="token punctuation">-</span><span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_parameter_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Host</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns1</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>segment<span class="token punctuation">}</span>.myhost.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> AddRequestParameter</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span> </span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> foo</span>
<span class="line">                <span class="token key atrule">value</span><span class="token punctuation">:</span> bar<span class="token punctuation">-</span><span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-addresponseheader" tabindex="-1"><a class="header-anchor" href="#_6-3-addresponseheader"><span>6.3.AddResponseHeader</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_response_header_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Host=localhost<span class="token punctuation">:</span><span class="token number">8080</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> AddResponseHeader=foo<span class="token punctuation">,</span> bar<span class="token punctuation">-</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_response_header_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Host=localhost<span class="token punctuation">:</span><span class="token number">8080</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> AddResponseHeader</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> foo</span>
<span class="line">                <span class="token key atrule">value</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240812165833754.png" alt="image-20240812165833754" tabindex="0" loading="lazy"><figcaption>image-20240812165833754</figcaption></figure><h3 id="_6-4-deduperesponseheader" tabindex="-1"><a class="header-anchor" href="#_6-4-deduperesponseheader"><span>6.4.DedupeResponseHeader</span></a></h3><p>参数有name(list)，strategy(默认RETAIN_FIRST、RETAIN_LAST、RETAIN_UNIQUE，可以不填)。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> dedupe_response_header_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> AddResponseHeader=Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Credentials<span class="token punctuation">,</span> <span class="token boolean important">false</span></span>
<span class="line">            <span class="token punctuation">-</span> DedupeResponseHeader=Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Credentials Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Origin</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">pattern</span><span class="token punctuation">:</span> /<span class="token important">**</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里有如果包含多个请求头key，key之间用空格分割，与其他不同。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> dedupe_response_header_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> AddResponseHeader</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Credentials</span>
<span class="line">                <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token number">100</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DedupeResponseHeader</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Credentials Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Origin</span>
<span class="line">                <span class="token key atrule">strategy</span><span class="token punctuation">:</span> RETAIN_FIRST</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">pattern</span><span class="token punctuation">:</span> /<span class="token important">**</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明AddResponseHeader添加的响应头比获取请求响应的头要早。</p><figure><img src="http://47.101.155.205/image-20240813090204930.png" alt="image-20240813090204930" tabindex="0" loading="lazy"><figcaption>image-20240813090204930</figcaption></figure><figure><img src="http://47.101.155.205/image-20240813090411387.png" alt="image-20240813090411387" tabindex="0" loading="lazy"><figcaption>image-20240813090411387</figcaption></figure><figure><img src="http://47.101.155.205/image-20240813090509562.png" alt="image-20240813090509562" tabindex="0" loading="lazy"><figcaption>image-20240813090509562</figcaption></figure><h3 id="_6-5-circuitbreaker" tabindex="-1"><a class="header-anchor" href="#_6-5-circuitbreaker"><span>6.5.CircuitBreaker</span></a></h3><p>断路器应该是类似与JDBC模式，spring-cloud-gateway定义好了断路器的接口，只要引入相关的实现类(即Jdbc的驱动)，就可以实现断路器功能了。</p><p>Spring Cloud supports Resilience4J就是开箱即用。</p><p>断路器实现相关文档：https://cloud.spring.io/spring-cloud-circuitbreaker/reference/html/spring-cloud-circuitbreaker.html</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> circuitbreaker_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/delay/<span class="token punctuation">{</span>int<span class="token punctuation">}</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CircuitBreaker</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> myCircuitBreaker</span>
<span class="line">                <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/demo</span>
<span class="line">            <span class="token punctuation">-</span> RewritePath=/delay/4<span class="token punctuation">,</span> /delay/5</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">routes</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;circuitbreaker_route&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                        r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/delay/{int}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span></span>
<span class="line">                                        f<span class="token punctuation">.</span><span class="token function">circuitBreaker</span><span class="token punctuation">(</span>c <span class="token operator">-&gt;</span> c<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;myCircuitBreaker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFallbackUri</span><span class="token punctuation">(</span><span class="token string">&quot;forward:/demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                                                <span class="token punctuation">.</span><span class="token function">rewritePath</span><span class="token punctuation">(</span><span class="token string">&quot;/delay/4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/delay/5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                                <span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把转发的请求拦截，在转发出去。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/delay/<span class="token important">**</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CircuitBreaker</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> fetchIngredients</span>
<span class="line">                <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/get</span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients<span class="token punctuation">-</span>fallback</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-5-1-配置状态码代表启用断路器" tabindex="-1"><a class="header-anchor" href="#_6-5-1-配置状态码代表启用断路器"><span>6.5.1.配置状态码代表启用断路器</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/delay/<span class="token important">**</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CircuitBreaker</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> fetchIngredients</span>
<span class="line">                <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/get</span>
<span class="line">                <span class="token key atrule">statusCodes</span><span class="token punctuation">:</span></span>
<span class="line">                  <span class="token punctuation">-</span> <span class="token number">404</span></span>
<span class="line">                  <span class="token punctuation">-</span> <span class="token string">&quot;NOT_FOUND&quot;</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients<span class="token punctuation">-</span>fallback</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">routes</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;circuitbreaker_route&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                        r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/delay/{int}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span></span>
<span class="line">                                        f<span class="token punctuation">.</span><span class="token function">circuitBreaker</span><span class="token punctuation">(</span>c <span class="token operator">-&gt;</span> c<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;myCircuitBreaker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFallbackUri</span><span class="token punctuation">(</span><span class="token string">&quot;forward:/demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addStatusCode</span><span class="token punctuation">(</span><span class="token string">&quot;INTERNAL_SERVER_ERROR&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                                                <span class="token punctuation">.</span><span class="token function">rewritePath</span><span class="token punctuation">(</span><span class="token string">&quot;/delay/4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/delay/5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                                <span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-6-fallbackheaders" tabindex="-1"><a class="header-anchor" href="#_6-6-fallbackheaders"><span>6.6.FallbackHeaders</span></a></h3><p>熔断转发的请求中添加异常信息</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/delay/<span class="token important">**</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CircuitBreaker</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> fetchIngredients</span>
<span class="line">                <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/get</span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients<span class="token punctuation">-</span>fallback</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FallbackHeaders</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">executionExceptionTypeHeaderName</span><span class="token punctuation">:</span> Test<span class="token punctuation">-</span>Header</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240813101642096.png" alt="image-20240813101642096" tabindex="0" loading="lazy"><figcaption>image-20240813101642096</figcaption></figure><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/delay/<span class="token important">**</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CircuitBreaker</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> fetchIngredients</span>
<span class="line">                <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/get</span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients<span class="token punctuation">-</span>fallback</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FallbackHeaders</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">executionExceptionTypeHeaderName</span><span class="token punctuation">:</span> Execution<span class="token punctuation">-</span>Exception<span class="token punctuation">-</span>Type</span>
<span class="line">                <span class="token key atrule">executionExceptionMessageHeaderName</span><span class="token punctuation">:</span> Execution<span class="token punctuation">-</span>Exception<span class="token punctuation">-</span>Message</span>
<span class="line">                <span class="token key atrule">rootCauseExceptionTypeHeaderName</span><span class="token punctuation">:</span> Root<span class="token punctuation">-</span>Cause<span class="token punctuation">-</span>Exception<span class="token punctuation">-</span>Type</span>
<span class="line">                <span class="token key atrule">rootCauseExceptionMessageHeaderName</span><span class="token punctuation">:</span> Root<span class="token punctuation">-</span>Cause<span class="token punctuation">-</span>Exception<span class="token punctuation">-</span>Message</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240813101939821.png" alt="image-20240813101939821" tabindex="0" loading="lazy"><figcaption>image-20240813101939821</figcaption></figure><h3 id="_6-7-maprequestheader" tabindex="-1"><a class="header-anchor" href="#_6-7-maprequestheader"><span>6.7.MapRequestHeader</span></a></h3><p>将到gateway的请求头中的key(fromHeader)的value携带到下游的请求头的key(toHeader)的value，如果fromHeader不存在，没有任何影响。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> map_request_header_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> MapRequestHeader=Blue<span class="token punctuation">,</span> X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Red</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> map_request_header_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> MapRequestHeader</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">fromHeader</span><span class="token punctuation">:</span> Blue</span>
<span class="line">                <span class="token key atrule">toHeader</span><span class="token punctuation">:</span> X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Red</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240813105448085.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_6-8-prefixpath" tabindex="-1"><a class="header-anchor" href="#_6-8-prefixpath"><span>6.8.PrefixPath</span></a></h3><p>把代理的请求添加前缀发送到下游。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> prefixpath_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> PrefixPath=/delay</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /*</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> prefixpath_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PrefixPath</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">prefix</span><span class="token punctuation">:</span> /delay</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /*</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240813110408161.png" alt="image-20240813110408161" tabindex="0" loading="lazy"><figcaption>image-20240813110408161</figcaption></figure><h3 id="_6-9-preservehostheader" tabindex="-1"><a class="header-anchor" href="#_6-9-preservehostheader"><span>6.9.PreserveHostHeader</span></a></h3><p>请求头的Host记录的是到达gateway之前的http发起客户端的host，而不是gateway发起http请求的host地址。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> preserve_host_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> PreserveHostHeader</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> preserve_host_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PreserveHostHeader</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240813111347589.png" alt="image-20240813111347589" tabindex="0" loading="lazy"><figcaption>image-20240813111347589</figcaption></figure><h3 id="_6-10-requestratelimiter" tabindex="-1"><a class="header-anchor" href="#_6-10-requestratelimiter"><span>6.10.RequestRateLimiter</span></a></h3><p>实现KeyResolver接口注入容器，通过request中的哪些属性来生成限流key，来限制请求速率(使用默认的策略，未开启不拒绝，请求响应403)。</p><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 使用客户端ip地址来限流</span></span>
<span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token class-name">KeyResolver</span> <span class="token function">userKeyResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> exchange <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>spring.cloud.gateway.filter.request-rate-limiter.deny-empty-key=true/false是否拒绝空的匹配</p><p>spring.cloud.gateway.filter.request-rate-limiter.empty-key-status-code拒绝的状态码</p><p>需要引入spring-boot-starter-data-redis-reactive依赖。</p><p>限速算法：https://en.wikipedia.org/wiki/Token_bucket</p><div class="language-pom" data-highlighter="prismjs" data-ext="pom" data-title="pom"><pre><code><span class="line">&lt;dependency&gt;</span>
<span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span>
<span class="line">	&lt;artifactId&gt;spring-boot-starter-data-redis-reactive&lt;/artifactId&gt;</span>
<span class="line">&lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>redis-rate-limiter.replenishRate：表示每秒令牌桶中能容纳的令牌数。</p><p>redis-rate-limiter.burstCapacity：表示桶的最大容量。</p><p>redis-rate-limiter.requestedTokens：每个请求消耗的令牌数，默认1</p><p>出现配置速率和实际请求不符的原因是没有配置redis的连接信息。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> requestratelimiter_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">redis-rate-limiter.replenishRate</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">                <span class="token key atrule">redis-rate-limiter.burstCapacity</span><span class="token punctuation">:</span> <span class="token number">60</span></span>
<span class="line">                <span class="token key atrule">redis-rate-limiter.requestedTokens</span><span class="token punctuation">:</span> <span class="token number">60</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PrefixPath</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">prefix</span><span class="token punctuation">:</span> /demo</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line">      <span class="token key atrule">filter</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">request-rate-limiter</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">deny-empty-key</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token class-name">KeyResolver</span> <span class="token function">userKeyResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> exchange <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240813142105464.png" alt="image-20240813142105464" tabindex="0" loading="lazy"><figcaption>image-20240813142105464</figcaption></figure><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> requestratelimiter_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">redis-rate-limiter.replenishRate</span><span class="token punctuation">:</span> <span class="token number">10</span></span>
<span class="line">                <span class="token key atrule">redis-rate-limiter.burstCapacity</span><span class="token punctuation">:</span> <span class="token number">20</span></span>
<span class="line">                <span class="token key atrule">redis-rate-limiter.requestedTokens</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PrefixPath</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">prefix</span><span class="token punctuation">:</span> /demo</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line">      <span class="token key atrule">filter</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">request-rate-limiter</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">deny-empty-key</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">  <span class="token key atrule">redis</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span></span>
<span class="line">    <span class="token key atrule">cluster</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">nodes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> 192.168.120.110<span class="token punctuation">:</span><span class="token number">26379</span></span>
<span class="line">        <span class="token punctuation">-</span> 192.168.120.110<span class="token punctuation">:</span><span class="token number">27379</span></span>
<span class="line">        <span class="token punctuation">-</span> 192.168.120.111<span class="token punctuation">:</span><span class="token number">26379</span></span>
<span class="line">        <span class="token punctuation">-</span> 192.168.120.111<span class="token punctuation">:</span><span class="token number">27379</span></span>
<span class="line">        <span class="token punctuation">-</span> 192.168.120.112<span class="token punctuation">:</span><span class="token number">26379</span></span>
<span class="line">        <span class="token punctuation">-</span> 192.168.120.112<span class="token punctuation">:</span><span class="token number">27379</span></span>
<span class="line">    <span class="token key atrule">password</span><span class="token punctuation">:</span> epredis</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240813144227463.png" alt="image-20240813144227463" tabindex="0" loading="lazy"><figcaption>image-20240813144227463</figcaption></figure><h4 id="_6-10-1-自定义方式" tabindex="-1"><a class="header-anchor" href="#_6-10-1-自定义方式"><span>6.10.1.自定义方式</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> requestratelimiter_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter</span>
<span class="line">          <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">rate-limiter</span><span class="token punctuation">:</span> <span class="token string">&quot;#{@myRateLimiter}&quot;</span></span>
<span class="line">            <span class="token key atrule">key-resolver</span><span class="token punctuation">:</span> <span class="token string">&quot;#{@userKeyResolver}&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-11-redirectto" tabindex="-1"><a class="header-anchor" href="#_6-11-redirectto"><span>6.11.RedirectTo</span></a></h3><p>重定向到http://httpbin.org/get地址，这里配置的uri路径不生效。</p><p>uri不换成这样uri: no://op，如果filters中的url是相对路径，则会映射到当前host+相对路径</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> prefixpath_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> RedirectTo=302<span class="token punctuation">,</span> http<span class="token punctuation">:</span>//httpbin.org/get</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240813150713446.png" alt="image-20240813150713446" tabindex="0" loading="lazy"><figcaption>image-20240813150713446</figcaption></figure><figure><img src="http://47.101.155.205/image-20240813151442642.png" alt="image-20240813151442642" tabindex="0" loading="lazy"><figcaption>image-20240813151442642</figcaption></figure><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> prefixpath_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> no<span class="token punctuation">:</span>//op</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RedirectTo</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token number">302</span></span>
<span class="line">                <span class="token key atrule">url</span><span class="token punctuation">:</span> demo/get</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240813153002214.png" alt="image-20240813153002214" tabindex="0" loading="lazy"><figcaption>image-20240813153002214</figcaption></figure><h3 id="_6-12-removerequestheader" tabindex="-1"><a class="header-anchor" href="#_6-12-removerequestheader"><span>6.12.RemoveRequestHeader</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> removerequestheader_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> RemoveRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Foo</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>展开配置仅支持name对应的value被移除，不支持多个key移除。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> removerequestheader_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RemoveRequestHeader</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Foo</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240814162431758.png" alt="image-20240814162431758" tabindex="0" loading="lazy"><figcaption>image-20240814162431758</figcaption></figure><h3 id="_6-13-removeresponseheader" tabindex="-1"><a class="header-anchor" href="#_6-13-removeresponseheader"><span>6.13.RemoveResponseHeader</span></a></h3><p>移除响应头中任何key</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> removeresponseheader_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> RemoveResponseHeader=Date</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240814163503850.png" alt="image-20240814163503850" tabindex="0" loading="lazy"><figcaption>image-20240814163503850</figcaption></figure><p>通过spring.cloud.gateway.default-filters这个配置过滤器，应用在所有的route上。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> defaultFilterRoute1</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> defaultFilterRoute2</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /delay/<span class="token punctuation">{</span>int<span class="token punctuation">}</span></span>
<span class="line">      <span class="token key atrule">default-filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RemoveResponseHeader</span>
<span class="line">          <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">name</span><span class="token punctuation">:</span> Date</span>
<span class="line">            </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-14-removerequestparameter" tabindex="-1"><a class="header-anchor" href="#_6-14-removerequestparameter"><span>6.14.RemoveRequestParameter</span></a></h3><p>移除请求参数</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> removerequestparameter_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> RemoveRequestParameter=user</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240814164454175.png" alt="image-20240814164454175" tabindex="0" loading="lazy"><figcaption>image-20240814164454175</figcaption></figure><figure><img src="http://47.101.155.205/image-20240814164509193.png" alt="image-20240814164509193" tabindex="0" loading="lazy"><figcaption>image-20240814164509193</figcaption></figure><h3 id="_6-15-rewritepath" tabindex="-1"><a class="header-anchor" href="#_6-15-rewritepath"><span>6.15.RewritePath</span></a></h3><p>重写转发请求路径。</p><p>需要regexp(待匹配的正则表达式)和replacement(替换后的表达式)两个参数。</p><p>匹配/get/开头的字符串，将/get/后面部分捕获到segmengt捕获组中。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewritepath_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get/<span class="token important">**</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> RewritePath=/get/<span class="token punctuation">?</span>(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">&gt;</span>.<span class="token important">*)</span><span class="token punctuation">,</span> /$\<span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewritepath_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get/<span class="token important">**</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RewritePath</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">regexp</span><span class="token punctuation">:</span> /get/<span class="token punctuation">?</span>(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">&gt;</span>.<span class="token important">*)</span></span>
<span class="line">                <span class="token key atrule">replacement</span><span class="token punctuation">:</span> /$\<span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240814172718935.png" alt="image-20240814172718935" tabindex="0" loading="lazy"><figcaption>image-20240814172718935</figcaption></figure><h3 id="_6-16-rewritelocationresponseheader" tabindex="-1"><a class="header-anchor" href="#_6-16-rewritelocationresponseheader"><span>6.16.RewriteLocationResponseHeader</span></a></h3><p>支持stripVersionMode, locationHeaderName, hostValue, protocolsRegex四个参数，用来修改请求响应头的Location的value。</p><p>作用是将locationHeaderName对应的值的响应头重写，如果协议匹配，host值替换成hostValue的值。</p><ol><li>stripVersionMode：有可选项NEVER_STRIP、AS_IN_REQUEST(默认)、ALWAYS_STRIP。请求的uri中以/v数字开始，决定是否把请求头的版本替换 <ol><li>NEVER_STRIP：不管请求中是否有uri请求头的版本号从不移除；</li><li>AS_IN_REQUEST：请求的uri中没有有版本号，才移除请求头中版本号；</li><li>ALWAYS_STRIP：不管请求里是否有版本号，都移除请求头的value的版本号。</li></ol></li><li>locationHeaderName：获取响应头key的name</li><li>hostValue：配置的hostValue，默认为请求头的Host的value</li><li>protocolsRegex：有效的正则表达式，用来匹配协议，如果协议不匹配，过滤器什么都不做，默认是http|https|ftp|ftps()。</li></ol><div class="language-txt line-numbers-mode" data-highlighter="prismjs" data-ext="txt" data-title="txt"><pre><code><span class="line">替换的正则表达式</span>
<span class="line">(?&lt;=^(?:protocolsRegex)://)[^:/]+(?::\d+)?(?=/)</span>
<span class="line">(?&lt;=^(?:https?|ftps?)://)[^:/]+(?::\d+)?(?=/)</span>
<span class="line">(?&lt;=^(?:protocolsRegex)://)[^:/]+(?::\d+)?(?:/v\d+)?(?=/)</span>
<span class="line">(?&lt;=^(?:https?|ftps?)://)[^:/]+(?::\d+)?(?:/v\d+)?(?=/)</span>
<span class="line">https?表示匹配http或https，因为?代表前面的表达式出现一次或零次</span>
<span class="line"></span>
<span class="line">请求版本号校验表达式</span>
<span class="line">^/v\\d+/.*</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewritelocationresponseheader_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> AddResponseHeader=TEST<span class="token punctuation">,</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/v1/demo/get</span>
<span class="line">            <span class="token punctuation">-</span> RewriteLocationResponseHeader=ALWAYS_STRIP <span class="token punctuation">,</span> TEST<span class="token punctuation">,</span> httpbin.org<span class="token punctuation">,</span> http<span class="token punctuation">|</span>https<span class="token punctuation">|</span>ftp<span class="token punctuation">|</span>ftps</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>localhost:8080替换成了httpbin.org，去掉了版本。</p><figure><img src="http://47.101.155.205/image-20240815112620809.png" alt="image-20240815112620809" tabindex="0" loading="lazy"><figcaption>image-20240815112620809</figcaption></figure><h3 id="_6-17-rewriteresponseheader" tabindex="-1"><a class="header-anchor" href="#_6-17-rewriteresponseheader"><span>6.17.RewriteResponseHeader</span></a></h3><p>支持参数：name, regexp, replacement。</p><p>响应头name的value，匹配regexp正则表达式的字符串部分都替换成replacemengt。</p><p>如果replacement需要用到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>字符，需要用</mtext></mrow><annotation encoding="application/x-tex">字符，需要用</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">字符，需要用</span></span></span></span>\表示。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewriteresponseheader_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> AddResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Red<span class="token punctuation">,</span> password=1234&amp;</span>
<span class="line">            <span class="token punctuation">-</span> RewriteResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Red<span class="token punctuation">,</span> <span class="token punctuation">,</span> password=<span class="token punctuation">[</span>^&amp;<span class="token punctuation">]</span>+<span class="token punctuation">,</span> password=<span class="token important">***</span></span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815145609596.png" alt="image-20240815145609596" tabindex="0" loading="lazy"><figcaption>image-20240815145609596</figcaption></figure><h3 id="_6-18-savesession" tabindex="-1"><a class="header-anchor" href="#_6-18-savesession"><span>6.18.SaveSession</span></a></h3><p>有使用SpringSecurity和SpringSession，将安全信息发送到下游请求。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> save_session</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=/foo/<span class="token important">**</span></span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> SaveSession</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-19-secureheaders" tabindex="-1"><a class="header-anchor" href="#_6-19-secureheaders"><span>6.19.SecureHeaders</span></a></h3><p>为了http响应头添加参数：https://blog.appcanary.com/2017/http-security-headers.html</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SecureHeaders</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line">      <span class="token key atrule">filter</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">secure-headers</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">disable</span><span class="token punctuation">:</span> x<span class="token punctuation">-</span>frame<span class="token punctuation">-</span>options<span class="token punctuation">,</span>strict<span class="token punctuation">-</span>transport<span class="token punctuation">-</span>security <span class="token comment"># 禁用key</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815153232147.png" alt="image-20240815153232147" tabindex="0" loading="lazy"><figcaption>image-20240815153232147</figcaption></figure><figure><img src="http://47.101.155.205/image-20240815153128019.png" alt="image-20240815153128019" tabindex="0" loading="lazy"><figcaption>image-20240815153128019</figcaption></figure><h3 id="_6-20-setpath" tabindex="-1"><a class="header-anchor" href="#_6-20-setpath"><span>6.20.SetPath</span></a></h3><p>修改到下游的路径。</p><p>支持参数template。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setpath_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> SetPath=/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815153739787.png" alt="image-20240815153739787" tabindex="0" loading="lazy"><figcaption>image-20240815153739787</figcaption></figure><h3 id="_6-21-setrequestheader" tabindex="-1"><a class="header-anchor" href="#_6-21-setrequestheader"><span>6.21.SetRequestHeader</span></a></h3><p>支持参数name、value。</p><p>修改请求头的key的value，替换所有。</p><p>支持动态替换匹配Host或Path的遍历。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setrequestheader_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> SetRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Red<span class="token punctuation">,</span> Blue</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815154131705.png" alt="image-20240815154131705" tabindex="0" loading="lazy"><figcaption>image-20240815154131705</figcaption></figure><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setrequestheader_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">Host</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>segment<span class="token punctuation">}</span>.myhost.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> SetRequestHeader=foo<span class="token punctuation">,</span> bar<span class="token punctuation">-</span><span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-22-setresponseheader" tabindex="-1"><a class="header-anchor" href="#_6-22-setresponseheader"><span>6.22.SetResponseHeader</span></a></h3><p>支持参数name、value。</p><p>修改响应头的key的value，替换所有。</p><p>支持动态替换匹配Host或Path的遍历。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setresponseheader_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> SetResponseHeader=Date<span class="token punctuation">,</span> Blue</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815154646877.png" alt="image-20240815154646877" tabindex="0" loading="lazy"><figcaption>image-20240815154646877</figcaption></figure><h3 id="_6-23-setstatus" tabindex="-1"><a class="header-anchor" href="#_6-23-setstatus"><span>6.23.SetStatus</span></a></h3><p>支持参数：status。</p><p>必须是一个有效的状态，在org.springframework.http.HttpStatus枚举中。</p><p>可以是状态码，也可以是单个枚举属性名。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusstring_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> SetStatus=BAD_REQUEST</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusint_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> SetStatus=401</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /delay/1</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815155600898.png" alt="image-20240815155600898" tabindex="0" loading="lazy"><figcaption>image-20240815155600898</figcaption></figure><p>可以通过配置spring.cloud.gateway.set-status.original-status-header-name=original-http-status，将代理请求响应的状态码放在响应头中，key为original-http-status</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusstring_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> SetStatus=BAD_REQUEST</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /get</span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusint_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> SetStatus=401</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Path</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">patterns</span><span class="token punctuation">:</span> /delay/1</span>
<span class="line">      <span class="token key atrule">set-status</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">original-status-header-name</span><span class="token punctuation">:</span> original<span class="token punctuation">-</span>http<span class="token punctuation">-</span>status</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815155826805.png" alt="image-20240815155826805" tabindex="0" loading="lazy"><figcaption>image-20240815155826805</figcaption></figure><h3 id="_6-24-stripprefix" tabindex="-1"><a class="header-anchor" href="#_6-24-stripprefix"><span>6.24.StripPrefix</span></a></h3><p>一个参数：parts</p><p>跳过几个/*，截取掉几个再转发请求。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> nameRoot</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/name/<span class="token important">**</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> StripPrefix=2</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815160407302.png" alt="image-20240815160407302" tabindex="0" loading="lazy"><figcaption>image-20240815160407302</figcaption></figure><h3 id="_6-25-retry" tabindex="-1"><a class="header-anchor" href="#_6-25-retry"><span>6.25.Retry</span></a></h3><p>重试，支持以下参数：</p><ol><li>retries：重试次数；</li><li>statuses：什么样的状态码应该重试(多个)；</li><li>methods：什么样的方法应该重试(多个)；</li><li>series：什么样的HttpStatus.Series应该重试(多个)；</li><li>exceptions：什么样的异常应该重试(多个)；</li><li>backoff：重试因子，控制重试间隔时间。</li></ol><p>启用该过滤器的默认配置：</p><ol><li>retries：3；</li><li>series：5xx；</li><li>methods：GET；</li><li>exceptions：IOException，TimeoutException；</li><li>backoff：空。</li></ol><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> retry_test</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org/get <span class="token comment"># 在转发请求时/get会被去掉</span></span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Retry</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span></span>
<span class="line">                <span class="token key atrule">statuses</span><span class="token punctuation">:</span> BAD_GATEWAY</span>
<span class="line">                <span class="token key atrule">methods</span><span class="token punctuation">:</span> GET<span class="token punctuation">,</span>POST</span>
<span class="line">                <span class="token key atrule">backoff</span><span class="token punctuation">:</span></span>
<span class="line">                  <span class="token key atrule">firstBackoff</span><span class="token punctuation">:</span> 10ms</span>
<span class="line">                  <span class="token key atrule">maxBackoff</span><span class="token punctuation">:</span> 50ms</span>
<span class="line">                  <span class="token key atrule">factor</span><span class="token punctuation">:</span> <span class="token number">2</span></span>
<span class="line">                  <span class="token key atrule">basedOnPreviousValue</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815163438183.png" alt="image-20240815163438183" tabindex="0" loading="lazy"><figcaption>image-20240815163438183</figcaption></figure><h3 id="_6-26-requestsize" tabindex="-1"><a class="header-anchor" href="#_6-26-requestsize"><span>6.26.RequestSize</span></a></h3><p>限制到下游请求的请求大小，默认单位B，可以添加后缀KB/MB表示单位。</p><p>没有配置，请求大小默认时5MB。超出大小，返回状态码为413。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> request_size_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/upload</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=/upload</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestSize</span>
<span class="line">          <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">maxSize</span><span class="token punctuation">:</span> <span class="token number">5000000</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815163924559.png" alt="image-20240815163924559" tabindex="0" loading="lazy"><figcaption>image-20240815163924559</figcaption></figure><h3 id="_6-27-setrequesthostheader" tabindex="-1"><a class="header-anchor" href="#_6-27-setrequesthostheader"><span>6.27.SetRequestHostHeader</span></a></h3><p>修改已经存在的请求头key为Host的value。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> set_request_host_header_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SetRequestHostHeader</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">host</span><span class="token punctuation">:</span> example.org</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815164051153.png" alt="image-20240815164051153" tabindex="0" loading="lazy"><figcaption>image-20240815164051153</figcaption></figure><h3 id="_6-28-modifyrequestbody" tabindex="-1"><a class="header-anchor" href="#_6-28-modifyrequestbody"><span>6.28.ModifyRequestBody</span></a></h3><p>修改请求体在发送请求之前。</p><p>只能使用代码实现，Java DSL。需要怎加null判断处理。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">routes</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;rewrite_request_obj&quot;</span><span class="token punctuation">,</span> r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">prefixPath</span><span class="token punctuation">(</span><span class="token string">&quot;/delay&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">modifyRequestBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Hello</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> s <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> message<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> message<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815165320644.png" alt="image-20240815165320644" tabindex="0" loading="lazy"><figcaption>image-20240815165320644</figcaption></figure><h3 id="_6-29-modifyresponsebody" tabindex="-1"><a class="header-anchor" href="#_6-29-modifyresponsebody"><span>6.29.ModifyResponseBody</span></a></h3><p>在返回请求到客户端之前，修改响应体。</p><p>只能使用代码实现，Java DSL。需要怎加null判断处理。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 这里不用一定要挂在一个过滤器下面</span></span>
<span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">routes</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;rewrite_response_upper&quot;</span><span class="token punctuation">,</span> r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">modifyResponseBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> </span>
<span class="line">                                                  <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815170320240.png" alt="image-20240815170320240" tabindex="0" loading="lazy"><figcaption>image-20240815170320240</figcaption></figure><h3 id="_6-30-relay" tabindex="-1"><a class="header-anchor" href="#_6-30-relay"><span>6.30.Relay</span></a></h3><p>抓取oauth2的token到下游。</p><p>https://github.com/spring-cloud-samples/sample-gateway-oauth2login</p><div class="language-pom" data-highlighter="prismjs" data-ext="pom" data-title="pom"><pre><code><span class="line">&lt;dependency&gt;</span>
<span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span>
<span class="line">	&lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt;</span>
<span class="line">&lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">customRouteLocator</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;resource&quot;</span><span class="token punctuation">,</span> r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">tokenRelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> resource</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=/get</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> TokenRelay=</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240815171541757.png" alt="image-20240815171541757" tabindex="0" loading="lazy"><figcaption>image-20240815171541757</figcaption></figure><h3 id="_6-31-cacherequestbody" tabindex="-1"><a class="header-anchor" href="#_6-31-cacherequestbody"><span>6.31.CacheRequestBody</span></a></h3><p>提起请求body至ServerWebExchange.getAttributes()中，key为ServerWebExchangeUtils.CACHED_REQUEST_BODY_ATTR。</p><p>仅适用于http和https请求。</p><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">routes</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;cache_request_body_route&quot;</span><span class="token punctuation">,</span> r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">cacheRequestBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cache_request_body_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get</span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CacheRequestBody</span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">bodyClass</span><span class="token punctuation">:</span> java.lang.String</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-32-default" tabindex="-1"><a class="header-anchor" href="#_6-32-default"><span>6.32.Default</span></a></h3><p>将过滤器应用至所有的route。</p><p>6.13有提到。</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">default-filters</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> AddResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Default<span class="token punctuation">-</span>Red<span class="token punctuation">,</span> Default<span class="token punctuation">-</span>Blue</span>
<span class="line">      <span class="token punctuation">-</span> PrefixPath=/httpbin</span>
<span class="line">      </span>
<span class="line"></span></code></pre></div><h2 id="_7-全局过滤器" tabindex="-1"><a class="header-anchor" href="#_7-全局过滤器"><span>7.全局过滤器</span></a></h2><h3 id="_7-1-自定义全局过滤器globalfilter" tabindex="-1"><a class="header-anchor" href="#_7-1-自定义全局过滤器globalfilter"><span>7.1.自定义全局过滤器GlobalFilter</span></a></h3><p>当请求与路由匹配时，过滤web处理器会将所有的全局过滤器实例和特定作用于路由的过滤器添加到过滤链中。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springcloudgatewaysimple<span class="token punctuation">.</span>filter</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">LogFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GlobalFilter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGlobalFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">Log</span> log <span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;custom global filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">GlobalFilter</span> <span class="token function">customFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomGlobalFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-forwardroutingfilter" tabindex="-1"><a class="header-anchor" href="#_7-2-forwardroutingfilter"><span>7.2.ForwardRoutingFilter</span></a></h3><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> path_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>///demo</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240816094556770.png" alt="image-20240816094556770" tabindex="0" loading="lazy"><figcaption>image-20240816094556770</figcaption></figure><h3 id="_7-3-reactiveloadbalancerclientfilter" tabindex="-1"><a class="header-anchor" href="#_7-3-reactiveloadbalancerclientfilter"><span>7.3.ReactiveLoadBalancerClientFilter</span></a></h3><p>过滤器获取ServerWebExchange的属性ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR(协议的lb://service)或获取的属性ServerWebExchangeUtils.GATEWAY_SCHEME_PREFIX_ATTR为lb，则会使用ReactorLoadBalancer解析service的host和port，然后替换属性ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR的值，为修改的url会添加的这个ServerWebExchangeUtils.GATEWAY_ORIGINAL_REQUEST_URL_ATTR列表中。</p><p>当gateway接收的请求协议是https时，如果这个过滤器获取协议为http，则会使用http协议发送到下游。相反也是如此。</p><p>spring-coud-loadbalancer：https://docs.spring.io/spring-cloud-commons/docs/current/reference/html/#spring-cloud-loadbalancer</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myRoute</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//service</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get/<span class="token important">**</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>当route配置成lb协议时，如果ReactorLoadBalancer对象没有在容器中找到，则会返回503的状态码。</p><p>可以通过这个spring.cloud.gateway.loadbalancer.use404: true配置修改返回状态码为404。</p><figure><img src="http://47.101.155.205/image-20240816095824567.png" alt="image-20240816095824567" tabindex="0" loading="lazy"><figcaption>image-20240816095824567</figcaption></figure><h3 id="_7-4-nettyroutingfilter" tabindex="-1"><a class="header-anchor" href="#_7-4-nettyroutingfilter"><span>7.4.NettyRoutingFilter</span></a></h3><p>URI requestUrl = (URI)exchange.getRequiredAttribute(ServerWebExchangeUtils.<em>GATEWAY_REQUEST_URL_ATTR</em>);获取的请求协议时http或https，则使用Netty HttpClient发送请求到下游。请求响应体放在exchange的属性ServerWebExchangeUtils.CLIENT_RESPONSE_ATTR中(可以在后续的过滤器中使用该属性)。</p><p>WebClientHttpRoutingFilter不要求Netty</p><h3 id="_7-5-nettywriteresponsefilter" tabindex="-1"><a class="header-anchor" href="#_7-5-nettywriteresponsefilter"><span>7.5.NettyWriteResponseFilter</span></a></h3><p>如果Netty的请求响应在exchange的属性ServerWebExchangeUtils.CLIENT_RESPONSE_ATTR中，则执行该过滤器。该过滤器执行在其他过滤器完成之后，将代理请求响应结果返回至客户端。</p><p>WebClientWriteResponseFilter不要求Netty。</p><h3 id="_7-6-routetorequesturlfilter" tabindex="-1"><a class="header-anchor" href="#_7-6-routetorequesturlfilter"><span>7.6.RouteToRequestUrlFilter</span></a></h3><p>如果exchange中属性ServerWebExchangeUtils.GATEWAY_ROUTE_ATTR存在值，RouteToRequestUrlFilter将会执行。</p><p>基于请求的URI和Route的URI创建一个新的URI，新的URI会被添加到exchange的属性ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR中。</p><p>如果是其他协议(URI.getSchemeSpecificPart())，例如：lb:ws://serviceid，则lb(协议)会被添加到exchange的属性ServerWebExchangeUtils.GATEWAY_SCHEME_PREFIX_ATTR中，以便其他后续过滤器使用。</p><figure><img src="http://47.101.155.205/image-20240816110532018.png" alt="image-20240816110532018" tabindex="0" loading="lazy"><figcaption>image-20240816110532018</figcaption></figure><h3 id="_7-7-websocketroutingfilter" tabindex="-1"><a class="header-anchor" href="#_7-7-websocketroutingfilter"><span>7.7.WebsocketRoutingFilter</span></a></h3><p>如果exchange的属性ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR值为ws或wss协议，该过滤器启用。使用Spring WebSocket发送请求到下游。</p><p>例如：lb:ws://serviceid配置在route中，则会触发该过滤器。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># SockJS route</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> websocket_sockjs_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">3001</span></span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=/websocket/info/<span class="token important">**</span></span>
<span class="line">      <span class="token comment"># Normal Websocket route</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> websocket_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> ws<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">3001</span></span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=/websocket/<span class="token important">**</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-8-gatewaymetricsfilter" tabindex="-1"><a class="header-anchor" href="#_7-8-gatewaymetricsfilter"><span>7.8.GatewayMetricsFilter</span></a></h3><p>GatewayMetricsFilter启用需要引入spring-boot-starter-actuator依赖。</p><div class="language-pom" data-highlighter="prismjs" data-ext="pom" data-title="pom"><pre><code><span class="line">&lt;dependency&gt;</span>
<span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span>
<span class="line">	&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span>
<span class="line">&lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>过滤器会添加名为spring.cloud.gateway.requests的计时器指标，有以下标签，</p><ol><li>routeId：route的id；</li><li>routeUri：API路由到的uri；</li><li>outcome：HttpStatus.Series，4XX或5XX等，表示一些了的状态码；</li><li>status：返回给客户端的请求的HTTP状态码；</li><li>httpStatusCode：返回给客户端的请求的HTTP状态码；</li><li>httpMethod：请求使用的请求方法GET、POST等；</li><li>path：请求的路径。</li></ol><p>spring.cloud.gateway.metrics.tags.path.enabled可以配置一些额外的监控标签。</p><p>查询这些指标，需要暴露端点metrics，同时这个过滤器有执行过，否则也是404.</p><figure><img src="http://47.101.155.205/image-20240816142737446.png" alt="image-20240816142737446" tabindex="0" loading="lazy"><figcaption>image-20240816142737446</figcaption></figure><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myRoute</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org/get</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get/<span class="token important">**</span></span>
<span class="line">      <span class="token key atrule">metrics</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>simple</span>
<span class="line"><span class="token key atrule">management</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">web</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">exposure</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&quot;metrics&quot;</span></span>
<span class="line">  <span class="token key atrule">metrics</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">export</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">prometheus</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-8-1-安装prometheus" tabindex="-1"><a class="header-anchor" href="#_7-8-1-安装prometheus"><span>7.8.1.安装prometheus</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 解压缩安装</span></span>
<span class="line"><span class="token function">tar</span> zvxf prometheus-2.53.0.linux-amd64.tar.gz</span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">cd</span> prometheus-2.53.0.linux-amd64</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 读取指定yml配置启动,以8090端口启动</span></span>
<span class="line">./prometheus <span class="token parameter variable">--config.file</span><span class="token operator">=</span>prometheus.yml --web.listen-address<span class="token operator">=</span>:8090</span>
<span class="line"></span>
<span class="line"><span class="token function">nohup</span> ./prometheus <span class="token parameter variable">--config.file</span><span class="token operator">=</span>prometheus.yml  <span class="token operator">&gt;</span> ./logs/prometheus.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置yaml文件，/actuator/metrics/spring.cloud.gateway.requests接口的数据prometheus不能解析。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">global</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s</span>
<span class="line">  <span class="token key atrule">evaluation_interval</span><span class="token punctuation">:</span> 15s</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">alerting</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token comment"># - alertmanager:9093</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">rule_files</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">&quot;prometheus&quot;</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;localhost:9090&quot;</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">&quot;spring-cloud-gateway-simple&quot;</span></span>
<span class="line">    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> <span class="token string">&quot;/actuator/prometheus&quot;</span> <span class="token comment"># 默认/metrics</span></span>
<span class="line">    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240816153742812.png" alt="image-20240816153742812" tabindex="0" loading="lazy"><figcaption>image-20240816153742812</figcaption></figure><h4 id="_7-8-2-安装grafana" tabindex="-1"><a class="header-anchor" href="#_7-8-2-安装grafana"><span>7.8.2.安装grafana</span></a></h4><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 解压缩安装安装</span></span>
<span class="line"><span class="token function">wget</span> https://dl.grafana.com/enterprise/release/grafana-enterprise-11.1.0.linux-amd64.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> grafana-enterprise-11.1.0.linux-amd64.tar.gz</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动</span></span>
<span class="line">./bin/grafana-server</span>
<span class="line"></span>
<span class="line"><span class="token comment"># http://localhost:3000 访问登录,默认admin/admin</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>json模板地址：https://docs.spring.io/spring-cloud-gateway/docs/3.1.0/reference/html/gateway-grafana-dashboard.json</p><div class="language-json" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span><span class="token property">&quot;__inputs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;DS_PROMETHEUS&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;prometheus&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;datasource&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;pluginId&quot;</span><span class="token operator">:</span><span class="token string">&quot;prometheus&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;pluginName&quot;</span><span class="token operator">:</span><span class="token string">&quot;Prometheus&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;__requires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;grafana&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;grafana&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Grafana&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;5.0.0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;panel&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;5.0.0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;datasource&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;prometheus&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Prometheus&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;5.0.0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;annotations&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;list&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;builtIn&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;-- Grafana --&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;enable&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;iconColor&quot;</span><span class="token operator">:</span><span class="token string">&quot;rgba(0, 211, 255, 1)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Annotations &amp; Alerts&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;dashboard&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;editable&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;gnetId&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;graphTooltip&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;iteration&quot;</span><span class="token operator">:</span><span class="token number">1550777954006</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;panels&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;collapsed&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token property">&quot;panels&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;cacheTimeout&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;colorBackground&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;colorValue&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;colors&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;rgba(245, 54, 54, 0.9)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;rgba(191, 148, 112, 0.89)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;rgba(50, 172, 45, 0.97)&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gauge&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;maxValue&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token property">&quot;minValue&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;thresholdLabels&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;thresholdMarkers&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;hideTimeOverride&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;mappingType&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;mappingTypes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;value to text&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;range to text&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;maxDataPoints&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;connected&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;nullText&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;postfix&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;postfixFontSize&quot;</span><span class="token operator">:</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;prefix&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;prefixFontSize&quot;</span><span class="token operator">:</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rangeMaps&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;N/A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;sparkline&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;fillColor&quot;</span><span class="token operator">:</span><span class="token string">&quot;rgba(31, 118, 189, 0.18)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;full&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;lineColor&quot;</span><span class="token operator">:</span><span class="token string">&quot;rgb(31, 120, 193)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;tableColumn&quot;</span><span class="token operator">:</span><span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;sum(spring_cloud_gateway_requests_seconds_count{job=~\&quot;$gatewayService\&quot;})&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">1200</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Total Requests Served&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;singlestat&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;valueFontSize&quot;</span><span class="token operator">:</span><span class="token string">&quot;80%&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;valueMaps&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;op&quot;</span><span class="token operator">:</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;N/A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;valueName&quot;</span><span class="token operator">:</span><span class="token string">&quot;current&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;cacheTimeout&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;colorBackground&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;colorValue&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;colors&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;rgba(245, 54, 54, 0.9)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;rgba(191, 148, 112, 0.89)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;rgba(50, 172, 45, 0.97)&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gauge&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;maxValue&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token property">&quot;minValue&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;thresholdLabels&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;thresholdMarkers&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;hideTimeOverride&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;mappingType&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;mappingTypes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;value to text&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;range to text&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;maxDataPoints&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;connected&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;nullText&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;postfix&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;postfixFontSize&quot;</span><span class="token operator">:</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;prefix&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;prefixFontSize&quot;</span><span class="token operator">:</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rangeMaps&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;N/A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;sparkline&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;fillColor&quot;</span><span class="token operator">:</span><span class="token string">&quot;rgba(31, 118, 189, 0.18)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;full&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;lineColor&quot;</span><span class="token operator">:</span><span class="token string">&quot;rgb(31, 120, 193)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;tableColumn&quot;</span><span class="token operator">:</span><span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;sum(spring_cloud_gateway_requests_seconds_count{outcome=\&quot;SUCCESSFUL\&quot;, job=~\&quot;$gatewayService\&quot;})&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">1200</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Total Successful Requests Served&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;singlestat&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;valueFontSize&quot;</span><span class="token operator">:</span><span class="token string">&quot;80%&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;valueMaps&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;op&quot;</span><span class="token operator">:</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;N/A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;valueName&quot;</span><span class="token operator">:</span><span class="token string">&quot;current&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;cacheTimeout&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;colorBackground&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;colorValue&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;colors&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;rgba(245, 54, 54, 0.9)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;rgba(191, 148, 112, 0.89)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;rgba(50, 172, 45, 0.97)&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gauge&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;maxValue&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token property">&quot;minValue&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;thresholdLabels&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;thresholdMarkers&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;hideTimeOverride&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;mappingType&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;mappingTypes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;value to text&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;range to text&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;maxDataPoints&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;connected&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;nullText&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;postfix&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;postfixFontSize&quot;</span><span class="token operator">:</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;prefix&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;prefixFontSize&quot;</span><span class="token operator">:</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rangeMaps&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;N/A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;sparkline&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;fillColor&quot;</span><span class="token operator">:</span><span class="token string">&quot;rgba(31, 118, 189, 0.18)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;full&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;lineColor&quot;</span><span class="token operator">:</span><span class="token string">&quot;rgb(31, 120, 193)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;tableColumn&quot;</span><span class="token operator">:</span><span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;sum(spring_cloud_gateway_requests_seconds_count{outcome!=\&quot;SUCCESSFUL\&quot;, job=~\&quot;$gatewayService\&quot;})&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">1200</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Total Unsuccessful Requests Served&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;singlestat&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;valueFontSize&quot;</span><span class="token operator">:</span><span class="token string">&quot;80%&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;valueMaps&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;op&quot;</span><span class="token operator">:</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;N/A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;valueName&quot;</span><span class="token operator">:</span><span class="token string">&quot;current&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Total Throughput&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;row&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;collapsed&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">,</span><span class="token property">&quot;panels&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token string">&quot;routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;ms-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;ms-test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_sum{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}/spring_cloud_gateway_requests_seconds_count{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ status }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;gateway_api_time_seconds_sum&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;repeatIteration&quot;</span><span class="token operator">:</span><span class="token number">1550777954005</span><span class="token punctuation">,</span><span class="token property">&quot;repeatPanelId&quot;</span><span class="token operator">:</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_sum{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}/spring_cloud_gateway_requests_seconds_count{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ status }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;gateway_api_time_seconds_sum&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;repeatIteration&quot;</span><span class="token operator">:</span><span class="token number">1550777954005</span><span class="token punctuation">,</span><span class="token property">&quot;repeatPanelId&quot;</span><span class="token operator">:</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-a3s&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-a3s&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_sum{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}/spring_cloud_gateway_requests_seconds_count{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ status }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;gateway_api_time_seconds_sum&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">72</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;repeatIteration&quot;</span><span class="token operator">:</span><span class="token number">1550777954005</span><span class="token punctuation">,</span><span class="token property">&quot;repeatPanelId&quot;</span><span class="token operator">:</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-sample&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-sample&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_sum{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}/spring_cloud_gateway_requests_seconds_count{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ status }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;gateway_api_time_seconds_sum&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Request Processing Time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;row&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;collapsed&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">,</span><span class="token property">&quot;panels&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;minSpan&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token string">&quot;routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;ms-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;ms-test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count{outcome=\&quot;SUCCESSFUL\&quot;, routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ job }} / {{ routeUri }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId Success API Gateway Calls&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;cumulative&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;transparent&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">73</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;minSpan&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;repeatIteration&quot;</span><span class="token operator">:</span><span class="token number">1550777954005</span><span class="token punctuation">,</span><span class="token property">&quot;repeatPanelId&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count{outcome=\&quot;SUCCESSFUL\&quot;, routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ job }} / {{ routeUri }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId Success API Gateway Calls&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;cumulative&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;transparent&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">74</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;minSpan&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;repeatIteration&quot;</span><span class="token operator">:</span><span class="token number">1550777954005</span><span class="token punctuation">,</span><span class="token property">&quot;repeatPanelId&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-a3s&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-a3s&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count{outcome=\&quot;SUCCESSFUL\&quot;, routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ job }} / {{ routeUri }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId Success API Gateway Calls&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;cumulative&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;transparent&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">75</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;minSpan&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;repeatIteration&quot;</span><span class="token operator">:</span><span class="token number">1550777954005</span><span class="token punctuation">,</span><span class="token property">&quot;repeatPanelId&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-sample&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-sample&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count{outcome=\&quot;SUCCESSFUL\&quot;, routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ job }} / {{ routeUri }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId Success API Gateway Calls&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;cumulative&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;transparent&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Successful API Calls&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;row&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;collapsed&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">53</span><span class="token punctuation">,</span><span class="token property">&quot;panels&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token string">&quot;routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count{outcome!=\&quot;SUCCESSFUL\&quot;, routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ job }} / {{ routeUri }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId Unsuccessful GW Calls&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;cumulative&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Unsuccessful API Calls&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;row&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;collapsed&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">54</span><span class="token punctuation">,</span><span class="token property">&quot;panels&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token string">&quot;routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;ms-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;ms-test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;sum(spring_cloud_gateway_requests_seconds_count{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}) by (job, status)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ job }} / {{ status }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;repeatIteration&quot;</span><span class="token operator">:</span><span class="token number">1550775166360</span><span class="token punctuation">,</span><span class="token property">&quot;repeatPanelId&quot;</span><span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;sum(spring_cloud_gateway_requests_seconds_count{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}) by (job, status)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ job }} / {{ status }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;repeatIteration&quot;</span><span class="token operator">:</span><span class="token number">1550775166360</span><span class="token punctuation">,</span><span class="token property">&quot;repeatPanelId&quot;</span><span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-a3s&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-a3s&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;sum(spring_cloud_gateway_requests_seconds_count{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}) by (job, status)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ job }} / {{ status }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;repeatIteration&quot;</span><span class="token operator">:</span><span class="token number">1550775166360</span><span class="token punctuation">,</span><span class="token property">&quot;repeatPanelId&quot;</span><span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token property">&quot;scopedVars&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;routeId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;selected&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-sample&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;msnext-sample&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;sum(spring_cloud_gateway_requests_seconds_count{routeId=~\&quot;$routeId\&quot;, job=~\&quot;$gatewayService\&quot;}) by (job, status)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ job }} / {{ status }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;metric&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring_cloud_gateway_requests_seconds_count&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;step&quot;</span><span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;$routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;API / HTTP Status&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;row&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;collapsed&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token property">&quot;panels&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;JVM&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;row&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;process_cpu_usage{job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ instance }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;CPU Usage&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">69</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;sum(jvm_memory_used_bytes{job=~\&quot;$gatewayService\&quot;}) by (job, instance)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;interval&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ instance }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Memory Used&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">77</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;jvm_threads_live_threads{job=~\&quot;$gatewayService\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ instance }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Live Threads&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;alert&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;conditions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;evaluator&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0.3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gt&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;operator&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;and&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;5m&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;now&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;reducer&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;avg&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;executionErrorState&quot;</span><span class="token operator">:</span><span class="token string">&quot;alerting&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;frequency&quot;</span><span class="token operator">:</span><span class="token string">&quot;60s&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;handler&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Memory Saturation alert&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;noDataState&quot;</span><span class="token operator">:</span><span class="token string">&quot;no_data&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;notifications&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;aliasColors&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;bars&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;dashLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;dashes&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;gridPos&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">79</span><span class="token punctuation">,</span><span class="token property">&quot;legend&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;avg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;total&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;lines&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;linewidth&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;links&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;nullPointMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;percentage&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;pointradius&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;points&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span><span class="token string">&quot;flot&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;seriesOverrides&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;spaceLength&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;stack&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;steppedLine&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;targets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;expr&quot;</span><span class="token operator">:</span><span class="token string">&quot;jvm_gc_memory_promoted_bytes_total/jvm_gc_memory_allocated_bytes_total&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;time_series&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;intervalFactor&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;legendFormat&quot;</span><span class="token operator">:</span><span class="token string">&quot;{{ instance }}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refId&quot;</span><span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;thresholds&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;colorMode&quot;</span><span class="token operator">:</span><span class="token string">&quot;critical&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fill&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;line&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;op&quot;</span><span class="token operator">:</span><span class="token string">&quot;gt&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token number">0.3</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;timeFrom&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;timeShift&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Memory Saturation&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tooltip&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;shared&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;value_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;individual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;graph&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;values&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;yaxes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;format&quot;</span><span class="token operator">:</span><span class="token string">&quot;short&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;logBase&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;show&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;refresh&quot;</span><span class="token operator">:</span><span class="token string">&quot;1m&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;schemaVersion&quot;</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token property">&quot;style&quot;</span><span class="token operator">:</span><span class="token string">&quot;dark&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tags&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;templating&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;list&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;allValue&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;includeAll&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Gateway Service&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;multi&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;gatewayService&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;options&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;label_values(spring_cloud_gateway_requests_seconds_count,job)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refresh&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;regex&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;tagValuesQuery&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tags&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;tagsQuery&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;useTags&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;allValue&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">&quot;current&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;datasource&quot;</span><span class="token operator">:</span><span class="token string">&quot;${DS_PROMETHEUS}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;hide&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;includeAll&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Route Id&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;multi&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;routeId&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;options&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;label_values(spring_cloud_gateway_requests_seconds_count,routeId)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;refresh&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;regex&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;tagValuesQuery&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tags&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;tagsQuery&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;useTags&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;time&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;now/d&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;now&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;timepicker&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;refresh_intervals&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;5s&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;10s&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;30s&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1m&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;5m&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;15m&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;30m&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1h&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2h&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1d&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;time_options&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;5m&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;15m&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1h&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;6h&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;12h&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;24h&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;7d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;30d&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;timezone&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Spring Cloud Gateway&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7voUGKrik&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240816154008774.png" alt="image-20240816154008774" tabindex="0" loading="lazy"><figcaption>image-20240816154008774</figcaption></figure><h3 id="_7-9-marking-an-exchange-as-routed" tabindex="-1"><a class="header-anchor" href="#_7-9-marking-an-exchange-as-routed"><span>7.9.Marking An Exchange As Routed</span></a></h3><p>标记请求已被route，如果请求已经被route，则exchange中有属性gatewayAlreadyRouted的值为true。一但请求被标记为已路由，则其他的route过滤器不会再路由它。</p><p>ServerWebExchangeUtils.isAlreadyRouted(exchange)，校验exchange是否被route。</p><p>ServerWebExchangeUtils.setAlreadyRouted(exchange)，标记exchange已被route。</p><h2 id="_8-httpheadersfilters" tabindex="-1"><a class="header-anchor" href="#_8-httpheadersfilters"><span>8.HttpHeadersFilters</span></a></h2><p>HttpHeadersFilters过滤器在gateway转发请求前执行，例如：NettyRoutingFilter。</p><h3 id="_8-1-forwardedheadersfilter" tabindex="-1"><a class="header-anchor" href="#_8-1-forwardedheadersfilter"><span>8.1.ForwardedHeadersFilter</span></a></h3><p>http://[0:0:0:0:0:0:0:1]:8080/info发起ipv6的请求</p><p>请求头不存在Forwarded的key，则创建这样一个头，里面的值有请求头的Host，请求的协议，客户端的ip和端口。如下图格式。</p><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getScheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取请求的协议</span></span>
<span class="line"><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取请求头host的第一个value</span></span>
<span class="line"><span class="token comment">// 获取客户端</span></span>
<span class="line">request<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ipv4则是客户端的ipv4地址</span></span>
<span class="line">request<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//远程客户端的端口号</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240816164311608.png" alt="image-20240816164311608" tabindex="0" loading="lazy"><figcaption>image-20240816164311608</figcaption></figure><h3 id="_8-2-removehopbyhopheadersfilter" tabindex="-1"><a class="header-anchor" href="#_8-2-removehopbyhopheadersfilter"><span>8.2.RemoveHopByHopHeadersFilter</span></a></h3><p>从接收的请求头移除一些key，同时接收的响应头中也会移除这些请求头的key，spring.cloud.gateway.filter.remove-hop-by-hop.headers可以配置移除的key。</p><figure><img src="http://47.101.155.205/image-20240816170721760.png" alt="image-20240816170721760" tabindex="0" loading="lazy"><figcaption>image-20240816170721760</figcaption></figure><figure><img src="http://47.101.155.205/image-20240816171749041.png" alt="image-20240816171749041" tabindex="0" loading="lazy"><figcaption>image-20240816171749041</figcaption></figure><figure><img src="http://47.101.155.205/image-20240816171813317.png" alt="image-20240816171813317" tabindex="0" loading="lazy"><figcaption>image-20240816171813317</figcaption></figure><h3 id="_8-3-xforwardedheadersfilter" tabindex="-1"><a class="header-anchor" href="#_8-3-xforwardedheadersfilter"><span>8.3.XForwardedHeadersFilter</span></a></h3><p>过滤器已经执行，共添加了4个请求头，实际只有一个请求头(是因为这里测试地址没有返回这个地址)。</p><ol><li>X-Forwarded-For：远程客户端的ip地址(可以是IPv4或IPv6)；</li><li>X-Forwarded-Host：到gateway请求域名(ip)+端口(http和https默认端口不显示)</li><li>X-Forwarded-Port：到gateway请求的端口号；</li><li>X-Forwarded-Proto：到gateway获取请求的协议；</li></ol><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 通过到web的Controller</span></span>
<span class="line"><span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headerNames <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeaderNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">while</span> <span class="token punctuation">(</span>headerNames<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token class-name">String</span> key <span class="token operator">=</span> headerNames<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">content<span class="token operator">-</span>length<span class="token operator">:</span> <span class="token number">303</span></span>
<span class="line"><span class="token class-name">Accept</span><span class="token operator">:</span> <span class="token operator">*</span><span class="token comment">/*</span>
<span class="line">User-Agent: PostmanRuntime/7.41.1</span>
<span class="line">Forwarded: proto=http;host=&quot;192.168.8.8:8080&quot;;for=&quot;192.168.8.8:59116&quot;</span>
<span class="line">X-Forwarded-Proto: http</span>
<span class="line">X-Forwarded-Host: 192.168.8.8:8080</span>
<span class="line">host: 192.168.8.8:9041</span>
<span class="line">X-Forwarded-For: 192.168.8.8</span>
<span class="line">Postman-Token: aaf82bc0-e59b-478d-988d-c00d88585d0b</span>
<span class="line">Accept-Encoding: gzip, deflate, br</span>
<span class="line">X-Forwarded-Port: 8080</span>
<span class="line">Content-Type: application/json</span>
<span class="line"></span>
<span class="line">// 请求地址为IPv6</span>
<span class="line">content-length: 303</span>
<span class="line">Accept: */</span><span class="token operator">*</span></span>
<span class="line"><span class="token class-name">User</span><span class="token operator">-</span><span class="token class-name">Agent</span><span class="token operator">:</span> <span class="token class-name">PostmanRuntime</span><span class="token operator">/</span><span class="token number">7.41</span><span class="token number">.1</span></span>
<span class="line"><span class="token class-name">Forwarded</span><span class="token operator">:</span> proto<span class="token operator">=</span>http<span class="token punctuation">;</span>host<span class="token operator">=</span><span class="token string">&quot;[fe80::410c:f0df:b0e:cb5b%6]:8080&quot;</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;[fe80:0:0:0:410c:f0df:b0e:cb5b%6]:59626&quot;</span></span>
<span class="line"><span class="token class-name">X</span><span class="token operator">-</span><span class="token class-name">Forwarded</span><span class="token operator">-</span><span class="token class-name">Proto</span><span class="token operator">:</span> http</span>
<span class="line"><span class="token class-name">X</span><span class="token operator">-</span><span class="token class-name">Forwarded</span><span class="token operator">-</span><span class="token class-name">Host</span><span class="token operator">:</span> <span class="token punctuation">[</span>fe80<span class="token operator">::</span><span class="token number">410</span>c<span class="token operator">:</span>f0df<span class="token operator">:</span>b0e<span class="token operator">:</span>cb5b<span class="token operator">%</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token number">8080</span></span>
<span class="line">host<span class="token operator">:</span> <span class="token number">192.168</span><span class="token number">.8</span><span class="token number">.8</span><span class="token operator">:</span><span class="token number">9041</span></span>
<span class="line"><span class="token class-name">X</span><span class="token operator">-</span><span class="token class-name">Forwarded</span><span class="token operator">-</span><span class="token class-name">For</span><span class="token operator">:</span> fe80<span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">410</span>c<span class="token operator">:</span>f0df<span class="token operator">:</span>b0e<span class="token operator">:</span>cb5b<span class="token operator">%</span><span class="token number">6</span></span>
<span class="line"><span class="token class-name">Postman</span><span class="token operator">-</span><span class="token class-name">Token</span><span class="token operator">:</span> f71e291e<span class="token operator">-</span><span class="token number">8528</span><span class="token operator">-</span><span class="token number">42d</span><span class="token number">6</span><span class="token operator">-</span><span class="token number">9d</span><span class="token number">70</span><span class="token operator">-</span><span class="token number">51e4</span>ba5cd6ac</span>
<span class="line"><span class="token class-name">Accept</span><span class="token operator">-</span><span class="token class-name">Encoding</span><span class="token operator">:</span> gzip<span class="token punctuation">,</span> deflate<span class="token punctuation">,</span> br</span>
<span class="line"><span class="token class-name">X</span><span class="token operator">-</span><span class="token class-name">Forwarded</span><span class="token operator">-</span><span class="token class-name">Port</span><span class="token operator">:</span> <span class="token number">8080</span></span>
<span class="line"><span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Type</span><span class="token operator">:</span> application<span class="token operator">/</span>json</span>
<span class="line">    </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240819130310522.png" alt="image-20240819130310522" tabindex="0" loading="lazy"><figcaption>image-20240819130310522</figcaption></figure><figure><img src="http://47.101.155.205/image-20240819125301054.png" alt="image-20240819125301054" tabindex="0" loading="lazy"><figcaption>image-20240819125301054</figcaption></figure><figure><img src="http://47.101.155.205/image-20240819125210435.png" alt="image-20240819125210435" tabindex="0" loading="lazy"><figcaption>image-20240819125210435</figcaption></figure><h2 id="_9-tls和ssl" tabindex="-1"><a class="header-anchor" href="#_9-tls和ssl"><span>9.TLS和SSL</span></a></h2><p>支持处理https请求协议。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 生成keysotre文件</span></span>
<span class="line"><span class="token comment"># -alias gateway 对应springboot配置server.ssl.key-alias</span></span>
<span class="line"><span class="token comment"># -storetype PKCS12 对应springboot配置server.ssl.key-sore-type</span></span>
<span class="line"><span class="token comment"># -keystore keystore.p12(文件名) 对应springboot配置server.ssl.key-sore(文件路径)</span></span>
<span class="line">keytool <span class="token parameter variable">-genkeypair</span> <span class="token parameter variable">-alias</span> gateway <span class="token parameter variable">-keyalg</span> RSA <span class="token parameter variable">-keysize</span> <span class="token number">2048</span> <span class="token parameter variable">-storetype</span> PKCS12 <span class="token parameter variable">-keystore</span> keystore.p12 <span class="token parameter variable">-validity</span> <span class="token number">3650</span></span>
<span class="line"><span class="token comment"># 密码窗口输入 对应springboot配置server.ssl.key-sore-password</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">ssl</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">key-alias</span><span class="token punctuation">:</span> gateway</span>
<span class="line">    <span class="token key atrule">key-store-password</span><span class="token punctuation">:</span> oycm12</span>
<span class="line">    <span class="token key atrule">key-store</span><span class="token punctuation">:</span> keystore.p12</span>
<span class="line">    <span class="token key atrule">key-store-type</span><span class="token punctuation">:</span> PKCS12</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>支持路由到http/https下游，路由到https，以下配置表示信任下游所有证书。</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">ssl</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">useInsecureTrustManager</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="_9-1-tls连接" tabindex="-1"><a class="header-anchor" href="#_9-1-tls连接"><span>9.1.TLS连接</span></a></h3><p>配置HTTPS连接时间</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">ssl</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">handshake-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">10000</span></span>
<span class="line">          <span class="token key atrule">close-notify-flush-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">3000</span></span>
<span class="line">          <span class="token key atrule">close-notify-read-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="_10-配置" tabindex="-1"><a class="header-anchor" href="#_10-配置"><span>10.配置</span></a></h2><p>Spring Cloud Gateway的配置有RouteDefinition对象集合驱动。</p><p>默认情况，PropertiesRouteDefinitionLocator加载配置通过SpringBoot的@ConfigurationProperties注解机制。</p><p>一般情况下，使用配置文件路由请求是足够的，也可以使用外部数据源加载路由，例如数据库，后续将支持Redis、MongoDB和Cassandra作为数据源，基于RouteDefinitionLocator实现。RedisRouteDefinitionRepository</p><h3 id="_10-1-路由指标" tabindex="-1"><a class="header-anchor" href="#_10-1-路由指标"><span>10.1.路由指标</span></a></h3><p>添加spring-boot-starter-actuator依赖之后，监控指标默认启动。</p><p>默认spring.cloud.gateway.metrics.enabled=true。</p><p>/actuator/metrics/spring.cloud.gateway.routes.count查询</p><figure><img src="http://47.101.155.205/image-20240821171320036.png" alt="image-20240821171320036" tabindex="0" loading="lazy"><figcaption>image-20240821171320036</figcaption></figure><h2 id="_11-路由元数据配置" tabindex="-1"><a class="header-anchor" href="#_11-路由元数据配置"><span>11.路由元数据配置</span></a></h2><p>每个路由配置额外参数。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> route_with_metadata</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org/get</span>
<span class="line">          <span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">optionName</span><span class="token punctuation">:</span> <span class="token string">&quot;OptionValue&quot;</span></span>
<span class="line">            <span class="token key atrule">compositeObject</span><span class="token punctuation">:</span></span>
<span class="line">              <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;value&quot;</span></span>
<span class="line">            <span class="token key atrule">iAmNumber</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> </span>
<span class="line">            <span class="token punctuation">-</span> Path=/get/<span class="token important">**</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Route</span> route <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchangeUtils</span><span class="token punctuation">.</span><span class="token constant">GATEWAY_ROUTE_ATTR</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 获取所有的原数据key=value</span></span>
<span class="line">log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 获取指定名称的原数据key的value</span></span>
<span class="line">log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;optionName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240821172140235.png" alt="image-20240821172140235" tabindex="0" loading="lazy"><figcaption>image-20240821172140235</figcaption></figure><h2 id="_12-http超时配置" tabindex="-1"><a class="header-anchor" href="#_12-http超时配置"><span>12.Http超时配置</span></a></h2><p>可以为所有的路由或特定的路由配置http超时时间(连接和响应)。</p><h3 id="_12-1-全局配置" tabindex="-1"><a class="header-anchor" href="#_12-1-全局配置"><span>12.1.全局配置</span></a></h3><p>connect-timeout配置时间单位为毫秒；</p><p>response-timeout配置时间遵循java.time.Duration格式，携带单位；</p><div class="language-yaml" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">connect-timeout</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">        <span class="token key atrule">response-timeout</span><span class="token punctuation">:</span> 5s</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="_12-2-每个路由配置" tabindex="-1"><a class="header-anchor" href="#_12-2-每个路由配置"><span>12.2.每个路由配置</span></a></h3><p>response-timeout、connect-timeout时间配置为毫秒单位，配置为负值表示禁用全局的配置。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> route_with_metadata</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org/</span>
<span class="line">          <span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">optionName</span><span class="token punctuation">:</span> <span class="token string">&quot;OptionValue&quot;</span></span>
<span class="line">            <span class="token key atrule">compositeObject</span><span class="token punctuation">:</span></span>
<span class="line">              <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;value&quot;</span></span>
<span class="line">            <span class="token key atrule">iAmNumber</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">            <span class="token key atrule">response-timeout</span><span class="token punctuation">:</span> <span class="token number">1000</span></span>
<span class="line">            <span class="token key atrule">connect-timeout</span><span class="token punctuation">:</span> <span class="token number">2000</span></span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/delay/<span class="token important">**</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码配置格式</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">RouteMetadataUtils</span><span class="token punctuation">.</span><span class="token static">CONNECT_TIMEOUT_ATTR</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">RouteMetadataUtils</span><span class="token punctuation">.</span><span class="token static">RESPONSE_TIMEOUT_ATTR</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token annotation punctuation">@Bean</span></span>
<span class="line">      <span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">customRouteLocator</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> routeBuilder<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">         <span class="token keyword">return</span> routeBuilder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">,</span> r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;*.somehost.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/somepath&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">addRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;header1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;header-value-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://someuri&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token constant">RESPONSE_TIMEOUT_ATTR</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token constant">CONNECT_TIMEOUT_ATTR</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">               <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">               <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-3-流式编程" tabindex="-1"><a class="header-anchor" href="#_12-3-流式编程"><span>12.3.流式编程</span></a></h3><p>支持and、or、negate操作。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">customRouteLocator</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">,</span> <span class="token class-name">ThrottleGatewayFilterFactory</span> throttle<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;**.abc.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/image/png&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span></span>
<span class="line">                        f<span class="token punctuation">.</span><span class="token function">addResponseHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-TestHeader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foobar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org:80&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/image/webp&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span></span>
<span class="line">                        f<span class="token punctuation">.</span><span class="token function">addResponseHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-AnotherHeader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org:80&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;**.throttle.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>throttle<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">                        <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">                        <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">                        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org:80&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-4-结合discoveryclient转发请求" tabindex="-1"><a class="header-anchor" href="#_12-4-结合discoveryclient转发请求"><span>12.4.结合DiscoveryClient转发请求</span></a></h3><p>spring.cloud.gateway.discovery.locator.enabled=true</p><p>classpath中引入DiscoveryClient的实现依赖，例如Netflix Eureka、Consul、Zookeeper。</p><p>gateway会根据发现的客户端自动定义predicate和过滤器来route请求。默认使用/serviceId/**断言请求，serviceId来自DiscoveryClient的服务id。</p><p>过滤器默认是RewritePath过滤器，/serviceId/?(?&lt;remaining&gt;.*)，替换成/${remaining}，serviceId会在发送到下游请求之前从服务端剥离。</p><h4 id="_12-4-1-eureka" tabindex="-1"><a class="header-anchor" href="#_12-4-1-eureka"><span>12.4.1.eureka</span></a></h4><div class="language-pom" data-highlighter="prismjs" data-ext="pom" data-title="pom"><pre><code><span class="line">&lt;dependency&gt;</span>
<span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span>
<span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span>
<span class="line">&lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> route_with_metadata</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org/</span>
<span class="line">          <span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">optionName</span><span class="token punctuation">:</span> <span class="token string">&quot;OptionValue&quot;</span></span>
<span class="line">            <span class="token key atrule">compositeObject</span><span class="token punctuation">:</span></span>
<span class="line">              <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;value&quot;</span></span>
<span class="line">            <span class="token key atrule">iAmNumber</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">            <span class="token key atrule">response-timeout</span><span class="token punctuation">:</span> <span class="token number">-1</span></span>
<span class="line">            <span class="token key atrule">connect-timeout</span><span class="token punctuation">:</span> <span class="token number">3000</span></span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/delay/<span class="token important">**</span></span>
<span class="line">      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">locator</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 开启基于发现客户端的route注册功能</span></span>
<span class="line">          <span class="token key atrule">lower-case-service-id</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 将服务id全部小写</span></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//192.168.125.224<span class="token punctuation">:</span>8761/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//192.168.125.225<span class="token punctuation">:</span>8761/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//192.168.125.226<span class="token punctuation">:</span>8761/eureka/</span>
<span class="line"><span class="token key atrule">logging</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">level</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">root</span><span class="token punctuation">:</span> info</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240822101533020.png" alt="image-20240822101533020" tabindex="0" loading="lazy"><figcaption>image-20240822101533020</figcaption></figure><p>在原有的Path断言和RewritePath过滤器中再添加过滤器。要按格式才能注册成功。</p><p>下面predicate断言新增Host要求，增加断路器的过滤器(转发到本地接口)。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line">spring.cloud.gateway.discovery.locator.predicates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.name<span class="token punctuation">:</span> Path</span>
<span class="line">spring.cloud.gateway.discovery.locator.predicates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>pattern<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;/&#39;+serviceId+&#39;/**&#39;&quot;</span></span>
<span class="line">spring.cloud.gateway.discovery.locator.predicates<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.name<span class="token punctuation">:</span> Host</span>
<span class="line">spring.cloud.gateway.discovery.locator.predicates<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>pattern<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;**.foo.com&#39;&quot;</span></span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.name<span class="token punctuation">:</span> CircuitBreaker</span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">:</span> serviceId</span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>fallbackUri<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;forward:/demo/&#39;+serviceId&quot;</span></span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.name<span class="token punctuation">:</span> RewritePath</span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>regexp<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;/&#39; + serviceId + &#39;/?(?&lt;remaining&gt;.*)&#39;&quot;</span></span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>replacement<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;/${remaining}&#39;&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240822112901286.png" alt="image-20240822112901286" tabindex="0" loading="lazy"><figcaption>image-20240822112901286</figcaption></figure><figure><img src="http://47.101.155.205/image-20240822112926427.png" alt="image-20240822112926427" tabindex="0" loading="lazy"><figcaption>image-20240822112926427</figcaption></figure><h2 id="_13-netty请求日志" tabindex="-1"><a class="header-anchor" href="#_13-netty请求日志"><span>13.netty请求日志</span></a></h2><p>配置系统参数-Dreactor.netty.http.server.accessLogEnabled=true(java启动参数)</p><h3 id="_13-1-log-xml日志结果说明" tabindex="-1"><a class="header-anchor" href="#_13-1-log-xml日志结果说明"><span>13.1.log.xml日志结果说明</span></a></h3><p>logger-日志记录器名称是log创建指定的类名？</p><p>rollingPolicy-是否只能出现在相关的appender的标签块中？</p><p>log.xml配置标签块：</p><ol><li>property：定义属性，文件中全局使用；</li><li>appender：日志输出目标：ConsoleAppender、FileAppender、RollingFileAppender、AsyncAppender等，每个Appender需要通过appender标签定义，并在root或logger中通过appender-ref引用；</li><li>rollingPolicy ：控制日志文件的滚动策略，如按时间、按文件大小； <ol><li>ch.qos.logback.core.rolling.TimeBasedRollingPolicy；</li><li>ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy；</li></ol></li><li>pattern：定义日志的输出格式； <ol><li>%d{日期格式}：打印时间；</li><li>%thread：线程名称；</li><li>%num1.num2t：线程名称的最长长度是num2，长度不足num1长度，前面补空格；</li><li>%-num1.num2t：线程名称的最长长度是num2，长度不足num1长度，后面补空格；</li><li>%level：日志级别，%-5level不够5个字符，后面空格结束；</li><li>%msg：日志消息；</li><li>%n：换行符；</li><li>%logger{length}：日志记录器名称，length限制长度；</li><li>%class：日志记录器名称(全路径名称)；</li><li>%file：触发日志的源文件名；</li><li>%M：触发日志的代码方法名；</li><li>%L：触发日志的源文件行号；</li><li>%line：触发日志的源文件行号；</li><li>${PID}：获取程序的pid；</li><li>%X{traceId}：结合spring-cloud-starter-sleuth使用；</li><li>%X{spanId}：结合spring-cloud-starter-sleuth使用；</li><li>%clr(日志内容) [{magenta}]：定义日志内容的颜色，%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint}</li></ol></li><li>logger：指定特定包或类的日志级别和输出目标； <ol><li>name：控制包或类；</li><li>level：控制日志级别；</li><li>additivity：默认true，会将该logger的记录传递到父级Logger，false则不会；，例如其中一个logger1(假如配置包为com.org.controller)指向一个输出至指定文件，如果不继承，则如果有另一个logger(com.org)则这个日志只会输出至logger1的位置，继承则会logger1使用其配置输出，在logger以其配置输出；</li><li>appender-ref：指向输出目标，appender的name；</li></ol></li><li>日志级别：TRACE、DEBUG、INFO、WARN、ERROR由低到高，设置日志级别意味着低于此级别的日志不会输出，例如设置为WARN，INFO级别的日志不会输出；</li></ol><h3 id="_13-2-asyncappender用法" tabindex="-1"><a class="header-anchor" href="#_13-2-asyncappender用法"><span>13.2.AsyncAppender用法</span></a></h3><p>日志在控制台打印，且异步输出至file。</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span> <span class="token attr-name">status</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!-- 配置输出日志到控制台 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CONSOLE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%date{yyyy-MM-dd HH:mm:ss} [%-5level] [%thread] [%logger{36}.%M.%L]: %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!-- 配置输出日志到File,使用时间滚动策略 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FILE_TIME<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 日志文件的名称模式 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>logs/logFile.%d{yyyy-MM-dd}.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 启动是否清理过期日志,过期日志根据maxHistory最大文件数 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cleanHistoryOnStart</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cleanHistoryOnStart</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 30个最大文件 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 日志输出格式 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{HH:mm:ss.SSS}[%X{traceId},%X{spanId}] [%-5level] [%thread] %logger{36} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 此处设置字符集 --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!-- 配置输出日志到File,使用大小和时间策略 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FILE_SIZE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!-- 当前日志文件的名称 --&gt;</span></span>
<span class="line">        <span class="token comment">&lt;!--&lt;file&gt;logs/logFile.log&lt;/file&gt;--&gt;</span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 日志文件的名称模式 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>logs/logFile.%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 单个日志文件的最大大小 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 保留的最大历史文件数 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 最大日志存储总量 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalSizeCap</span><span class="token punctuation">&gt;</span></span>3GB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalSizeCap</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token comment">&lt;!-- 日志输出格式 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{HH:mm:ss.SSS}[%X{traceId},%X{spanId}] [%-5level] [%thread] %logger{36} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 此处设置字符集 --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!-- 配置AsyncAppender,异步输出日志到FILE配置 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ASYNC<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.classic.AsyncAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FILE_TIME<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!-- 存储日志事件的队列的大小,默认256 --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queueSize</span><span class="token punctuation">&gt;</span></span>512<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>queueSize</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!-- 0表示满时清理低优先级队列日志(在队列中怎么判断日志的优先级?),其他正值表示表示超过多少%开始清理,默认值时queueSize/5 --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discardingThreshold</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discardingThreshold</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!--默认false,队列满会阻塞调用线程,true则不会--&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>neverBlock</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>neverBlock</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!--控制台--&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CONSOLE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!--异步实际滚动日志输出--&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ASYNC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!--时间+文件大小滚动--&gt;</span></span>
<span class="line">        <span class="token comment">&lt;!--&lt;appender-ref ref=&quot;FILE_SIZE&quot;/&gt;--&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_14-cors跨域配置" tabindex="-1"><a class="header-anchor" href="#_14-cors跨域配置"><span>14.CORS跨域配置</span></a></h2><h3 id="_14-1-全局cors配置" tabindex="-1"><a class="header-anchor" href="#_14-1-全局cors配置"><span>14.1.全局CORS配置</span></a></h3><p>以下配置允许跨域源头来自docs.spring.io的所有get请求。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">cors-configurations</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">&#39;[/**]&#39;</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token string">&quot;https://docs.spring.io&quot;</span></span>
<span class="line">            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> GET</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置<code>spring.cloud.gateway.globalcors.add-to-simple-url-handler-mapping</code>为true(默认false)，false：只有gateway路由处理的请求才允许跨域；true：gateway所有的请求配置都应用跨域规则。</p><h3 id="_14-2-局部cors配置" tabindex="-1"><a class="header-anchor" href="#_14-2-局部cors配置"><span>14.2.局部CORS配置</span></a></h3><p>基于路由的跨域配置</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> custom_route</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/api/<span class="token important">**</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;CorsResponseHeader&quot;</span></span>
<span class="line">              <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token string">&quot;http://example.com&quot;</span></span>
<span class="line">                <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span> <span class="token string">&quot;GET,POST&quot;</span></span>
<span class="line">                <span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span></span>
<span class="line">                <span class="token key atrule">allowCredentials</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-3-spring-webflux" tabindex="-1"><a class="header-anchor" href="#_14-3-spring-webflux"><span>14.3.Spring WebFlux</span></a></h3><p>通过注入CorsWebFilter过滤器实现解决跨域，gateway所有的请求都会配置。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springcloudgatewaysimple<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>cors<span class="token punctuation">.</span></span><span class="token class-name">CorsConfiguration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>cors<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">CorsWebFilter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>cors<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">UrlBasedCorsConfigurationSource</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token keyword">@author</span> ouyangcm</span>
<span class="line"> * create 2024/8/23 11:28</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CorsConfig</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">CorsWebFilter</span> <span class="token function">corsWebFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">CorsConfiguration</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorsConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        config<span class="token punctuation">.</span><span class="token function">addAllowedOrigin</span><span class="token punctuation">(</span><span class="token string">&quot;http://example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        config<span class="token punctuation">.</span><span class="token function">addAllowedHeader</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        config<span class="token punctuation">.</span><span class="token function">setAllowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">UrlBasedCorsConfigurationSource</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlBasedCorsConfigurationSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        source<span class="token punctuation">.</span><span class="token function">registerCorsConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CorsWebFilter</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-4-自定义过滤器工厂处理跨域" tabindex="-1"><a class="header-anchor" href="#_14-4-自定义过滤器工厂处理跨域"><span>14.4.自定义过滤器工厂处理跨域</span></a></h3><p>{FilterName}GatewayFilterFactory继承了AbstractGatewayFilterFactory，往容器中注入了该过滤器，过滤器要生效，需要在路由中应用过滤器。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springcloudgatewaysimple<span class="token punctuation">.</span>filter</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">AbstractGatewayFilterFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHeaders</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpMethod</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpRequest</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpResponse</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token keyword">@author</span> ouyangcm</span>
<span class="line"> * create 2024/8/23 13:12</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomCorsFilterGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CustomCorsFilterGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">CustomCorsFilterGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 处理预检请求</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">OPTIONS</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">ACCESS_CONTROL_ALLOW_ORIGIN</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">ACCESS_CONTROL_ALLOW_METHODS</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">getAllowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">ACCESS_CONTROL_ALLOW_HEADERS</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">getAllowedHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 浏览器是(true)否允许跨域请求携带凭证信息</span></span>
<span class="line">                response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">ACCESS_CONTROL_ALLOW_CREDENTIALS</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">getAllowCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                response<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 处理非预检请求</span></span>
<span class="line">            response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">ACCESS_CONTROL_ALLOW_ORIGIN</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">ACCESS_CONTROL_ALLOW_METHODS</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">getAllowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">ACCESS_CONTROL_ALLOW_HEADERS</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">getAllowedHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">ACCESS_CONTROL_ALLOW_CREDENTIALS</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">getAllowCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">private</span> <span class="token class-name">String</span> allowedOrigin <span class="token operator">=</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">private</span> <span class="token class-name">String</span> allowedMethods <span class="token operator">=</span> <span class="token string">&quot;GET, POST, PUT, DELETE, OPTIONS&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">private</span> <span class="token class-name">String</span> allowedHeaders <span class="token operator">=</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">private</span> <span class="token class-name">String</span> allowCredentials <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// Getters and Setters for these fields</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAllowedOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> allowedOrigin<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAllowedOrigin</span><span class="token punctuation">(</span><span class="token class-name">String</span> allowedOrigin<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>allowedOrigin <span class="token operator">=</span> allowedOrigin<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAllowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> allowedMethods<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAllowedMethods</span><span class="token punctuation">(</span><span class="token class-name">String</span> allowedMethods<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>allowedMethods <span class="token operator">=</span> allowedMethods<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAllowedHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> allowedHeaders<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAllowedHeaders</span><span class="token punctuation">(</span><span class="token class-name">String</span> allowedHeaders<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>allowedHeaders <span class="token operator">=</span> allowedHeaders<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAllowCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> allowCredentials<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAllowCredentials</span><span class="token punctuation">(</span><span class="token class-name">String</span> allowCredentials<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>allowCredentials <span class="token operator">=</span> allowCredentials<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> route_with_metadata</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org/</span>
<span class="line">          <span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">optionName</span><span class="token punctuation">:</span> <span class="token string">&quot;OptionValue&quot;</span></span>
<span class="line">            <span class="token key atrule">compositeObject</span><span class="token punctuation">:</span></span>
<span class="line">              <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;value&quot;</span></span>
<span class="line">            <span class="token key atrule">iAmNumber</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">            <span class="token key atrule">response-timeout</span><span class="token punctuation">:</span> <span class="token number">-1</span></span>
<span class="line">            <span class="token key atrule">connect-timeout</span><span class="token punctuation">:</span> <span class="token number">3000</span></span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/delay/<span class="token important">**</span></span>
<span class="line">      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">locator</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">          <span class="token key atrule">lower-case-service-id</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">      <span class="token key atrule">default-filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CustomCorsFilter <span class="token comment"># 配置过滤器生效,不可缺少</span></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//192.168.125.224<span class="token punctuation">:</span>8761/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//192.168.125.225<span class="token punctuation">:</span>8761/eureka/</span>
<span class="line"><span class="token key atrule">logging</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">level</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">root</span><span class="token punctuation">:</span> info</span>
<span class="line">spring.cloud.gateway.discovery.locator.predicates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.name<span class="token punctuation">:</span> Path</span>
<span class="line">spring.cloud.gateway.discovery.locator.predicates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>pattern<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;/&#39;+serviceId+&#39;/**&#39;&quot;</span></span>
<span class="line">spring.cloud.gateway.discovery.locator.predicates<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.name<span class="token punctuation">:</span> Host</span>
<span class="line">spring.cloud.gateway.discovery.locator.predicates<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>pattern<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;**.foo.com&#39;&quot;</span></span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.name<span class="token punctuation">:</span> CircuitBreaker</span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">:</span> serviceId</span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>fallbackUri<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;forward:/demo/&#39;+serviceId&quot;</span></span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.name<span class="token punctuation">:</span> RewritePath</span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>regexp<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;/&#39; + serviceId + &#39;/?(?&lt;remaining&gt;.*)&#39;&quot;</span></span>
<span class="line">spring.cloud.gateway.discovery.locator.filters<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.args<span class="token punctuation">[</span>replacement<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;/${remaining}&#39;&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_15-actuator-api" tabindex="-1"><a class="header-anchor" href="#_15-actuator-api"><span>15.Actuator API</span></a></h2><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">management.endpoint.gateway.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true # default value</span></span>
<span class="line"><span class="token key attr-name">management.endpoints.web.exposure.include</span><span class="token punctuation">=</span><span class="token value attr-value">gateway</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myRoute</span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//httpbin.org/get</span>
<span class="line">          <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> Path=/get/<span class="token important">**</span></span>
<span class="line">      <span class="token key atrule">metrics</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>simple</span>
<span class="line"><span class="token key atrule">management</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">web</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">exposure</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;metrics&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gateway&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;actuator&quot;</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">metrics</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">export</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">prometheus</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-1-route查询" tabindex="-1"><a class="header-anchor" href="#_15-1-route查询"><span>15.1.route查询</span></a></h3><p>/actuator/gateway/routes</p><p>org.springframework.cloud.gateway.actuate.GatewayLegacyControllerEndpoint</p><p>org.springframework.cloud.gateway.actuate.GatewayControllerEndpoint</p><p>类中可以查询哪些接口可以调用。</p><figure><img src="http://47.101.155.205/image-20240823163048254.png" alt="image-20240823163048254" tabindex="0" loading="lazy"><figcaption>image-20240823163048254</figcaption></figure><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">spring.cloud.gateway.actuator.verbose.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240823163726862.png" alt="image-20240823163726862" tabindex="0" loading="lazy"><figcaption>image-20240823163726862</figcaption></figure><figure><img src="http://47.101.155.205/image-20240823163632878.png" alt="image-20240823163632878" tabindex="0" loading="lazy"><figcaption>image-20240823163632878</figcaption></figure><h3 id="_15-2-检索过滤器" tabindex="-1"><a class="header-anchor" href="#_15-2-检索过滤器"><span>15.2.检索过滤器</span></a></h3><h4 id="_15-2-1-全局过滤器" tabindex="-1"><a class="header-anchor" href="#_15-2-1-全局过滤器"><span>15.2.1.全局过滤器</span></a></h4><p>/actuator/gateway/globalfilters显示作用于所有routes的</p><p>过滤器的toStirng方法，getOrder返回值。</p><figure><img src="http://47.101.155.205/image-20240823164804225.png" alt="image-20240823164804225" tabindex="0" loading="lazy"><figcaption>image-20240823164804225</figcaption></figure><h4 id="_15-2-2-路由过滤器" tabindex="-1"><a class="header-anchor" href="#_15-2-2-路由过滤器"><span>15.2.2.路由过滤器</span></a></h4><p>/actuator/gateway/routefilters显示所有GatewayFilter工厂对象，这些过滤器可以作用于特定的路由。</p><figure><img src="http://47.101.155.205/image-20240823165827192.png" alt="image-20240823165827192" tabindex="0" loading="lazy"><figcaption>image-20240823165827192</figcaption></figure><h3 id="_15-3-刷新路由缓存" tabindex="-1"><a class="header-anchor" href="#_15-3-刷新路由缓存"><span>15.3.刷新路由缓存</span></a></h3><p>Post：/actuator/gateway/refresh，没有响应体。</p><h3 id="_15-4-查询定义的所有路由信息" tabindex="-1"><a class="header-anchor" href="#_15-4-查询定义的所有路由信息"><span>15.4.查询定义的所有路由信息</span></a></h3><figure><img src="http://47.101.155.205/image-20240823170603505.png" alt="image-20240823170603505" tabindex="0" loading="lazy"><figcaption>image-20240823170603505</figcaption></figure><p>spring.cloud.gateway.actuator.verbose.enabled=false的效果如下</p><figure><img src="http://47.101.155.205/image-20240823171925548.png" alt="image-20240823171925548" tabindex="0" loading="lazy"><figcaption>image-20240823171925548</figcaption></figure><p>上面的json格式是因为使用配置创建的路由，接口创建路由以下面json格式为准。</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;first_route&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;predicates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Path&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;_genkey_0&quot;</span><span class="token operator">:</span><span class="token string">&quot;/first&quot;</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://www.uri-destination.org&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-5-查询特定路由的信息" tabindex="-1"><a class="header-anchor" href="#_15-5-查询特定路由的信息"><span>15.5.查询特定路由的信息</span></a></h3><p>/actuator/gateway/routes/{route_id}</p><figure><img src="http://47.101.155.205/image-20240823170958270.png" alt="image-20240823170958270" tabindex="0" loading="lazy"><figcaption>image-20240823170958270</figcaption></figure><h3 id="_15-6-创建-删除特定路由" tabindex="-1"><a class="header-anchor" href="#_15-6-创建-删除特定路由"><span>15.6.创建/删除特定路由</span></a></h3><p>POST：/actuator/gateway/routes/{route_id}，请求体为JSON，以spring.cloud.gateway.actuator.verbose.enabled=false的查询路由信息Json格式为准；</p><p>DELETE：/actuator/gateway/routes/{route_id}，删除路由；</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;route_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;delay&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;route_definition&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;delay&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;predicates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Path&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token property">&quot;_genkey_0&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/delay/**&quot;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://httpbin.org/&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;metadata&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://47.101.155.205/image-20240823172541915.png" alt="image-20240823172541915" tabindex="0" loading="lazy"><figcaption>image-20240823172541915</figcaption></figure><figure><img src="http://47.101.155.205/image-20240823173110791.png" alt="image-20240823173110791" tabindex="0" loading="lazy"><figcaption>image-20240823173110791</figcaption></figure><h3 id="_15-7-所有端点接口" tabindex="-1"><a class="header-anchor" href="#_15-7-所有端点接口"><span>15.7.所有端点接口</span></a></h3><figure><img src="http://47.101.155.205/image-20240823171515170.png" alt="image-20240823171515170" tabindex="0" loading="lazy"><figcaption>image-20240823171515170</figcaption></figure><h3 id="_15-8-在多个网关共享路由" tabindex="-1"><a class="header-anchor" href="#_15-8-在多个网关共享路由"><span>15.8.在多个网关共享路由</span></a></h3><p>spring cloud gateway提供两个RouteDefinitionRepository(路由定义仓库)的实现类。一个是InMemoryRouteDefinitionRepository，仅保存在gateway的内存中，这个类型不能实现跨多个网关实例填充路由。</p><p>在gateway集群中共享路由，RedisRouteDefinitionRepository可以实现。开启这个功能，需要开启spring.cloud.gateway.redis-route-definition-repository.enabled=true。引入spring-boot-starter-data-redis-reactive依赖。</p><p>redis中的key有格式要求routedefinition_。</p><figure><img src="http://47.101.155.205/image-20240826135121656.png" alt="image-20240826135121656" tabindex="0" loading="lazy"><figcaption>image-20240826135121656</figcaption></figure><h2 id="_16-故障排除" tabindex="-1"><a class="header-anchor" href="#_16-故障排除"><span>16.故障排除</span></a></h2><h3 id="_16-1-日志级别" tabindex="-1"><a class="header-anchor" href="#_16-1-日志级别"><span>16.1.日志级别</span></a></h3><p>DEBUG和TRACE的日志级别消息，以下的包中，包含一个可用信息：</p><ol><li>org.springframework.cloud.gateway</li><li>org.springframework.http.server.reactive</li><li>org.springframework.web.reactive</li><li>org.springframework.boot.autoconfigure.web</li><li>reactor.netty</li><li>redisratelimiter</li></ol><h3 id="_16-2-窃听请求-响应" tabindex="-1"><a class="header-anchor" href="#_16-2-窃听请求-响应"><span>16.2.窃听请求/响应</span></a></h3><p>reactor.netty的日志级别设为DEBUG/TRACE，能够记录发送/接收的请求体和请求头。</p><p>启用功能需要有以下配置。</p><div class="language-properties" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">spring.cloud.gateway.httpserver.wiretap</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"><span class="token key attr-name">spring.cloud.gateway.httpclient.wiretap</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><figure><img src="http://47.101.155.205/image-20240826151107962.png" alt="image-20240826151107962" tabindex="0" loading="lazy"><figcaption>image-20240826151107962</figcaption></figure><h2 id="_17-开发指南" tabindex="-1"><a class="header-anchor" href="#_17-开发指南"><span>17.开发指南</span></a></h2><h3 id="_17-1-自定义路由断言工厂" tabindex="-1"><a class="header-anchor" href="#_17-1-自定义路由断言工厂"><span>17.1.自定义路由断言工厂</span></a></h3><p>实现RoutePredicateFactory接口，将对象作为Bean注入在容器中。也可以基于抽象类AbstractRoutePredicateFactory扩展。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springcloudgatewaysimple<span class="token punctuation">.</span>predicate</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>predicate<span class="token punctuation">.</span></span><span class="token class-name">AbstractRoutePredicateFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>style<span class="token punctuation">.</span></span><span class="token class-name">ToStringCreator</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpRequest</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Predicate</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token keyword">@author</span> ouyangcm</span>
<span class="line"> * create 2024/8/26 15:30</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRoutePredicateFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRoutePredicateFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">MATCH_TRAILING_SLASH</span> <span class="token operator">=</span> <span class="token string">&quot;matchTrailingSlash&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">MyRoutePredicateFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerWebExchange</span><span class="token punctuation">&gt;</span></span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 获取配置判断是否route</span></span>
<span class="line">        <span class="token keyword">return</span> exchange <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 获取请求的信息</span></span>
<span class="line">            <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 后续做判断 请求是否和配置的信息匹配</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 把配置过滤的信息配置在这里</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> patterns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//</span></span>
<span class="line">        <span class="token keyword">private</span> <span class="token keyword">boolean</span> matchTrailingSlash <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPatterns</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> patterns<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span> <span class="token function">setPatterns</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> patterns<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>patterns <span class="token operator">=</span> patterns<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isMatchTrailingSlash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> matchTrailingSlash<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span> <span class="token function">setMatchTrailingSlash</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> matchTrailingSlash<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>matchTrailingSlash <span class="token operator">=</span> matchTrailingSlash<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token annotation punctuation">@Override</span></span>
<span class="line">        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ToStringCreator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;patterns&quot;</span><span class="token punctuation">,</span> patterns<span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">MATCH_TRAILING_SLASH</span><span class="token punctuation">,</span> matchTrailingSlash<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-2-自定义过滤器工厂" tabindex="-1"><a class="header-anchor" href="#_17-2-自定义过滤器工厂"><span>17.2.自定义过滤器工厂</span></a></h3><p>实现GatewayFilterFactory接口，作为Bean注入在容器中。可以继承抽象类AbstractGatewayFilterFactory实现。</p><p>建议定义的类名以GatewayFilterFactory结尾，引用过滤器则使用GatewayFilterFactory之前的作为过滤器名称。也可以不按这个规则使用，后续可能会不支持。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springcloudgatewaysimple<span class="token punctuation">.</span>filter<span class="token punctuation">.</span>facotry</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">AbstractGatewayFilterFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpRequest</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 前置过滤器</span>
<span class="line"> * <span class="token keyword">@author</span> ouyangcm</span>
<span class="line"> * create 2024/8/27 15:27</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PreGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">PreGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// grab configuration from Config object</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// If you want to build a &quot;pre&quot; filter you need to manipulate the request before calling chain.filter</span></span>
<span class="line">            <span class="token comment">// 在chain.filter之前执行代码的是前置过滤器</span></span>
<span class="line">            <span class="token class-name">ServerHttpRequest<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//use builder to manipulate the request</span></span>
<span class="line">            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 存放定义过滤器的配置属性内容</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springcloudgatewaysimple<span class="token punctuation">.</span>filter<span class="token punctuation">.</span>facotry</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">AbstractGatewayFilterFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpResponse</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 后置过滤器</span>
<span class="line"> * <span class="token keyword">@author</span> ouyangcm</span>
<span class="line"> * create 2024/8/27 15:33</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PostGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">PostGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// grab configuration from Config object</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// chain.filter(exchange)之后执行的是后置过滤器</span></span>
<span class="line">            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//Manipulate the response in some way</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//放定义过滤器的属性</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_17-2-1网关拒绝请求" tabindex="-1"><a class="header-anchor" href="#_17-2-1网关拒绝请求"><span>17.2.1网关拒绝请求</span></a></h4><figure><img src="http://47.101.155.205/image-20240827165407346.png" alt="image-20240827165407346" tabindex="0" loading="lazy"><figcaption>image-20240827165407346</figcaption></figure><h3 id="_17-3-自定义全局过滤器" tabindex="-1"><a class="header-anchor" href="#_17-3-自定义全局过滤器"><span>17.3.自定义全局过滤器</span></a></h3><p>实现GlobalFilter接口，并作为Bean注入到容器中。</p><h4 id="_17-3-1" tabindex="-1"><a class="header-anchor" href="#_17-3-1"><span>17.3.1</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springcloudgatewaysimple<span class="token punctuation">.</span>filter</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">LogFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GlobalFilter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token keyword">@author</span> ouyangcm</span>
<span class="line"> * create 2024/8/16 9:20</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGlobalFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">Log</span> log <span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">InetSocketAddress</span> remoteAddress <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>remoteAddress <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;custom global filter, address: &quot;</span> <span class="token operator">+</span> remoteAddress<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, port: &quot;</span> <span class="token operator">+</span> remoteAddress<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;custom global filter, remoteAddress is null&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_17-3-2" tabindex="-1"><a class="header-anchor" href="#_17-3-2"><span>17.3.2</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">GlobalFilter</span> <span class="token function">customGlobalFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> exchange<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Principal</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">defaultIfEmpty</span><span class="token punctuation">(</span><span class="token string">&quot;Default User&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>userName <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">//adds header to proxied request</span></span>
<span class="line">          exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;CUSTOM-REQUEST-HEADER&quot;</span><span class="token punctuation">,</span> userName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">return</span> exchange<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>chain<span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">GlobalFilter</span> <span class="token function">customGlobalPostFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>serverWebExchange <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">//adds header to response</span></span>
<span class="line">          serverWebExchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;CUSTOM-RESPONSE-HEADER&quot;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>serverWebExchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;It worked&quot;</span><span class="token operator">:</span> <span class="token string">&quot;It did not work&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">return</span> serverWebExchange<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_18-不使用配置构建gateway" tabindex="-1"><a class="header-anchor" href="#_18-不使用配置构建gateway"><span>18.不使用配置构建gateway</span></a></h2><p>引入spring-cloud-gateway-mvc或spring-cloud-gateway-webflux的依赖</p><div class="language-xml" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token comment">&lt;!-- spring-cloud-gateway-webflux 依赖 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-gateway-webflux<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>gateway作为一个controller处理请求，使用ProxyExchange对请求进行后续处理。转发请求到下游之前，添加请求参数，请求头添加参数等。</p><p>默认情况下支持cookie和authorization的请求头，但是不支持<code>x-forwarded-*</code>代理相关的请求头。</p><figure><img src="http://47.101.155.205/image-20240827161954748.png" alt="image-20240827161954748" tabindex="0" loading="lazy"><figcaption>image-20240827161954748</figcaption></figure><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springcloudgatewaysimple</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springcloudgatewaysimple<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">UriConfiguration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">EnableConfigurationProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>webflux<span class="token punctuation">.</span></span><span class="token class-name">ProxyExchange</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ResponseEntity</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">UriConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringCloudGatewaySimpleApplication</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringCloudGatewaySimpleApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${remote.home:http://httpbin.org}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token operator">&lt;</span><span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token class-name">ProxyExchange</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> proxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> proxy<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>host<span class="token operator">+</span> <span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_19-其他配置项介绍" tabindex="-1"><a class="header-anchor" href="#_19-其他配置项介绍"><span>19.其他配置项介绍</span></a></h2><p>https://docs.spring.io/spring-cloud-gateway/docs/3.1.0/reference/html/appendix.html</p><h2 id="_20-搭配nacos服务发现" tabindex="-1"><a class="header-anchor" href="#_20-搭配nacos服务发现"><span>20.搭配nacos服务发现</span></a></h2><p>404状态码，服务未注册在nacos中。</p><p>500状态码，服务注册在nacos中，但是停止了。</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="http://github.com/FirstBloodForJava/vuepress-blog/edit/main/docs/springcloud/gateway/spring-cloud-gateway.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: mingorg@163.com">ouyangcm</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 1164864987@qq.com">oycm</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/vuepress-blog/assets/app-BIGZvh4f.js" defer></script>
  </body>
</html>
